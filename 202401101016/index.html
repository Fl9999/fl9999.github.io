<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16-next.png">
  <link rel="mask-icon" href="../images/logo.svg" color="#222">

<link rel="stylesheet" href="../css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"csms.tech","root":"/","images":"../images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"../search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="../js/config.js"></script>

    <meta name="description" content="环境信息 Kubernetes 1.29  kubeadm 初始化集群Network setup组件的 advertise IP 地址选择Kubernetes 中的组件（如 Kubeadm、Kube-apiserver 等）在初始化启动时，都需要在节点（主机）上找到一个合适的 IP 作为组件的 advertising&#x2F;listening 的地址。[1] 默认情况下，此 IP 是主机上默认">
<meta property="og:type" content="article">
<meta property="og:title" content="kubernetes 理论知识点汇总">
<meta property="og:url" content="http://csms.tech/202401101016/index.html">
<meta property="og:site_name" content="L B T">
<meta property="og:description" content="环境信息 Kubernetes 1.29  kubeadm 初始化集群Network setup组件的 advertise IP 地址选择Kubernetes 中的组件（如 Kubeadm、Kube-apiserver 等）在初始化启动时，都需要在节点（主机）上找到一个合适的 IP 作为组件的 advertising&#x2F;listening 的地址。[1] 默认情况下，此 IP 是主机上默认">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-01-10T02:17:01.000Z">
<meta property="article:modified_time" content="2024-02-13T02:50:33.000Z">
<meta property="article:author" content="COSMOS">
<meta property="article:tag" content="Kubernetes">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://csms.tech/202401101016/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://csms.tech/202401101016/","path":"202401101016/","title":"kubernetes 理论知识点汇总"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>kubernetes 理论知识点汇总 | L B T</title>
  








  <noscript>
    <link rel="stylesheet" href="../css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">L B T</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记 录 过 去 的 经 验</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="../index.html" rel="section"><i class="fa fa-earth-americas fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="../categories/" rel="section"><i class="fa fa-folder-tree fa-fw"></i>总目录<span class="badge">51</span></a></li><li class="menu-item menu-item-linux"><a href="../categories/Linux" rel="section"><i class="fa fa-brands fa-linux fa-fw"></i>Linux</a></li><li class="menu-item menu-item-python"><a href="../categories/Python" rel="section"><i class="fa fa-brands fa-python fa-fw"></i>Python</a></li><li class="menu-item menu-item-docker"><a href="../categories/Docker" rel="section"><i class="fa fa-brands fa-docker fa-fw"></i>Docker</a></li><li class="menu-item menu-item-kubernetes"><a href="../categories/Kubernetes" rel="section"><i class="fa fa-dharmachakra fa-fw"></i>Kubernetes</a></li><li class="menu-item menu-item-tags"><a href="../tags/" rel="section"><i class="fa fa-tornado fa-fw"></i>标签<span class="badge">79</span></a></li><li class="menu-item menu-item-archives"><a href="../archives/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>列表<span class="badge">250</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章总目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF"><span class="nav-number">1.</span> <span class="nav-text">环境信息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#kubeadm-%E5%88%9D%E5%A7%8B%E5%8C%96%E9%9B%86%E7%BE%A4"><span class="nav-number">2.</span> <span class="nav-text">kubeadm 初始化集群</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Network-setup"><span class="nav-number">2.1.</span> <span class="nav-text">Network setup</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6%E7%9A%84-advertise-IP-%E5%9C%B0%E5%9D%80%E9%80%89%E6%8B%A9"><span class="nav-number">2.1.1.</span> <span class="nav-text">组件的 advertise IP 地址选择</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-%E7%BD%91%E6%AE%B5%E9%80%89%E6%8B%A9"><span class="nav-number">2.1.2.</span> <span class="nav-text">Pod 网段选择</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#control-plane-endpoint-%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="nav-number">2.2.</span> <span class="nav-text">control-plane-endpoint 参数说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#admin-conf-%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7"><span class="nav-number">2.3.</span> <span class="nav-text">admin.conf 的重要性</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Node"><span class="nav-number">3.</span> <span class="nav-text">Node</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8A%82%E7%82%B9%E5%90%8D%E7%A7%B0"><span class="nav-number">3.1.</span> <span class="nav-text">节点名称</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E8%8A%82%E7%82%B9%E4%B8%BA%E4%B8%8D%E5%8F%AF%E8%B0%83%E5%BA%A6"><span class="nav-number">3.2.</span> <span class="nav-text">配置节点为不可调度</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Labels-Selectors-Annotations"><span class="nav-number">4.</span> <span class="nav-text">Labels Selectors Annotations</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E9%97%B4%E9%80%9A%E8%AE%AF%E6%B5%81%E9%87%8F%E8%AF%B4%E6%98%8E"><span class="nav-number">5.</span> <span class="nav-text">集群间通讯流量说明</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#API-Server-%E5%88%B0-kubelet"><span class="nav-number">5.1.</span> <span class="nav-text">API Server 到 kubelet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API-Server-%E5%88%B0-nodes-pods-%E5%92%8C-services"><span class="nav-number">5.2.</span> <span class="nav-text">API Server 到 nodes, pods 和 services</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Leases"><span class="nav-number">6.</span> <span class="nav-text">Leases</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#kubelet"><span class="nav-number">7.</span> <span class="nav-text">kubelet</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%B2%E8%A1%8C%E5%92%8C%E5%B9%B6%E8%A1%8C%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="nav-number">7.1.</span> <span class="nav-text">串行和并行拉取镜像</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pod"><span class="nav-number">8.</span> <span class="nav-text">Pod</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Pod-%E7%8A%B6%E6%80%81"><span class="nav-number">8.1.</span> <span class="nav-text">Pod 状态</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-%E4%B8%AD%E7%9A%84%E5%AE%B9%E5%99%A8%E7%9A%84%E7%8A%B6%E6%80%81"><span class="nav-number">8.1.1.</span> <span class="nav-text">Pod 中的容器的状态</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#QoS"><span class="nav-number">9.</span> <span class="nav-text">QoS</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%84%9A%E6%B3%A8"><span class="nav-number">10.</span> <span class="nav-text">脚注</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">COSMOS</p>
  <div class="site-description" itemprop="description">得 能 莫 忘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="../archives/">
          <span class="site-state-item-count">250</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="../categories/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">目录</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="../tags/">
        <span class="site-state-item-count">79</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202401101016/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="kubernetes 理论知识点汇总 | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          kubernetes 理论知识点汇总
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-01-10 10:17:01" itemprop="dateCreated datePublished" datetime="2024-01-10T10:17:01+08:00">2024-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-02-13 10:50:33" itemprop="dateModified" datetime="2024-02-13T10:50:33+08:00">2024-02-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Kubernetes 1.29</li>
</ul>
<h1 id="kubeadm-初始化集群"><a href="#kubeadm-初始化集群" class="headerlink" title="kubeadm 初始化集群"></a>kubeadm 初始化集群</h1><h2 id="Network-setup"><a href="#Network-setup" class="headerlink" title="Network setup"></a>Network setup</h2><h3 id="组件的-advertise-IP-地址选择"><a href="#组件的-advertise-IP-地址选择" class="headerlink" title="组件的 advertise IP 地址选择"></a>组件的 advertise IP 地址选择</h3><p>Kubernetes 中的组件（如 <code>Kubeadm</code>、<code>Kube-apiserver</code> 等）在初始化启动时，都需要在节点（主机）上找到一个合适的 IP 作为组件的 <code>advertising</code>&#x2F;<code>listening</code> 的地址。<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Network setup](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#network-setup)">[1]</span></a></sup></p>
<p>默认情况下，此 IP 是主机上默认路由对应的网卡所在的 IP。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ip route show</span></span><br><span class="line">default via 172.31.16.1 dev eth0 </span><br><span class="line">10.244.1.0/24 via 10.244.1.0 dev flannel.1 onlink </span><br><span class="line">10.244.2.0/24 via 10.244.2.0 dev flannel.1 onlink </span><br><span class="line">10.244.3.0/24 via 10.244.3.0 dev flannel.1 onlink </span><br><span class="line">10.244.4.0/24 via 10.244.4.0 dev flannel.1 onlink </span><br><span class="line">172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 </span><br><span class="line">172.31.16.0/20 dev eth0 proto kernel scope link src 172.31.26.11</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果系统上有多个默认路由，组件会尝试使用第一个默认路由对应的网卡所在的 IP。<strong>如果系统上没有默认路由，并且未明确为组件配置 IP，组件会初始化失败并退出</strong></p>
</blockquote>
<p>组件选择的 IP 地址将会作为 X.509 证书的 SAN(Subject Alternative Name) 的一部分。因此在系统初始化运行之后修改 IP 需要重新签发证书并重启相关组件。</p>
<h3 id="Pod-网段选择"><a href="#Pod-网段选择" class="headerlink" title="Pod 网段选择"></a>Pod 网段选择</h3><p>Pod 的网段必须不能和主机网络重叠，如果选用的网络插件的网络和主机的网段重叠，必须为网络插件选择合适的和主机不同的网段，在集群初始化时通过参数 <code>--pod-network-cidr</code> 配置，并在安装网络插件时在其 YAML 文件中修改为对应的网段。 <sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Installing a Pod network add-on](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#pod-network)">[4]</span></a></sup></p>
<h2 id="control-plane-endpoint-参数说明"><a href="#control-plane-endpoint-参数说明" class="headerlink" title="control-plane-endpoint 参数说明"></a>control-plane-endpoint 参数说明</h2><p><code>--control-plane-endpoint</code> 选项用来配置 <code>api-server</code> 的共享地址，可以是域名或者负载均衡器的 IP。 <sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Initializing your control-plane node](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#initializing-your-control-plane-node)">[2]</span></a></sup></p>
<p><em><strong>如果是单主节点的 Kubernetes 集群，想要扩展成为多个 Master 节点（高可用），初始化时没有 <code>--control-plane-endpoint</code>，是不被支持的。</strong></em></p>
<p>因此为了后期可以由单个 Master 节点扩展为多个 Master 节点，即高可用，初始化节点时，建议加上此选项配置 <code>api-server</code> 的负载均衡地址。 </p>
<p>&lt;– more –&gt;</p>
<h2 id="admin-conf-的重要性"><a href="#admin-conf-的重要性" class="headerlink" title="admin.conf 的重要性"></a>admin.conf 的重要性</h2><p><code>kubeadm init</code> 初始化集群成功后，会产生一个 <code>kubeconfig</code> 文件 <code>/etc/kubernetes/admin.conf</code>，此配置中包含了一个绑定到 <code>cluster-admin</code> 的 ClusterRole 的组，其拥有对整个集群的控制权，<em><strong>不要将其共享给任何人</strong></em>。<sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[admin.conf](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#more-information)">[3]</span></a></sup></p>
<p><code>kubeadm init</code> 初始化集群成功后，同时会生成一个名为 <code>super-admin.conf</code> 的 <code>kubeconfig</code> 文件，其中配置的超级用户可以跳过 <code>authorization layer</code>，比如 RBAC。<em><strong>不要将其共享给任何人</strong></em>。建议将其保存在一个安全的位置。</p>
<h1 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h1><h2 id="节点名称"><a href="#节点名称" class="headerlink" title="节点名称"></a>节点名称</h2><p>在 Kubernetes 集群中，节点名称（Node Name）唯一的标识一个节点。在一个集群中，不能有多个名称一样的节点，<strong>Kubernetes 系统默认同一个 <em>节点名（Node Name）</em> 的实例将具有同样的一个状态和属性</strong> <sup id="fnref:7"><a href="#fn:7" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Node name uniqueness](https://kubernetes.io/docs/concepts/architecture/nodes/#node-name-uniqueness)">[7]</span></a></sup></p>
<h2 id="配置节点为不可调度"><a href="#配置节点为不可调度" class="headerlink" title="配置节点为不可调度"></a>配置节点为不可调度</h2><p>将节点标记为 <strong>不可调度（unschedulable ）</strong> 会阻止系统调度新的 Pod 到节点上，但是不会影响节点上已有的 Pod。</p>
<h1 id="Labels-Selectors-Annotations"><a href="#Labels-Selectors-Annotations" class="headerlink" title="Labels Selectors Annotations"></a>Labels Selectors Annotations</h1><p>Label 主要用来给 Kubernetes 中的对象添加 <em><strong>可识别属性</strong></em>。 Label 可以提供高效的查询和匹配以选择 Kubernetes 中的对象，Lables 可以在对象创建时或者运行过程中随时做变更。</p>
<p><strong>不具有识别属性的信息</strong> 不建议用作 Labels，而是应该写入 Annotations 中。<sup id="fnref:5"><a href="#fn:5" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Labels and Selectors](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)">[5]</span></a></sup></p>
<p>Label Key 由 2 部分构成：</p>
<ul>
<li>（可选的）前缀。系统组件（如 <code>kube-scheduler</code>, <code>kube-controller-manager</code>, <code>kube-apiserver</code>, <code>kubectl</code>） 或者第三方自动化组件为对象添加 labels 时必须带有前缀（prefix）。<code>kubernetes.io/</code> and <code>k8s.io/</code> 是为 Kubernetes 核心系统保留的前缀</li>
<li>（必须的）名字。<blockquote>
<p>Annotations 的 Key 命名规则和 Label Key 基本一致 <sup id="fnref:6"><a href="#fn:6" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Annotations Key Syntax and character set](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/#syntax-and-character-set)">[6]</span></a></sup></p>
</blockquote>
</li>
</ul>
<p><a href="https://csms.tech/202209241108/#标签和选择算符">Label select 用法说明</a></p>
<h1 id="集群间通讯流量说明"><a href="#集群间通讯流量说明" class="headerlink" title="集群间通讯流量说明"></a>集群间通讯流量说明</h1><h2 id="API-Server-到-kubelet"><a href="#API-Server-到-kubelet" class="headerlink" title="API Server 到 kubelet"></a>API Server 到 kubelet</h2><p>API Server 请求 <code>kubelet</code> 的主要目的包括： <sup id="fnref:8"><a href="#fn:8" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[API server to kubelet](https://kubernetes.io/docs/concepts/architecture/control-plane-node-communication/#api-server-to-kubelet)">[8]</span></a></sup></p>
<ul>
<li>获取到 Pods 的日志</li>
<li>（比如使用 <code>kubectl</code>） Attach 到 Pods 中的容器</li>
<li>提供 <code>kubelet</code> 的端口转发功能。</li>
</ul>
<blockquote>
<p> 默认情况下，API 服务器不检查 <code>kubelet</code> 的服务证书。这使得此类连接容易受到中间人攻击， 在非受信网络或公开网络上运行也是 <strong>不安全的</strong>。<br>为了对这个连接进行认证，使用 <code>--kubelet-certificate-authority</code> 标志给 API 服务器提供一个根证书包，用于 <code>kubelet</code> 的服务证书。</p>
</blockquote>
<h2 id="API-Server-到-nodes-pods-和-services"><a href="#API-Server-到-nodes-pods-和-services" class="headerlink" title="API Server 到 nodes, pods 和 services"></a>API Server 到 nodes, pods 和 services</h2><p>从 API 服务器到节点、Pod 或服务的连接默认为纯 HTTP 方式，因此既没有认证，也没有加密。 这些连接可通过给 API URL 中的节点、Pod 或服务名称添加前缀 https: 来运行在安全的 HTTPS 连接上。 不过这些连接既不会验证 HTTPS 末端提供的证书，也不会提供客户端证书。 因此，虽然连接是加密的，仍无法提供任何完整性保证。 这些连接 目前还不能安全地 在非受信网络或公共网络上运行。 <sup id="fnref:8"><a href="#fn:8" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[API server to kubelet](https://kubernetes.io/docs/concepts/architecture/control-plane-node-communication/#api-server-to-kubelet)">[8]</span></a></sup></p>
<p>Kubernetes 支持使用 <a target="_blank" rel="noopener" href="https://www.ssh.com/academy/ssh/tunneling">SSH tunnels</a> 来加密从 API 到 nodes 的链接（目前已经处于废弃状态，推荐使用 <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/architecture/control-plane-node-communication/#konnectivity-service">Konnectivity service</a> 替代）。</p>
<h1 id="Leases"><a href="#Leases" class="headerlink" title="Leases"></a>Leases</h1><p>Kubernetes 使用 Lease API 来更新 <code>kubelet</code> 发送到 Kubernetes API Server 的心跳信息。Kubernetes 中的每一个节点在 <code>kube-node-lease</code> Namespace 中都有一个 <code>Lease</code> Object。<code>kubelet</code> 向系统上报心跳的过程，就是在更新对应的 <code>Lease</code> Object 的 <code>spec.renewTime</code> 字段，Kubernetes 控制平面会使用这个上报的时间戳来决定节点是否可用 <sup id="fnref:9"><a href="#fn:9" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Node heartbeats](https://kubernetes.io/docs/concepts/architecture/leases/#node-heart-beats)">[9]</span></a></sup> </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl describe lease -n kube-node-lease k8s-admin</span></span><br><span class="line">Name:         k8s-node1</span><br><span class="line">Namespace:    kube-node-lease</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line">API Version:  coordination.k8s.io/v1</span><br><span class="line">Kind:         Lease</span><br><span class="line">Metadata:</span><br><span class="line">  Creation Timestamp:  2023-09-07T09:54:15Z</span><br><span class="line">  Managed Fields:</span><br><span class="line">    API Version:  coordination.k8s.io/v1</span><br><span class="line">    Fields Type:  FieldsV1</span><br><span class="line">	...</span><br><span class="line">  Owner References:</span><br><span class="line">    API Version:     v1</span><br><span class="line">    Kind:            Node</span><br><span class="line">    Name:            k8s-node1</span><br><span class="line">    UID:             db3dafee-1232-4c07-a1c6-524f86a96fbe</span><br><span class="line">  Resource Version:  46696081</span><br><span class="line">  UID:               053d9b79-81be-4f3f-801e-09192012c822</span><br><span class="line">Spec:</span><br><span class="line">  Holder Identity:         k8s-node1</span><br><span class="line">  Lease Duration Seconds:  40</span><br><span class="line">  Renew Time:              2024-02-03T02:30:11.760176Z</span><br><span class="line">Events:                    &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p>Leases 也被用来确保 HA 的组件（类似 <code>kube-controller-manager</code> 和 <code>kube-scheduler</code>）在同一时刻只有一个实例提供服务，其他实例处于备用状态 <sup id="fnref:9"><a href="#fn:9" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Node heartbeats](https://kubernetes.io/docs/concepts/architecture/leases/#node-heart-beats)">[9]</span></a></sup></p>
<h1 id="kubelet"><a href="#kubelet" class="headerlink" title="kubelet"></a>kubelet</h1><h2 id="串行和并行拉取镜像"><a href="#串行和并行拉取镜像" class="headerlink" title="串行和并行拉取镜像"></a>串行和并行拉取镜像</h2><p>Kubelet 默认（同一个节点）串行的拉取镜像，即同一时间只发送一个拉取镜像的请求到 Registry Server，其他的拉取镜像的请求保持等待，直到当前请求处理完成。多个节点上的镜像拉取请求是隔离的，即不同的节点在同一时间是并行的拉取镜像的。 <sup id="fnref:10"><a href="#fn:10" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Serial and parallel image pulls](https://kubernetes.io/docs/concepts/containers/images/#serial-and-parallel-image-pulls)">[10]</span></a></sup></p>
<p>如果要配置一个节点上的 Kubelet 并行的拉取镜像，可以在 kubelet 的配置中配置 <code>serializeImagePulls</code> 为 <code>false</code>，前提是 Registry Server 和 CRI 支持并行拉取镜像。  </p>
<h1 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h1><h2 id="Pod-状态"><a href="#Pod-状态" class="headerlink" title="Pod 状态"></a>Pod 状态</h2><p>Pod 的状态字段（<code>status</code>） 是一个 <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.29/#podstatus-v1-core">PodStatus</a> Object。其中包含 <code>phase</code> 字段。<code>phase</code> 字段描述&#x2F;记录了 Pod 在其整个生命周期中所处的阶段 <sup id="fnref:11"><a href="#fn:11" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Pod phase](https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-phase)">[11]</span></a></sup></p>
<p><code>phase</code> 字段可以有以下值：</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>Pending</code></td>
<td>Kubernetes 集群已经接收到创建 Pod 的请求，并且开始调度到节点、下载容器镜像并启动容器，但是有一个或多个容器还未正常运行</td>
</tr>
<tr>
<td><code>Running</code></td>
<td>Pod 已经被调度到某个节点，并且 Pod 中所有的容器已经被创建，至少其中的一个容器已经处于运行状态或重启中</td>
</tr>
<tr>
<td><code>Succeeded</code></td>
<td>Pod 中所有的容器都已经成功终止，并且不会再被重启</td>
</tr>
<tr>
<td><code>Failed</code></td>
<td>Pod 中所有的容器都被终止，但至少有一个容器终止失败，也就是说，容器要么以非零状态码退出或者是被系统终止</td>
</tr>
<tr>
<td><code>Unknow</code></td>
<td>因为某些原因，Pod 的状态获取不到。这个经常发生在和 Pod 运行的节点通信异常时</td>
</tr>
</tbody></table>
<h3 id="Pod-中的容器的状态"><a href="#Pod-中的容器的状态" class="headerlink" title="Pod 中的容器的状态"></a>Pod 中的容器的状态</h3><p>Kubernetes 会跟踪 Pod 中每个容器的状态。一旦通过 Scheduler 将 Pod 分配到某个 Node，Kubernetes 会通过 CRI 创建 Pod 中的容器。</p>
<p>在 Kubernetes 中，容器可以有以下 3 种状态 <sup id="fnref:11"><a href="#fn:11" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Pod phase](https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-phase)">[11]</span></a></sup></p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>Waiting </code></td>
<td>表示容器正在进行必要的操作以正常启动，比如拉取镜像、应用 Secret 数据等。当容器处于此状态时，可以通过 <code>kubectl describe pod</code> 查看输出中对应容器的信息，一般会包含一个 <code>Reason </code> 字段简述 <code>Waiting</code> 的原因</td>
</tr>
<tr>
<td><code>Running</code></td>
<td>表示容器在正常运行</td>
</tr>
<tr>
<td><code>Terminated</code></td>
<td>表示容器运行结束或者因为某些原因失败。详细信息可以通过 <code>kubectl describe pod</code> 查看</td>
</tr>
</tbody></table>
<h1 id="QoS"><a href="#QoS" class="headerlink" title="QoS"></a>QoS</h1><p>Kubernetes 会根据 Pod 定义中的 <code>resource requests and limits</code> 将 Pod 划归到某一个 QoS 类中，Kubernetes 将会根据 QoS 类来决定在节点资源不足的情况下，哪些 Pod 将会被优先驱逐（Evict）。目前存在的 QoS 类主要有以下三个 <sup id="fnref:12"><a href="#fn:12" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Quality of Service](https://kubernetes.io/docs/concepts/workloads/pods/pod-qos/)">[12]</span></a></sup></p>
<table>
<thead>
<tr>
<th>QoS Class</th>
<th>说明</th>
<th>被驱逐权重</th>
</tr>
</thead>
<tbody><tr>
<td><code>Guaranteed</code></td>
<td>Pod 中的 <strong>每个容器必须定义</strong> CPU &amp; Mem <code>request</code> 和 <code>limit</code>，并且 <code>request</code> 的值等于 <code>limit</code> 的值，确保系统会预留定义的资源给 Pod 和其中的容器</td>
<td>最后被驱逐</td>
</tr>
<tr>
<td><code>Burstable</code></td>
<td>Pod 中 <strong>至少有一个容器定义了</strong> CPU <em><strong>或</strong></em> Mem 的 <code>request</code>。可以不定义 <code>limit</code>， <strong>如果未定义 <code>limit</code>，默认可以使用节点上所有可用的资源</strong>。</td>
<td>中间级别</td>
</tr>
<tr>
<td><code>BestEffort</code></td>
<td>未定义任何 CPU <em><strong>或</strong></em> Mem 的 <code>request</code> 或   <code>limit</code></td>
<td>最先被驱逐</td>
</tr>
</tbody></table>
<blockquote>
<p>Memory QoS 基于系统内核的 cgroup v2 实现 <sup id="fnref:12"><a href="#fn:12" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Quality of Service](https://kubernetes.io/docs/concepts/workloads/pods/pod-qos/)">[12]</span></a></sup></p>
<p>Pod 中如果有个容器因为 Limit 被 kill，系统只会 kill 掉这一个容器并重启之，不会影响其他容器</p>
</blockquote>
<h1 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#network-setup">Network setup</a><a href="#fnref:1" rev="footnote"> ↩</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#initializing-your-control-plane-node">Initializing your control-plane node</a><a href="#fnref:2" rev="footnote"> ↩</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#more-information">admin.conf</a><a href="#fnref:3" rev="footnote"> ↩</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#pod-network">Installing a Pod network add-on</a><a href="#fnref:4" rev="footnote"> ↩</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">Labels and Selectors</a><a href="#fnref:5" rev="footnote"> ↩</a></span></li><li id="fn:6"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">6.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/#syntax-and-character-set">Annotations Key Syntax and character set</a><a href="#fnref:6" rev="footnote"> ↩</a></span></li><li id="fn:7"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">7.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/architecture/nodes/#node-name-uniqueness">Node name uniqueness</a><a href="#fnref:7" rev="footnote"> ↩</a></span></li><li id="fn:8"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">8.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/architecture/control-plane-node-communication/#api-server-to-kubelet">API server to kubelet</a><a href="#fnref:8" rev="footnote"> ↩</a></span></li><li id="fn:9"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">9.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/architecture/leases/#node-heart-beats">Node heartbeats</a><a href="#fnref:9" rev="footnote"> ↩</a></span></li><li id="fn:10"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">10.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/containers/images/#serial-and-parallel-image-pulls">Serial and parallel image pulls</a><a href="#fnref:10" rev="footnote"> ↩</a></span></li><li id="fn:11"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">11.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-phase">Pod phase</a><a href="#fnref:11" rev="footnote"> ↩</a></span></li><li id="fn:12"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">12.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/workloads/pods/pod-qos/">Quality of Service</a><a href="#fnref:12" rev="footnote"> ↩</a></span></li></ol></div></div>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="../tags/Kubernetes/" rel="tag"><i class="fa fa-tag"></i> Kubernetes</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="../202312151503/" rel="prev" title="ELK 常见错误">
                  <i class="fa fa-chevron-left"></i> ELK 常见错误
                </a>
            </div>
            <div class="post-nav-item">
                <a href="../202401171333/" rel="next" title="和田玉知识归纳">
                  和田玉知识归纳 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">COSMOS</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.3" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="../js/comments.js"></script><script src="../js/utils.js"></script><script src="../js/motion.js"></script><script src="../js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="../js/third-party/search/local-search.js"></script>




  <script src="../js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"fl9999","repo":"fl9999.github.io","client_id":"a11bf6f7860762b725b5","client_secret":"a99046105f8bddc72ec718d54dc3fd7f22070821","admin_user":"fl9999","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d41d8cd98f00b204e9800998ecf8427e"}</script>
<script src="../js/third-party/comments/gitalk.js"></script>

</body>
</html>
