<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16-next.png">
  <link rel="mask-icon" href="../images/logo.svg" color="#222">

<link rel="stylesheet" href="../css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"csms.tech","root":"/","images":"../images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"../search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="../js/config.js"></script>

    <meta name="description" content="环境信息 Centos 7 kernel 5.4.221  启动过程在 systemd 管理的系统中，提供了工具 systemd-analyze 用于分析具体的启动过程，使用 systemd-analyze --help 查看使用帮助 检查系统启动时间使用 systemd-analyze 命令会显示系统启动所用的时间，等同于 systemd-analyze time # systemd-analy">
<meta property="og:type" content="article">
<meta property="og:title" content="linux 系统状态查看">
<meta property="og:url" content="http://csms.tech/202301171137/index.html">
<meta property="og:site_name" content="L B T">
<meta property="og:description" content="环境信息 Centos 7 kernel 5.4.221  启动过程在 systemd 管理的系统中，提供了工具 systemd-analyze 用于分析具体的启动过程，使用 systemd-analyze --help 查看使用帮助 检查系统启动时间使用 systemd-analyze 命令会显示系统启动所用的时间，等同于 systemd-analyze time # systemd-analy">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.csms.tech/img_278.png">
<meta property="article:published_time" content="2023-01-17T03:37:49.000Z">
<meta property="article:modified_time" content="2024-11-20T02:11:00.000Z">
<meta property="article:author" content="COSMOS">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.csms.tech/img_278.png">


<link rel="canonical" href="http://csms.tech/202301171137/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://csms.tech/202301171137/","path":"202301171137/","title":"linux 系统状态查看"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>linux 系统状态查看 | L B T</title>
  








  <noscript>
    <link rel="stylesheet" href="../css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">L B T</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记 录 过 去 的 经 验</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="../index.html" rel="section"><i class="fa fa-earth-americas fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="../categories/" rel="section"><i class="fa fa-folder-tree fa-fw"></i>总目录<span class="badge">51</span></a></li><li class="menu-item menu-item-linux"><a href="../categories/Linux" rel="section"><i class="fa fa-brands fa-linux fa-fw"></i>Linux</a></li><li class="menu-item menu-item-python"><a href="../categories/Python" rel="section"><i class="fa fa-brands fa-python fa-fw"></i>Python</a></li><li class="menu-item menu-item-docker"><a href="../categories/Docker" rel="section"><i class="fa fa-brands fa-docker fa-fw"></i>Docker</a></li><li class="menu-item menu-item-kubernetes"><a href="../categories/Kubernetes" rel="section"><i class="fa fa-dharmachakra fa-fw"></i>Kubernetes</a></li><li class="menu-item menu-item-tags"><a href="../tags/" rel="section"><i class="fa fa-tornado fa-fw"></i>标签<span class="badge">78</span></a></li><li class="menu-item menu-item-archives"><a href="../archives/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>列表<span class="badge">243</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章总目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF"><span class="nav-number">1.</span> <span class="nav-text">环境信息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">2.</span> <span class="nav-text">启动过程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E6%97%B6%E9%97%B4"><span class="nav-number">2.1.</span> <span class="nav-text">检查系统启动时间</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%86%85%E5%AD%98%E4%BF%A1%E6%81%AF"><span class="nav-number">3.</span> <span class="nav-text">查看内存信息</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E9%87%8F%E7%BB%9F%E8%AE%A1"><span class="nav-number">3.1.</span> <span class="nav-text">系统内存使用量统计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#free"><span class="nav-number">3.1.1.</span> <span class="nav-text">free</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ps"><span class="nav-number">3.1.2.</span> <span class="nav-text">ps</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sar-%E5%91%BD%E4%BB%A4"><span class="nav-number">3.1.3.</span> <span class="nav-text">sar 命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%9F%90%E4%B8%AA%E8%BF%9B%E7%A8%8B%E4%BD%BF%E7%94%A8%E7%9A%84%E5%86%85%E5%AD%98%E9%87%8F"><span class="nav-number">3.2.</span> <span class="nav-text">查看某个进程使用的内存量</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sar-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95%E5%8F%82%E8%80%83"><span class="nav-number">4.</span> <span class="nav-text">sar 命令用法参考</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#sar-%E6%A3%80%E6%9F%A5%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AD%98%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE"><span class="nav-number">4.1.</span> <span class="nav-text">sar 检查系统内存统计数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sar-%E6%A3%80%E6%9F%A5%E7%B3%BB%E7%BB%9F-CPU-%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE"><span class="nav-number">4.2.</span> <span class="nav-text">sar 检查系统 CPU 统计数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CPU-%E6%95%B4%E4%BD%93%E4%BD%BF%E7%94%A8%E7%8E%87%E6%83%85%E5%86%B5%E7%BB%9F%E8%AE%A1"><span class="nav-number">4.2.1.</span> <span class="nav-text">CPU 整体使用率情况统计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E8%B4%9F%E8%BD%BD%E7%9B%B8%E5%85%B3%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE"><span class="nav-number">4.2.2.</span> <span class="nav-text">系统负载相关统计数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sar-%E6%A3%80%E6%9F%A5%E7%B3%BB%E7%BB%9F-IO-%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE"><span class="nav-number">4.3.</span> <span class="nav-text">sar 检查系统 IO 统计数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sar-%E7%BB%9F%E8%AE%A1%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99%E6%83%85%E5%86%B5"><span class="nav-number">4.4.</span> <span class="nav-text">sar 统计磁盘读写情况</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sar-%E7%BB%9F%E8%AE%A1%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%88%86%E5%8C%BA%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5"><span class="nav-number">4.5.</span> <span class="nav-text">sar 统计文件系统分区使用情况</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sar-%E7%BB%9F%E8%AE%A1%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE"><span class="nav-number">4.6.</span> <span class="nav-text">sar 统计网络数据</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SysRq"><span class="nav-number">5.</span> <span class="nav-text">SysRq</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">COSMOS</p>
  <div class="site-description" itemprop="description">得 能 莫 忘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="../archives/">
          <span class="site-state-item-count">243</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="../categories/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">目录</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="../tags/">
        <span class="site-state-item-count">78</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202301171137/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="linux 系统状态查看 | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          linux 系统状态查看
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-17 11:37:49" itemprop="dateCreated datePublished" datetime="2023-01-17T11:37:49+08:00">2023-01-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-20 10:11:00" itemprop="dateModified" datetime="2024-11-20T10:11:00+08:00">2024-11-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos 7 kernel 5.4.221</li>
</ul>
<h1 id="启动过程"><a href="#启动过程" class="headerlink" title="启动过程"></a>启动过程</h1><p>在 <code>systemd</code> 管理的系统中，提供了工具 <code>systemd-analyze</code> 用于分析具体的启动过程，使用 <code>systemd-analyze --help</code> 查看使用帮助</p>
<h2 id="检查系统启动时间"><a href="#检查系统启动时间" class="headerlink" title="检查系统启动时间"></a>检查系统启动时间</h2><p>使用 <code>systemd-analyze</code> 命令会显示系统启动所用的时间，等同于 <code>systemd-analyze time</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemd-analyze</span> </span><br><span class="line">Startup finished in 1.830s (kernel) + 36.827s (userspace) = 38.657s </span><br><span class="line">graphical.target reached after 12.604s in userspace</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>systemd-analyze blame</code> 列出系统上各个 Unit 启动的时间</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemd-analyze blame</span></span><br><span class="line">          6.414s wazuh-agent.service</span><br><span class="line">          3.161s dracut-initqueue.service</span><br><span class="line">          2.473s network.service</span><br><span class="line">          1.004s watchdog.service</span><br><span class="line">          ...</span><br><span class="line">            45ms sysstat.service</span><br><span class="line">            14ms plymouth-switch-root.service</span><br><span class="line">            14ms systemd-journald.service</span><br><span class="line">             4ms systemd-logind.service</span><br><span class="line">             3ms sys-kernel-config.mount</span><br><span class="line">             3ms initrd-udevadm-cleanup-db.service</span><br><span class="line">             3ms systemd-random-seed.service</span><br><span class="line">             2ms google-shutdown-scripts.service</span><br></pre></td></tr></table></figure>

<p><strong>列出系统各个 Unit 启动消耗的时间</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemd-analyze critical-chain</span></span><br><span class="line">The time when unit became active or started is printed after the &quot;@&quot; character.</span><br><span class="line">The time the unit took to start is printed after the &quot;+&quot; character.</span><br><span class="line"></span><br><span class="line">graphical.target @12.604s</span><br><span class="line">└─multi-user.target @12.601s</span><br><span class="line">  └─skylight-agent.service @36.639s</span><br><span class="line">    └─network.target @9.073s</span><br><span class="line">      └─NetworkManager.service @8.795s +275ms</span><br><span class="line">        └─dbus.service @8.788s</span><br><span class="line">          └─basic.target @8.774s</span><br><span class="line">            └─sockets.target @8.772s</span><br><span class="line">              └─snapd.socket @8.766s +5ms</span><br><span class="line">                └─sysinit.target @8.669s</span><br><span class="line">                  └─cloud-init.service @6.850s +1.811s</span><br><span class="line">                    └─systemd-networkd-wait-online.service @4.970s +1.871s</span><br><span class="line">                      └─systemd-networkd.service @4.864s +91ms</span><br><span class="line">                        └─network-pre.target @4.850s</span><br><span class="line">                          └─cloud-init-local.service @3.228s +1.620s</span><br><span class="line">                            └─systemd-remount-fs.service @1.113s +93ms</span><br><span class="line">                              └─systemd-fsck-root.service @1.030s +69ms</span><br><span class="line">                                └─systemd-journald.socket @853ms</span><br><span class="line">                                  └─-.mount @692ms</span><br><span class="line">                                    └─-.slice @692ms</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="查看内存信息"><a href="#查看内存信息" class="headerlink" title="查看内存信息"></a>查看内存信息</h1><p>内存相关概念说明：</p>
<ul>
<li><strong>VSS ,Virtual Set Size , VIRT</strong> - 虚拟耗用内存（包含共享库占用的内存）， <strong>通常 VIRT 是系统承诺分配给应用的内存，不是实际使用的内存</strong></li>
<li><strong>RSS , Resident Set Size , RES</strong> - 实际使用物理内存（包含共享库占用的内存）</li>
<li><strong>PSS , Proportional Set Size</strong> - 实际使用的物理内存（比例分配共享库占用的内存）。 <strong><code>top</code> 命令中的 <code>SHR</code> 列展示的就是共享库按比例分配给进程的内存</strong></li>
<li><strong>USS , Unique Set Size</strong> - 进程独自占用的物理内存（不包含共享库占用的内存）</li>
</ul>
<h2 id="系统内存使用量统计"><a href="#系统内存使用量统计" class="headerlink" title="系统内存使用量统计"></a>系统内存使用量统计</h2><h3 id="free"><a href="#free" class="headerlink" title="free"></a>free</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">free -h</span></span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            15Gi       7.8Gi       707Mi       449Mi       7.0Gi       6.9Gi</span><br><span class="line">Swap:           30Gi       1.0Gi        29Gi</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h3><p>例如查看使用内存排名前十的进程：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ps aux | sort -k4,4nr | head -n 10</span><br></pre></td></tr></table></figure>

<h3 id="sar-命令"><a href="#sar-命令" class="headerlink" title="sar 命令"></a>sar 命令</h3><p><a href="#sar-%E6%A3%80%E6%9F%A5%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AD%98%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE">使用 <code>sar</code> 命令检查系统上的内存及 Swap 使用情况</a></p>
<h2 id="查看某个进程使用的内存量"><a href="#查看某个进程使用的内存量" class="headerlink" title="查看某个进程使用的内存量"></a>查看某个进程使用的内存量</h2><p>比如检查 <code>docker</code> 使用的内存量，首先通过 <code>ps</code> 命令查询到 <code>docker</code> 的 PID 信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ps -elf | grep docker</span></span><br><span class="line">4 S root      1243     1  4  80   0 - 1067527 futex_ Jan03 ?      15:14:45 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br></pre></td></tr></table></figure>
<p>例如此处的 <code>docker</code> 进程的 PID 为 1243</p>
<ul>
<li><p>使用 <code>top</code> 命令动态查看 <code>docker</code> 使用的内存信息</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">top -p 1243</span></span><br><span class="line">top - 11:47:40 up 14 days,  2:09,  3 users,  load average: 0.65, 1.42, 1.70</span><br><span class="line">Tasks:   1 total,   0 running,   1 sleeping,   0 stopped,   0 zombie</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">Cpu(s):  1.0 us,  0.6 sy,  0.0 ni, 98.3 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span></span><br><span class="line">KiB Mem : 32068748 total,  2494500 free, 18536188 used, 11038060 buff/cache</span><br><span class="line">KiB Swap:        0 total,        0 free,        0 used.  9586340 avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                           </span><br><span class="line"> 1243 root      20   0 4270108   1.4g  53956 S   1.0  4.6 914:55.80 dockerd</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>ps aux</code> 命令查看内存使用量</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ps aux | grep 1243</span></span><br><span class="line">root      1243  4.5  4.6 4270108 1486460 ?     Ssl  Jan03 914:57 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br></pre></td></tr></table></figure>

<p>  输出结果中</p>
<ul>
<li>第 3、4 列 (<code>4.5  4.6</code>) 分别表示 <code>cpu 使用率</code>、<code>内存使用率</code>。</li>
<li>第 5、6 列 (<code>4270108 1486460</code>) 分别表示 <code>虚拟内存使用量</code>、<code>物理内存使用量</code>，单位为 <code>k</code>。</li>
</ul>
</li>
<li><p>通过进程的 <code>status</code> 文件查看内存使用</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> /proc/1243/status</span></span><br><span class="line">Name:	dockerd</span><br><span class="line">Umask:	0022</span><br><span class="line">State:	S (sleeping)</span><br><span class="line">Pid:	1243</span><br><span class="line">PPid:	1</span><br><span class="line">VmPeak:	 4270364 kB</span><br><span class="line">VmSize:	 4270108 kB</span><br><span class="line">VmLck:	       0 kB</span><br><span class="line">VmPin:	       0 kB</span><br><span class="line">VmHWM:	 1562204 kB</span><br><span class="line">VmRSS:	 1492340 kB</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>其中，<code>VmRSS</code> 为进程使用的物理内存</p>
</li>
<li><p>使用 <code>pmap</code> 命令查看进程使用的内存信息</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pmap -x 1243</span><br><span class="line">pmap -p 1243</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>pidstat</code> 命令查看进程使用的内存信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pidstat -r -t -p 1424681 1 1</span></span><br><span class="line">Linux 6.8.0-1017-aws (U-3TSDMAL9IVFAQ) 	11/26/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">04:15:40 PM   UID      TGID       TID  minflt/s  majflt/s     VSZ     RSS   %MEM  Command</span><br><span class="line">04:15:41 PM 408001114   1424681         -      0.00      0.00 34656400  256620   1.59  chrome</span><br><span class="line">04:15:41 PM 408001114         -   1424681      0.00      0.00 34656400  256620   1.59  |__chrome</span><br><span class="line">04:15:41 PM 408001114         -   1424696      0.00      0.00 34656400  256620   1.59  |__sandbox_ipc_thr</span><br><span class="line">04:15:41 PM 408001114         -   1424702      0.00      0.00 34656400  256620   1.59  |__chrome</span><br><span class="line">04:15:41 PM 408001114         -   1424703      0.00      0.00 34656400  256620   1.59  |__HangWatcher</span><br><span class="line">04:15:41 PM 408001114         -   1424704      0.00      0.00 34656400  256620   1.59  |__ThreadPoolServi</span><br><span class="line">04:15:41 PM 408001114         -   1424705      0.00      0.00 34656400  256620   1.59  |__ThreadPoolForeg</span><br><span class="line">04:15:41 PM 408001114         -   1424706      0.00      0.00 34656400  256620   1.59  |__ThreadPoolForeg</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<span id="more"></span></li>
</ul>
<h1 id="sar-命令用法参考"><a href="#sar-命令用法参考" class="headerlink" title="sar 命令用法参考"></a>sar 命令用法参考</h1><p><code>sar</code>（System Activity Reporter）是查看系统上各项活动统计数据的经典工具。他是系统包 <code>sysstat</code> 的一部分，并且依赖于 <code>sysstat.service</code>。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemclt <span class="built_in">enable</span> sysstat</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl start sysstat</span></span><br></pre></td></tr></table></figure>

<p>要查看 <code>sar</code> 命令用法，请参考 <code>sar --help</code> 或者 <code>man sar</code></p>
<p>下图列出了 <code>sar</code> 可以观测的各个部分及其命令行选项<br><img src="https://i.csms.tech/img_278.png"></p>
<p><code>sar</code> 采集系统统计数据依赖于 <code>crond</code> 服务，具体配置可以查看 <code>/etc/cron.d/sysstat</code>，默认每 10 分钟归档一次</p>
<figure class="highlight shell"><figcaption><span>/etc/cron.d/sysstat</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The first element of the path is a directory <span class="built_in">where</span> the debian-sa1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">script is located</span></span><br><span class="line">PATH=/usr/lib/sysstat:/usr/sbin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Activity reports every 10 minutes everyday</span></span><br><span class="line">5-55/10 * * * * root command -v debian-sa1 &gt; /dev/null &amp;&amp; debian-sa1 1 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Additional run at 23:59 to rotate the statistics file</span></span><br><span class="line">59 23 * * * root command -v debian-sa1 &gt; /dev/null &amp;&amp; debian-sa1 60 2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>sar</code> 采集的统计数据默认归档于 <code>/var/log/sysstat/</code> 下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> /var/log/sysstat/</span></span><br><span class="line">sa12  sa13  sa14  sa15	sa16  sa17  sa18  sa19	sa20  sar11  sar12  sar13  sar14  sar15  sar16	sar17  sar18  sar19</span><br></pre></td></tr></table></figure>

<p><code>sar</code> 用法提示：</p>
<ul>
<li><code>sar -A</code> 可以导出所有的统计数据</li>
<li><code>sar</code> 的统计数据支持多种格式。可以使用 <code>sysstat</code> 安装包中的 <code>sadf</code> 命令（用于查看 <code>sar</code> 命令的统计数据）查看，如 <code>JSON（-j）</code>、<code>SVG（-g）</code>、<code>CSV(-d)</code></li>
</ul>
<h2 id="sar-检查系统内存统计数据"><a href="#sar-检查系统内存统计数据" class="headerlink" title="sar 检查系统内存统计数据"></a>sar 检查系统内存统计数据</h2><p>假如要查看系统上的整体的内存使用情况，可以参考命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sar -r ALL 1</span></span><br><span class="line">Linux 6.8.0-1015-aws (U-3TSDMAL9IVFAQ) 	10/18/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">02:32:53 PM kbmemfree   kbavail kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty  kbanonpg    kbslab  kbkstack   kbpgtbl  kbvmused</span><br><span class="line">02:32:54 PM    709824   7191784   7831332     48.38    355616   6471148  24765960     51.00   7304484   6628076       656   7136392    819348     20320     86304    244720</span><br><span class="line">02:32:55 PM    709348   7191436   7831680     48.38    355616   6471276  24765960     51.00   7304876   6628076       720   7136644    819348     20348     86392    244752</span><br><span class="line">02:32:56 PM    706212   7188300   7831264     48.38    355616   6471276  24765960     51.00   7304688   6628076       512   7136420    822900     20320     86304    244752</span><br><span class="line">02:32:57 PM    721052   7203152   7819660     48.31    355620   6471496  24766216     51.00   7310564   6628088       536   7142084    819440     20320     86304    244752</span><br><span class="line">02:32:58 PM    720324   7202444   7820452     48.31    355620   6471560  24766216     51.00   7310664   6628108       864   7142140    819312     20320     86304    244752</span><br><span class="line">^C</span><br><span class="line">Average:       713352   7195423   7826878     48.35    355618   6471351  24766062     51.00   7307055   6628085       658   7138736    820070     20326     86322    244746</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>以下命令展示系统上的 Swap 使用情况统计</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sar -S  1</span></span><br><span class="line">Linux 6.8.0-1015-aws (U-3TSDMAL9IVFAQ) 	10/18/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">02:33:42 PM kbswpfree kbswpused  %swpused  kbswpcad   %swpcad</span><br><span class="line">02:33:43 PM  31314692   1059840      3.27      2260      0.21</span><br><span class="line">02:33:44 PM  31314692   1059840      3.27      2260      0.21</span><br><span class="line">02:33:45 PM  31314692   1059840      3.27      2260      0.21</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="sar-检查系统-CPU-统计数据"><a href="#sar-检查系统-CPU-统计数据" class="headerlink" title="sar 检查系统 CPU 统计数据"></a>sar 检查系统 CPU 统计数据</h2><h3 id="CPU-整体使用率情况统计"><a href="#CPU-整体使用率情况统计" class="headerlink" title="CPU 整体使用率情况统计"></a>CPU 整体使用率情况统计</h3><p>假如要查看系统上的整体的 CPU 使用情况，可以参考命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sar -u ALL 1</span></span><br><span class="line">Linux 6.8.0-1015-aws (U-3TSDMAL9IVFAQ) 	10/18/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">02:42:41 PM     CPU      %usr     %nice      %sys   %iowait    %steal      %irq     %soft    %guest    %gnice     %idle</span><br><span class="line">02:42:42 PM     all     14.29      0.00      1.23      0.00      6.40      0.00      0.49      0.00      0.00     77.59</span><br><span class="line">02:42:43 PM     all      9.14      0.00      2.22      0.00      4.20      0.00      0.00      0.00      0.00     84.44</span><br><span class="line">02:42:44 PM     all     10.78      0.00      6.13      0.00      8.33      0.00      0.00      0.00      0.00     74.75</span><br><span class="line">02:42:45 PM     all      8.60      0.00      1.72      0.00      4.42      0.00      0.00      0.00      0.00     85.26</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中每列数据说明如下：</p>
<ul>
<li><code>%usr</code> ： User CPU Time， 在用户态执行进程所占的 CPU 时间百分比。</li>
<li><code>%nice</code> ： Nice CPU Time， 在用户态下以改变了优先级（<code>nice</code> 值）的进程所占的 CPU 时间百分比。</li>
<li><code>%sys</code> ： System CPU Time， 在内核态执行进程（系统调用）所占的 CPU 时间百分比。</li>
<li><code>%iowait</code> ： I&#x2F;O Wait， CPU 等待 I&#x2F;O 完成的时间百分比。</li>
<li><code>%steal</code> ： Steal Time， 虚拟化环境中，CPU 等待物理 CPU 被其他虚拟机使用的时间百分比。这个值相对较高是虚拟化环境中的常见现象。</li>
<li><code>%irq</code> ： Interrupt Requests， 硬件中断处理所占的 CPU 时间百分比。</li>
<li><code>%soft</code> ： Soft IRQ， 软中断处理所占的 CPU 时间百分比。</li>
<li><code>%guest</code> ： Guest Time， 虚拟机内部运行进程所占的 CPU 时间百分比。系统上安装了其他虚拟机时会占用此指标。</li>
<li><code>%gnice</code> ： Guest Nice Time， 在虚拟机中以改变了优先级运行的进程所占的 CPU 时间百分比。为 0 表示没有 CPU 时间被分配给虚拟机中带有改变优先级的进程。</li>
</ul>
<h3 id="系统负载相关统计数据"><a href="#系统负载相关统计数据" class="headerlink" title="系统负载相关统计数据"></a>系统负载相关统计数据</h3><p>查看系统 CPU 负载情况，命令帮助参考 <code>sar --help</code>。<code>-q</code> 选项支持查看：</p>
<ul>
<li><code>LOAD</code> ： Queue length and load average statistics [A_QUEUE]，默认值</li>
<li><code>CPU</code> ： Pressure-stall CPU statistics [A_PSI_CPU]</li>
<li><code>IO</code> ： Pressure-stall I&#x2F;O statistics [A_PSI_IO]</li>
<li><code>MEM</code> ： Pressure-stall memory statistics [A_PSI_MEM]</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sar -q 1 5</span></span><br><span class="line">Linux 6.8.0-1015-aws (U-3TSDMAL9IVFAQ) 	10/18/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">02:45:55 PM   runq-sz  plist-sz   ldavg-1   ldavg-5  ldavg-15   blocked</span><br><span class="line">02:45:56 PM         1      1269      0.86      1.21      1.07         0</span><br><span class="line">02:45:57 PM         0      1269      0.86      1.21      1.07         0</span><br><span class="line">02:45:58 PM         1      1269      0.95      1.22      1.07         0</span><br><span class="line">02:45:59 PM         0      1269      0.95      1.22      1.07         0</span><br><span class="line">02:46:00 PM         2      1269      0.95      1.22      1.07         0</span><br><span class="line">Average:            1      1269      0.91      1.22      1.07         0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其中每列数据说明如下：</p>
<ul>
<li><code>runq-sz</code> ： Run Queue Size， 表示运行队列中的进程数，即正在等待 CPU 执行的进程数量。</li>
<li><code>plist-sz</code> ： Process List Size， 表示进程表中的进程总数（无论进程的状态如何）。</li>
<li><code>ldavg-1</code> ： Load Average over 1 Minute</li>
<li><code>blocked</code> ： 表示当前处于阻塞状态的进程数，通常是等待 I&#x2F;O（例如等待磁盘操作完成）的进程。</li>
</ul>
<p><strong>CPU 使用率的统计情况</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sar -q CPU 1 3</span></span><br><span class="line">Linux 6.8.0-1015-aws (U-3TSDMAL9IVFAQ) 	10/18/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">03:06:56 PM  %scpu-10  %scpu-60 %scpu-300     %scpu</span><br><span class="line">03:06:57 PM      2.07      1.96      3.89      2.99</span><br><span class="line">03:06:58 PM      2.06      1.96      3.88      1.74</span><br><span class="line">03:06:59 PM      2.06      1.96      3.88      1.94</span><br><span class="line">Average:         2.06      1.96      3.88      2.22</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其中每列数据说明如下：</p>
<ul>
<li><code>%scpu-10</code> ： 过去 10 秒内的 CPU 使用百分比平均值</li>
<li><code>%scpu</code> ： 当前时间点的 CPU 使用率。</li>
</ul>
<p><strong>内存使用率的统计情况</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sar -q MEM 1 5</span></span><br><span class="line">Linux 6.8.0-1015-aws (U-3TSDMAL9IVFAQ) 	10/18/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">02:48:16 PM  %smem-10  %smem-60 %smem-300     %smem  %fmem-10  %fmem-60 %fmem-300     %fmem</span><br><span class="line">02:48:17 PM      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">02:48:18 PM      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">02:48:19 PM      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">02:48:20 PM      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">02:48:21 PM      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">Average:         0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其中每列数据说明如下：</p>
<ul>
<li><code>%smem</code> ： 当前时刻的系统内存使用百分比。</li>
<li><code>%fmem</code> ： 当前时刻的文件内存使用百分比。</li>
</ul>
<p><strong>IO 使用率情况统计</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sar -q IO 1 3</span></span><br><span class="line">Linux 6.8.0-1015-aws (U-3TSDMAL9IVFAQ) 	10/18/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">03:10:54 PM   %sio-10   %sio-60  %sio-300      %sio   %fio-10   %fio-60  %fio-300      %fio</span><br><span class="line">03:10:55 PM      0.00      0.00      0.00      0.04      0.00      0.00      0.00      0.04</span><br><span class="line">03:10:56 PM      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">03:10:57 PM      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">Average:         0.00      0.00      0.00      0.01      0.00      0.00      0.00      0.01</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="sar-检查系统-IO-统计数据"><a href="#sar-检查系统-IO-统计数据" class="headerlink" title="sar 检查系统 IO 统计数据"></a>sar 检查系统 IO 统计数据</h2><p><code>sar -b</code> 检查系统 IO 统计数据</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sar -b 1 5</span></span><br><span class="line">Linux 6.8.0-1015-aws (U-3TSDMAL9IVFAQ) 	10/18/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">02:54:25 PM       tps      rtps      wtps      dtps   bread/s   bwrtn/s   bdscd/s</span><br><span class="line">02:54:26 PM      2.00      0.00      2.00      0.00      0.00    224.00      0.00</span><br><span class="line">02:54:27 PM      4.00      0.00      4.00      0.00      0.00    192.00      0.00</span><br><span class="line">02:54:28 PM      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">02:54:29 PM      1.00      0.00      1.00      0.00      0.00      8.00      0.00</span><br><span class="line">02:54:30 PM      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">Average:         1.40      0.00      1.40      0.00      0.00     84.80      0.00</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其中每列数据说明如下：</p>
<ul>
<li><code>tps</code> ： Transfers per second， 每秒钟系统执行的 I&#x2F;O 请求总数（读和写请求的总和）</li>
<li><code>rtps</code> ： Read transfers per second， 每秒钟发起的读请求数。</li>
<li><code>wtps</code> ： Write transfers per second， 每秒钟发起的写请求数。</li>
<li><code>dtps</code> ： Discard transfers per second， 每秒钟的丢弃操作次数。</li>
<li><code>bread/s</code> ： Blocks read per second， 每秒钟读取的块数（数据块的单位取决于系统的配置，通常为 512 字节）。</li>
<li><code>bwrtn/s</code> ： Blocks written per second， 每秒钟写入的块数</li>
<li><code>bdscd/s</code> ： Blocks discarded per second， 每秒钟被丢弃的块数（例如，通过 trim&#x2F;discard 操作减少 SSD 的写放大）。</li>
</ul>
<h2 id="sar-统计磁盘读写情况"><a href="#sar-统计磁盘读写情况" class="headerlink" title="sar 统计磁盘读写情况"></a>sar 统计磁盘读写情况</h2><p><code>sar</code> 命令统计磁盘读写相关数据使用选项 <code>-d</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sar -d 1 3</span></span><br><span class="line">Linux 3.10.0-1160.114.2.el7.x86_64 (zzxhy-admin) 	10/18/2024 	_x86_64_	(8 CPU)</span><br><span class="line"></span><br><span class="line">04:17:07 PM       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util</span><br><span class="line">04:17:08 PM  dev259-0      3.00      0.00     87.00     29.00      0.00      0.67      1.00      0.30</span><br><span class="line"></span><br><span class="line">04:17:08 PM       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util</span><br><span class="line">04:17:09 PM  dev259-0      3.00      0.00     78.00     26.00      0.00      0.33      1.00      0.30</span><br><span class="line"></span><br><span class="line">04:17:09 PM       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util</span><br><span class="line">04:17:10 PM  dev259-0      3.00      0.00     91.00     30.33      0.00      0.33      1.00      0.30</span><br><span class="line"></span><br><span class="line">Average:          DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util</span><br><span class="line">Average:     dev259-0      3.00      0.00     85.33     28.44      0.00      0.44      1.00      0.30</span><br></pre></td></tr></table></figure>

<p>其中每列数据说明如下：</p>
<ul>
<li><code>DEV</code> ： 表示设备名称</li>
<li><code>tps</code> ： Transactions per Second， 每秒钟执行的 I&#x2F;O 操作数（包括读写请求）。</li>
<li><code>rd_sec/s</code> ： Read Sectors per Second， 每秒读取的扇区数（扇区的大小通常为 512 字节）。</li>
<li><code>wr_sec/s</code> ： Write Sectors per Second， 每秒写入的扇区数。</li>
<li><code>avgrq-sz</code> ： Average Request Size， I&#x2F;O 请求的平均大小（以扇区为单位）。例如，<code>avgrq-sz</code> 为 <code>29.00</code>，表示每个 I&#x2F;O 请求平均涉及 29 个扇区。</li>
<li><code>avgqu-sz</code> ： Average Queue Size， I&#x2F;O 请求队列的平均长度。</li>
<li><code>await</code> ： Average Wait Time， I&#x2F;O 请求的平均等待时间（以毫秒为单位），包括排队和服务时间。</li>
<li><code>svctm</code> ： Service Time， I&#x2F;O 请求的平均服务时间（以毫秒为单位）。</li>
<li><code>%util</code> ： Percentage of CPU Time Used for I&#x2F;O Operations， 设备的 I&#x2F;O 操作占用的时间百分比，表示设备忙碌的程度。</li>
</ul>
<h2 id="sar-统计文件系统分区使用情况"><a href="#sar-统计文件系统分区使用情况" class="headerlink" title="sar 统计文件系统分区使用情况"></a>sar 统计文件系统分区使用情况</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sar -F 1 3</span></span><br><span class="line">Linux 3.10.0-1160.114.2.el7.x86_64 (zzxhy-admin) 	10/18/2024 	_x86_64_	(8 CPU)</span><br><span class="line"></span><br><span class="line">04:26:29 PM  MBfsfree  MBfsused   %fsused  %ufsused     Ifree     Iused    %Iused FILESYSTEM</span><br><span class="line">04:26:30 PM    534794    512747     48.95     48.95 534097719   2248329      0.42 /dev/nvme0n1p1</span><br><span class="line"></span><br><span class="line">04:26:30 PM  MBfsfree  MBfsused   %fsused  %ufsused     Ifree     Iused    %Iused FILESYSTEM</span><br><span class="line">04:26:31 PM    534794    512747     48.95     48.95 534097719   2248329      0.42 /dev/nvme0n1p1</span><br><span class="line"></span><br><span class="line">04:26:31 PM  MBfsfree  MBfsused   %fsused  %ufsused     Ifree     Iused    %Iused FILESYSTEM</span><br><span class="line">04:26:32 PM    534794    512747     48.95     48.95 534097719   2248329      0.42 /dev/nvme0n1p1</span><br><span class="line"></span><br><span class="line">Summary:     MBfsfree  MBfsused   %fsused  %ufsused     Ifree     Iused    %Iused FILESYSTEM</span><br><span class="line">Summary        534794    512747     48.95     48.95 534097719   2248329      0.42 /dev/nvme0n1p1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其中每列数据说明如下：</p>
<ul>
<li><code>MBfsfree</code> ： Megabytes of Free Filesystem Space， 文件系统中剩余的可用空间，以 MB 为单位。</li>
<li><code>MBfsused</code> ： Megabytes of Used Filesystem Space， 文件系统中已使用的空间，以 MB 为单位。</li>
<li><code>%fsused</code> ： Percentage of Filesystem Used， 文件系统已使用空间的百分比。</li>
<li><code>%ufsused</code> ： User Filesystem Usage Percentage， 与 %fsused 相同，表示用户文件系统已使用空间的百分比。</li>
<li><code>Ifree</code> ： Inodes Free， 文件系统中剩余的可用 inode 数量。Inodes 是存储文件元数据的结构，如文件名、文件大小、文件权限等。</li>
<li><code>Iused</code> ： Inodes Used， 文件系统中已使用的 inode 数量。</li>
<li><code>%Iused</code> ： Percentage of Inodes Used， 文件系统已使用 inode 的百分比。</li>
<li><code>FILESYSTEM</code> ： 文件系统的挂载点或设备名。例如，&#x2F;dev&#x2F;nvme0n1p1 是一个 NVMe 磁盘分区。</li>
</ul>
<h2 id="sar-统计网络数据"><a href="#sar-统计网络数据" class="headerlink" title="sar 统计网络数据"></a>sar 统计网络数据</h2><p><code>sar</code> 命令统计网络相关数据使用选项 <code>-n</code>， 帮助信息如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-n &#123; &lt;keyword&gt; [,...] | ALL &#125;</span><br><span class="line">	Network statistics [A_NET_...]</span><br><span class="line">	Keywords are:</span><br><span class="line">	DEV	Network interfaces</span><br><span class="line">	EDEV	Network interfaces (errors)</span><br><span class="line">	NFS	NFS client</span><br><span class="line">	NFSD	NFS server</span><br><span class="line">	SOCK	Sockets	(v4)</span><br><span class="line">	IP	IP traffic	(v4)</span><br><span class="line">	EIP	IP traffic	(v4) (errors)</span><br><span class="line">	ICMP	ICMP traffic	(v4)</span><br><span class="line">	EICMP	ICMP traffic	(v4) (errors)</span><br><span class="line">	TCP	TCP traffic	(v4)</span><br><span class="line">	ETCP	TCP traffic	(v4) (errors)</span><br><span class="line">	UDP	UDP traffic	(v4)</span><br><span class="line">	SOCK6	Sockets	(v6)</span><br><span class="line">	IP6	IP traffic	(v6)</span><br><span class="line">	EIP6	IP traffic	(v6) (errors)</span><br><span class="line">	ICMP6	ICMP traffic	(v6)</span><br><span class="line">	EICMP6	ICMP traffic	(v6) (errors)</span><br><span class="line">	UDP6	UDP traffic	(v6)</span><br><span class="line">	FC	Fibre channel HBAs</span><br><span class="line">	SOFT	Software-based network processing</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>如下示例统计所有网卡上的网络数据</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sar -n DEV 1 2</span></span><br><span class="line">Linux 6.8.0-1015-aws (U-3TSDMAL9IVFAQ) 	10/18/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">03:55:13 PM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil</span><br><span class="line">03:55:14 PM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">03:55:14 PM      eth0     56.00     92.00      4.32    279.30      0.00      0.00      0.00      0.00</span><br><span class="line">03:55:14 PM      eth1      4.00      4.00      0.35      0.68      0.00      0.00      0.00      0.00</span><br><span class="line">03:55:14 PM   docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">03:55:14 PM vethc08e5f9      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line"></span><br><span class="line">03:55:14 PM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil</span><br><span class="line">03:55:15 PM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">03:55:15 PM      eth0     85.00     92.00      7.87    176.03      0.00      0.00      0.00      0.00</span><br><span class="line">03:55:15 PM      eth1      4.00      4.00      0.34      0.43      0.00      0.00      0.00      0.00</span><br><span class="line">03:55:15 PM   docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">03:55:15 PM vethc08e5f9      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line"></span><br><span class="line">Average:        IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil</span><br><span class="line">Average:           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">Average:         eth0     70.50     92.00      6.10    227.67      0.00      0.00      0.00      0.00</span><br><span class="line">Average:         eth1      4.00      4.00      0.35      0.55      0.00      0.00      0.00      0.00</span><br><span class="line">Average:      docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">Average:    vethc08e5f9      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中每列数据说明如下：</p>
<ul>
<li><code>IFACE</code> ： 网络接口名称</li>
<li><code>rxpck/s</code> ： Receive Packets per Second， 每秒接收到的数据包数量。</li>
<li><code>txpck/s</code> ： Transmit Packets per Second， 每秒发送的数据包数量。</li>
<li><code>rxkB/s</code> ： Received Kilobytes per Second， 每秒接收到的数据量（以 KB 为单位）</li>
<li><code>txkB/s</code> ： Transmitted Kilobytes per Second， 每秒发送的数据量（以 KB 为单位）</li>
<li><code>rxcmp/s</code> ： Compressed Packets Received per Second， 每秒接收到的压缩数据包数量。</li>
<li><code>txcmp/s</code> ： Compressed Packets Transmitted per Second， 每秒发送的压缩数据包数量。</li>
<li><code>rxmcst/s</code> ： Multicast Packets Received per Second， 每秒接收到的组播数据包数量。</li>
<li><code>%ifutil</code> ： Interface Utilization Percentage， 网络接口的利用率，表示该接口的总带宽使用情况。</li>
</ul>
<p><strong>统计 Socket 使用情况</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sar -n SOCK 1 2</span></span><br><span class="line">Linux 6.8.0-1015-aws (U-3TSDMAL9IVFAQ) 	10/18/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">04:05:21 PM    totsck    tcpsck    udpsck    rawsck   ip-frag    tcp-tw</span><br><span class="line">04:05:22 PM      1577        36        20         0         0         3</span><br><span class="line">04:05:23 PM      1577        36        20         0         0         3</span><br><span class="line">Average:         1577        36        20         0         0         3</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>监控 IP 层的网络活动情况</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sar -n IP 1 2</span></span><br><span class="line">Linux 6.8.0-1015-aws (U-3TSDMAL9IVFAQ) 	10/18/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">04:06:39 PM    irec/s  fwddgm/s    idel/s     orq/s   asmrq/s   asmok/s  fragok/s fragcrt/s</span><br><span class="line">04:06:40 PM     43.00      0.00     43.00     47.00      0.00      0.00      0.00      0.00</span><br><span class="line">04:06:41 PM     71.00      0.00     71.00     77.00      0.00      0.00      0.00      0.00</span><br><span class="line">Average:        57.00      0.00     57.00     62.00      0.00      0.00      0.00      0.00</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其中每列数据说明如下：</p>
<ul>
<li><code>irec/s</code> ： Incoming Packets Received per Second， 每秒接收到的 IP 数据包数量。</li>
<li><code>fwddgm/s</code> ： Forwarded Datagrams per Second， 每秒被路由转发的 IP 数据包数量（如果系统配置为路由器）。</li>
<li><code>idel/s</code> ： Incoming Datagrams Delivered per Second， 每秒成功交付给上层协议（如 TCP&#x2F;UDP）的 IP 数据包数量。</li>
<li><code>orq/s</code> ： Outgoing Request Packets per Second， 每秒发出的 IP 数据包请求数。</li>
<li><code>asmrq/s</code> ： Address Mask Requests per Second， 每秒发送的地址掩码请求数据包数。</li>
<li><code>asmok/s</code> ： Address Mask Replies per Second， 每秒发送的地址掩码应答数据包数。</li>
<li><code>fragok/s</code> ： Fragmentation OK per Second， 每秒成功处理的 IP 数据包碎片数。</li>
<li><code>fragcrt/s</code> ： Fragmentation Created per Second， 每秒创建的 IP 数据包碎片数。</li>
</ul>
<p><strong>监控 TCP 层的网络活动情况</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sar -n TCP 1 2</span></span><br><span class="line">Linux 6.8.0-1015-aws (U-3TSDMAL9IVFAQ) 	10/18/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">04:13:34 PM  active/s passive/s    iseg/s    oseg/s</span><br><span class="line">04:13:35 PM      0.00      0.00     79.00    104.00</span><br><span class="line">04:13:36 PM      0.00      0.00     31.00     51.00</span><br><span class="line">Average:         0.00      0.00     55.00     77.50</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其中每列数据说明如下：</p>
<ul>
<li><code>active/s</code> ： Active Connections per Second， 每秒发起的主动连接请求数量（客户端发起的 TCP 连接，如 HTTP 请求）。</li>
<li><code>passive/s</code> ： Passive Connections per Second， 每秒接受的被动连接请求数量（服务器接受的 TCP 连接，如服务端的 TCP 监听）。</li>
<li><code>iseg/s</code> ： Incoming Segments per Second， 每秒接收到的 TCP 段数量</li>
<li><code>oseg/s</code> ： Outgoing Segments per Second， 每秒发送的 TCP 段数量。</li>
</ul>
<h1 id="SysRq"><a href="#SysRq" class="headerlink" title="SysRq"></a>SysRq</h1><p>在某些情况，如系统内存耗尽，会导致系统（Shell,GUI）无响应，在这种场景下，可以使用 <code>Alt+SysRq</code> 组合键，它的全称是 <code>System Request</code>，内核对 <code>Alt+SysRq</code> 组合键有高响应优先级，通过此组合键可以完成以下内容：</p>
<ul>
<li><code>Alt + SysRq + S</code> ： 同步所有挂载的文件系统。</li>
<li><code>Alt + SysRq + U</code> ： 卸载所有文件系统（只读模式）。</li>
<li><code>Alt + SysRq + B</code> ： 强制重启系统。</li>
<li><code>Alt + SysRq + K</code> ： 杀死所有用户进程。</li>
</ul>
<p><strong>要启用 <code>SysRq</code> 功能，系统必须配置了 <code>/proc/sys/kernel/sysrq</code> 的值为 <code>1</code>，或者配置 <code>kernel.sysrq = 1</code> 到 <code>/etc/sysctl.conf</code> 中，并且只有在系统的终端中才支持这些快捷键组合，远程终端不支持</strong></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="../tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="../202301050935/" rel="prev" title="Kubernetes 上部署 cert-manager 及使用">
                  <i class="fa fa-chevron-left"></i> Kubernetes 上部署 cert-manager 及使用
                </a>
            </div>
            <div class="post-nav-item">
                <a href="../202301171752/" rel="next" title="aws cli 命令用法">
                  aws cli 命令用法 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">COSMOS</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.3" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="../js/comments.js"></script><script src="../js/utils.js"></script><script src="../js/motion.js"></script><script src="../js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="../js/third-party/search/local-search.js"></script>




  <script src="../js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"fl9999","repo":"fl9999.github.io","client_id":"a11bf6f7860762b725b5","client_secret":"a99046105f8bddc72ec718d54dc3fd7f22070821","admin_user":"fl9999","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d41d8cd98f00b204e9800998ecf8427e"}</script>
<script src="../js/third-party/comments/gitalk.js"></script>

</body>
</html>
