<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png">
  <link rel="mask-icon" href="../../images/logo.svg" color="#222">

<link rel="stylesheet" href="../../css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"csms.tech","root":"/","images":"../../images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"../../search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="../../js/config.js"></script>

    <meta name="description" content="得 能 莫 忘">
<meta property="og:type" content="website">
<meta property="og:title" content="L B T">
<meta property="og:url" content="http://csms.tech/page/3/index.html">
<meta property="og:site_name" content="L B T">
<meta property="og:description" content="得 能 莫 忘">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="COSMOS">
<meta property="article:tag" content="博客, 记录，技术">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://csms.tech/page/3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>L B T</title>
  








  <noscript>
    <link rel="stylesheet" href="../../css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">L B T</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记 录 过 去 的 经 验</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="../../index.html" rel="section"><i class="fa fa-earth-americas fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="../../categories/" rel="section"><i class="fa fa-folder-tree fa-fw"></i>总目录<span class="badge">53</span></a></li><li class="menu-item menu-item-linux"><a href="../../categories/Linux" rel="section"><i class="fa fa-brands fa-linux fa-fw"></i>Linux</a></li><li class="menu-item menu-item-python"><a href="../../categories/Python" rel="section"><i class="fa fa-brands fa-python fa-fw"></i>Python</a></li><li class="menu-item menu-item-docker"><a href="../../categories/Docker" rel="section"><i class="fa fa-brands fa-docker fa-fw"></i>Docker</a></li><li class="menu-item menu-item-kubernetes"><a href="../../categories/Kubernetes" rel="section"><i class="fa fa-dharmachakra fa-fw"></i>Kubernetes</a></li><li class="menu-item menu-item-tags"><a href="../../tags/" rel="section"><i class="fa fa-tornado fa-fw"></i>标签<span class="badge">78</span></a></li><li class="menu-item menu-item-archives"><a href="../../archives/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>列表<span class="badge">263</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章总目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">COSMOS</p>
  <div class="site-description" itemprop="description">得 能 莫 忘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="../../archives/">
          <span class="site-state-item-count">263</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="../../categories/">
        <span class="site-state-item-count">53</span>
        <span class="site-state-item-name">目录</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="../../tags/">
        <span class="site-state-item-count">78</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241127111451/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20241127111451/" class="post-title-link" itemprop="url">Linux 性能分析工具 perf</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-27 11:11:00" itemprop="dateCreated datePublished" datetime="2024-11-27T11:11:00+08:00">2024-11-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-12-16 14:12:00" itemprop="dateModified" datetime="2024-12-16T14:12:00+08:00">2024-12-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" itemprop="url" rel="index"><span itemprop="name">性能分析</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><code>perf</code> 是 Linux 中标准的 Profiler，常用于 CPU Profiling、CPU flame Graphs、Syscall Tracing 等。</p>
<h1 id="perf-命令行操作"><a href="#perf-命令行操作" class="headerlink" title="perf 命令行操作"></a>perf 命令行操作</h1><p><code>perf</code> 常用子命令，命令帮助及选项参数帮助文档可查看 <code>man perf</code>、<code>man perf-record</code> 、<code>man perf-report</code> 等</p>
<table>
<thead>
<tr>
<th>子命令</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>record</code></td>
<td>进行 Profile 操作并将结果写入 <code>perf.data</code></td>
<td></td>
</tr>
<tr>
<td><code>report</code></td>
<td>读取 <code>perf.data</code> （created by <code>perf record</code>）并展示 Profile 内容</td>
<td></td>
</tr>
<tr>
<td><code>script</code></td>
<td>读取 <code>perf.data</code> （created by <code>perf record</code>）并展示堆栈内容</td>
<td></td>
</tr>
<tr>
<td><code>stat</code></td>
<td>显示 PMC（Performance Monitor Counter） 统计数据</td>
<td></td>
</tr>
<tr>
<td><code>list</code></td>
<td>列出系统支持的事件(Event）列表</td>
<td></td>
</tr>
</tbody></table>
<p><strong><code>perf record</code> 命令常用选项</strong></p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-F, --freq=</code></td>
<td>指定 Profile 的频率，使用 <code>max</code> 以当前系统允许的最大频率（对应内核参数 <code>kernel.perf_event_max_sample_rate</code>）进行 Profile<br/>通常建议 <code>99 Hz</code></td>
<td></td>
</tr>
<tr>
<td><code>-a, --all-cpus</code></td>
<td>采集所有 CPU 的全局数据，默认操作</td>
<td></td>
</tr>
<tr>
<td><code>-g</code></td>
<td>Kernel Space 和 User Space Stack Traces</td>
<td></td>
</tr>
<tr>
<td><code>-p, --pid=</code></td>
<td>对指定 PIDs （comma separated list） 进行采样</td>
<td></td>
</tr>
<tr>
<td><code>-e, --event=</code></td>
<td>针对 Event 进行采样追踪</td>
<td><code>perf record -F 99 -a -e sched:sched_process_exec</code></td>
</tr>
</tbody></table>
<p><strong><code>perf report</code> 命令常用选项</strong></p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-n, --show-nr-samples</code></td>
<td>显示每个 Symbol 采样的数量</td>
<td></td>
</tr>
<tr>
<td><code>-s, --sort=</code></td>
<td>按照指定的（CSV）字段排序</td>
<td></td>
</tr>
</tbody></table>
<h1 id="perf-使用示例"><a href="#perf-使用示例" class="headerlink" title="perf 使用示例"></a>perf 使用示例</h1><h2 id="记录使用-exec-启动的进程"><a href="#记录使用-exec-启动的进程" class="headerlink" title="记录使用 exec 启动的进程"></a>记录使用 exec 启动的进程</h2><p>通过监控系统调用事件，可以采样&#x2F;追踪系统上符合条件的行为，比如以下命令追踪使用 <code>exec</code> 系统调用启动的进程</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">perf record -F 99 -a -e <span class="built_in">sched</span>:sched_process_exec</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">perf report</span></span><br><span class="line">Overhead  Command          Shared Object      Symbol</span><br><span class="line">  40.48%  runc             [kernel.kallsyms]  [k] exec_binprm</span><br><span class="line">  34.86%  exe              [kernel.kallsyms]  [k] exec_binprm</span><br><span class="line">  24.57%  rsync            [kernel.kallsyms]  [k] exec_binprm</span><br><span class="line">   0.06%  rsync2Server.sh  [kernel.kallsyms]  [k] exec_binprm</span><br><span class="line">   0.03%  watchtower       [kernel.kallsyms]  [k] exec_binprm</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>添加 <code>-g</code> 选项追踪详细的堆栈信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">perf record -F 99 -a -e <span class="built_in">sched</span>:sched_process_exec -g</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">perf report</span></span><br><span class="line">  Children      Self  Command          Shared Object         Symbol</span><br><span class="line">+   59.92%    59.92%  rsync            [kernel.kallsyms]     [k] exec_binprm</span><br><span class="line">+   59.92%     0.00%  rsync            ld-linux-x86-64.so.2  [.] _start</span><br><span class="line">+   59.92%     0.00%  rsync            [kernel.kallsyms]     [k] entry_SYSCALL_64_after_hwframe</span><br><span class="line">+   59.92%     0.00%  rsync            [kernel.kallsyms]     [k] do_syscall_64</span><br><span class="line">+   59.92%     0.00%  rsync            [kernel.kallsyms]     [k] x64_sys_call</span><br><span class="line">+   59.92%     0.00%  rsync            [kernel.kallsyms]     [k] __x64_sys_execve</span><br><span class="line">+   59.92%     0.00%  rsync            [kernel.kallsyms]     [k] do_execveat_common.isra.0</span><br><span class="line">+   59.92%     0.00%  rsync            [kernel.kallsyms]     [k] bprm_execve</span><br><span class="line">+   59.92%     0.00%  rsync            [kernel.kallsyms]     [k] bprm_execve.part.0</span><br><span class="line">+   40.02%    40.02%  rsync2Server.sh  [kernel.kallsyms]     [k] exec_binprm</span><br><span class="line">+   40.02%     0.00%  rsync2Server.sh  ld-linux-x86-64.so.2  [.] _start</span><br><span class="line">+   40.02%     0.00%  rsync2Server.sh  [kernel.kallsyms]     [k] entry_SYSCALL_64_after_hwframe</span><br><span class="line">+   40.02%     0.00%  rsync2Server.sh  [kernel.kallsyms]     [k] do_syscall_64</span><br><span class="line">+   40.02%     0.00%  rsync2Server.sh  [kernel.kallsyms]     [k] x64_sys_call</span><br><span class="line">+   40.02%     0.00%  rsync2Server.sh  [kernel.kallsyms]     [k] __x64_sys_execve</span><br><span class="line">+   40.02%     0.00%  rsync2Server.sh  [kernel.kallsyms]     [k] do_execveat_common.isra.0</span><br><span class="line">+   40.02%     0.00%  rsync2Server.sh  [kernel.kallsyms]     [k] bprm_execve</span><br><span class="line">+   40.02%     0.00%  rsync2Server.sh  [kernel.kallsyms]     [k] bprm_execve.part.0</span><br><span class="line">     0.07%     0.07%  sleep            [kernel.kallsyms]     [k] exec_binprm</span><br><span class="line">     0.07%     0.00%  sleep            ld-linux-x86-64.so.2  [.] _start</span><br><span class="line">     0.07%     0.00%  sleep            [kernel.kallsyms]     [k] entry_SYSCALL_64_after_hwframe</span><br><span class="line">     0.07%     0.00%  sleep            [kernel.kallsyms]     [k] do_syscall_64</span><br><span class="line">     0.07%     0.00%  sleep            [kernel.kallsyms]     [k] x64_sys_call</span><br><span class="line">     0.07%     0.00%  sleep            [kernel.kallsyms]     [k] __x64_sys_execve</span><br><span class="line">     0.07%     0.00%  sleep            [kernel.kallsyms]     [k] do_execveat_common.isra.0</span><br><span class="line">     0.07%     0.00%  sleep            [kernel.kallsyms]     [k] bprm_execve</span><br><span class="line">     0.07%     0.00%  sleep            [kernel.kallsyms]     [k] bprm_execve.part.0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="perf-读取-PMC-统计数据"><a href="#perf-读取-PMC-统计数据" class="headerlink" title="perf 读取 PMC 统计数据"></a>perf 读取 PMC 统计数据</h2><p>使用以下命令可以读取系统中的 PMC 统计数据，其中包含了 CPU 使用时钟、CPU Context Switch、CPU Migrations、Page-Faults 等统计信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">perf <span class="built_in">stat</span> -a -- <span class="built_in">sleep</span> 10</span></span><br><span class="line"></span><br><span class="line"> Performance counter stats for &#x27;system wide&#x27;:</span><br><span class="line"></span><br><span class="line">         40,019.66 msec cpu-clock                        #    4.000 CPUs utilized             </span><br><span class="line">            51,242      context-switches                 #    1.280 K/sec                     </span><br><span class="line">             4,912      cpu-migrations                   #  122.740 /sec                      </span><br><span class="line">             7,944      page-faults                      #  198.502 /sec                      </span><br><span class="line">   &lt;not supported&gt;      cycles                                                                </span><br><span class="line">   &lt;not supported&gt;      instructions                                                          </span><br><span class="line">   &lt;not supported&gt;      branches                                                              </span><br><span class="line">   &lt;not supported&gt;      branch-misses                                                         </span><br><span class="line"></span><br><span class="line">      10.004545496 seconds time elapsed</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>&lt;not supported&gt;</code> 可能包括以下原因:</p>
<ul>
<li><strong>缺乏硬件支持</strong><ul>
<li>某些处理器可能不支持所需的硬件性能计数器（如 <code>cycles</code> 或 <code>instructions</code>）</li>
<li>这可能出现在虚拟机环境中，尤其是未启用硬件性能监控功能的虚拟机。</li>
</ul>
</li>
<li><strong>权限不足</strong><ul>
<li>性能计数器访问可能需要更高权限，通常是 root 权限</li>
</ul>
</li>
<li><strong>内核配置问题</strong><ul>
<li><code>perf</code> 依赖于 Linux 内核的性能监控功能。如果内核未启用某些性能计数器，可能会导致 <code>&lt;not supported&gt;</code>。</li>
</ul>
</li>
<li><strong>禁用了特定的事件源</strong><ul>
<li>某些环境中，特定性能监控功能可能被内核禁用（例如为了安全性）。</li>
</ul>
</li>
</ul>
</blockquote>
<h1 id="参考链接-Bibliography"><a href="#参考链接-Bibliography" class="headerlink" title="参考链接|Bibliography"></a>参考链接|Bibliography</h1><p><a target="_blank" rel="noopener" href="https://s.csms.tech/file/Systems.Performance.Enterprise.and.the.Cloud.2nd.Edition.2020.12.pdf">Systems Performance: Enterprise and the Cloud v2</a></p>
<h1 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://s.csms.tech/file/Systems.Performance.Enterprise.and.the.Cloud.2nd.Edition.2020.12.pdf">Systems Performance: Enterprise and the Cloud v2</a> #5.5.1 perf<a href="#fnref:1" rev="footnote"> ↩</a></span></li></ol></div></div>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202306051707/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202306051707/" class="post-title-link" itemprop="url">Grafana 使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-05 17:07:23" itemprop="dateCreated datePublished" datetime="2023-06-05T17:07:23+08:00">2023-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-12-05 10:12:00" itemprop="dateModified" datetime="2024-12-05T10:12:00+08:00">2024-12-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Grafana 是一款用 GO 语言开发的开源数据可视化工具，可以做数据监控和数据统计，带有告警功能。</p>
<h1 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h1><h2 id="组织-Organization-与用户-User"><a href="#组织-Organization-与用户-User" class="headerlink" title="组织(Organization) 与用户(User)"></a>组织(Organization) 与用户(User)</h2><p><strong>Organization</strong> 相当于一个 Namespace，一个 Organization 完全独立于另一个 Organization，包括 <code>datasource</code>、<code>dashboard</code> 等，创建一个 Organization 就相当于打开了一个全新的视图，所有的 <code>datasource</code>、<code>dashboard</code> 等都需要重新创建。一个用户(User) 可以属于多个 Organization。</p>
<p><strong>User</strong> 是 Grafana 里面的用户，用户可以有以下 <strong>角色</strong></p>
<ul>
<li><code>admin</code> - 管理员权限，可以执行任何操作。</li>
<li><code>editor</code> - <em>p</em>不可以创建用户<strong>、</strong>不可以新增 <code>Datasource</code><strong>、</strong>可以创建 Dashboard**</li>
<li><code>viewer</code> - 仅可以查看 Dashboard</li>
<li><code>read only editor</code> - 允许用户修改 Dashboard，但是 <strong>不允许保存</strong></li>
</ul>
<h2 id="数据源-Datasource"><a href="#数据源-Datasource" class="headerlink" title="数据源 Datasource"></a>数据源 Datasource</h2><p>Grafana 中操作的数据集、可视化数据的来源</p>
<h2 id="Dashboard"><a href="#Dashboard" class="headerlink" title="Dashboard"></a>Dashboard</h2><p>在 Dashboard 页面中，可以组织可视化数据图表。</p>
<ul>
<li><code>Panel</code> - 在一个 Dashboard 中，Panel 是最基本的可视化单元。通过 Panel 的 <code>Query Editor</code> 可以为每一个 Panel 添加查询的数据源以及数据查询方式。每一个 Panel 都是独立的，可以选择一种或者多种数据源进行查询。<strong>一个 Panel 中可以有多个 <code>Query Editor</code> 来汇聚多个可视化数据集</strong></li>
<li><code>Row</code> - 在 Dashboard 中，可以定义一个 <code>Row</code>，来组织和管理一组相关的 <code>Panel</code></li>
</ul>
<h3 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h3><p>在 Dashboard 的设置页面中，有 <code>Variables</code> 页面，在其中可以为 Dashboard 配置变量，之后可以在 Panel 的 <code>Query Editor</code> 中使用这些预定义的变量。<strong>变量的值也可以是通过表达式获取的值</strong>。也可以在 <strong>Panel 的标题中使用变量</strong></p>
<p>例如以下 Variables 配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Node    label_values(kubernetes_io_hostname)</span><br></pre></td></tr></table></figure>

<p><img src="https://i.csms.tech/img_169.png"></p>
<p><img src="https://i.csms.tech/img_168.png"></p>
<p>在 Dashboard 中定义了这些变量后，可以在 Panel 的 <code>Query Editor</code> 中使用，在 <code>Query Editor</code> 中使用了 Variables 中定义的变量后，在 Dashboard 的顶部下拉菜单中可以选择预定义的变量的值（<strong>需要在定义 Variables 时配置 <code>Show on dashboard</code> 为 <code>Label and Value</code> 以使在 Dashboard 顶部显示下拉菜单</strong>），Panel 中的 <code>Query</code> 表达式就会使用这些变量的值进行计算以及显示图表。<br><img src="https://i.csms.tech/img_170.png"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202306051707/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/d5da7d5e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../d5da7d5e/" class="post-title-link" itemprop="url">Django 常见错误</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-12 13:55:03" itemprop="dateCreated datePublished" datetime="2022-07-12T13:55:03+08:00">2022-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-12-04 10:12:00" itemprop="dateModified" datetime="2024-12-04T10:12:00+08:00">2024-12-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Python/Django/" itemprop="url" rel="index"><span itemprop="name">Django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>centos7</li>
<li>python3</li>
<li>Django 4</li>
</ul>
<h2 id="ModuleNotFoundError-No-module-named-‘MySQLdb’"><a href="#ModuleNotFoundError-No-module-named-‘MySQLdb’" class="headerlink" title="ModuleNotFoundError: No module named ‘MySQLdb’"></a>ModuleNotFoundError: No module named ‘MySQLdb’</h2><blockquote>
<p>ModuleNotFoundError: No module named ‘MySQLdb’<br>…<br>django.core.exceptions.ImproperlyConfigured: Error loading MySQLdb module.</p>
</blockquote>
<p><strong>解决方法</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip3 install pymysql</span><br></pre></td></tr></table></figure>

<p>编辑文件<code>./python36/lib/python3.6/site-packages/django/db/backends/mysql/__init__.py</code>, 输入以下内容</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql </span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../d5da7d5e/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241204092829/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20241204092829/" class="post-title-link" itemprop="url">Python 代码集成 Prometheus Client 输出 Metrics 到 Prometheus</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-12-04 09:12:00" itemprop="dateCreated datePublished" datetime="2024-12-04T09:12:00+08:00">2024-12-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在 Python 中，可以使用 Prometheus Python Client Library 来输出 Metrics，供 Prometheus 采集。</p>
<p><strong>安装 Prometheus 客户端库</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install prometheus-client</span><br></pre></td></tr></table></figure>

<p>以下是一个完整的示例，展示如何设置和暴露 Metrics：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> prometheus_client <span class="keyword">import</span> start_http_server, Summary, Counter, Gauge, Histogram</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 Metrics</span></span><br><span class="line">REQUEST_TIME = Summary(<span class="string">&#x27;request_processing_seconds&#x27;</span>, <span class="string">&#x27;Time spent processing request&#x27;</span>)</span><br><span class="line">REQUEST_COUNT = Counter(<span class="string">&#x27;request_count&#x27;</span>, <span class="string">&#x27;Total number of requests&#x27;</span>)</span><br><span class="line">IN_PROGRESS = Gauge(<span class="string">&#x27;in_progress_requests&#x27;</span>, <span class="string">&#x27;Number of requests in progress&#x27;</span>)</span><br><span class="line">REQUEST_LATENCY = Histogram(<span class="string">&#x27;request_latency_seconds&#x27;</span>, <span class="string">&#x27;Histogram of request latency&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟一个请求处理函数</span></span><br><span class="line"><span class="meta">@REQUEST_TIME.time()  </span><span class="comment"># 使用 Summary 记录函数运行时间</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_request</span>():</span><br><span class="line">    REQUEST_COUNT.inc()  <span class="comment"># 记录请求次数</span></span><br><span class="line">    IN_PROGRESS.inc()  <span class="comment"># 增加正在进行的请求数</span></span><br><span class="line"></span><br><span class="line">    latency = random.random()  <span class="comment"># 模拟随机延迟</span></span><br><span class="line">    REQUEST_LATENCY.observe(latency)  <span class="comment"># 记录延迟</span></span><br><span class="line">    time.sleep(latency)</span><br><span class="line"></span><br><span class="line">    IN_PROGRESS.dec()  <span class="comment"># 减少正在进行的请求数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 启动 HTTP Server，用于暴露 Metrics</span></span><br><span class="line">    start_http_server(<span class="number">8000</span>)  <span class="comment"># 默认端口 8000</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Prometheus metrics available at http://localhost:8000/metrics&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模拟请求处理</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        process_request()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong>Metrics 类型说明（对应 Prometheus 中相关的数据类型）</strong></p>
<ul>
<li><code>Summary</code> : 用于记录事件的持续时间或大小（例如请求处理时间）。</li>
<li><code>Counter</code> : 计数器，记录事件的总发生次数（例如请求总数）。</li>
<li><code>Gauge</code> : 测量当前值，可以增加或减少（例如当前活跃请求数）。</li>
<li><code>Histogram</code> : 创建直方图，记录数据分布（例如请求延迟分布）。</li>
</ul>
<p><strong>向 Prometheus 暴露 Metrics</strong></p>
<p><code>start_http_server(8000)</code> 会启动一个 HTTP 服务器，在 <code>/metrics</code> 路径下暴露指标数据。Prometheus 将通过该路径采集数据。</p>
<p><strong>装饰器</strong></p>
<p>使用 <code>@REQUEST_TIME.time()</code> 装饰器自动记录函数执行时间。</p>
<p><strong>标签</strong></p>
<p>可以在指标中添加 <strong>标签（Labels）</strong> 来提供多维度的指标。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">REQUEST_COUNT.labels(method=<span class="string">&#x27;GET&#x27;</span>).inc()</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../20241204092829/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202406260952/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202406260952/" class="post-title-link" itemprop="url">Linux 进程管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-26 09:52:30" itemprop="dateCreated datePublished" datetime="2024-06-26T09:52:30+08:00">2024-06-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-12-03 13:12:00" itemprop="dateModified" datetime="2024-12-03T13:12:00+08:00">2024-12-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><strong><code>Program</code></strong> 是一个静态实体，只是存储在操作系统中的文件（集合）</p>
<p><strong><code>Process</code></strong> 是操作系统上的活动（Active）实体，是 <strong><code>Program</code></strong> 由操作系统加载到内存并运行之后的实体。</p>
<p><strong><code>Process</code></strong> 运行过程中需要操作系统为其分配各种资源，如 CPU、Memory、Files、IO 等来完成其运行。</p>
<p>如果一个 <strong><code>Program</code></strong> 被操作系统运行（启动）了多次，那么其产生的多个 <strong><code>Process</code></strong>  属于分割（单独）的实体。</p>
<p>Linux 系统中调度的进程&#x2F;线程，通常被称为任务（Task）</p>
<p>Linux 中常见的进程状态如下表：</p>
<table>
<thead>
<tr>
<th>状态标识</th>
<th>状态名称</th>
<th>状态说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>R</code></td>
<td><code>task_running</code></td>
<td>进程处于运行或就绪状态</td>
<td></td>
</tr>
<tr>
<td><code>S</code></td>
<td><code>task_interruptible</code><br/> <code>sleeping</code></td>
<td>可中断的睡眠状态</td>
<td></td>
</tr>
<tr>
<td><code>D</code></td>
<td><code>task_uninterruptible</code></td>
<td>不可中断的睡眠状态<br/>1. 它是一种睡眠状态，意味着处于此状态的进程不会消耗 CPU<br/>2. 睡眠的原因是等待某些资源（比如锁或者磁盘 IO），这也是非常多 D 状态的进程都处在处理 IO 操作的原因<br/>3. 是它不能被中断，这个要区别于 <code>硬件中断</code> 的中断，是指不希望在其获取到资源或者超时前被终止。因此他不会被信号唤醒，也就不会响应 <code>kill -9</code> 这类信号。这也是它跟 <code>S（可中断睡眠）</code>状态的区别</td>
<td></td>
</tr>
<tr>
<td><code>T</code></td>
<td><code>task_stopped</code> <br/> <code>task_traced</code><br/><code>Traced</code></td>
<td>暂停状态或跟踪状态</td>
<td></td>
</tr>
<tr>
<td><code>Z</code></td>
<td><code>task_dead</code> <br/> <code>exit_zombie</code><br/><code>zombie</code></td>
<td>退出状态，进程成为僵尸进程</td>
<td></td>
</tr>
<tr>
<td><code>X</code></td>
<td><code>task_dead</code> <br/> <code>exit_dead</code></td>
<td>退出状态，进程即将被销毁</td>
<td></td>
</tr>
<tr>
<td><code>I</code></td>
<td><code>idle</code></td>
<td>空闲状态</td>
<td></td>
</tr>
<tr>
<td><code>+</code></td>
<td></td>
<td>表示关联了前台操作（Foreground Operation），比如前台运行的进程</td>
<td></td>
</tr>
</tbody></table>
<h1 id="进程调度"><a href="#进程调度" class="headerlink" title="进程调度"></a>进程调度</h1><p>Linux 中任务（Task）调度算法默认使用 CFS（Completely Fair Scheduler，内核版本 &gt;&#x3D; 2.6.23）.</p>
<p>CFS 调度算法没有使用固定的进程（此处的进程可能是进程或者线程，Linux 中统称为 Task）优先级（Priority），而是根据进程的 <code>nice value</code> 为进程分配一定比例的（Proportional） CPU 计算时间。 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Operating System Concepts v10 Online](https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf)  5.7.1 Example: Linux Scheduling">[1]</span></a></sup></p>
<p><strong><code>nice</code> 的取值从 <code>-20</code> - <code>+19</code>，值越小，优先级越高，默认值为 <code>0</code></strong> 。优先级高的进程会被分配到更高比例的 CPU 处理时间。</p>
<p>在 Linux 内核中，优先级分为两种：静态优先级和动态优先级。CFS 使用的是动态优先级，它是根据 <code>nice</code> 值计算出来的。</p>
<p>CFS Scheduler 不会直接设定 Priorities，而是为每个 Task 维护变量 <code>vruntime（virtual runtime）</code>（可以检查系统 <code>/proc/&lt;PID&gt;/sched</code>），这个值记录了每个 task 使用了多少 CPU 时间。</p>
<p>CFS 通过将进程的虚拟运行时间（<code>vruntime</code>）与其他进程的虚拟运行时间进行比较来决定调度优先级。权重越大，<code>vruntime</code> 增长越慢，意味着进程的优先级越高，能够更频繁地被调度。</p>
<p>假入一个任务有默认的 Priority（<code>nice=0</code>），那么他的 <code>vruntime</code> 和实际使用的 CPU 时间相同。例如一个 <code>nice=0</code> 的进程使用了 CPU 200ms，那么他的 <code>vruntime=200ms</code>。<strong>低优先级（low priority，<code>nice&gt;0</code>）</strong> 的任务在 CPU 上运行了 200ms，那么他的 <code>vruntime&gt;200ms</code>，相反的，一个 <strong>高优先级（high priority,<code>nice&lt;0</code>）</strong> 的任务在 CPU 上运行了 200ms，那么他的 <code>vruntime&lt;200ms</code>。<strong>基于此，CFS Scheduler 在选择下一个要执行的任务时，会选择 <code>vruntime</code> 最小的任务来运行</strong>。如果有高优先级的任务就绪（可执行），它会抢占（preemptive）正在执行的低优先级的任务。</p>
<p>假如 Linux 中有 2 个优先级一样的任务（<code>nice=0</code>），一个进程为 I&#x2F;O-bound，另一个为 CPU-bound。通常情况下，在一个 CPU 周期内，I&#x2F;O-bound 的任务会使用很少的 CPU 时间就会因等待 IO 而中断在 CPU 上的执行并进入 CPU 的等待调度队列（schedule queue），而 CPU-bound 的任务会用尽分配给它的整个 CPU 周期。执行一段时间之后， I&#x2F;O-bound 的任务的 <code>vruntime</code> 的值会显著的小于 CPU-bound 的任务的 <code>vruntime</code>，导致 I&#x2F;O-bound 的任务拥有比 CPU-bound 的任务更高的优先级，当 I&#x2F;O-bound 的任务就绪（IO 返回数据）时，它会立即抢占 CPU 开始执行。</p>
<blockquote>
<p><code>nice</code> 只能针对单一的进程调整优先级，无法同时将优先级配置关联到相关进程，如 子进程或者同一个服务中的其他进程</p>
</blockquote>
<h2 id="修改-nice-的值"><a href="#修改-nice-的值" class="headerlink" title="修改 nice 的值"></a>修改 nice 的值</h2><p>在 Linux 中，<code>nice</code> 值用于调整进程的优先级，数值范围从 <code>-20</code>（ <strong>最高优先级</strong> ）到 <code>19</code>（ <strong>最低优先级</strong> ）。较低的 <code>nice</code> 值表示进程有更高的优先级，会更频繁地获得 CPU 时间，而较高的 <code>nice</code> 值表示进程有较低的优先级。</p>
<p>你可以使用 <code>nice</code> 和 <code>renice</code> 命令来修改进程的 <code>nice</code> 值</p>
<blockquote>
<p>普通用户（<code>root</code> 之外的用户）启动应用程序时默认只能配置初始 <code>nice</code> 值 <code>0-19</code></p>
<p>普通用户（<code>root</code> 之外的用户）修改正在运行的应用程序的 <code>nice</code> 值，只能改大，不能改小。比如进程启动时，其 <code>nice</code> 为 <code>10</code>，拥有权限的普通用户只能将其 <code>nice</code> 值改为大于 <code>10</code> 的值。 </p>
</blockquote>
<h3 id="nice-命令"><a href="#nice-命令" class="headerlink" title="nice 命令"></a>nice 命令</h3><p><strong><code>nice</code> 命令用于在启动进程时指定 <code>nice</code> 值</strong> 。如果不指定，默认 <code>nice</code> 值为 <code>0</code>。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nice -n 10 command</span><br></pre></td></tr></table></figure>

<h3 id="renice-命令"><a href="#renice-命令" class="headerlink" title="renice 命令"></a>renice 命令</h3><p><code>renice</code> 命令可以修改已经在运行的进程的 <code>nice</code> 值。需要提供进程 ID（ <strong>PID</strong> ）来指定要修改的进程。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">renice &lt;nice_value&gt; -p &lt;PID&gt;</span><br></pre></td></tr></table></figure>
<p>如果想要一次修改多个进程的 <code>nice</code> 值，可以传递多个 PID：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo renice 10 -p 1234 2345 3456</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Linux-进程资源控制-cgroups"><a href="#Linux-进程资源控制-cgroups" class="headerlink" title="Linux 进程资源控制 cgroups"></a>Linux 进程资源控制 cgroups</h1><p><code>cgroups</code> 可以将一个任务（<code>task</code>）标识（绑定）到一个特殊的 <strong>控制组（<code>Control Group</code>）</strong> ，此任务启动的子进程可以继承父进程的 <strong>控制组（<code>Control Group</code>）</strong> </p>
<p><strong>控制组（<code>Control Group</code>）</strong> 可以限制的资源类型如下：</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>blkio</code></td>
<td><strong>Storage</strong> <br/>限制到存储设备（如 Hard Disk、USB Drivers等）的请求</td>
</tr>
<tr>
<td><code>cpu</code></td>
<td><strong>CPU</strong> <br/>限制 CPU 调度</td>
</tr>
<tr>
<td><code>cpuacct</code></td>
<td><strong>Process Accounting</strong> <br/>上报 CPU 使用状态，可以用于统计客户端使用的处理量并进行收费</td>
</tr>
<tr>
<td><code>cpuset</code></td>
<td><strong>CPU Assignment</strong> <br/>在多处理器的系统上，将 Task 分配到特定的处理器以及关联的内存</td>
</tr>
<tr>
<td><code>devices</code></td>
<td><strong>Device Access</strong> <br/>限制 <strong>控制组（<code>Control Group</code>）</strong> 中的 Task 对目标设备类型的使用</td>
</tr>
<tr>
<td><code>freezer</code></td>
<td><strong>Suspend&#x2F;Resume</strong> <br/>暂停&#x2F;恢复  <strong>控制组（<code>Control Group</code>）</strong> 中的 Task</td>
</tr>
<tr>
<td><code>memory</code></td>
<td><strong>Memory Usage</strong>  <br/>限制并报告  <strong>控制组（<code>Control Group</code>）</strong> 中的 Task 使用的内存</td>
</tr>
<tr>
<td><code>net_cls</code></td>
<td><strong>Network Bandwidth</strong> <br/> 制并报告  <strong>控制组（<code>Control Group</code>）</strong> 中的 Task 使用的网络流量，主要通过对网络流量打上 <code>cgroups</code> 相关标签实现</td>
</tr>
<tr>
<td><code>net_prio</code></td>
<td><strong>Network Traffic</strong> <br/> 控制  <strong>控制组（<code>Control Group</code>）</strong> 中的网络流量的优先级</td>
</tr>
<tr>
<td><code>ns</code></td>
<td><strong>Namespaces</strong> <br/> 将 <code>cgroups</code> 分配到不同的 Namespaces，如此同一个 <code>cgroups</code> 中的进程只能看到本 Namespace 中的进程</td>
</tr>
</tbody></table>
<h1 id="Linux-进程管理"><a href="#Linux-进程管理" class="headerlink" title="Linux 进程管理"></a>Linux 进程管理</h1><h2 id="进程命令名和进程可执行文件名"><a href="#进程命令名和进程可执行文件名" class="headerlink" title="进程命令名和进程可执行文件名"></a>进程命令名和进程可执行文件名</h2><p>在系统中遇到以下进程：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ps -elf | grep 18686</span></span><br><span class="line">5 S root     18686  1239  0  80   0 - 46620 pipe_w 15:50 ?        00:00:00 /usr/sbin/CROND -n</span><br><span class="line">0 R root     18694 18686  7  80   0 - 610547 -     15:50 ?        00:00:02 /usr/local/php73/bin/php /home/www/admin/artisan PullData</span><br><span class="line">0 S root     18754 18686  0  80   0 - 22453 pipe_w 15:50 ?        00:00:00 /usr/sbin/sendmail -FCronDaemon -i -odi -oem -oi -t -f root</span><br></pre></td></tr></table></figure>
<p>其中 PID 为 <code>18686</code> 的进程名为 <code>/usr/sbin/CROND</code>，其启动了另外两个子进程。但是在系统中检查，并不存在路径 <code>/usr/sbin/CROND</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> -l /usr/sbin/CROND</span></span><br><span class="line">ls: cannot access /usr/sbin/CROND: No such file or directory</span><br></pre></td></tr></table></figure>

<p>出现此种现象，主要是因为 <em><strong>在启动时，进程的命令名是根据路径传递给 <code>execve()</code> 函数的参数决定的，而不是直接与系统中的文件进行匹配</strong></em>。</p>
<p>在 Linux 系统中，<code>ps</code> 命令显示的进程信息是从 <code>/proc</code> 文件系统中获取的，而 <code>/proc</code> 文件系统包含有关正在运行的进程的信息，包括每个进程的命令名。因此，即使实际上系统中不存在 <code>/usr/sbin/CROND</code> 文件，但如果进程的命令名是 <code>/usr/sbin/CROND</code>，那么 <code>ps</code> 命令仍然会显示进程的命令名为 <code>/usr/sbin/CROND</code>。</p>
<p><em><strong>进程的命令名可以查看 <code>/proc/&lt;PID&gt;/cmdline</code> 文件</strong></em>，本示例中显示如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /proc/18686/cmdline</span> </span><br><span class="line">/usr/sbin/CROND-n</span><br></pre></td></tr></table></figure>

<p>对应的系统上的可执行文件的名称可以查看 <code>/proc/&lt;PID&gt;/stat</code>、<code>/proc/&lt;PID&gt;/comm</code>、<code>/proc/&lt;PID&gt;/status</code> 等文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /proc/900/comm</span> </span><br><span class="line">crond</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /proc/900/status</span> </span><br><span class="line">Name:	crond</span><br><span class="line">Umask:	0022</span><br><span class="line">State:	S (sleeping)</span><br><span class="line">Tgid:	900</span><br><span class="line">Ngid:	0</span><br><span class="line">Pid:	900</span><br><span class="line">PPid:	1239</span><br><span class="line">TracerPid:	0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /proc/900/stat</span></span><br><span class="line">900 (crond) S 1239 1239 1239 0 -1 4202816 1627 0 0 0 0 0 0 0 20 0 1 0 139129633 190955520 1478 18446744073709551615 94685936058368 94685936118156 140733000396032 140733000262488 140427856103840 0 0 4096 16387 18446744071797306256 0 0 17 3 0 0 0 0 0 94685938219080 94685938221648 94685948321792 140733000400770 140733000400789 140733000400789 140733000400872 0</span><br></pre></td></tr></table></figure>

<p>在本示例中，实际执行的命令为 <code>crond</code></p>
<h2 id="进程状态检查"><a href="#进程状态检查" class="headerlink" title="进程状态检查"></a>进程状态检查</h2><h3 id="top-命令"><a href="#top-命令" class="headerlink" title="top 命令"></a>top 命令</h3><p>使用 <code>top</code> 命令可以查看系统负载、CPU 和 内存使用情况。也可以查看单个进程的具体信息。</p>
<p><code>htop</code> 是 <code>top</code> 命令的一个变种，它提供了更多的交互性、定制性以及其他一些功能，但是它同时使用了相比 <code>top</code> 更多的资源（4 倍多的 <code>syscalls</code>）</p>
<p><strong><code>top</code> 命令常用选项</strong></p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-H</code></td>
<td><code>Threads Mode</code>，线程模式。默认情况 <code>top</code> 展示进程的简要信息，使用此选项显示进程中的线程状态。<br/>对应交互式命令 <code>H</code></td>
<td></td>
</tr>
</tbody></table>
<p><strong><code>top</code> 常用交互命令</strong></p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>P</code></td>
<td>CPU Utilization 排序，默认排序方式</td>
</tr>
<tr>
<td><code>M</code></td>
<td>Memory Utilization 排序</td>
</tr>
<tr>
<td><code>I</code></td>
<td>Irix&#x2F;Solaris-Mode 切换。<br/>默认为 Itrix Mode,在这种模式下，如果某个进程使用了系统中的 2 个 CPU 的所有计算资源，则其 CPU 使用率展示为 200%，依此类推。<br/>在 Solaris Mode 下，进程的 CPU 使用率是整体 CPU 使用的资源除于 CPU 数。如在 4 CPU 的系统中，Itrix 模式下，进程 CPU 使用率为 200%，在 Solaris 模式下，则为 50%</td>
</tr>
</tbody></table>
<ul>
<li>显示单个进程的（线程）详细信息  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">top -H -p 1423</span></span><br><span class="line">top - 09:44:42 up 54 days, 23:53,  2 users,  load average: 8.82, 6.84, 7.21</span><br><span class="line">Threads:  15 total,   0 running,  15 sleeping,   0 stopped,   0 zombie</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">Cpu(s): 40.9 us, 10.8 sy,  0.0 ni, 48.1 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.2 si,  0.0 st</span></span><br><span class="line">KiB Mem : 15790488 total,   466056 free,  7761544 used,  7562888 buff/cache</span><br><span class="line">KiB Swap:        0 total,        0 free,        0 used.  3895716 avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND                                                                                  </span><br><span class="line"> 1423 root      20   0 1477368 778788   4260 S 39.5  4.9  11999:41 [watchdog:1:6]                                                                           </span><br><span class="line"> 2572 root      20   0 1477368 778788   4260 S 37.9  4.9  11363:48 [watchdog:1:6]                                                                           </span><br><span class="line"> 1436 root      20   0 1477368 778788   4260 S 34.2  4.9  11286:08 [watchdog:1:6]                                                                           </span><br><span class="line"> 1435 root      20   0 1477368 778788   4260 S 33.9  4.9  12059:53 [watchdog:1:6]                                                                           </span><br><span class="line"> 1434 root      20   0 1477368 778788   4260 S 33.2  4.9  10249:00 [watchdog:1:6]                                                                           </span><br><span class="line"> 1437 root      20   0 1477368 778788   4260 S 30.6  4.9  11717:47 [watchdog:1:6]                                                                           </span><br><span class="line"> 1431 root      20   0 1477368 778788   4260 S 28.9  4.9  11222:06 [watchdog:1:6]                                                                           </span><br><span class="line">21378 root      20   0 1477368 778788   4260 S 27.6  4.9  12143:35 [watchdog:1:6]                                                                           </span><br><span class="line"> 1433 root      20   0 1477368 778788   4260 S 17.6  4.9   8738:21 [watchdog:1:6]                                                                           </span><br><span class="line"> 1428 root      20   0 1477368 778788   4260 S  8.0  4.9   7650:56 [watchdog:1:6]                                                                           </span><br><span class="line"> 1429 root      20   0 1477368 778788   4260 S  0.0  4.9   0:00.04 [watchdog:1:6]                                                                           </span><br><span class="line"> 1430 root      20   0 1477368 778788   4260 S  0.0  4.9   0:00.05 [watchdog:1:6]                                                                           </span><br><span class="line"> 1432 root      20   0 1477368 778788   4260 S  0.0  4.9   0:00.03 [watchdog:1:6]                                                                           </span><br><span class="line"> 1438 root      20   0 1477368 778788   4260 S  0.0  4.9  12260:30 [watchdog:1:6]                                                                           </span><br><span class="line"> 1529 root      20   0 1477368 778788   4260 S  0.0  4.9  11068:39 [watchdog:1:6]</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="pidstat"><a href="#pidstat" class="headerlink" title="pidstat"></a>pidstat</h3><p><code>pidstat</code> 命令用于检查 Linux 内核管理的进程的状态。帮助文档请查看 <code>man pidstat</code>。要查看特定的进程的信息，使用 <code>-p [PID|ALL]</code> 选项，查看子进程相关信息，参考 <code>-T [TASK | CHILD | ALL]</code> 选项</p>
<p>命令常用选项</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-d</code></td>
<td>报告 I&#x2F;O statistics</td>
<td></td>
</tr>
<tr>
<td><code>-C comm</code></td>
<td>查看 <code>command name</code> 的详细信息， <code>comm</code> 可以是正则表达式</td>
<td><code>pidstat -C chrome -T CHILD 1 10</code></td>
</tr>
<tr>
<td><code>-p &#123; pid[,...]   / SELF / ALL &#125;</code></td>
<td>查看指定的 PID 或者所有（ALL） 进程的统计信息，不指定默认使用 <code>-p ALL</code></td>
<td></td>
</tr>
<tr>
<td><code>-e program args</code></td>
<td>使用指定的 <code>args</code> 运行 <code>program</code> 并使用 <code>pidstat</code> 监控其统计数据</td>
<td></td>
</tr>
<tr>
<td><code>-l</code></td>
<td>在统计输出中，包含详细的命令及其参数</td>
<td></td>
</tr>
<tr>
<td><code>-r</code></td>
<td>统计进程的 <code>faults</code> 和 Memory 使用情况</td>
<td></td>
</tr>
<tr>
<td><code>-T &#123; TASK  / CHILD / ALL &#125;</code> <br/><code>-t</code></td>
<td>查看子进程相关统计信息</td>
<td></td>
</tr>
<tr>
<td><code>-u</code></td>
<td>CPU 使用率</td>
<td></td>
</tr>
<tr>
<td><code>-w</code></td>
<td>统计进程上下文切换（Context Switch）信息</td>
<td></td>
</tr>
</tbody></table>
<p><strong>查看指定的 PID 以及关联的子进程的统计信息</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pidstat -t -p 22737 1 1</span></span><br><span class="line">Linux 3.10.0-1160.49.1.el7.x86_64 (ecs-34a8) 	11/26/2024 	_x86_64_	(2 CPU)</span><br><span class="line"></span><br><span class="line">04:04:52 PM   UID      TGID       TID    %usr %system  %guest    %CPU   CPU  Command</span><br><span class="line">04:04:53 PM     0     22737         -    0.00    0.00    0.00    0.00     0  python3</span><br><span class="line">04:04:53 PM     0         -     22737    0.00    0.00    0.00    0.00     0  |__python3</span><br><span class="line">04:04:53 PM     0         -     22805    0.00    0.00    0.00    0.00     1  |__python3</span><br><span class="line">04:04:53 PM     0         -     22806    0.00    0.00    0.00    0.00     0  |__python3</span><br><span class="line">04:04:53 PM     0         -     22807    0.00    0.00    0.00    0.00     1  |__python3</span><br><span class="line">04:04:53 PM     0         -     22808    0.00    0.00    0.00    0.00     0  |__python3</span><br><span class="line">04:04:53 PM     0         -     22809    0.00    0.00    0.00    0.00     0  |__python3</span><br><span class="line">04:04:53 PM     0         -     22810    0.00    0.00    0.00    0.00     1  |__python3</span><br><span class="line"></span><br><span class="line">Average:      UID      TGID       TID    %usr %system  %guest    %CPU   CPU  Command</span><br><span class="line">Average:        0     22737         -    0.00    0.00    0.00    0.00     -  python3</span><br><span class="line">Average:        0         -     22737    0.00    0.00    0.00    0.00     -  |__python3</span><br><span class="line">Average:        0         -     22759    0.00    0.00    0.00    0.00     -  |__python3</span><br><span class="line">Average:        0         -     22806    0.00    0.00    0.00    0.00     -  |__python3</span><br><span class="line">Average:        0         -     22807    0.00    0.00    0.00    0.00     -  |__python3</span><br><span class="line">Average:        0         -     22808    0.00    0.00    0.00    0.00     -  |__python3</span><br><span class="line">Average:        0         -     22809    0.00    0.00    0.00    0.00     -  |__python3</span><br><span class="line">Average:        0         -     22810    0.00    0.00    0.00    0.00     -  |__python3</span><br></pre></td></tr></table></figure>

<p><strong>查看进程使用的内存以及 <code>faults</code> 统计信息</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pidstat -r | more</span></span><br><span class="line">Linux 6.8.0-1017-aws (U-3TSDMAL9IVFAQ) 	11/26/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">03:17:25 PM   UID       PID  minflt/s  majflt/s     VSZ     RSS   %MEM  Command</span><br><span class="line">03:17:25 PM     0         1      0.97      0.00  168668   13552   0.08  systemd</span><br><span class="line">03:17:25 PM     0       147      1.85      0.00  228472  158232   0.98  systemd-journal</span><br><span class="line">03:17:25 PM     0       189      0.00      0.00  289100   27392   0.17  multipathd</span><br><span class="line">03:17:25 PM     0       199      0.00      0.00   12160    6376   0.04  systemd-udevd</span><br><span class="line">03:17:25 PM   118       512      0.00      0.00   14624    6400   0.04  systemd-oomd</span><br><span class="line">03:17:25 PM   100       551      0.00      0.00   16044    7296   0.05  systemd-network</span><br><span class="line">03:17:25 PM   101       553      0.00      0.00   26512   10240   0.06  systemd-resolve</span><br><span class="line">03:17:25 PM     0       643      0.00      0.00    2816    1920   0.01  acpid</span><br><span class="line">03:17:25 PM   123       644      0.00      0.00   19088    3840   0.02  avahi-daemon</span><br><span class="line">03:17:25 PM   102       645      0.00      0.00   31628    7436   0.05  dbus-daemon</span><br><span class="line">03:17:25 PM     0       646      0.00      0.00  278416   14852   0.09  NetworkManager</span><br><span class="line">03:17:25 PM     0       649      0.01      0.00  757540   17788   0.11  euc-analytics-a</span><br><span class="line">03:17:25 PM     0       653      0.00      0.00   82768    3840   0.02  irqbalance</span><br><span class="line">03:17:25 PM     0       656      0.00      0.00   48880   10368   0.06  networkd-dispat</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>查看进程使用的 CPU 统计信息</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pidstat -u -l | more</span></span><br><span class="line">Linux 6.8.0-1017-aws (U-3TSDMAL9IVFAQ) 	11/26/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">04:08:08 PM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command</span><br><span class="line">04:08:08 PM     0         1    0.04    0.02    0.00    0.02    0.06     1  /sbin/init</span><br><span class="line">04:08:08 PM     0         2    0.00    0.00    0.00    0.00    0.00     0  kthreadd</span><br><span class="line">04:08:08 PM     0        15    0.00    0.00    0.00    0.01    0.00     0  ksoftirqd/0</span><br><span class="line">04:08:08 PM     0        49    0.00    0.00    0.00    0.00    0.00     2  khugepaged</span><br><span class="line">04:08:08 PM     0        63    0.00    0.00    0.00    0.00    0.00     3  kworker/3:1H-kblockd</span><br><span class="line">04:08:08 PM     0        64    0.00    0.00    0.00    0.00    0.00     3  kswapd0</span><br><span class="line">04:08:08 PM     0        75    0.00    0.00    0.00    0.00    0.00     2  kworker/2:1H-kblockd</span><br><span class="line">04:08:08 PM     0       100    0.00    0.00    0.00    0.00    0.00     0  jbd2/nvme0n1p1-8</span><br><span class="line">04:08:08 PM     0       102    0.00    0.00    0.00    0.00    0.00     1  kworker/1:1H-kblockd</span><br><span class="line">04:08:08 PM     0       129    0.00    0.00    0.00    0.00    0.00     0  kworker/0:1H-kblockd</span><br><span class="line">04:08:08 PM     0       147    0.00    0.00    0.00    0.00    0.01     3  /lib/systemd/systemd-journald</span><br><span class="line">04:08:08 PM     0       189    0.00    0.00    0.00    0.00    0.01     3  /sbin/multipathd -d -s</span><br><span class="line">04:08:08 PM     0       199    0.00    0.00    0.00    0.00    0.00     3  /lib/systemd/systemd-udevd</span><br><span class="line">04:08:08 PM     0       382    0.00    0.00    0.00    0.00    0.00     2  jbd2/nvme1n1p1-8</span><br><span class="line">04:08:08 PM   118       512    0.05    0.05    0.00    0.00    0.10     3  /lib/systemd/systemd-oom</span><br><span class="line">d</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>在使用 <code>pidstat</code> 时如果未指定统计数据的采样间隔及采样次数，则 <strong>默认统计的是从系统启动以来的平均资源使用率，如果目标进程的运行时间相对于系统启动时间很短（例如仅几分钟），那么它的平均 CPU 使用率会趋近于 0</strong> 。比如以下示例：  </p>
<p><em>未指定采样间隔及采样次数</em> ，统计结果显示进程的 CPU 使用率为 <code>0</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pidstat  | grep gzip</span></span><br><span class="line">01:37:06 PM     0       784    0.00    0.00    0.00    0.00     4  gzip</span><br></pre></td></tr></table></figure>

<p><em>以下命令指定采样间隔和采样次数</em> ，统计结果显示 CPU 使用率较高</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pidstat 1 1 | grep gzip</span></span><br><span class="line">01:37:14 PM     0      1974   15.69    1.96    0.00   87.65     7  gzip</span><br><span class="line">Average:        0      1974   15.69    1.96    0.00   87.65     -  gzip</span><br></pre></td></tr></table></figure>

</blockquote>
<h1 id="参考链接-Bibliography"><a href="#参考链接-Bibliography" class="headerlink" title="参考链接|Bibliography"></a>参考链接|Bibliography</h1><p><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a><br><a target="_blank" rel="noopener" href="http://lionheartwang.github.io/blog/2018/06/05/linuxjin-cheng-zhuang-tai-shuo-ming/">Linux进程状态说明</a></p>
<h1 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a>  5.7.1 Example: Linux Scheduling<a href="#fnref:1" rev="footnote"> ↩</a></span></li></ol></div></div>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202311221348/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202311221348/" class="post-title-link" itemprop="url">常用小脚本收集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-11-22 13:48:41" itemprop="dateCreated datePublished" datetime="2023-11-22T13:48:41+08:00">2023-11-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-12-02 17:12:00" itemprop="dateModified" datetime="2024-12-02T17:12:00+08:00">2024-12-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="批量下载"><a href="#批量下载" class="headerlink" title="批量下载"></a>批量下载</h1><h2 id="Python3-批量下载文件中给定的-urls"><a href="#Python3-批量下载文件中给定的-urls" class="headerlink" title="Python3 批量下载文件中给定的 urls"></a>Python3 批量下载文件中给定的 urls</h2><p>假如需要下载的 urls 存在于给定的文件中（每行一个 url），本示例演示批量并发下载，假设 urls 存在于文件 <code>urls.txt</code> 中</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> concurrent.futures</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个函数来下载图片</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_image</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url)</span><br><span class="line">        response.raise_for_status()  <span class="comment"># 检查是否有 HTTP 错误</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;下载完成: <span class="subst">&#123;url&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;下载失败: <span class="subst">&#123;url&#125;</span>, 错误: <span class="subst">&#123;e&#125;</span>&quot;</span>) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件中读取图片链接</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;urls.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    img_urls = file.read().splitlines()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 ThreadPoolExecutor 来限制并发线程数量为 10</span></span><br><span class="line">max_concurrent_threads = <span class="number">10</span></span><br><span class="line"><span class="keyword">with</span> concurrent.futures.ThreadPoolExecutor(max_concurrent_threads) <span class="keyword">as</span> executor:</span><br><span class="line">    <span class="comment"># 提交任务并下载图片</span></span><br><span class="line">    executor.<span class="built_in">map</span>(download_image, img_urls)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;所有图片下载完成&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="shell-批量下载文件中给定的-urls"><a href="#shell-批量下载文件中给定的-urls" class="headerlink" title="shell 批量下载文件中给定的 urls"></a>shell 批量下载文件中给定的 urls</h2><p>假如需要下载的 urls 存在于给定的文件中（每行一个 url），本示例演示批量并发下载，假设 urls 存在于文件 <code>urls.txt</code> 中</p>
<p>本示例中的 <code>urls.txt</code> 内容示例如下：</p>
<figure class="highlight shell"><figcaption><span>urls.txt</span></figcaption><table><tr><td class="code"><pre><span class="line">http://cdn-log-customer-bj4.obs.cn-north-4.myhuaweicloud.com:80/oversea/20241202/09/2024120209-domain-ov.gz?AccessKeyId=WWHEIFLWKIMHHDKIPRWLJJ40CFS&amp;Expires=1733208754&amp;response-content-disposition=attachment%3Bfilename%3D%222024120209-domain-ov.gz%22&amp;Signature=bGHy1CPncaXJladgG9NdIRwASsdgSIvs%3D</span><br><span class="line">http://cdn-log-customer-bj4.obs.cn-north-4.myhuaweicloud.com:80/mainland/20241202/09/2024120209-domain-cn.gz?AccessKeyId=WWHEIFLWKIMHHDKIPRWLJJ40CFS&amp;Expires=1733208754&amp;response-content-disposition=attachment%3Bfilename%3D%222024120209-domain-cn.gz%22&amp;Signature=bGHy1CPncaXJladgG9NdIRwASsdgSIvs%3D</span><br><span class="line">http://cdn-log-customer-bj4.obs.cn-north-4.myhuaweicloud.com:80/oversea/20241202/08/2024120208-domain-ov.gz?AccessKeyId=WWHEIFLWKIMHHDKIPRWLJJ40CFS&amp;Expires=1733208754&amp;response-content-disposition=attachment%3Bfilename%3D%222024120208-domain-ov.gz%22&amp;Signature=ZT64%bGHy1CPncaXJladgG9NdIRwASsdgSIvs%3D</span><br><span class="line">http://cdn-log-customer-bj4.obs.cn-north-4.myhuaweicloud.com:80/mainland/20241202/08/2024120208-domain-cn.gz?AccessKeyId=WWHEIFLWKIMHHDKIPRWLJJ40CFS&amp;Expires=1733208754&amp;response-content-disposition=attachment%3Bfilename%3D%222024120208-domain-cn.gz%22&amp;Signature=bGHy1CPncaXJladgG9NdIRwASsdgSIvs%3D</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>简单的 <strong>串行下载命令</strong> 如下，从 url 中取出文件名作为下载文件名：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for i in `cat urls.txt`; do fn=`echo $i | cut -d&#x27;?&#x27; -f1  | cut -d&#x27;/&#x27; -f7` ; curl -o $fn &quot;$i&quot;; done</span><br></pre></td></tr></table></figure>

<p>使用以上命令，如果下载内容太多，会比较慢，以下代码示例使用 <strong><code>xargs</code> 命令批量下载，<code>xargs</code> 会自动分配任务，确保多个下载任务同时运行</strong> 。：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat log-url | xargs -P 10 -I &#123;&#125; sh -c &#x27;fn=$(echo &quot;&#123;&#125;&quot; | cut -d&quot;?&quot; -f1 | cut -d&quot;/&quot; -f7);  curl -o $fn &quot;&#123;&#125;&quot;&#x27;</span><br></pre></td></tr></table></figure>
<p><code>xargs</code> 参数说明：</p>
<ul>
<li><code>-P 10</code> : 指定并发进程数为 10，可以根据系统资源调整。</li>
<li><code>-I &#123;&#125;</code> : 替换（Pipe）输入中的每行（URL） 为 <code>&#123;&#125;</code> 。</li>
</ul>
<p>如果无需提取文件名，可以 <strong>使用 <code>wget</code> 命令的并行下载功能</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget -i urls.txt -P output-dir -nc --max-threads=10</span><br></pre></td></tr></table></figure>
<p>参数说明如下：</p>
<ul>
<li><code>-i urls.txt</code> : 从文件中读取下载 URL。</li>
<li><code>-P output-dir</code> : 将下载文件存储到 <code>output-dir</code>。</li>
<li><code>--max-threads=10</code> : 设置并发线程数为 10。</li>
<li><code>-nc</code> : 跳过已下载的文件，避免重复下载。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241128094720/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20241128094720/" class="post-title-link" itemprop="url">Linux CPUs</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-28 09:11:00" itemprop="dateCreated datePublished" datetime="2024-11-28T09:11:00+08:00">2024-11-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" itemprop="url" rel="index"><span itemprop="name">性能分析</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="CPU-Architecture-and-Common-Concepts"><a href="#CPU-Architecture-and-Common-Concepts" class="headerlink" title="CPU Architecture and Common Concepts"></a>CPU Architecture and Common Concepts</h1><h2 id="CPU-Architecture"><a href="#CPU-Architecture" class="headerlink" title="CPU Architecture"></a>CPU Architecture</h2><p>下图展示了一个简单的 CPU 架构图，有一个物理 CPU（Physical Processor），包含 4 个 CPU Cores，每个 CPU Core 包含 2 个 Hardware Threads，总计 8 个 CPUs。右侧的图是这 8 个 CPUs 在操作系统（Operating System）中的视图（也被称为 Logical CPU&#x2F;Virtual Processor&#x2F;Virtual Core） <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Systems Performance: Enterprise and the Cloud v2](https://s.csms.tech/file/Systems.Performance.Enterprise.and.the.Cloud.2nd.Edition.2020.12.pdf) #6.2.1 CPU Architecture">[1]</span></a></sup><br><img src="https://i.csms.tech/img_281.png"></p>
<p>Operating System 可能对于 CPU 的拓扑结构（Topology）有一定程度的了解，如知道哪些 Logical CPU 位于同一个 CPU Core 或者 CPU Cache 是如何被共享的（Shared），这有助于 CPU Scheduler 做出更优的调度决策。</p>
<p>下图展示了通用 2 Core 处理器的组成。具体的组成取决于具体的处理器。<br><img src="https://i.csms.tech/img_284.png"></p>
<ul>
<li><code>Control Unit</code> 是 CPU 处理器的核心组件，负责指令（Instruction）的 <code>Fetch</code>、<code>Decoding</code>、<code>Execution</code> 并负责保存执行结果（Storing Results）。</li>
<li><code>Shared Floating-Points Unit</code></li>
<li><code>Shared Level-3 Cache</code></li>
<li><code>MMU</code> Memory Management Unit，负责将虚拟内存地址转换为物理内存地址（Virtual-to-Physical Address Translation）</li>
<li><code>TLB</code> Translation Lookaside Buffer，用于 Cache 内存地址转换（Virtual-to-Physical Address Translation），未缓存的地址转换需要去 Main Memory 中的 Page Tables 中查询，MMU 的基本构成如下图<br><img src="https://i.csms.tech/img_286.png"></li>
</ul>
<h2 id="P-States-and-C-States"><a href="#P-States-and-C-States" class="headerlink" title="P-States and C-States"></a>P-States and C-States</h2><p>Intel 处理器的 ACPI（Advanced Configuration and Power Interface）标准定义了 <strong>P-States (Processor Performance States)</strong>  和 <strong>S-States (Processor Power States)</strong> 。 <sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Systems Performance: Enterprise and the Cloud v2](https://s.csms.tech/file/Systems.Performance.Enterprise.and.the.Cloud.2nd.Edition.2020.12.pdf) #6.4.1 P-States and C-States">[4]</span></a></sup></p>
<ul>
<li><strong>P-States</strong> 通过在 Processor 运行过程中提供不同的 Clock Rate 提供不同的性能选择。 <strong>P0</strong> 提供最高级别的性能，<strong>P1</strong> 到 <strong>PN</strong> 提供较慢的 Clock Rate，这些级别通常可以被硬件（如依赖处理器温度）或者系统上的软件（如内核的节能策略）控制。</li>
<li><strong>C-States</strong> 提供当 CPU 处于 Idle 时，提供不同的 <code>idle states</code>，用于节省电力（节能），下图列出了常见的 C-States<br><img src="https://i.csms.tech/img_285.png"></li>
</ul>
<p>Linux 中可以配置和管理 CPU Status 的方式包括(是否支持取决于不同的 Processor、操作系统和内核版本)：</p>
<ul>
<li><code> /sys/devices/system/cpu/cpufreq/policy0/scaling_available_governors</code> 可以查看可用的 CPU Scaling Governors，一般包括 <code>performance</code>、 <code>powersave</code>，通过配置 <code>/sys/devices/system/cpu/cpufreq/policy0/scaling_governor</code> 为对应值。 <sup id="fnref:6"><a href="#fn:6" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Systems Performance: Enterprise and the Cloud v2](https://s.csms.tech/file/Systems.Performance.Enterprise.and.the.Cloud.2nd.Edition.2020.12.pdf) #6.9.4 Scaling Governors">[6]</span></a></sup></li>
<li><code>cpupower</code> 工具箱，其中包括 <code>cpupower frequency-info</code>、<code>cpupower frequency-set</code> 等一系列管理和查看 CPU 频率等信息的工具</li>
</ul>
<h2 id="CPU-Memory-Caches"><a href="#CPU-Memory-Caches" class="headerlink" title="CPU Memory Caches"></a>CPU Memory Caches</h2><p>Processors（物理 CPU 处理器）提供了各种个样的硬件缓存（Hardware Caches）用于提高 CPU 读写 Memory I&#x2F;O 的性能（CPU 的处理速度是 Memory I&#x2F;O 处理速度的多个量级），下图展示了 Processor Caches 在大小（Sizes）和响应速度之间的关系， <strong>离 Processor 越近，其响应速度越快，存储空间越小，成本越高（贵）</strong><br><img src="https://i.csms.tech/img_282.png"></p>
<h2 id="Clock-Rate"><a href="#Clock-Rate" class="headerlink" title="Clock Rate"></a>Clock Rate</h2><p><strong>CPU 时钟频率（Clock Rate）</strong> 是指 Processor 每秒跳动（转换）的次数，每一个 Processor 的时钟变化也称为一个 <strong>Clock Cycle</strong> 。 Processor 通常是以特定的时钟频率运行，比如 4GHz 的 CPU 每秒会进行 4 Billion Clock Cycles。每个 CPU 指令（Instruction）都需要通过一个或者多个 Clock Cycles 来完成。 <strong>现代 CPU 通常会变频，即调整 Processor 的 Clock Rate，如果提高 CLock Rate 以提升性能，降低 Clock Rate 以节能</strong> 。变频操作通常是通过 OS 请求 Processor 变频或者是 Processor 自动进行变频，比如内核中的 <code>idle</code> 线程通常会要求 CPU 降低其 Clock Rate 以节能。</p>
<p>Clock Rate 是衡量 Processor 能力（Capacity）的一个主要指标。通常来说，较高 Clock Rate 的 Processor 会有更高的性能，但是在性能分析的场景中，提高 CPU 的 Clock Rate 不一定会提高 CPU 性能，这主要取决于 CPU 的 Clock Cycles 到底是在忙于什么，如果 Clock Cycles 主要忙于等待 Memory Access，那么换成更高频率的处理器，并不会提高整个系统的性能。</p>
<h2 id="SMT"><a href="#SMT" class="headerlink" title="SMT"></a>SMT</h2><p>Simultaneous Multi-Threading(SMT) 是一种由 Processor 支持的硬件多线程（Hardware Multithreading）技术，用于实现同一个 Processor Core 上的并发（Parallelism），它允许一个 CPU Core 运行多个 Thread，每个 Hardware Thread 从 Operating System 层面来看都是一个 CPU。这种技术的典型应用包括 Intel 的 Hyper-Threading 技术，允许每个 Processor Core 运行 2 个 Threads，以及 POWER8，允许每个 Processor Core 运行 8 个 Threads。</p>
<p>SMT 的实现通常基于 Core 运行指令（Instructions）的过程中的 <code>Stall Cycles</code>，当某个指令处于 <code>Stall Cycles</code> 时，Core 会允许调度另一个指令来运行。基于 Hardware Thread 的 CPU，其性能和单独的 CPU Core 是有区别的，这个差别取决于其上的工作负载（Workload），<code>Stall Cycles</code> 严重的 Workloads 会比 <code>Instruction Cycles</code> 严重的 Workloads 性能更好，因为 <code>Stall Cycles</code> 会减少竞争（Core Contention）  </p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../20241128094720/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241105095741/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20241105095741/" class="post-title-link" itemprop="url">Systems Performance Enterprise and the Cloud v2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-05 09:11:00" itemprop="dateCreated datePublished" datetime="2024-11-05T09:11:00+08:00">2024-11-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-26 16:11:00" itemprop="dateModified" datetime="2024-11-26T16:11:00+08:00">2024-11-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/OS/Systems-Performance-Enterprise-and-the-Cloud-v2/" itemprop="url" rel="index"><span itemprop="name">Systems Performance Enterprise and the Cloud v2</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="性能分析相关的术语"><a href="#性能分析相关的术语" class="headerlink" title="性能分析相关的术语"></a>性能分析相关的术语</h1><p>以下为性能分析中常用到的专业术语或指标 <sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="#2.1 Terminology">[2]</span></a></sup></p>
<ul>
<li><p><strong>IOPS</strong><br>  Input&#x2F;Output Operations Per Second. 用于衡量数据传输操作（Rate of Data transfer operations）的频率。对于硬盘 I&#x2F;O （Disk I&#x2F;O）来说，指 <strong>每秒发生的读写请求</strong> 。</p>
</li>
<li><p><strong>Throughput</strong><br>  <strong>吞吐量</strong> 。在网络通信中，主要指 <strong>数据传输速率（Data Rate, bytes&#x2F;bits per second）</strong> 。在其他上下文（Contexts,如 Databases），Throughput 通常指 Operation Rate（Operations Per Second or Transactions Per Second）</p>
</li>
<li><p><strong>Response Time</strong><br>  <strong>响应时间</strong> 。一个操作执行到结束的时间。这通常包括 <strong>请求等待时间（Waiting Time）</strong> 、 <strong>被服务时间（Serviced Time）</strong> 、 <strong>传输时间（Transfer Time）</strong></p>
</li>
<li><p><strong>Latency</strong><br>  <strong>延迟</strong> 。可以指某个操作（Operation）消耗在 <strong>等待被处理&#x2F;服务（Time Waiting to be Serviced&#x2F;Processed）的时间</strong> 。在某些上下文中，等同于 <strong>Response Time</strong> 。</p>
</li>
<li><p><strong>Utilization</strong><br>  <strong>使用率</strong> 。衡量资源的忙的程度。</p>
</li>
<li><p><strong>Saturation</strong><br>衡量一个资源（如 CPU）的待处理队列中未处理的任务数量。</p>
</li>
<li><p><strong>Bottleneck</strong> </p>
</li>
<li><p><strong>Workload</strong><br>  一般是客户端请求</p>
</li>
<li><p><strong>Cache</strong>  </p>
</li>
<li><p><strong>SUT</strong><br>  <strong>System Under Test</strong> 。性能测试目标</p>
</li>
<li><p><strong>Off-CPU</strong><br>  Off-CPU 指的是当前不在 CPU 上运行的程序的一种状态。比如在性能分析过程中，需要分析当前不在 CPU 上运行的 Process&#x2F;Threads 所处的状态，通常包括导致 Task 被 Block 的原因： <code>Disk I/O</code>、<code>Network I/O</code>、<code>Lock Contention</code>、<code>Explicit Sleeps</code>、<code>Scheduler Preemption</code> 等</p>
</li>
</ul>
<h1 id="Thread-State-Analysis"><a href="#Thread-State-Analysis" class="headerlink" title="Thread State Analysis"></a>Thread State Analysis</h1><p>在进行性能分析的过程中，特别是 Application Performance Analysis，首先要清楚 Process&#x2F;Thread&#x2F;Task 所处的当前状态，至少可以将其划分为 2 个状态： <sup id="fnref:8"><a href="#fn:8" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="#5.4.5 Thread State Analysis">[8]</span></a></sup></p>
<ul>
<li>On-CPU</li>
<li>Off-CPU</li>
</ul>
<p>更详细的状态划分可以参考以下状态：</p>
<ul>
<li><code>User</code>  ： On-CPU ，用户模式（User Mode）</li>
<li><code>Kernel</code> ： On-CPU，Kernel 模式</li>
<li><code>Runnable</code> ： Off-CPU，正在等待调度到 CPU（等待变为 On-CPU）</li>
<li><code>Swapping</code> ： Runnable，但是被 <code>Page-In</code> 阻塞（Blocked）</li>
<li><code>Disk I/O</code> ： 等待 Block Device I&#x2F;O</li>
<li><code>Network I/O</code> ： 等待网络 I&#x2F;O，如 Sockets 读&#x2F;写</li>
<li><code>Sleeping</code> ： 自愿睡眠状态（Voluntary Sleep）</li>
<li><code>Lock</code> ： 等待获取锁</li>
<li><code>Idle</code> ： 等待工作（Waiting for work）</li>
</ul>
<p><img src="https://i.csms.tech/img_280.png"></p>
<h1 id="Observability-Tools"><a href="#Observability-Tools" class="headerlink" title="Observability Tools"></a>Observability Tools</h1><p>Linux 系统各个部分相关的监控工具如下图： <sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="#4.1 Tool Coverage">[3]</span></a></sup><br><img src="https://i.csms.tech/img_275.png"></p>
<p>Linux Static Performance Tuning Tools:<br><img src="https://i.csms.tech/img_276.png"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../20241105095741/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202405311003/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202405311003/" class="post-title-link" itemprop="url">操作系统导论</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-05-31 10:03:37" itemprop="dateCreated datePublished" datetime="2024-05-31T10:03:37+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-19 11:11:00" itemprop="dateModified" datetime="2024-11-19T11:11:00+08:00">2024-11-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/OS/Operating-System-Concepts-v10/" itemprop="url" rel="index"><span itemprop="name">Operating System Concepts v10</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文档中的内容主要源于以下书籍：</p>
<ul>
<li><strong><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online(操作系统导论第10版)</a></strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://s.csms.tech/file/Systems.Performance.Enterprise.and.the.Cloud.2nd.Edition.2020.12.pdf">Systems Performance: Enterprise and the Cloud v2</a></strong></li>
</ul>
<h1 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h1><h2 id="Main-Memory"><a href="#Main-Memory" class="headerlink" title="Main Memory"></a>Main Memory</h2><p><strong>Main Memory</strong> 通常是 CPU 可以直接定位和访问的唯一的大存储设备。如果 CPU 要处理磁盘上的数据，数据必须首先被传输到 <strong>Main Memory</strong>，指令要能被 CPU 执行，也必须首先载入内存中。</p>
<p><strong><code>Program</code></strong> 要能被运行，首先必须载入到内存中，并提供内存绝对地址给 CPU 以供加载指令和数据。</p>
<h2 id="Logical-Memory-Address-and-Virtual-Memory-Address"><a href="#Logical-Memory-Address-and-Virtual-Memory-Address" class="headerlink" title="Logical Memory Address and Virtual Memory Address"></a>Logical Memory Address and Virtual Memory Address</h2><p>通常情况下，CPU 生成的内存地址被称为 <code>Logical Memory Address</code>，也称为 <code>Virtual Memory Address</code>。</p>
<p>Memory-address 注册器（memory-address register）加载的地址通常称为 <code>Physical Memory Address</code>。</p>
<p>程序运行过程中，CPU 操作的是 <code>Virtual Memory Address</code>，需要由硬件设备 MMU（Memory Management Unit）负责将 <code>Virtual Memory Address space</code> 映射到对应的 <code>Physical Memory Address space</code>。程序或者是 CPU 运行过程中，不会直接操作（访问&#x2F;access）物理内存地址空间。</p>
<p><img src="https://i.csms.tech/img_243.png"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202405311003/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20240822111015/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20240822111015/" class="post-title-link" itemprop="url">Linux systemd</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-22 11:08:00" itemprop="dateCreated datePublished" datetime="2024-08-22T11:08:00+08:00">2024-08-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-15 16:11:00" itemprop="dateModified" datetime="2024-11-15T16:11:00+08:00">2024-11-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>systemd</code> 是一种用于 Linux 操作系统的系统和服务管理器。它被广泛应用于许多现代 Linux 发行版中，如 CentOS、Fedora、Ubuntu 等。<code>systemd</code> 旨在替代传统的 <code>SysV</code> 和 <code>LSB init</code> 系统，并提供更强大、灵活的系统启动和服务管理功能。</p>
<p><code>systemd</code> 的关键概念和组件</p>
<ul>
<li><p><strong>Unit 文件</strong>：</p>
<ul>
<li><strong><code>systemd</code> 使用单元（<code>Unit</code>）文件来描述系统资源</strong>。常见的单元类型包括：<ul>
<li><code>Service Unit (*.service)</code> ： 用于定义和管理服务。</li>
<li><code>Target Unit (*.target)</code> ： 用于分组和同步一组单元的启动，如 <code>multi-user.target</code>。</li>
<li><code>Timer Unit (*.timer)</code> ： 用于定时任务，相当于 <code>cron</code> 的替代品。</li>
<li><code>Socket Unit (*.socket)</code> ：用于管理网络或 IPC 套接字。</li>
<li><code>Mount Unit (*.mount)</code> ： 用于定义挂载点。</li>
<li><code>Path Unit (*.path)</code> : 监控文件或者目录的变化。当监控的文件或目录发生变化时，可以触发相应的 <code>service</code> 单元。</li>
</ul>
</li>
<li><strong>单元（<code>Unit</code>）文件通常存储在以下目录</strong><ul>
<li><code>/etc/systemd/system/</code> ：系统管理员定义的单位文件，优先级较高。</li>
<li><code>/lib/systemd/system/</code> ：发行版提供的单位文件，优先级较低。</li>
<li><code>/run/systemd/system/</code> ：运行时生成的单位文件，临时的。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Target 文件</strong></p>
<ul>
<li><code>systemd</code> 使用 <code>target</code> 取代传统的运行级别（<code>runlevel</code>）。常见的目标包括：<ul>
<li><code>multi-user.target</code> ： 相当于传统的运行级别 3，支持多用户、无图形界面。</li>
<li><code>graphical.target</code> ： 相当于传统的运行级别 5，支持多用户和图形界面。</li>
<li><code>rescue.target</code> ： 相当于传统的单用户模式，提供基本的系统恢复环境。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>日志管理</strong></p>
<ul>
<li><code>systemd</code> <a href="/202211211437/" title="使用 &#96;journald&#96;">使用 &#96;journald&#96;</a> 来管理系统日志。你可以使用 <code>journalctl</code> 命令查看日志</li>
</ul>
</li>
<li><p><strong>服务间的依赖关系</strong></p>
<ul>
<li><code>systemd</code> 处理服务间的依赖关系。你可以通过 <code>After=</code>、<code>Before=</code>、<code>Requires=</code> 等指令在单元文件中定义这些依赖。</li>
</ul>
</li>
</ul>
<p><strong><code>systemd</code> 的优势：</strong></p>
<ul>
<li><strong>并行启动</strong>： <code>systemd</code> 可以并行启动服务，减少启动时间。</li>
<li><strong>依赖管理</strong> ： 能够自动处理服务间的依赖关系，保证系统按需启动服务。</li>
<li><strong>日志记录</strong> ： <code>systemd</code> 的日志管理功能强大，提供了统一的接口查看和分析日志。</li>
<li><strong>定时任务管理</strong> ： 通过 <code>timer</code> 单元文件可以灵活地配置定时任务，作为 <code>cron</code> 的替代方案。</li>
<li><strong>性能统计数据</strong> ： <code>systemd</code> 启动过程中记录了性能（如服务启动时间）相关的统计数据，可以使用命令 <a href="https://csms.tech/202301171137/#启动过程">systemd-analyze</a> 查看。</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../20240822111015/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202406271324/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202406271324/" class="post-title-link" itemprop="url">Linux system call</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-27 13:24:42" itemprop="dateCreated datePublished" datetime="2024-06-27T13:24:42+08:00">2024-06-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-14 10:11:00" itemprop="dateModified" datetime="2024-11-14T10:11:00+08:00">2024-11-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="CPU-相关的-syscall-函数"><a href="#CPU-相关的-syscall-函数" class="headerlink" title="CPU 相关的 syscall 函数"></a>CPU 相关的 syscall 函数</h1><p>Linux System Call 的帮助文档包含在内核文档中，可以通过 <code>man 2</code> 查看对应的手册，如 <code>man 2 fork</code>。</p>
<table>
<thead>
<tr>
<th>system call function</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>fork</code></td>
<td>创建 Processes<br/>Linux 中的 <code>fork</code> 是通过封装了 <code>clone</code> 函数实现的</td>
<td></td>
</tr>
</tbody></table>
<h1 id="内存相关的-syscall"><a href="#内存相关的-syscall" class="headerlink" title="内存相关的 syscall"></a>内存相关的 syscall</h1><table>
<thead>
<tr>
<th>system call function</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>shm open</code></td>
<td>使用 <code>Shared Memory</code> 方式的 IPC 进程使用此方法创建 <code>shared memory</code>，要相互通信的进程链接到此 FD（File Descripter）</td>
<td><code>fd = shm open(name, O CREAT &amp;#124; O RDWR, 0666);</code></td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202306071109/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202306071109/" class="post-title-link" itemprop="url">Prometheus Node exporter 使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-07 11:09:43" itemprop="dateCreated datePublished" datetime="2023-06-07T11:09:43+08:00">2023-06-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-06 17:11:00" itemprop="dateModified" datetime="2024-11-06T17:11:00+08:00">2024-11-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/Prometheus/" itemprop="url" rel="index"><span itemprop="name">Prometheus</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos 7</li>
<li>Prometheus 2.44.0</li>
<li>node_exporter-1.6.0</li>
</ul>
<h1 id="node-exporter-安装"><a href="#node-exporter-安装" class="headerlink" title="node_exporter 安装"></a>node_exporter 安装</h1><p><a target="_blank" rel="noopener" href="https://prometheus.io/docs/guides/node-exporter/#installing-and-running-the-node-exporter">安装 node_exporter 官方文档</a></p>
<p>以下步骤演示安装 <code>node_exporter</code> 并使用 <code>systemd</code> 管理服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://github.com/prometheus/node_exporter/releases/download/v1.6.0/node_exporter-1.6.0.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">tar -xf node_exporter-1.6.0.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">cp node_exporter-1.6.0.linux-amd64/node_exporter /usr/bin/</span><br></pre></td></tr></table></figure>
<p>生成 <code>systemd</code> 服务配置文件 <code>/usr/lib/systemd/system/node_exporter.service</code></p>
<figure class="highlight shell"><figcaption><span>/usr/lib/systemd/system/node_exporter.service</span></figcaption><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=node_exporter</span><br><span class="line">After=syslog.target</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/bin/node_exporter</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=10</span><br><span class="line">StartLimitInterval=100</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>执行以下命令管理服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl daemon-reload</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl status node_exporter</span></span><br><span class="line">● node_exporter.service - node_exporter</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/node_exporter.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: inactive (dead)</span><br><span class="line">   </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl <span class="built_in">enable</span> --now node_exporter</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/node_exporter.service to /usr/lib/systemd/system/node_exporter.service.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl status node_exporter</span></span><br><span class="line">● node_exporter.service - node_exporter</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/node_exporter.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Fri 2023-06-23 10:34:08 CST; 2s ago</span><br><span class="line"> Main PID: 28578 (node_exporter)</span><br><span class="line">   CGroup: /system.slice/node_exporter.service</span><br><span class="line">           └─28578 /usr/bin/node_exporter   </span><br></pre></td></tr></table></figure>

<h1 id="node-exporter-配置信息"><a href="#node-exporter-配置信息" class="headerlink" title="node_exporter 配置信息"></a>node_exporter 配置信息</h1><h2 id="启动参数详解"><a href="#启动参数详解" class="headerlink" title="启动参数详解"></a>启动参数详解</h2><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>--web.listen-address=&quot;:9100&quot;</code></td>
<td>node_exporter 监听端口，默认 9100</td>
<td></td>
</tr>
<tr>
<td><code>--web.telemetry-path=&quot;/metrics&quot;</code></td>
<td>prometheus 获取 Metrics 访问的 url，默认 <code>/metrics</code></td>
<td></td>
</tr>
<tr>
<td><code>--log.level=&quot;info&quot;</code></td>
<td>日志级别</td>
<td></td>
</tr>
<tr>
<td><code>--log.format=&quot;logger:stderr&quot;</code></td>
<td>日志打印格式</td>
<td></td>
</tr>
<tr>
<td><code>--collector.disable-defaults</code></td>
<td>关闭默认的采集项</td>
<td></td>
</tr>
<tr>
<td><code>--no-collector.$&#123;item&#125;</code></td>
<td>关闭某一项默认开启的采集项</td>
<td><code>--no-collector.cpu</code></td>
</tr>
<tr>
<td><code>--collector.systemd.unit-include=&quot;(docker&#39;|&#39;sshd).service&quot;</code></td>
<td>收集指定服务的指标</td>
<td></td>
</tr>
</tbody></table>
<p>可以配置通过正则表达式屏蔽或者选择某些监控项 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[node_exporter 官网 github](https://github.com/prometheus/node_exporter)">[1]</span></a></sup></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>--collector.diskstats.ignored-devices=&quot;^(ram&#39;|&#39;loop&#39;|&#39;)\\d+$&quot;</code></td>
<td>忽略某些磁盘的信息收集</td>
<td></td>
</tr>
<tr>
<td><code>--collector.filesystem.ignored-mount-points=&quot;^/(dev&#39;|&#39;proc&#39;|&#39;)($&#39;|&#39;/)&quot;</code></td>
<td>忽略某些文件系统挂载点的信息收集</td>
<td></td>
</tr>
<tr>
<td><code>--collector.filesystem.ignored-fs-types=&quot;^(autofs&#39;|&#39;proc)$&quot;</code></td>
<td>忽略某些文件系统类型的信息收集</td>
<td></td>
</tr>
<tr>
<td><code>--collector.netclass.ignored-devices=&quot;^$&quot;</code></td>
<td>忽略某些网络类的信息收集</td>
<td></td>
</tr>
<tr>
<td><code>--collector.netdev.ignored-devices=&quot;^$&quot;</code></td>
<td>忽略某些网络设备的信息收集</td>
<td></td>
</tr>
<tr>
<td><code>--collector.netstat.fields=&quot;^$&quot;</code></td>
<td>配置需要获取的网络状态信息</td>
<td></td>
</tr>
<tr>
<td><code>--collector.vmstat.fields=&quot;^(oom_kill&#39;|&#39;pgpg&#39;|&#39;pswp).*&quot;</code></td>
<td>配置 vmstat 返回信息中需要收集的选项</td>
<td></td>
</tr>
</tbody></table>
<h2 id="功能对照表"><a href="#功能对照表" class="headerlink" title="功能对照表"></a>功能对照表</h2><h3 id="默认开启的功能"><a href="#默认开启的功能" class="headerlink" title="默认开启的功能"></a>默认开启的功能</h3><p>默认开启的功能 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[node_exporter 官网 github](https://github.com/prometheus/node_exporter)">[1]</span></a></sup></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>系统</th>
</tr>
</thead>
<tbody><tr>
<td><code>arp</code></td>
<td>从 <code>/proc/net/arp</code> 中收集 ARP 统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>conntrack</code></td>
<td>从 <code>/proc/sys/net/netfilter/</code> 中收集 <code>conntrack</code> 统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>cpu</code></td>
<td>收集 cpu 统计信息</td>
<td>Darwin, Dragonfly, FreeBSD, Linux</td>
</tr>
<tr>
<td><code>diskstats</code></td>
<td>从 <code>/proc/diskstats</code> 中收集磁盘 I&#x2F;O 统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>edac</code></td>
<td>错误检测与纠正统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>entropy</code></td>
<td>可用内核熵信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>exec</code></td>
<td>execution 统计信息</td>
<td>Dragonfly, FreeBSD</td>
</tr>
<tr>
<td><code>filefd</code></td>
<td>从 <code>/proc/sys/fs/file-nr</code> 中收集文件描述符统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>filesystem</code></td>
<td>文件系统统计信息，例如磁盘已使用空间</td>
<td>Darwin, Dragonfly, FreeBSD, Linux, OpenBSD</td>
</tr>
<tr>
<td><code>hwmon</code></td>
<td>从 <code>/sys/class/hwmon/</code> 中收集监控器或传感器数据信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>infiniband</code></td>
<td>从 InfiniBand 配置中收集网络统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>loadavg</code></td>
<td>收集系统负载信息</td>
<td>Darwin, Dragonfly, FreeBSD, Linux, NetBSD, OpenBSD, Solaris</td>
</tr>
<tr>
<td><code>mdadm</code></td>
<td>从 <code>/proc/mdstat</code> 中获取设备统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>meminfo</code></td>
<td>内存统计信息</td>
<td>Darwin, Dragonfly, FreeBSD, Linux</td>
</tr>
<tr>
<td><code>netdev</code></td>
<td>网口流量统计信息，单位 bytes</td>
<td>Darwin, Dragonfly, FreeBSD, Linux, OpenBSD</td>
</tr>
<tr>
<td><code>netstat</code></td>
<td>从 <code>/proc/net/netstat</code> 收集网络统计数据，等同于 <code>netstat -s</code></td>
<td>Linux</td>
</tr>
<tr>
<td><code>sockstat</code></td>
<td>从 <code>/proc/net/sockstat</code> 中收集 socket 统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>stat</code></td>
<td>从 <code>/proc/stat</code> 中收集各种统计信息，包含系统启动时间，forks, 中断等</td>
<td>Linux</td>
</tr>
<tr>
<td><code>textfile</code></td>
<td>通过 <code>--collector.textfile.directory</code> 参数指定本地文本收集路径，收集文本信息</td>
<td>any</td>
</tr>
<tr>
<td><code>time</code></td>
<td>系统当前时间</td>
<td>any</td>
</tr>
<tr>
<td><code>uname</code></td>
<td>通过 <code>uname</code> 系统调用, 获取系统信息</td>
<td>any</td>
</tr>
<tr>
<td><code>vmstat</code></td>
<td>从 <code>/proc/vmstat</code> 中收集统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>wifi</code></td>
<td>收集 <code>wifi</code> 设备相关统计数据</td>
<td>Linux</td>
</tr>
<tr>
<td><code>xfs</code></td>
<td>收集 xfs 运行时统计信息</td>
<td>Linux (kernel 4.4+)</td>
</tr>
<tr>
<td><code>zfs</code></td>
<td>收集 zfs 性能统计信息</td>
<td>Linux</td>
</tr>
</tbody></table>
<h3 id="默认关闭的功能"><a href="#默认关闭的功能" class="headerlink" title="默认关闭的功能"></a>默认关闭的功能</h3><p>默认关闭的功能 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[node_exporter 官网 github](https://github.com/prometheus/node_exporter)">[1]</span></a></sup></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>系统</th>
</tr>
</thead>
<tbody><tr>
<td><code>bonding</code></td>
<td>收集系统配置以及激活的绑定网卡数量</td>
<td>Linux</td>
</tr>
<tr>
<td><code>buddyinfo</code></td>
<td>从 <code>/proc/buddyinfo</code> 中收集内存碎片统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>devstat</code></td>
<td>收集设备统计信息</td>
<td>Dragonfly, FreeBSD</td>
</tr>
<tr>
<td><code>drbd</code></td>
<td>收集远程镜像块设备（DRBD）统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>interrupts</code></td>
<td>收集更具体的中断统计信息</td>
<td>Linux，OpenBSD</td>
</tr>
<tr>
<td><code>ipvs</code></td>
<td>从 <code>/proc/net/ip_vs</code> 中收集 IPVS 状态信息，从 <code>/proc/net/ip_vs_stats</code> 获取统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>ksmd</code></td>
<td>从 <code>/sys/kernel/mm/ksm</code> 中获取内核和系统统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>logind</code></td>
<td>从 <code>logind</code> 中收集会话统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>meminfo_numa</code></td>
<td>从 <code>/proc/meminfo_numa</code> 中收集内存统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>mountstats</code></td>
<td>从 <code>/proc/self/mountstat</code> 中收集文件系统统计信息，包括 NFS 客户端统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>nfs</code></td>
<td>从 <code>/proc/net/rpc/nfs</code> 中收集 NFS 统计信息，等同于 <code>nfsstat -c</code></td>
<td>Linux</td>
</tr>
<tr>
<td><code>qdisc</code></td>
<td>收集队列推定统计信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>runit</code></td>
<td>收集 <code>runit</code> 状态信息</td>
<td>any</td>
</tr>
<tr>
<td><code>supervisord</code></td>
<td>收集 <code>supervisord</code> 状态信息</td>
<td>any</td>
</tr>
<tr>
<td><code>systemd</code></td>
<td>从 <code>systemd</code> 中收集设备系统状态信息</td>
<td>Linux</td>
</tr>
<tr>
<td><code>tcpstat</code></td>
<td>从 <code>/proc/net/tcp</code> 和 <code>/proc/net/tcp6</code> 收集 TCP 连接状态信息</td>
<td>Linux</td>
</tr>
</tbody></table>
<h2 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h2><h3 id="采集白名单配置"><a href="#采集白名单配置" class="headerlink" title="采集白名单配置"></a>采集白名单配置</h3><p>关闭默认的采集项，只开启指定的采集项（白名单）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">node-exporter --collector.disable-defaults --collector.cpu --collector.meminfo</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202306071109/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241023162615/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20241023162615/" class="post-title-link" itemprop="url">BIOS 和 UEFI</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-23 16:10:00" itemprop="dateCreated datePublished" datetime="2024-10-23T16:10:00+08:00">2024-10-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-04 15:11:00" itemprop="dateModified" datetime="2024-11-04T15:11:00+08:00">2024-11-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>计算机启动（上电）后，需要固件（firmware）程序来 <strong>初始化硬件</strong> 以及选择 <strong>需要启动的 Operating System</strong></p>
<p>曾经最流行的固件（firmware）程序是 BIOS（Basic Input Output System），最近 BIOS 正在逐渐被 UEFI（Unified Extensible Firmware Interface）取代。在同一个计算机上，他们只能使用一个（互斥）</p>
<p>UEFI 设计包含安全启动特性（Secure Boot Feature），他可以确保 <strong>只有所有组建都进行过有效签名的 OS 才能启动过程中被加载</strong> 。此特性也可以禁用以启动未经签名的 OS.</p>
<p>BIOS 或者 UEFI 的主要工作是 <strong>初始化硬件</strong> 和 <strong>并将计算机控制权移交给 Boot Loader</strong> ，之后 Boot Loader 会寻找并启动 Operating System.</p>
<p>BIOS 或者 UEFI 通常可以在计算机上电启动后进行配置，一般通过特定的按键（如 F1、F2、F12 等）进入设定界面。主要包含 2 部分内容</p>
<ul>
<li><strong>Bios&#x2F;UEFI 配置工具</strong> ： 可以修改 BIOS&#x2F;UEFI 设定，如启用&#x2F;禁止某些功能</li>
<li><strong>Boot Order</strong> ： 修改启动顺序，如从特定设备（CD、DVD、USB 等）启动</li>
</ul>
<h1 id="BIOS"><a href="#BIOS" class="headerlink" title="BIOS"></a>BIOS</h1><p>BIOS 是位于主板（motherboard）上的一个芯片，负责初始化 CPU（Central Processing Unit）、RAM（Random Access Memory）、PCIE Card（Peripheral Component Interconnect Express Card）和 Network Devices. BIOS 通电后后会立即执行 POST（Power-on self test），确保硬件（CPU、RAM、PCIE、NIC等）配置正确并可正常运行。</p>
<ul>
<li><strong>BIOS 仅支持运行于 16 位处理器模式下</strong> ，这限制了任一时刻固件上运行的软件命令（Software Commands）的数量。</li>
<li><strong>BIOS 为任务运行只分配 1M 内存</strong></li>
<li><strong>BIOS 运行中的接口和设备（Interfaces and Devices）只能按顺序初始化</strong> ，可能会导致开机缓慢</li>
<li><strong>BIOS 查找 MBR（Master Boot Record）以确定 OS 的位置并运行 Boot Loader</strong> 。MBR 只有 32-bit 的空间用于描述分区（Partitions）的信息，这限制了基于 BIOS 启动的系统，最多支持 4 个主分区（3 个主分区和 1 个逻辑分区），并且分区最大不能超过 2TB.</li>
</ul>
<h1 id="UEFI"><a href="#UEFI" class="headerlink" title="UEFI"></a>UEFI</h1><p>UEFI 最初由 Intel 提出并实现，包括 GPT（Globally Unique Identifier Partition Table），是 UEFI 的一部分。</p>
<p>UEFI 是一个软件（标准）或者说更像是一个微型的系统，用于连接 <em>计算机固件（Computer’s firmware）</em> 和 <em>OS（Operating System）</em> 。UEFI 最终会替代 BIOS 但是向后兼容 BIOS。</p>
<p>UEFI 的功能是通过安装在主板（motherboard）上的特殊固件（firmware）实现的，和 BIOS 一样，其在（生产）出厂之时就已经安装，它是计算机开机（上电）运行的 <strong>第一个程序</strong> ，<strong>执行和 BIOS 同样的自检（POST）流程，但是它提供了比 BIOS 更多的灵活性</strong> 。 UEFI 解决了 BIOS 面临的一些限制，如 <em>最大分区</em> 、 <em>BIOS 执行任务的时间</em> 等</p>
<p>大多数现代化的计算机都已经能同时支持 BIOS 和 UEFI（二选一）。</p>
<p>UEFI 定义了一种新的 OS 和 计算机固件（platform firmware）交流的方式，相比于 BIOS 只能提供 OS 启动过程中必须的信息，UEFI 可以提供更多的特性，如安全启动等。</p>
<p>UEFI 将其初始化数据存放在一个 EFI 分区中，而不是存放在固件（Firmware）中，这个 EFI 分区位于 <strong>Nonvolatile Flash Memory</strong> ，UEFI 甚至可以在启动时从一个共享网络位置加载。</p>
<p>UEFI 使用比 MBR 更灵活的分区方案，即著名的 GPT（Globally Unique Identifier Partition Table），GPT 使用了 64-bit 用于保留分区表信息，支持多达 128 个分区，并支持系统识别并安装于超过 2TB 的分区之上。</p>
<p>UEFI 能在一个 EFI 系统分区中支持多个 OS，如 Windows OS loader 或者 Debian-based OS loaders，BIOS 只允许存在一个 Boot Loader.</p>
<p>UEFI 是可编程的（Programmable），其相当于一个轻量的 OS. </p>
<p>UEFI 的安全启动（Secure Boot）支持计算机在启动时对其硬件和系统完整性进行校验，可以防止黑客在系统启动时安装 rootkits 并获得系统控制权，Secure Boot 甚至支持授权用户（网络）远程定位问题。</p>
<p>UEFI 包含了一个平台相关（platform-related）的 <strong>数据表（data table）</strong> ，以及 <strong>可以被 OS Loader 调用的 Boot and Runtime Service Calls</strong> 。这些信息定义了为支持 UEFI ，固件（Firmwares）或者计算机硬件（Hardwares）应该实现的接口和数据结构（Interfaces and Structures）。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../20241023162615/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241017100414/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20241017100414/" class="post-title-link" itemprop="url">Linux GRUB2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-17 10:10:00" itemprop="dateCreated datePublished" datetime="2024-10-17T10:10:00+08:00">2024-10-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-01 16:11:00" itemprop="dateModified" datetime="2024-11-01T16:11:00+08:00">2024-11-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>boot loader</code> 在计算机启动的时候决定如何运行（启动）安装于硬盘上的操作系统，GRand Unified Bootloader（GRUB）是 Linux 中最流行的 Bootloader 程序。目前主要有 2 个 GRUB 版本：</p>
<ul>
<li>GRUB Legacy ： 遗留版本 GRUB v1，在较旧的 Linux 发行版中使用</li>
<li>GRUB 2 ： 当前最新版本，较新的 Linux 发行版中默认的 Bootloader. GRUB 2 的主要功能依旧是 <strong>查找并启动已安装在计算机上的操作系统</strong> 。同时 <strong>通过内嵌了一些工具和配置文件提供了更强大的功能以及灵活性</strong> 。</li>
</ul>
<p>相比于 GRUB Legacy，GRUB 2 有以下优点：</p>
<ul>
<li><strong>脚本支持</strong> 。支持脚本语言如 <em>函数</em> ， <em>循环</em> ， <em>变量</em> 等</li>
<li><strong>模块动态加载（Dynamic Module Loading）</strong></li>
<li><strong>救援模式（Rescue Mode）</strong></li>
<li><strong>自定义菜单（Custom Menus）</strong></li>
<li><strong>主题（Thems）</strong></li>
<li><strong>图形化的启动菜单</strong></li>
<li><strong>直接从硬盘启动 LiveCD ISO</strong></li>
<li><strong>全新的配置文件结构</strong></li>
<li><strong><code>Non-x86</code> 架构支持，如 PowerPC</strong></li>
<li><strong>全局 UUIDs 支持</strong></li>
</ul>
<p>GRUB 2 的配置文件是 <code>/boot/grub/grub.cfg</code> 或者 <code>/boot/grub2/grub.cfg</code>，关于其配置文件，要注意以下事项：</p>
<ul>
<li><strong><code>/boot/grub/grub.cfg</code> 的内容是由工具 <code>grub-mkconfig</code> 或者 <code>update-grub</code> 根据 <code>/etc/default/grub</code> 和 <code>/etc/grub.d/</code> 中的内容自动生成，最好不要手动改动 <code>/boot/grub/grub.cfg</code>。要修改控制选项，可以修改 <code>/etc/default/grub</code> 和 <code>/etc/grub.d/*</code>，然后使用 <code>update-grub</code></strong></li>
<li><strong><code>/boot/grub/grub.cfg</code> 的内容会因为 GRUB 2 的包升级（如内核升级导致新增内核或移除内核）而被覆盖，或者用户使用 <code>update-grub</code> 命令也会覆盖</strong></li>
<li><strong>可用的启动内核列表（<code>/boot/grub/grub.cfg</code> 中的 <code>menuentry</code>）是由命令 <code>update-grub</code> 或 <code>update-grub2</code>(一般是 <code>grub</code> 的软链接)自动生成</strong></li>
<li><strong>用户可以在 OS 启动列表中自定义添加启动条目（menu entry），这个功能一般是通过修改 <code>/etc/grub.d/40_custom</code> 实现</strong></li>
<li><strong>控制启动列表显示菜单的选项位于主配置文件 <code>/etc/default/grub</code> 中</strong></li>
<li><strong>和 GRUB Legacy 不同，GRUB 2 分区（partitions）编号从 1 开始，而不是 0。但是 <em>硬盘编号</em> 依旧从 0 开始</strong> 。如系统上的第一个硬盘的第一个分区，GRUB Legacy 中是 <code>hd(0, 0)</code>，GRUB 2 中是 <code>hd(0, 1)</code>  </li>
<li><code>grub.cfg</code> 中可以包含 Shell 脚本语法，如 函数，循环，变量等</li>
<li>用于定位内核（Kernels）和 <code>Initial RAM</code> 位置的设备名称，最好是使用更加可靠的 <strong>标签（Labels）</strong> 或者是 <strong>UUIDs（Universally Unique Identifiers）</strong> ，而不是类似于 <code>/dev/sda</code> 的设备名称，这可以防止计算机系统新增硬盘后，<code>/dev/sda</code> 变成了 <code>/dev/sdb</code> 而导致系统启动时内核无法找到。</li>
<li><strong>配置文件更改后，只有执行了 <code>update-grub</code> 后才会最终生效</strong></li>
</ul>
<h1 id="GRUB-2-配置流程"><a href="#GRUB-2-配置流程" class="headerlink" title="GRUB 2 配置流程"></a>GRUB 2 配置流程</h1><p>GRUB 2 的配置变更主要是通过修改主配置文件 <code>/etc/default/grub</code> 以及包含自定义脚本文件的目录 <code>/etc/grub.d/</code>，然后执行 <code>update-grub</code> 最终生效。<code>update-grub</code> 会从 <code>/etc/default/grub</code> 和 <code>/etc/grub.d/</code> 收集相关配置并将其更新到 <code>/boot/grub/grub.cfg</code>。</p>
<p><strong>启动菜单（Menu Display）的展示行为主要是通过 <code>/etc/default/grub</code> 进行控制</strong> 。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../20241017100414/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241028135437/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20241028135437/" class="post-title-link" itemprop="url">linux modules 及 library 相关操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-28 13:10:00" itemprop="dateCreated datePublished" datetime="2024-10-28T13:10:00+08:00">2024-10-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="检查命令依赖的共享库"><a href="#检查命令依赖的共享库" class="headerlink" title="检查命令依赖的共享库"></a>检查命令依赖的共享库</h1><p>以下命令检查 <code>crontab</code> 命令依赖的共享库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ldd `<span class="built_in">which</span> crontab`</span></span><br><span class="line">	linux-vdso.so.1 (0x00007ffe2db17000)</span><br><span class="line">	libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007063f4c00000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007063f4fc3000)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241028140006/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20241028140006/" class="post-title-link" itemprop="url">Linux PAM</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-28 13:10:00" itemprop="dateCreated datePublished" datetime="2024-10-28T13:10:00+08:00">2024-10-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>PAM（Pluggable Authentication Modules） 由 Sun Microsystems 发明并最初在 Solarise OS 上实现，Linux 于 1997 年实现了 Linux-PAM.</p>
<p>PAM 简化了系统认证管理的过程，使用 PAM 提供了以下好处：</p>
<ul>
<li>使用中心化的方式简化了用户身份认证过程以及系统管理员的视角</li>
<li>简化了应用在认证相关功能方面的开发，开发者无需重复写认证相关代码，只需要直接使用已有的认证模块即可</li>
<li>认证灵活性<ul>
<li>可以根据用户身份或者是特定的时间，或者是对特定资源的使用进行允许&#x2F;拒绝操作</li>
</ul>
</li>
</ul>
<p><strong>包含 PAM 的应用中 PAM 使用流程大体如下</strong> ：</p>
<ul>
<li>一个主体（用户或者进程）请求访问（通过认证）一个应用</li>
<li>此应用读取其 PAM 配置文件，其 PAM 配置文件中配置了认证策略，认证策略中一般包含要进行认证的 PAM 模块的列表，这个列表也称为 <em>Stack</em></li>
<li>Stack 中配置的 PAM 模块被依次调用</li>
<li>每个 PAM 模块会根据其配置返回 <strong>成功（Success）</strong> 或者 <strong>失败（Failure）</strong> 状态</li>
<li>最后是否认证成功，由所有的 PAM 模块返回的结果组合得到 <strong>成功（Success）</strong> 或者 <strong>失败（Failure）</strong> ，具体组合方式取决于配置文件中的配置。</li>
</ul>
<p>Linux 中，大多数包含 PAM 的应用的配置文件位于 <code>/etc/pam.d/</code>，通用的 PAM 配置文件格式使用：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">context &#x27;control flag&#x27; &#x27;PAM module&#x27; [module options]</span><br></pre></td></tr></table></figure>

<p>Linux 中，系统安全（如资源限制，用户登陆等）相关的 PAM 配置文件位于 <code>/etc/security/*.conf</code></p>
<h1 id="PAM-Contexts"><a href="#PAM-Contexts" class="headerlink" title="PAM Contexts"></a>PAM Contexts</h1><p>PAM 模块为不同的认证服务提供了标准的函数，这些 PAM 模块中的标准函数根据其函数类型称为 <code>Contexts</code>，也可以叫做 <code>Module Interfaces</code> 或者 <code>Types</code>，下列出了不同的 PAM Contexts 及其对应的 认证服务（Authentication Service）</p>
<table>
<thead>
<tr>
<th>Context</th>
<th>Service Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>auth</code></td>
<td>提供认证管理服务（Authentication Management Services），如验证帐号密码</td>
</tr>
<tr>
<td><code>account</code></td>
<td>帐号验证服务（Account Validation Services），例如只允许特定时间登陆</td>
</tr>
<tr>
<td><code>password</code></td>
<td>管理帐号密码（Manages Account Passwords），如限制帐号密码长度</td>
</tr>
</tbody></table>
<h1 id="PAM-Control-Flags"><a href="#PAM-Control-Flags" class="headerlink" title="PAM Control Flags"></a>PAM Control Flags</h1><p>PAM 中的 Control Flags 用于决定返回什么样的状态。下表列出了 PAM 配置中的相关的 Control Flags 及其响应</p>
<table>
<thead>
<tr>
<th>Control Flag</th>
<th>Response Handle</th>
</tr>
</thead>
<tbody><tr>
<td><code>required</code></td>
<td>If failed, returns a failure status to the application, after the rest of the contexts have been run in the stack.<br/>For example, a <code>requisite control</code> might cause a login to fail if someone types in an invalid user. But the user might not be told of the failure until after entering a password, hiding the fact that it was the bad username that caused the failure</td>
</tr>
<tr>
<td><code>requisite</code></td>
<td>If failed, returns a failure status to the application immediately <strong>without running the rest of the stack</strong> 。 <strong>(Be careful where you place this control in the stack.)</strong> <br/> For example, a <code>requisite control</code> might require key-based authentication and <strong>fail immediately when a valid key is not provided</strong> . In that case, it could fail before even prompting for a username&#x2F;password.</td>
</tr>
<tr>
<td><code>sufficient</code></td>
<td>- If failed, the module status is ignored. <br/> - If successful, then a success status is immediately returned to the application without running the rest of the stack.<br/> <strong>(Be careful where you place this control in the stack.)</strong></td>
</tr>
<tr>
<td><code>optional</code></td>
<td><strong>This control flag is important only for the final overall return status of success or failure</strong> . Think of it as a tiebreaker. When the other modules in the configuration file stack return statuses that are neither clear-cut failure nor success statuses, this optional module’s status is used to determine the final status or break the tie. In cases where the other modules in the stack are returning a clear-cut path of failure or success, this status is ignored.</td>
</tr>
<tr>
<td><code>include</code></td>
<td>Get all the return statuses from this particular PAM configuration file’s stack to include in this stack’s overall return status. It’s as if the entire stack from the named configuration file is now in this configuration file</td>
</tr>
<tr>
<td><code>substack</code></td>
<td>Similar to the include control flag, except for how certain errors and evaluations affect the main stack. This forces the included configuration file stack to act as a substack to the main stack. Thus, certain errors and evaluations affect only the substack and not the main stack.</td>
</tr>
</tbody></table>
<h1 id="PAM-Modules"><a href="#PAM-Modules" class="headerlink" title="PAM Modules"></a>PAM Modules</h1><p>Linux 中，PAM Modules 其实是系统共享库（Shared Library Module）文件，RHEL 默认位于 <code> /usr/lib64/security/pam*.so</code>， Ubuntu 位于 <code>/usr/lib/x86_64-linux-gnu/security/pam*.so</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> /usr/lib/x86_64-linux-gnu/security/</span></span><br><span class="line">pam_access.so           pam_exec.so        pam_gdm.so            pam_listfile.so   pam_nologin.so           pam_securetty.so  pam_stress.so      pam_unix.so</span><br><span class="line">pam_cap.so              pam_extrausers.so  pam_gnome_keyring.so  pam_localuser.so  pam_oddjob_mkhomedir.so  pam_selinux.so    pam_succeed_if.so  pam_userdb.so</span><br><span class="line">pam_dcvgraphicalsso.so  pam_faildelay.so   pam_group.so          pam_loginuid.so   pam_permit.so            pam_sepermit.so   pam_systemd.so     pam_usertype.so</span><br><span class="line">pam_debug.so            pam_faillock.so    pam_issue.so          pam_mail.so       pam_pwhistory.so         pam_setquota.so   pam_time.so        pam_warn.so</span><br><span class="line">pam_deny.so             pam_filter.so      pam_keyinit.so        pam_mkhomedir.so  pam_pwquality.so         pam_shells.so     pam_timestamp.so   pam_wheel.so</span><br><span class="line">pam_echo.so             pam_fprintd.so     pam_lastlog.so        pam_motd.so       pam_rhosts.so            pam_sss_gss.so    pam_tty_audit.so   pam_xauth.so</span><br><span class="line">pam_env.so              pam_ftp.so         pam_limits.so         pam_namespace.so  pam_rootok.so            pam_sss.so        pam_umask.so</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>要查看 PAM Module 的帮助文档，可以使用 <code>man</code> 手册，如 <code>man pam_access</code>。</p>
<p>使用 PAM 的应用可以大概分为以下 2 类：</p>
<ul>
<li><p><strong>普通程序（Application）</strong> 。默认使用 PAM 的应用的配置位于 <code>/etc/pam.d</code>，每个使用 PAM Module 的应用程序都应该有其自己的配置文件来定义它如何使用 PAM 模块。如果没有，这将是一个漏洞，为了防止这种情况出现，系统内置了一个 <code>other</code> 的配置（<code>/etc/pam.d/other</code>），所有使用了 PAM 但是没有指定其配置文件的应用都将使用此配置。 <strong><code>other</code> 配置默认拒绝（Implicit Deny）所有的请求</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> /etc/pam.d/</span></span><br><span class="line">chfn            common-auth                    cron               gdm-autologin           gdm-smartcard                   login     polkit-1   samba             sudo</span><br><span class="line">chpasswd        common-password                cups               gdm-fingerprint         gdm-smartcard-pkcs11-exclusive  newusers  ppp        sshd              sudo-i</span><br><span class="line">chsh            common-session                 dcv                gdm-launch-environment  gdm-smartcard-sssd-exclusive    other     runuser    sssd-shadowutils  su-l</span><br><span class="line">common-account  common-session-noninteractive  dcv-graphical-sso  gdm-password            gdm-smartcard-sssd-or-password  passwd    runuser-l  su                vmtoolsd</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>系统安全相关程序</strong> 。系统安全相关的 PAM 配置默认位于 <code> /etc/security</code>。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> /etc/security/</span></span><br><span class="line">access.conf      faillock.conf  limits.conf  namespace.conf  namespace.init  pam_env.conf    sepermit.conf</span><br><span class="line">capability.conf  group.conf     limits.d     namespace.d     opasswd         pwquality.conf  time.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../20241028140006/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241026144120/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20241026144120/" class="post-title-link" itemprop="url">加密</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-26 13:10:00" itemprop="dateCreated datePublished" datetime="2024-10-26T13:10:00+08:00">2024-10-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">安全</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>加密解密相关常用概念</strong> ：</p>
<ul>
<li><strong>Plain Text</strong> ： 明文，可以被人类或者激情理解的内容</li>
<li><strong>Ciphertext</strong> ： 密文，加密后的内容，一般不能直接被人类或者机器所理解，需要解密</li>
<li><strong>Encryption</strong> ： 将 <code>Plain Text</code> 转换为 <code>Ciphertext</code> 的过程，通常使用一种加密算法（Encrypt Algorithm）</li>
<li><strong>Decryption</strong>  ： 解密，将 <code>Ciphertext</code> 转换为 <code>Plain Text</code> 的过程，通常使用和加密算法（Encrypt Algorithm）相对应的解密算法（Decrypt Algorithms）</li>
<li><strong>Cipher</strong> ： 加密和解密过程中算法使用的密码。</li>
<li><strong>Block Cipher</strong> ： 在对数据进行加密之前，需要首先将其分割成块（Block）</li>
<li><strong>Stream Cipher</strong> ： 加密过程中无需将其分割成块（Block）</li>
<li><strong>Key</strong> ： 通常值密钥对（公钥&#x2F;私钥）</li>
</ul>
<p>以下是一些较为经典的加密算法</p>
<table>
<thead>
<tr>
<th>Algorithm</th>
<th>Description</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><code>AES</code><br/>Advanced Encryption Standard, also called Rijndael</td>
<td>- <strong>Symmetric Cryptography</strong><br/>- <strong>Block Cipher</strong> 。encrypting data in <code>128-</code>, <code>192-</code>, <code>256-</code>, <code>512-</code> bit， blocks using a <code>128-</code>, <code>192-</code>, <code>256</code>, or <code>512</code>-bit key</td>
<td></td>
</tr>
<tr>
<td><code>Blowfish</code></td>
<td>- <strong>Symmetric Cryptography</strong><br/>- <strong>Block Cipher</strong> 。encrypting data in 64-bit blocks using the same 32-bit to 448-bit keys for encrypting&#x2F;decrypting.</td>
<td></td>
</tr>
<tr>
<td><code>CAST5</code></td>
<td>- <strong>Symmetric Cryptography</strong><br/> - <strong>Block Cipher</strong> 。    encrypting data in 64-bit blocks using the same up to 128-bit key for encrypting&#x2F;decrypting.</td>
<td></td>
</tr>
<tr>
<td><code>DES</code><br/>Data Encryption Standard</td>
<td><strong>已经被认为是不安全的<br/></strong> - <strong>Symmetric Cryptography</strong><br/>- <strong>Block Cipher</strong> 。encrypting data in 64-bit blocks using the same 56-bit key for encrypting&#x2F;decrypting.</td>
<td></td>
</tr>
<tr>
<td><code>3DES</code></td>
<td>增强的 DES 加密算法<br/> - <strong>Symmetric Cryptography</strong> <br/> Data is encrypted up to 48 times with three different 56-bit keys before the encryption process is completed.</td>
<td></td>
</tr>
<tr>
<td><code>IDEA</code></td>
<td>- <strong>Symmetric Cryptography</strong> <br/> - <strong>Block Cipher</strong> 。 encrypting data in 64-bit blocks using the same 128-bit key for encrypting&#x2F;decrypting</td>
<td></td>
</tr>
<tr>
<td><code>RC5</code></td>
<td>- <strong>Symmetric Cryptography</strong> <br/>  - <strong>Block Cipher</strong> 。  encrypting data in <code>32-</code>, 64-&#96;&#96;, or <code>128-</code> bit blocks ，using the same up to 2,048-bit keys for encrypting&#x2F;decrypting</td>
<td></td>
</tr>
<tr>
<td><code>RC6</code></td>
<td>- <strong>Symmetric Cryptography</strong> <br/> Same as RC5, but slightly faster</td>
<td></td>
</tr>
<tr>
<td><code>EI Gamal</code></td>
<td>- <strong>Asymmetric Cryptography</strong> <br/>  Uses two keys derived from a logarithm algorithm</td>
<td></td>
</tr>
<tr>
<td><code>Elliptic Curve Cryptosystems</code></td>
<td>- <strong>Asymmetric Cryptography</strong> <br/> Uses two keys derived from an algorithm containing two randomly chosen points on an elliptic curve.</td>
<td></td>
</tr>
<tr>
<td><code>RC4</code> <br/>    also called <code>ArcFour</code> or <code>ARC4</code></td>
<td>- <strong>Stream Cipher</strong> <br/>    encrypting data in 64-bit blocks using a variable key size for encrypting&#x2F;decrypting.</td>
<td></td>
</tr>
<tr>
<td><code>RSA</code></td>
<td><strong>最流行的非对称加密算法，使用 <code>Public/Private Key</code> 进行加解密</strong><br/>- <strong>Asymmetric Cryptography</strong></td>
<td></td>
</tr>
</tbody></table>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../20241026144120/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241026135656/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20241026135656/" class="post-title-link" itemprop="url">关于 Hash</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-26 13:10:00" itemprop="dateCreated datePublished" datetime="2024-10-26T13:10:00+08:00">2024-10-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">安全</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><strong>Hash 不是加密（Encryption）</strong>，不像 <strong>加密（Encrypt）-解密（decrypt）</strong> ， <strong>对一个对象进行 Hash 操作后，不可能通过 Hash 后的值 dehash 回原来的对象</strong> 。</p>
<p>Hash 算法需要 <strong>Collision Free</strong> ，即对两个完全不同的输入，经过 Hash 算法后的值也必须 <strong>不同</strong> 。</p>
<p>在 Linux 系统中，用户名秘密验证就是使用 Hash 算法。<code>/etc/shadow</code> 中包含的是用户密码（加 Salt） Hash 后的值，而不是用户密码，当用户使用密码登陆系统时，会计算用户密码（加 Salt）的 Hash 值并和 <code>/etc/shadow</code> 中保存的内容进行对比以验证用户密码是否正确。</p>
<p>Hash 在 Linux 系统中，有以下用途：</p>
<ul>
<li>Passwords 验证</li>
<li>校验文件内容</li>
<li>数字签名</li>
<li>病毒签名</li>
</ul>
<p>Hash 也有以下叫法：</p>
<ul>
<li><code>Message Digest</code> ：  消息摘要，Linux 中常用的命令如 <code>md5sum</code>、<code>sha1sum</code>、<code>sha224sum</code>、<code>sha256sum</code>、<code>sha384sum</code>、<code>sha512sum</code>、<code>shasum</code> 等应用了不同的 Hash 算法 </li>
<li><code>Checksum</code> ： 校验和</li>
<li><code>Fingerprint</code>  ： 数字指纹</li>
<li><code>Signature</code>  ： 签名</li>
</ul>
<h1 id="Hash-常见用途示例"><a href="#Hash-常见用途示例" class="headerlink" title="Hash 常见用途示例"></a>Hash 常见用途示例</h1><h2 id="内容完整性校验"><a href="#内容完整性校验" class="headerlink" title="内容完整性校验"></a>内容完整性校验</h2><p>例如网上公开的 ISO 系统镜像，发布者会同时发布镜像的 SHA-256 Hash 算法摘要值，当你下载了此镜像后，可以在本地对其镜像同样的 Hash 计算（如 <code>sha256sum</code> 命令），如果计算出的值和发布者公布的值一致，说明其内容和发布者发布的镜像内容一致（未被篡改）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sha256sum</span> Fedora-Workstation-Live-x86_64-30-1.2.iso</span></span><br><span class="line">a4e2c49368860887f1cc1166b0613232d4d5de6b46f29c9756bc7cfd5e13f39f</span><br><span class="line"> Fedora-Workstation-Live-x86_64-30-1.2.iso</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241025105226/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20241025105226/" class="post-title-link" itemprop="url">Linux auditd 服务</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-25 10:10:00" itemprop="dateCreated datePublished" datetime="2024-10-25T10:10:00+08:00">2024-10-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">常用服务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Linux 审计系统提供了一种方式来跟踪系统上与安全相关的信息。根据预配置的规则，审计会生成日志条目，来尽可能多地记录系统上所发生的事件的相关信息。对于关键任务环境而言至关重要，可用来确定安全策略的违反者及其所执行的操作。审计不会为您的系统提供额外的安全，而是用于发现系统上使用的安全策略的违规。可以通过其他安全措施(如 SELinux)进一步防止这些违规。 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[第 7 章 系统审计](https://docs.redhat.com/zh_hans/documentation/red_hat_enterprise_linux/7/html/security_guide/chap-system_auditing#chap-system_auditing) ">[1]</span></a></sup></p>
<p>以下列表总结了审计可以在其日志文件中记录的一些信息：</p>
<ul>
<li>事件的日期、时间、类型和结果.</li>
<li>主题和对象的敏感度标签。</li>
<li>事件与触发事件的用户身份的关联。</li>
<li>对审计配置的所有修改，以及对访问审计日志文件的尝试。</li>
<li>所有身份验证机制的使用，如 SSH 和 Kerberos 等。</li>
<li>对任何受信任数据库的修改，如 &#x2F;etc&#x2F;passwd。</li>
<li>尝试将信息导入系统或从系统导出。</li>
<li>根据用户身份、主题和对象标签以及其他属性包含或排除事件。</li>
</ul>
<p><strong>使用案例</strong></p>
<ul>
<li><strong>监视文件访问</strong><br>  审计可以跟踪文件或目录是否已被访问、修改、执行或者文件的属性是否已改变。例如，这有助于检测对重要文件的访问，并在其中一个文件损坏时提供审计跟踪。</li>
<li><strong>监控系统调用</strong><br>  可将审计配置为在每次使用特定系统调用时生成日志条目。例如，这可用于通过监控 <code>settimeofday</code>、<code>clock_adjtime</code> 和其他与时间相关的系统调用来跟踪对系统时间的修改。</li>
<li><strong>记录用户运行的命令</strong><br>  审计可以跟踪文件是否已被执行，因此可以定义一个规则以记录每次特定命令的执行。例如，可以对 <code>/bin</code> 目录中的每个可执行文件定义一个规则。然后，可以按用户 ID 搜索生成的日志条目，以生成每个用户所执行的命令的审计跟踪。</li>
<li><strong>记录系统路径名称的执行</strong><br>  除了观察在规则调用时将路径转换为 inode 的文件访问之外，审计现在还可以观察路径的执行，即使路径在规则调用中不存在，或者在规则调用后文件被替换了。这允许规则在升级程序可执行文件后或甚至在其安装之前继续运行。</li>
<li><strong>记录安全事件</strong><br>  <code>pam_faillock</code> 认证模块能够记录失败的登录尝试。也可以将审计设置为记录失败的登录尝试，并提供有关试图登录的用户的附加信息。</li>
<li><strong>搜索事件</strong><br>  审计提供了 <code>ausearch</code> 工具，可用于过滤日志条目，并根据多个条件提供完整的审计跟踪。</li>
<li><strong>运行总结报告</strong><br>  <code>aureport</code> 实用程序可用于生成记录事件的日常报告等。然后，系统管理员可以分析这些报告，并进一步调查可疑的活动。</li>
<li><strong>监控网络访问</strong><br>  <code>iptables</code> 和 <code>ebtables</code> 工具可以配置为触发审计事件，允许系统管理员监控网络访问。<blockquote>
<p>系统性能可能会受到影响，具体取决于审计所收集的信息量。</p>
</blockquote>
</li>
</ul>
<h1 id="审计系统架构"><a href="#审计系统架构" class="headerlink" title="审计系统架构"></a>审计系统架构</h1><p>审计系统由两个主要部分组成： <strong>用户空间应用程序和工具</strong> ，以及 <strong>内核端系统调用处理</strong> 。内核组件接收用户空间应用程序的系统调用，并通过以下过滤器对其进行过滤： <code>user</code>、<code>task</code>、<code>fstype</code> 或 <code>exit</code> 。 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[第 7 章 系统审计](https://docs.redhat.com/zh_hans/documentation/red_hat_enterprise_linux/7/html/security_guide/chap-system_auditing#chap-system_auditing) ">[1]</span></a></sup></p>
<p><strong>用户空间审计守护进程</strong> 从内核收集信息，并在日志文件中创建条目。<strong>其他审计用户空间工具</strong> 与 <strong>审计守护进程</strong> 、 <strong>内核审计组件</strong> 或 <strong>审计日志文件</strong> 进行交互：</p>
<ul>
<li><code>audisp</code> - Audit 分配程序守护进程与 Audit 守护进程交互，并将事件发送到其他应用程序，以便进一步处理。此守护进程的目的是提供插件机制，以便实时分析程序可以与审计事件交互。</li>
<li><code>auditctl</code> - 审计控制实用程序与内核审计组件交互，以管理规则并控制事件生成进程的多个设置和参数。</li>
<li>其余的审计工具会将审计日志文件的内容作为输入，并根据用户的要求生成输出。例如，<code>aureport</code> 工具生成所有记录的事件的报告。</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../20241025105226/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241018132717/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20241018132717/" class="post-title-link" itemprop="url">Linux 系统安全加固</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-18 13:10:00" itemprop="dateCreated datePublished" datetime="2024-10-18T13:10:00+08:00">2024-10-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-24 17:10:00" itemprop="dateModified" datetime="2024-10-24T17:10:00+08:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>Linux 系统安全加固常用方法</p>
<h1 id="服务网络安全"><a href="#服务网络安全" class="headerlink" title="服务网络安全"></a>服务网络安全</h1><ul>
<li>启用防火墙，并确保入口流量都是必须的，禁止无关的 IP 访问目标主机上的服务（端口）</li>
</ul>
<h1 id="系统软件安全检测"><a href="#系统软件安全检测" class="headerlink" title="系统软件安全检测"></a>系统软件安全检测</h1><ul>
<li><p>定期扫描系统上安装的软件，确保关键系统命令未被篡改，例如使用 <code>rpm -Va</code> 对所有系统上的软件进行校验，检查是否有软件被篡改</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rpm -Va</span></span><br><span class="line">.......T.    /usr/src/kernels/3.10.0-1160.114.2.el7.x86_64/virt/lib/Kconfig</span><br><span class="line">.......T.    /usr/src/kernels/3.10.0-1160.114.2.el7.x86_64/virt/lib/Makefile</span><br><span class="line">S.5....T.  c /root/.bash_profile</span><br><span class="line">S.5....T.  c /root/.bashrc</span><br><span class="line">.M.......    /var/run/supervisor</span><br><span class="line">missing     /etc/filebeat/fields.yml</span><br><span class="line">SM5....T.  c /etc/filebeat/filebeat.yml</span><br><span class="line">....L....  c /etc/pam.d/fingerprint-auth</span><br><span class="line">....L....  c /etc/pam.d/password-auth</span><br><span class="line">....L....  c /etc/pam.d/postlogin</span><br><span class="line">....L....  c /etc/pam.d/smartcard-auth</span><br><span class="line">....L....  c /etc/pam.d/system-auth</span><br></pre></td></tr></table></figure>
<p>  输出的每一行对应一个文件，前 9 个字符的字符串显示了该文件的属性状态。每个字符的位置代表了特定的属性检查结果。<code>rpm -Va</code> 对比的是当前系统中文件的状态与 RPM 数据库中记录的文件状态。</p>
<p>  每个字符的含义:</p>
<ul>
<li>第 1 位 ： 文件类型 (S).<br>  如果文件丢失了，则会显示 <code>S</code>（代表文件缺失，”File is missing”）。</li>
<li>第 2 位：文件大小 (5)<br>  如果文件大小与 RPM 数据库中的记录不一致，则会显示 <code>5</code>  </li>
<li>第 3 位：文件权限（模式&#x2F;权限位，M）<br>  如果文件的权限与 RPM 数据库记录的不一致，则会显示 <code>M</code>。  </li>
<li>第 4 位：文件的所有者 (U)<br>  如果文件的所有者与 RPM 数据库记录的不一致，则会显示 <code>U</code>  </li>
<li>第 5 位：文件所属的组 (G)<br>  如果文件的所属组与 RPM 数据库记录的不一致，则会显示 <code>G</code>  </li>
<li>第 6 位：文件的设备类型 (D)<br>  如果文件的设备类型（如块设备或字符设备）与 RPM 数据库记录的不一致，则会显示 <code>D</code>  </li>
<li>第 7 位：文件的时间戳 (T)<br>  如果文件的修改时间与 RPM 数据库中的记录不一致，则会显示 <code>T</code>。  </li>
<li>第 8 位：文件的校验和 (5)<br>  如果文件内容的校验和与 RPM 数据库记录的不一致，则会显示 <code>5</code>。</li>
<li>第 9 位：文件的符号链接 (L)<br>  如果文件是一个符号链接，并且符号链接目标发生变化，则会显示 <code>L</code>。</li>
<li>如果是配置文件，会被标记为 <code>c</code></li>
</ul>
</li>
</ul>
<h1 id="文件加固"><a href="#文件加固" class="headerlink" title="文件加固"></a>文件加固</h1><h2 id="文件系统加固"><a href="#文件系统加固" class="headerlink" title="文件系统加固"></a>文件系统加固</h2><p>Linux 操作系统中的很多目录都有约定的用途，可能会挂载单独的文件系统，不同用途的目录，对权限的要求不同，从安全角度考量，可以针对文件系统进行一定程度的安全加固。</p>
<p>文件系统的挂载，主要依赖配置文件 <code>/etc/fstab</code>，此配置会被 <code>mount</code>、<code>dump</code>、<code>fsck</code> 等命令使用，其权限应该设置为 <code>644</code>，属主和属组都应该是 <code>root</code>。在挂载不同用途的文件系统时，可以根据其用途配置权限限制。以下列出部分示例</p>
<blockquote>
<p><strong>可用的挂载选项可以查看 <code>man fatab</code>、<code>man mount</code>、<code>man 5 ext4</code> 等内容中的选项，不同的文件系统支持不同的挂载选项，通用的挂载选项（独立于文件系统）可以查看 <code>man mount</code> 中的 <code>FILESYSTEM-INDEPENDENT MOUNT OPTIONS</code> 部分</strong></p>
</blockquote>
<ul>
<li><code>/home/</code> 目录下通常是用户家目录，可能会挂载到单独的文件系统，根据其特性，可以配置以下限制<ul>
<li><code>nosuid</code> ： 禁止其中的文件&#x2F;目录配置 <a href="https://csms.tech/202306261438/#Set-UID">SUID 或 SGID 权限</a></li>
<li><code>nodev</code> : 禁止其中的设备被内核识别，放置在此目录下的设备可能都是恶意设备，应该被禁止识别并使用</li>
<li><code>noexec</code> ： 禁止此文件系统中的可执行文件执行。</li>
</ul>
</li>
<li><code>/tmp/</code> 目录也可以设置以下限制<ul>
<li><code>nosuid</code> </li>
<li><code>nodev</code></li>
<li><code>noexec</code></li>
</ul>
</li>
</ul>
<h2 id="关键文件审计及监控"><a href="#关键文件审计及监控" class="headerlink" title="关键文件审计及监控"></a>关键文件审计及监控</h2><h3 id="auditd-审计"><a href="#auditd-审计" class="headerlink" title="auditd 审计"></a>auditd 审计</h3><a href="/20241025105226/" title="可以使用 &#96;auditd&#96; 服务对系统上的关键文件进行审计日志记录">可以使用 &#96;auditd&#96; 服务对系统上的关键文件进行审计日志记录</a>

<h3 id="关键文件监控"><a href="#关键文件监控" class="headerlink" title="关键文件监控"></a>关键文件监控</h3><p>系统上的某些关键文件，如常用可执行文件（<code>/sbin/</code> 下的文件）、关键配置文件等，要监控其是否被恶意修改。可以参考以下方法</p>
<ul>
<li><p><code>find</code> 命令搜索文件修改时间<br>  <code>find</code> 命令的 <code>-mtime</code> 可以查找文件的 <strong>内容修改时间</strong></p>
<p>  <code>find</code> 命令的 <code>-ctime</code> 可以查找文件的 <strong>创建时间&#x2F;属性修改时间</strong>  </p>
<p>  如常用的系统命令不会出现内容的修改和属性的修改，如果出现这些现象，很可能属于恶意篡改，可以使用 <code>find</code> 命令查找或是监控这些变化</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">find /sbin -mtime -1</span></span><br><span class="line">/sbin</span><br><span class="line">/sbin/init</span><br><span class="line">/sbin/reboot</span><br></pre></td></tr></table></figure>
<p> 在发现关键文件被篡改后可以及时发送告警。可以使用 <code>stat</code> 命令检查文件变更的更详细信息</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">stat</span> /sbin/init</span></span><br><span class="line"> File: &#x27;/sbin/init&#x27; -&gt; &#x27;../bin/systemd&#x27;</span><br><span class="line"> Size: 14 Blocks: 0 IO Block: 4096 symbolic link</span><br><span class="line">Device: fd01h/64769d Inode: 9551 Links: 1</span><br><span class="line">Access: (0777/lrwxrwxrwx)</span><br><span class="line">Uid: ( 0/ root) Gid: ( 0/ root)</span><br><span class="line">Context: system_u:object_r:bin_t:s0</span><br><span class="line">Access: 2016-02-03 03:34:57.276589176 -0500</span><br><span class="line">Modify: 2016-02-02 23:40:39.139872288 -0500</span><br><span class="line">Change: 2016-02-02 23:40:39.140872415 -0500</span><br><span class="line"> Birth: -</span><br></pre></td></tr></table></figure>
<p> 为了更好的监控关键文件的篡改，可以在系统运行之初就为其创建一个包含关键文件的 <code>mtimes</code> 和 <code>ctimes</code> 信息的数据库，并在系统运行过程中通过脚本检测关键文件的 <code>mtimes</code> 和 <code>ctimes</code> 并和原始数据库中的信息进行对比已检测文件是否被篡改。通常的 <strong>Intrusion Detection System</strong> 基本都实现了类似的功能。</p>
<p> 通常需要关注的可以被 <code>find</code> 检查的其他特殊类型文件和特殊权限还可能包括以下事项：</p>
<table>
<thead>
<tr>
<th>File or Settings</th>
<th>Scan Command</th>
<th>Problem With File or Settings</th>
</tr>
</thead>
<tbody><tr>
<td><code>SUID</code></td>
<td><code>find / -perm -4000</code></td>
<td>Allows anyone to become the file’s owner temporarily while the file is being executed in memory</td>
</tr>
<tr>
<td><code>GID</code></td>
<td><code>find / -perm -2000</code></td>
<td>Allows anyone to become a group member of the file’s group temporarily while the file is being executed in memory.</td>
</tr>
<tr>
<td><code>rhost files</code></td>
<td><code>find /home -name .rhosts</code></td>
<td>Allows a system to trust another system completely. It should not be in <code>/home</code> directories.</td>
</tr>
<tr>
<td><code>Ownerless files</code></td>
<td><code>find / -nouser</code></td>
<td>Indicates files that are not associated with any username.</td>
</tr>
<tr>
<td><code>Groupless files</code></td>
<td><code>find / -nogroup</code></td>
<td>Indicates files that are not associated with any group name.</td>
</tr>
</tbody></table>
</li>
</ul>
<h1 id="Viruses"><a href="#Viruses" class="headerlink" title="Viruses"></a>Viruses</h1><h2 id="ClamAV"><a href="#ClamAV" class="headerlink" title="ClamAV"></a>ClamAV</h2><p>ClamAV 是一个开源并免费的 Linux 杀毒（Antivirus Software）软件。</p>
<h1 id="Rootkit"><a href="#Rootkit" class="headerlink" title="Rootkit"></a>Rootkit</h1><h2 id="chkrootkit"><a href="#chkrootkit" class="headerlink" title="chkrootkit"></a>chkrootkit</h2><p><code>chkrootkit</code> 是 Linux 上常用的检测 <code>rootkit</code> 的工具，这个工具的结果需要更深入的分析，它可能出错</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">chkrootkit | grep INFECTED</span></span><br><span class="line">Checking &#x27;du&#x27;... INFECTED</span><br><span class="line">Checking &#x27;find&#x27;... INFECTED</span><br><span class="line">Checking &#x27;ls&#x27;... INFECTED</span><br><span class="line">Checking &#x27;lsof&#x27;... INFECTED</span><br><span class="line">Checking &#x27;pstree&#x27;... INFECTED</span><br><span class="line">Searching for Suckit rootkit... Warning: /sbin/init INFECTED</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Rootkit-Hunter"><a href="#Rootkit-Hunter" class="headerlink" title="Rootkit Hunter"></a>Rootkit Hunter</h2><p>Rootkit Hunter 是另一个比较出名的 <code>rootkit</code> 检测工具</p>
<h1 id="Intrusion-Detection-and-Prevention-System"><a href="#Intrusion-Detection-and-Prevention-System" class="headerlink" title="Intrusion Detection and Prevention System"></a>Intrusion Detection and Prevention System</h1><p><strong>入侵检测和防御系统</strong> 可以监控系统上的活动并找到潜在的恶意活动或者进程并报告相关活动。Linux 上常用的入侵检测系统有</p>
<ul>
<li><code>aide</code> ： Advanced Intrusion Detection Environment. </li>
<li><code>snort</code></li>
<li><code>tripwire</code></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="../2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><a class="page-number" href="../2/">2</a><span class="page-number current">3</span><a class="page-number" href="../4/">4</a><span class="space">&hellip;</span><a class="page-number" href="../14/">14</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="../4/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">COSMOS</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.3" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="../../js/comments.js"></script><script src="../../js/utils.js"></script><script src="../../js/motion.js"></script><script src="../../js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="../../js/third-party/search/local-search.js"></script>




  <script src="../../js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"fl9999","repo":"fl9999.github.io","client_id":"a11bf6f7860762b725b5","client_secret":"a99046105f8bddc72ec718d54dc3fd7f22070821","admin_user":"fl9999","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d41d8cd98f00b204e9800998ecf8427e"}</script>
<script src="../../js/third-party/comments/gitalk.js"></script>

</body>
</html>
