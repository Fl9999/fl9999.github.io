<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png">
  <link rel="mask-icon" href="../../images/logo.svg" color="#222">

<link rel="stylesheet" href="../../css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"csms.tech","root":"/","images":"../../images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"../../search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="../../js/config.js"></script>

    <meta name="description" content="得 能 莫 忘">
<meta property="og:type" content="website">
<meta property="og:title" content="L B T">
<meta property="og:url" content="http://csms.tech/page/5/index.html">
<meta property="og:site_name" content="L B T">
<meta property="og:description" content="得 能 莫 忘">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="COSMOS">
<meta property="article:tag" content="博客, 记录，技术">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://csms.tech/page/5/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>L B T</title>
  








  <noscript>
    <link rel="stylesheet" href="../../css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">L B T</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记 录 过 去 的 经 验</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="../../index.html" rel="section"><i class="fa fa-earth-americas fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="../../categories/" rel="section"><i class="fa fa-folder-tree fa-fw"></i>总目录<span class="badge">51</span></a></li><li class="menu-item menu-item-linux"><a href="../../categories/Linux" rel="section"><i class="fa fa-brands fa-linux fa-fw"></i>Linux</a></li><li class="menu-item menu-item-python"><a href="../../categories/Python" rel="section"><i class="fa fa-brands fa-python fa-fw"></i>Python</a></li><li class="menu-item menu-item-docker"><a href="../../categories/Docker" rel="section"><i class="fa fa-brands fa-docker fa-fw"></i>Docker</a></li><li class="menu-item menu-item-kubernetes"><a href="../../categories/Kubernetes" rel="section"><i class="fa fa-dharmachakra fa-fw"></i>Kubernetes</a></li><li class="menu-item menu-item-tags"><a href="../../tags/" rel="section"><i class="fa fa-tornado fa-fw"></i>标签<span class="badge">78</span></a></li><li class="menu-item menu-item-archives"><a href="../../archives/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>列表<span class="badge">250</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章总目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">COSMOS</p>
  <div class="site-description" itemprop="description">得 能 莫 忘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="../../archives/">
          <span class="site-state-item-count">250</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="../../categories/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">目录</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="../../tags/">
        <span class="site-state-item-count">78</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202306011739/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202306011739/" class="post-title-link" itemprop="url">向 Telegram 发送消息</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-01 17:39:32" itemprop="dateCreated datePublished" datetime="2023-06-01T17:39:32+08:00">2023-06-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-26 15:05:42" itemprop="dateModified" datetime="2024-04-26T15:05:42+08:00">2024-04-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos 7</li>
<li>Python 3</li>
</ul>
<h1 id="在-Telegram-中生成-Bot"><a href="#在-Telegram-中生成-Bot" class="headerlink" title="在 Telegram 中生成 Bot"></a>在 Telegram 中生成 Bot</h1><ol>
<li><p>首先在 telegram 中搜索 <code>@BotFather</code>，和其对话，根据提示创建 <strong>机器人</strong>，记录下生成的 <code>token</code> 信息<br><img src="https://i.csms.tech/img_164.png"><br><img src="https://i.csms.tech/img_165.png"></p>
</li>
<li><p>创建新的 Channel 或者 Group 或者将刚刚新建的 Bot 加入已有的 Channel&#x2F;Group。</p>
</li>
<li><p>获取 ChatGroup ID，可以使用以下方法之一</p>
<ol>
<li><p>添加机器人 <code>@getmyid_bot</code> 到 Channel，会自动显示 <code>Chat ID</code><br><img src="https://i.csms.tech/img_167.png"></p>
</li>
<li><p>使用以下代码获取</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; import requests</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; response = requests.get(f<span class="string">&#x27;https://api.telegram.org/bot&#123;token&#125;/getUpdates&#x27;</span>)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; data = response.json()</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; chat_id = data[<span class="string">&#x27;result&#x27;</span>][0][<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;chat&#x27;</span>][<span class="string">&#x27;id&#x27;</span>]</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; chat_id</span></span><br><span class="line">-992754669</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h1 id="使用-curl-向-telegram-发送消息"><a href="#使用-curl-向-telegram-发送消息" class="headerlink" title="使用 curl 向 telegram 发送消息"></a>使用 curl 向 telegram 发送消息</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -v <span class="string">&quot;https://api.telegram.org/bot&#123;token&#125;/sendMessage?text=sa&amp;chat_id=-992754669&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">GET /bot&#123;token&#125;/sendMessage?text=sa&amp;chat_id=-992754669 HTTP/1.1</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">User-Agent: curl/7.29.0</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Host: api.telegram.org</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Accept: */*</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">&lt; HTTP/1.1 200 OK</span></span><br><span class="line">&lt; Server: nginx/1.18.0</span><br><span class="line">&lt; Date: Fri, 02 Jun 2023 03:03:58 GMT</span><br><span class="line">&lt; Content-Type: application/json</span><br><span class="line">&lt; Content-Length: 276</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">&lt; Strict-Transport-Security: max-age=31536000; includeSubDomains; preload</span><br><span class="line">&lt; Access-Control-Allow-Origin: *</span><br><span class="line">&lt; Access-Control-Allow-Methods: GET, POST, OPTIONS</span><br><span class="line">&lt; Access-Control-Expose-Headers: Content-Length,Content-Type,Date,Server,Connection</span><br><span class="line">&lt; </span><br><span class="line">* Connection #0 to host api.telegram.org left intact</span><br><span class="line">&#123;&quot;ok&quot;:true,&quot;result&quot;:&#123;&quot;message_id&quot;:12,&quot;from&quot;:&#123;&quot;id&quot;:5683237521,&quot;is_bot&quot;:true,&quot;first_name&quot;:&quot;AlertManager&quot;,&quot;username&quot;:&quot;AlertManager_Bot&quot;&#125;,&quot;chat&quot;:&#123;&quot;id&quot;:-992754669,&quot;title&quot;:&quot;AlertManager Test&quot;,&quot;type&quot;:&quot;group&quot;,&quot;all_members_are_administrators&quot;:true&#125;,&quot;date&quot;:1685675038,&quot;text&quot;:&quot;sa&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="使用-python-向-telegram-发送消息"><a href="#使用-python-向-telegram-发送消息" class="headerlink" title="使用 python 向 telegram 发送消息"></a>使用 python 向 telegram 发送消息</h1><h2 id="使用-requests-库"><a href="#使用-requests-库" class="headerlink" title="使用 requests 库"></a>使用 requests 库</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; import requests</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; response = requests.get(f<span class="string">&#x27;https://api.telegram.org/bot&#123;token&#125;/sendMessage?text=sa&amp;chat_id=-992754669&#x27;</span>)</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; response.text</span></span><br><span class="line">&#x27;&#123;&quot;ok&quot;:true,&quot;result&quot;:&#123;&quot;message_id&quot;:13,&quot;from&quot;:&#123;&quot;id&quot;:5683237521,&quot;is_bot&quot;:true,&quot;first_name&quot;:&quot;AlertManager&quot;,&quot;username&quot;:&quot;AlertManager_Bot&quot;&#125;,&quot;chat&quot;:&#123;&quot;id&quot;:-992754669,&quot;title&quot;:&quot;AlertManager Test&quot;,&quot;type&quot;:&quot;group&quot;,&quot;all_members_are_administrators&quot;:true&#125;,&quot;date&quot;:1685675769,&quot;text&quot;:&quot;sa&quot;&#125;&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="使用-telegram-库"><a href="#使用-telegram-库" class="headerlink" title="使用 telegram 库"></a>使用 telegram 库</h2><p>需要安装 <code>python-telegram-bot</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install --upgrade python-telegram-bot</span><br></pre></td></tr></table></figure>
<p>发送消息代码</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; import telegram</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; import asyncio</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; bot = telegram.Bot(token=<span class="string">&#x27;5683231111:AAHzaGf0oRg8A&#x27;</span>)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; async def send_telegram_message():</span></span><br><span class="line">...     response = await bot.send_message(chat_id=-992754669, text=&quot;la&quot;)</span><br><span class="line">...     print(response)</span><br><span class="line">... </span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; loop = asyncio.get_event_loop()</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; loop.run_until_complete(send_telegram_message())</span></span><br><span class="line">Message(channel_chat_created=False, chat=Chat(api_kwargs=&#123;&#x27;all_members_are_administrators&#x27;: True&#125;, id=-992754669, title=&#x27;AlertManager Test&#x27;, type=&lt;ChatType.GROUP&gt;), date=datetime.datetime(2023, 6, 2, 3, 39, 16, tzinfo=datetime.timezone.utc), delete_chat_photo=False, from_user=User(first_name=&#x27;AlertManager&#x27;, id=5683237521, is_bot=True, username=&#x27;MS_AlertManager_Bot&#x27;), group_chat_created=False, message_id=14, supergroup_chat_created=False, text=&#x27;la&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果需要在非异步环境中（例如 Django 试图函数） 运行以上异步代码，会报错： <code>RuntimeError: There is no current event loop in thread &#39;Thread-1&#39;</code>。需要特殊处理，可以使用 <code>asyncio.run()</code> 函数来运行异步代码，它可以在非异步环境中创建一个新的事件循环并运行异步函数。</p>
<p>Django 视图中参考代码如下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">def send_message_to_tg(chat_id: int, text: str):</span><br><span class="line">    &#x27;&#x27;&#x27; 发送消息到 tg&#x27;&#x27;&#x27;</span><br><span class="line">    bot = telegram.Bot(token=tg_bot_token)</span><br><span class="line"></span><br><span class="line">    async def send_telegram_message():</span><br><span class="line">        response = await bot.send_message(chat_id=chat_id, text=text)</span><br><span class="line">        print(response)</span><br><span class="line">    # loop = asyncio.get_event_loop()</span><br><span class="line">    # loop.run_until_complete(send_telegram_message()) </span><br><span class="line">    asyncio.run(send_telegram_message())</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202306270934/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202306270934/" class="post-title-link" itemprop="url">Nginx 安装及升级</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-27 09:34:56" itemprop="dateCreated datePublished" datetime="2023-06-27T09:34:56+08:00">2023-06-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-25 10:17:23" itemprop="dateModified" datetime="2024-04-25T10:17:23+08:00">2024-04-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">常用服务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>本文档主要做为需要安装或升级 Nginx 版本或者需要重新编译 Nginx 为其添加新模块时的参考。<a href="/202207261420/" title="Nginx 服务常用配置说明">Nginx 服务常用配置说明</a></p>
<h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos 7 5.4.225-1</li>
<li>nginx stable 1.24.0</li>
</ul>
<h1 id="编译安装-Nginx"><a href="#编译安装-Nginx" class="headerlink" title="编译安装 Nginx"></a>编译安装 Nginx</h1><p>编译安装 Nginx 之前，首先需要安装依赖包 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Compiling and Installing from Source](https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/)">[1]</span></a></sup></p>
<h2 id="pcre"><a href="#pcre" class="headerlink" title="pcre"></a>pcre</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">wget github.com/PCRE2Project/pcre2/releases/download/pcre2-10.42/pcre2-10.42.tar.gz</span><br><span class="line">tar -zxf pcre2-10.42.tar.gz</span><br><span class="line">cd pcre2-10.42</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>

<h2 id="zlib"><a href="#zlib" class="headerlink" title="zlib"></a>zlib</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">wget http://zlib.net/zlib-1.2.13.tar.gz</span><br><span class="line">tar -zxf zlib-1.2.13.tar.gz</span><br><span class="line">cd zlib-1.2.13</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<h2 id="openssl"><a href="#openssl" class="headerlink" title="openssl"></a>openssl</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">wget --no-check-certificate http://www.openssl.org/source/openssl-1.1.1t.tar.gz</span><br><span class="line">tar -zxf openssl-1.1.1t.tar.gz</span><br><span class="line">cd openssl-1.1.1t</span><br><span class="line">./config shared zlib</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h2 id="编译安装-Nginx-1"><a href="#编译安装-Nginx-1" class="headerlink" title="编译安装 Nginx"></a>编译安装 Nginx</h2><p>下载 Nginx stable 版本编译安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://nginx.org/download/nginx-1.24.0.tar.gz</span><br><span class="line">tar zxf nginx-1.24.0.tar.gz</span><br><span class="line">cd nginx-1.24.0</span><br></pre></td></tr></table></figure>
<p>要启用或者停用指定的 Nginx 自带模块，<a target="_blank" rel="noopener" href="https://nginx.org/en/docs/configure.html">参考 Nginx 编译配置选项说明</a></p>
<p>此处编译配置添加第三方模块 <code>nginx-module-vts</code> 以支持 Prometheus。执行以下命令编译 Nginx 并添加第三方模块 <code>nginx-module-vts</code>。<a target="_blank" rel="noopener" href="https://github.com/vozlt/nginx-module-vts/#compatibility">Nginx 和 nginx-module-vts 版本兼容列表</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://github.com/vozlt/nginx-module-vts/archive/refs/tags/v0.2.2.tar.gz</span><br><span class="line">tar -xf v0.2.2.tar.gz</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr/local/nginx-1.24.0 \</span><br><span class="line">            --with-http_stub_status_module \</span><br><span class="line">            --with-http_ssl_module \</span><br><span class="line">            --with-stream --with-stream_ssl_module \</span><br><span class="line">            --with-openssl=/tmp/openssl-1.1.1t \</span><br><span class="line">            --with-http_v2_module \</span><br><span class="line">            --add-module=nginx-module-vts-0.2.2/</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>编译安装后的软件包，只需要安装好依赖，便可以迁移到其他机器上面使用，<a target="_blank" rel="noopener" href="https://s.csms.tech/file/nginx-1.24.0.tar">本文档编译安装后的软件包下载链接</a></p>
<h2 id="为-Nginx-配置-systemd-管理配置文件"><a href="#为-Nginx-配置-systemd-管理配置文件" class="headerlink" title="为 Nginx 配置 systemd 管理配置文件"></a>为 Nginx 配置 systemd 管理配置文件</h2><p>为了能使用 <code>systemctl</code> 管理源码编译安装的 nginx，可以为其使用以下配置文件将其托管到 <code>systemd</code></p>
<figure class="highlight shell"><figcaption><span>/usr/lib/systemd/system/nginx.service</span></figcaption><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=The nginx HTTP and reverse proxy server</span><br><span class="line">After=network-online.target remote-fs.target nss-lookup.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/run/nginx.pid</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Nginx will fail to start <span class="keyword">if</span> /run/nginx.pid already exists but has the wrong</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SELinux context. This might happen when running `nginx -t` from the cmdline.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https://bugzilla.redhat.com/show_bug.cgi?<span class="built_in">id</span>=1268621</span></span><br><span class="line">ExecStartPre=/usr/bin/rm -f /run/nginx.pid</span><br><span class="line">ExecStartPre=/usr/local/nginx-1.24.0/sbin/nginx -t</span><br><span class="line">ExecStart=/usr/local/nginx-1.24.0/sbin/nginx</span><br><span class="line">ExecReload=/usr/local/nginx-1.24.0/sbin/nginx -s reload</span><br><span class="line">KillSignal=SIGQUIT</span><br><span class="line">TimeoutStopSec=5</span><br><span class="line">KillMode=process</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Prometheus-采集-Nginx-监控数据"><a href="#Prometheus-采集-Nginx-监控数据" class="headerlink" title="Prometheus 采集 Nginx 监控数据"></a>Prometheus 采集 Nginx 监控数据</h1><p><a href="#%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85-Nginx">参考步骤安装 <code>nginx-module-vts</code> 模块</a>，以支持 Prometheus 采集 Nginx 统计数据。</p>
<p>如果要统计 Nginx 所有的 vhost 数据，则将 <code>nginx-module-vts</code> 模块相关配置放置于 <code>http</code> 模块内，否则可以在只想要监控（统计）的 vhost (<code>server</code> 配置段) 中添加配置。</p>
<p><code>nginx-module-vts</code> 模块相关配置命令说明：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>用法示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>vhost_traffic_status_zone</code></td>
<td>定义 <code>vhost_traffic_status</code> 模块使用的共享内存区域。用于存储虚拟主机的流量统计信息</td>
<td><code>vhost_traffic_status_zone shared_memory_name size;</code><br/><code>shared_memory_name</code> 是共享内存区域的名称，<code>size</code> 是共享内存区域的大小。</td>
</tr>
<tr>
<td><code>vhost_traffic_status_filter_by_host</code></td>
<td>按主机名过滤虚拟主机状态信息<br/>默认会将流量全部计算到第一个 server_name 上；启用后，只会显示与请求的主机名匹配的虚拟主机状态信息。</td>
<td><code>vhost_traffic_status_filter_by_host on;</code></td>
</tr>
<tr>
<td><code>vhost_traffic_status_filter_by_set_key</code></td>
<td>根据自定义键值对来过滤虚拟主机的状态信息</td>
<td><code>vhost_traffic_status_filter_by_set_key $host$request_uri;</code></td>
</tr>
<tr>
<td><code>vhost_traffic_status_filter_by_set_zone</code></td>
<td>过滤器使用的共享内存区域</td>
<td></td>
</tr>
<tr>
<td><code>vhost_traffic_status_display</code></td>
<td>用于显示虚拟主机状态信息的格式<br/>支持 <code>json</code>、<code>CSV</code> 和 <code>html</code></td>
<td><code>vhost_traffic_status_display_format html;</code></td>
</tr>
<tr>
<td><code>vhost_traffic_status_display_format</code></td>
<td>用于显示虚拟主机状态信息的字段格式。<br/>可以选择显示的字段有：request、status、request_time、request_length、request_method、request_uri、request_length、request_time、request_time_counter、request_time_counter_overflows、request_time_min、request_time_max、request_time_avg、request_time_median、request_time_percentile。</td>
<td><code>vhost_traffic_status_display_format field1 field2 ...;</code></td>
</tr>
</tbody></table>
<p>为了获取所有域名的统计信息，在 Nginx 的 <code>http</code> 模块内添加以下配置：</p>
<figure class="highlight shell"><figcaption><span>nginx.con</span></figcaption><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    ...   </span><br><span class="line">    vhost_traffic_status_zone;</span><br><span class="line"></span><br><span class="line">    vhost_traffic_status_filter_by_host on;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 8888;</span><br><span class="line">        server_name localhost;</span><br><span class="line">        location /status &#123;</span><br><span class="line">            vhost_traffic_status_display;</span><br><span class="line">            vhost_traffic_status_display_format json;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;                                                                                                                                                        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重载配置后查看请求内容：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">curl localhost:8888/status</span></span><br><span class="line">&#123;&quot;hostName&quot;:&quot;testhost&quot;,&quot;moduleVersion&quot;:&quot;v0.2.2&quot;,&quot;nginxVersion&quot;:&quot;1.24.0&quot;,&quot;loadMsec&quot;:1713418497362,&quot;nowMsec&quot;:1713418504352,&quot;connections&quot;:&#123;&quot;active&quot;:7,&quot;reading&quot;:0,&quot;writing&quot;:1,&quot;waiting&quot;:6,&quot;accepted&quot;:7,&quot;handled&quot;:7,&quot;requests&quot;:14&#125;,&quot;sharedZones&quot;:&#123;&quot;name&quot;:&quot;ngx_http_vhost_traffic_status&quot;,&quot;maxSize&quot;:1048575,&quot;usedSize&quot;:10587,&quot;usedNode&quot;:3&#125;,&quot;serverZones&quot;:&#123;&quot;api.testdomain.com&quot;:&#123;&quot;requestCounter&quot;:12,&quot;inBytes&quot;:9330,&quot;outBytes&quot;:6249,&quot;responses&quot;:&#123;&quot;1xx&quot;:0,&quot;2xx&quot;:12,&quot;3xx&quot;:0,&quot;4xx&quot;:0,&quot;5xx&quot;:0,&quot;miss&quot;:0,&quot;bypass&quot;:0,&quot;expired&quot;:0,&quot;stale&quot;:0,&quot;updating&quot;:0,&quot;revalidated&quot;:0,&quot;hit&quot;:0,&quot;scarce&quot;:0&#125;,&quot;requestMsecCounter&quot;:11,&quot;requestMsec&quot;:0,&quot;requestMsecs&quot;:&#123;&quot;times&quot;:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1713418503612,1713418503612,1713418503612,1713418503612,1713418503612,1713418503962,1713418503965,1713418503965,1713418503966,1713418503966,1713418504330,1713418504331],&quot;msecs&quot;:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,1,3,3,0,0]&#125;,&quot;requestBuckets&quot;:&#123;&quot;msecs&quot;:[],&quot;counters&quot;:[]&#125;,&quot;overCounts&quot;:&#123;&quot;maxIntegerSize&quot;:18446744073709551615,&quot;requestCounter&quot;:0,&quot;inBytes&quot;:0,&quot;outBytes&quot;:0,&quot;1xx&quot;:0,&quot;2xx&quot;:0,&quot;3xx&quot;:0,&quot;4xx&quot;:0,&quot;5xx&quot;:0,&quot;miss&quot;:0,&quot;bypass&quot;:0,&quot;expired&quot;:0,&quot;stale&quot;:0,&quot;updating&quot;:0,&quot;revalidated&quot;:0,&quot;hit&quot;:0,&quot;scarce&quot;:0,&quot;requestMsecCounter&quot;:0&#125;&#125;,&quot;src.testdomain.ph&quot;:&#123;&quot;requestCounter&quot;:1,&quot;inBytes&quot;:393,&quot;outBytes&quot;:309,&quot;responses&quot;:&#123;&quot;1xx&quot;:0,&quot;2xx&quot;:0,&quot;3xx&quot;:1,&quot;4xx&quot;:0,&quot;5xx&quot;:0,&quot;miss&quot;:0,&quot;bypass&quot;:0,&quot;expired&quot;:0,&quot;stale&quot;:0,&quot;updating&quot;:0,&quot;revalidated&quot;:0,&quot;hit&quot;:0,&quot;scarce&quot;:0&#125;,&quot;requestMsecCounter&quot;:0,&quot;requestMsec&quot;:0,&quot;requestMsecs&quot;:&#123;&quot;times&quot;:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1713418500180],&quot;msecs&quot;:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]&#125;,&quot;requestBuckets&quot;:&#123;&quot;msecs&quot;:[],&quot;counters&quot;:[]&#125;,&quot;overCounts&quot;:&#123;&quot;maxIntegerSize&quot;:18446744073709551615,&quot;requestCounter&quot;:0,&quot;inBytes&quot;:0,&quot;outBytes&quot;:0,&quot;1xx&quot;:0,&quot;2xx&quot;:0,&quot;3xx&quot;:0,&quot;4xx&quot;:0,&quot;5xx&quot;:0,&quot;miss&quot;:0,&quot;bypass&quot;:0,&quot;expired&quot;:0,&quot;stale&quot;:0,&quot;updating&quot;:0,&quot;revalidated&quot;:0,&quot;hit&quot;:0,&quot;scarce&quot;:0,&quot;requestMsecCounter&quot;:0&#125;&#125;,&quot;*&quot;:&#123;&quot;requestCounter&quot;:13,&quot;inBytes&quot;:9723,&quot;outBytes&quot;:6558,&quot;responses&quot;:&#123;&quot;1xx&quot;:0,&quot;2xx&quot;:12,&quot;3xx&quot;:1,&quot;4xx&quot;:0,&quot;5xx&quot;:0,&quot;miss&quot;:0,&quot;bypass&quot;:0,&quot;expired&quot;:0,&quot;stale&quot;:0,&quot;updating&quot;:0,&quot;revalidated&quot;:0,&quot;hit&quot;:0,&quot;scarce&quot;:0&#125;,&quot;requestMsecCounter&quot;:11,&quot;requestMsec&quot;:0,&quot;requestMsecs&quot;:&#123;&quot;times&quot;:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1713418500180,1713418503612,1713418503612,1713418503612,1713418503612,1713418503612,1713418503962,1713418503965,1713418503965,1713418503966,1713418503966,1713418504330,1713418504331],&quot;msecs&quot;:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,1,3,3,0,0]&#125;,&quot;requestBuckets&quot;:&#123;&quot;msecs&quot;:[],&quot;counters&quot;:[]&#125;,&quot;overCounts&quot;:&#123;&quot;maxIntegerSize&quot;:18446744073709551615,&quot;requestCounter&quot;:0,&quot;inBytes&quot;:0,&quot;outBytes&quot;:0,&quot;1xx&quot;:0,&quot;2xx&quot;:0,&quot;3xx&quot;:0,&quot;4xx&quot;:0,&quot;5xx&quot;:0,&quot;miss&quot;:0,&quot;bypass&quot;:0,&quot;expired&quot;:0,&quot;stale&quot;:0,&quot;updating&quot;:0,&quot;revalidated&quot;:0,&quot;hit&quot;:0,&quot;scarce&quot;:0,&quot;requestMsecCounter&quot;:0&#125;&#125;&#125;,&quot;upstreamZones&quot;:&#123;&quot;::nogroups&quot;:[&#123;&quot;server&quot;:&quot;127.0.0.1:12000&quot;,&quot;requestCounter&quot;:5,&quot;inBytes&quot;:4154,&quot;outBytes&quot;:3351,&quot;responses&quot;:&#123;&quot;1xx&quot;:0,&quot;2xx&quot;:5,&quot;3xx&quot;:0,&quot;4xx&quot;:0,&quot;5xx&quot;:0&#125;,&quot;requestMsecCounter&quot;:11,&quot;requestMsec&quot;:2,&quot;requestMsecs&quot;:&#123;&quot;times&quot;:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1713418503962,1713418503965,1713418503965,1713418503966,1713418503966],&quot;msecs&quot;:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,1,3,3]&#125;,&quot;requestBuckets&quot;:&#123;&quot;msecs&quot;:[],&quot;counters&quot;:[]&#125;,&quot;responseMsecCounter&quot;:11,&quot;responseMsec&quot;:2,&quot;responseMsecs&quot;:&#123;&quot;times&quot;:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1713418503962,1713418503965,1713418503965,1713418503966,1713418503966],&quot;msecs&quot;:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,1,3,3]&#125;,&quot;responseBuckets&quot;:&#123;&quot;msecs&quot;:[],&quot;counters&quot;:[]&#125;,&quot;weight&quot;:0,&quot;maxFails&quot;:0,&quot;failTimeout&quot;:0,&quot;backup&quot;:false,&quot;down&quot;:false,&quot;overCounts&quot;:&#123;&quot;maxIntegerSize&quot;:18446744073709551615,&quot;requestCounter&quot;:0,&quot;inBytes&quot;:0,&quot;outBytes&quot;:0,&quot;1xx&quot;:0,&quot;2xx&quot;:0,&quot;3xx&quot;:0,&quot;4xx&quot;:0,&quot;5xx&quot;:0,&quot;requestMsecCounter&quot;:0,&quot;responseMsecCounter&quot;:0&#125;&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>统计信息输出结果支持多种格式：</p>
<ul>
<li><code>localhost:8888/status/format/json</code> - Json</li>
<li><code>localhost:8888/status/format/html</code> - Html</li>
<li><code>localhost:8888/status/format/jsonp</code> - Jsonp</li>
<li><code>localhost:8888/status/format/prometheus</code> - Prometheus</li>
<li><code>localhost:8888/status/format/control</code> - control</li>
</ul>
<p>在 Prometheus 中添加以下 Targets 配置抓取 <code>nginx-module-vts</code> 模块暴露出的统计信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">- job_name: &quot;Nginx&quot;</span><br><span class="line">    metrics_path: &#x27;/status/format/prometheus&#x27;</span><br><span class="line">    static_configs:</span><br><span class="line">    - targets: [&#x27;IPADDRESS:8888&#x27;]</span><br><span class="line">      labels:</span><br><span class="line">        Department : &#x27;OP&#x27;</span><br></pre></td></tr></table></figure>

<p>在 Prometheus 中检查抓取到的数据<br><img src="https://i.csms.tech/img_229.png"></p>
<h1 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h1><h2 id="error-while-loading-shared-libraries"><a href="#error-while-loading-shared-libraries" class="headerlink" title="error while loading shared libraries"></a>error while loading shared libraries</h2><p>Nginx 编译安装成功后，启动报错</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/usr/local/nginx-1.24.0/sbin/nginx -t</span></span><br><span class="line">/usr/local/nginx-1.24.0/sbin/nginx: error while loading shared libraries: libpcre2-8.so.0: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>
<p><strong>问题原因</strong> 为 Nginx 在系统的库文件路径中未找到已经安装的 <code>libpcre2-8.so.0</code> 库文件。可以通过以下方式验证</p>
<ol>
<li>搜索 <code>libpcre2-8.so.0</code>，可以看到系统上已经存在此库文件 <code>/usr/local/lib/libpcre2-8.so.0</code> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">find / -name libpcre2-8.so.0</span></span><br><span class="line">/usr/local/lib/libpcre2-8.so.0</span><br></pre></td></tr></table></figure></li>
<li>检查此库文件是否在系统已加载的库文件中。执行以下命令搜索系统已经加载的库文件，发现没有 <code>/usr/local/lib/libpcre2-8.so.0</code> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ldconfig -p | grep libpcre</span></span><br><span class="line">    libpcre32.so.0 (libc6,x86-64) =&gt; /lib64/libpcre32.so.0</span><br><span class="line">    libpcre16.so.0 (libc6,x86-64) =&gt; /lib64/libpcre16.so.0</span><br><span class="line">    libpcreposix.so.0 (libc6,x86-64) =&gt; /lib64/libpcreposix.so.0</span><br><span class="line">    libpcrecpp.so.0 (libc6,x86-64) =&gt; /lib64/libpcrecpp.so.0</span><br><span class="line">    libpcre.so.1 (libc6,x86-64) =&gt; /lib64/libpcre.so.1</span><br></pre></td></tr></table></figure></li>
<li>检查系统共享库文件的查找路径的配置文件 <code>/etc/ld.so.conf</code>，发现其中不包括路径 <code>/usr/local/lib/</code>，因此位于此路径下的共享库文件无法被搜索到 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> /etc/ld.so.conf</span></span><br><span class="line">include ld.so.conf.d/*.conf</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<p>要解决此问题，可以使用以下方法之一：</p>
<ul>
<li><p>添加 <code>/usr/local/lib/</code> 到系统共享库查找路径配置文件 <code>/etc/ld.so.conf</code></p>
  <figure class="highlight shell"><figcaption><span>/etc/ld.so.conf</span></figcaption><table><tr><td class="code"><pre><span class="line">include ld.so.conf.d/*.conf</span><br><span class="line">/usr/local/lib/</span><br></pre></td></tr></table></figure>
<p> 执行以下命令，使配置生效</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ldconfig</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置系统环境变量 <code>LD_LIBRARY_PATH</code>，这个变量定义了系统共享库的查找目录。将 <code>/usr/local/lib</code> 添加到此变量的值中，要永久生效需要将其写入配置文件，如 <code>~/.bash_profile</code> 等</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=&quot;/usr/local/lib:$LD_LIBRARY_PATH&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建符号链接</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ln -s /usr/local/lib/libpcre2-8.so.0 /usr/local/nginx-1.24.0/sbin/libpcre2-8.so.0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>或者</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ln -s /usr/local/lib/libpcre2-8.so.0 /lib64/libpcre2-8.so.0</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="SSL-modules-require-the-OpenSSL-library"><a href="#SSL-modules-require-the-OpenSSL-library" class="headerlink" title="SSL modules require the OpenSSL library"></a>SSL modules require the OpenSSL library</h2><p>执行以下命令执行编译前配置时报错 <code>./configure: error: SSL modules require the OpenSSL library.</code>：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">./configure --prefix=/usr/local/nginx-1.24.0 \</span></span><br><span class="line"><span class="language-bash">            --with-http_stub_status_module \</span></span><br><span class="line"><span class="language-bash">            --with-http_ssl_module \</span></span><br><span class="line"><span class="language-bash">            --with-stream --with-stream_ssl_module \</span></span><br><span class="line"><span class="language-bash">            --with-http_v2_module \</span></span><br><span class="line"><span class="language-bash">            --add-module=nginx-module-vts-0.2.2/</span></span><br><span class="line"></span><br><span class="line">checking for PCRE2 library ... found</span><br><span class="line">checking for OpenSSL library ... not found</span><br><span class="line">checking for OpenSSL library in /usr/local/ ... not found</span><br><span class="line">checking for OpenSSL library in /usr/pkg/ ... not found</span><br><span class="line">checking for OpenSSL library in /opt/local/ ... not found</span><br><span class="line"></span><br><span class="line">./configure: error: SSL modules require the OpenSSL library.</span><br><span class="line">You can either do not enable the modules, or install the OpenSSL library</span><br><span class="line">into the system, or build the OpenSSL library statically from the source</span><br><span class="line">with nginx by using --with-openssl=&lt;path&gt; option.</span><br></pre></td></tr></table></figure>
<p>此报错原因为未找到 OpenSSL 的库文件。</p>
<p>针对此场景，可以通过在编译配置时指定 OpenSSL 的源码中库文件的具体位置(<code>--with-openssl=/tmp/openssl-1.1.1t</code>)，参考以下命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/usr/local/nginx-1.24.0 \</span><br><span class="line">            --with-http_stub_status_module \</span><br><span class="line">            --with-http_ssl_module \</span><br><span class="line">            --with-stream --with-stream_ssl_module \</span><br><span class="line">            --with-openssl=/tmp/openssl-1.1.1t \</span><br><span class="line">            --with-http_v2_module \</span><br><span class="line">            --add-module=nginx-module-vts-0.2.2/</span><br></pre></td></tr></table></figure>


<h2 id="Error-127"><a href="#Error-127" class="headerlink" title="Error 127"></a>Error 127</h2><p>Nginx 执行 <code>make</code> 命令时报错： <code>/bin/sh: line 2: ./config: No such file or directory</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">./configure --prefix=/usr/local/nginx-1.24.0 \</span></span><br><span class="line"><span class="language-bash">            --with-http_stub_status_module \</span></span><br><span class="line"><span class="language-bash">            --with-http_ssl_module \</span></span><br><span class="line"><span class="language-bash">            --with-stream --with-stream_ssl_module \</span></span><br><span class="line"><span class="language-bash">            --with-openssl=/usr/local/lib64/ \</span></span><br><span class="line"><span class="language-bash">            --with-http_v2_module \</span></span><br><span class="line"><span class="language-bash">            --add-module=nginx-module-vts-0.2.2/</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">make</span></span><br><span class="line">make -f objs/Makefile</span><br><span class="line">make[1]: Entering directory `/root/nginx-1.24.0&#x27;</span><br><span class="line">cd /usr/local/lib64/ \</span><br><span class="line">&amp;&amp; if [ -f Makefile ]; then make clean; fi \</span><br><span class="line">&amp;&amp; ./config --prefix=/usr/local/lib64//.openssl no-shared no-threads  \</span><br><span class="line">&amp;&amp; make \</span><br><span class="line">&amp;&amp; make install_sw LIBDIR=lib</span><br><span class="line">/bin/sh: line 2: ./config: No such file or directory</span><br><span class="line">make[1]: *** [/usr/local/lib64//.openssl/include/openssl/ssl.h] Error 127</span><br><span class="line">make[1]: Leaving directory `/root/nginx-1.24.0&#x27;</span><br><span class="line">make: *** [build] Error 2</span><br></pre></td></tr></table></figure>

<p>错误信息表明在编译 nginx 时，<code>make</code> 命令无法找到 OpenSSL 的配置脚本 <code>config</code>。此脚本位于 OpenSSL 的源码目录中。可以通过 <code>--with-openssl=/tmp/openssl-1.1.1t</code> 指定。<br>修改编译前的配置命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/usr/local/nginx-1.24.0 \</span><br><span class="line">            --with-http_stub_status_module \</span><br><span class="line">            --with-http_ssl_module \</span><br><span class="line">            --with-stream --with-stream_ssl_module \</span><br><span class="line">            --with-openssl=/tmp/openssl-1.1.1t \</span><br><span class="line">            --with-http_v2_module \</span><br><span class="line">            --add-module=nginx-module-vts-0.2.2/</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h2 id="getpwnam-“nginx”-failed"><a href="#getpwnam-“nginx”-failed" class="headerlink" title="getpwnam(“nginx”) failed"></a>getpwnam(“nginx”) failed</h2><p>nginx 报错</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nginx: the configuration file /usr/local/nginx-1.24.0/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: [emerg] getpwnam(&quot;nginx&quot;) failed</span><br><span class="line">nginx: configuration file /usr/local/nginx-1.24.0/conf/nginx.conf test failed</span><br></pre></td></tr></table></figure>

<p><strong>问题原因</strong> 为 <code>nginx</code> 用户不存在，创建 <code>nginx</code> 用户或者修改配置文件，使用已有的用户运行 <code>nginx</code></p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a target="_blank" rel="noopener" href="https://nginx.org/en/docs/">Nginx 官网文档</a></p>
<h1 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/">Compiling and Installing from Source</a><a href="#fnref:1" rev="footnote"> ↩</a></span></li></ol></div></div>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202306061427/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202306061427/" class="post-title-link" itemprop="url">Prometheus 指标汇总</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-06 14:27:37" itemprop="dateCreated datePublished" datetime="2023-06-06T14:27:37+08:00">2023-06-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-16 13:29:18" itemprop="dateModified" datetime="2024-04-16T13:29:18+08:00">2024-04-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/Prometheus/" itemprop="url" rel="index"><span itemprop="name">Prometheus</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Prometheus 2.44.0</li>
<li>Grafana 9.5.2</li>
<li>Kubernetes 1.24</li>
</ul>
<h1 id="Kubernetes-相关指标"><a href="#Kubernetes-相关指标" class="headerlink" title="Kubernetes 相关指标"></a>Kubernetes 相关指标</h1><a href="/202212141608/" title="Kubernetes 中部署并监控 Kubernetes 集群参考">Kubernetes 中部署并监控 Kubernetes 集群参考</a>。

<p><a href="https://csms.tech/202212141608/#配置-Prometheus-自动发现-kubelet-并读取监控指标">配置 Prometheus 监控 Kubelet</a> 之后可以采集到 Kubelet 监控指标。</p>
<p><a href="https://csms.tech/202212141608/#配置-Prometheus-从-cAdvisor-读取监控数据">配置 Prometheus 读取 cAdvisor</a> 之后可以通过 cAdvisor 采集到容器相关的监控指标。</p>
<table>
<thead>
<tr>
<th>指标名称</th>
<th>类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>kubelet_pod_start_duration_seconds_count</code></td>
<td></td>
<td>Pod 启动的时间</td>
<td></td>
</tr>
<tr>
<td><code>kubelet_pod_start_duration_seconds_bucket</code></td>
<td></td>
<td>Pod 启动的时间的延迟直方图数据</td>
<td><code>kubelet_pod_start_duration_seconds_bucket&#123;le=&quot;0.5&quot;&#125;</code></td>
</tr>
<tr>
<td><code>kubelet_running_pods</code></td>
<td></td>
<td>运行的 Pod 的数量</td>
<td></td>
</tr>
<tr>
<td><code>kubelet_running_containers</code></td>
<td></td>
<td>运行的 Containers 的数量</td>
<td></td>
</tr>
<tr>
<td><code>kubelet_runtime_operations_errors_total</code></td>
<td></td>
<td>Kubelet 和 CRI 交互产生的错误（类型）</td>
<td></td>
</tr>
<tr>
<td><code>kubelet_started_containers_total</code></td>
<td></td>
<td>Kubelet 启动的 Container 总数</td>
<td></td>
</tr>
<tr>
<td><code>kubelet_started_pods_total</code></td>
<td></td>
<td>Kubelet 启动的 Pod 总数</td>
<td></td>
</tr>
<tr>
<td><code>kubelet_volume_stats_available_bytes</code></td>
<td></td>
<td>PV Volume 可以使用的磁盘空间</td>
<td></td>
</tr>
<tr>
<td><code>kube_node_status_allocatable</code><br/><code>kube_node_status_capacity</code></td>
<td></td>
<td>节点的可分配的 <strong>资源</strong> 数量</td>
<td><code>kube_node_status_allocatable&#123;resource=&quot;pods&quot;&#125;</code><br/>节点可分配的 Pod 的数量</td>
</tr>
<tr>
<td><code>kubelet_started_pods_total</code></td>
<td><code>Counter</code></td>
<td>已启动的 Pod 数量</td>
<td></td>
</tr>
<tr>
<td><code>container_cpu_usage_seconds_total</code></td>
<td><code>Counter</code></td>
<td>Container 使用的 CPU</td>
<td></td>
</tr>
<tr>
<td><code>container_memory_usage_bytes</code></td>
<td><code>Gauge</code></td>
<td>Pod 使用的内存</td>
<td><code>container_memory_usage_bytes&#123;namespace=&quot;default&quot;&#125;</code></td>
</tr>
<tr>
<td><code>kube_pod_container_status_restarts_total</code></td>
<td><code>Counter</code></td>
<td>Pod 的重启次数</td>
<td></td>
</tr>
</tbody></table>
<h2 id="nginx-ingress-controller-相关指标"><a href="#nginx-ingress-controller-相关指标" class="headerlink" title="nginx-ingress-controller 相关指标"></a>nginx-ingress-controller 相关指标</h2><p><a href="https://csms.tech/202212141608/#配置-Prometheus-抓取-Ingress-Nginx-指标">配置 Prometheus 监控 Ingress-Nginx-Controller 指标</a> 后，Prometheus 可以读取到 Ingress-Nginx-Controller 暴露的监控指标。</p>
<p><a href="https://csms.tech/202306051707/#使用-Prometheus-数据源展示-Kubernetes-中-Ingress-Nginx-Controller-监控数据">Grafana 中配置使用 Ingress-Nginx-Controller 指标示例</a></p>
<table>
<thead>
<tr>
<th>指标名称</th>
<th>类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>nginx_ingress_controller_requests</code></td>
<td><code>Counter</code></td>
<td>Ingress Nginx Controller 接收到的所有请求数，，包括各个状态码</td>
<td><code>irate(nginx_ingress_controller_requests[2m])</code> - 请求速率</td>
</tr>
<tr>
<td><code>nginx_ingress_controller_nginx_process_connections</code></td>
<td>连接数，包括各个状态码</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>nginx_ingress_controller_request_duration_seconds_sum</code></td>
<td>请求持续时间的总和<br/><em><strong>请求持续时间是从请求进入 Ingress 控制器开始，到响应返回给客户端结束的整个时间</strong></em></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>nginx_ingress_controller_request_duration_seconds_count</code></td>
<td>请求持续时间的计数。</td>
<td>计算平均请求持续时间：平均请求持续时间 &#x3D; 请求持续时间总和 &#x2F; 请求持续时间计数</td>
<td></td>
</tr>
<tr>
<td><code>nginx_ingress_controller_ingress_upstream_latency_seconds_sum</code></td>
<td>upstream 占用时间的总和<br/><em><strong>upstream 占用时间是指请求从 Ingress 到达 upstream（backend）服务器的时间</strong></em></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>nginx_ingress_controller_ingress_upstream_latency_seconds_count</code></td>
<td>upstream 上游占用时间的计数</td>
<td>计算平均上游占用时间：平均上游占用时间 &#x3D; 上游占用时间总和 &#x2F; 上游占用时间计数。</td>
<td></td>
</tr>
</tbody></table>
<h1 id="node-相关指标"><a href="#node-相关指标" class="headerlink" title="node 相关指标"></a>node 相关指标</h1><h2 id="主机信息"><a href="#主机信息" class="headerlink" title="主机信息"></a>主机信息</h2><p>包括 CPU 架构、内核版本、操作系统类型、主机名等，集中在指标 <code>node_uname_info</code> 中。</p>
<h2 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h2><table>
<thead>
<tr>
<th>指标名称</th>
<th>类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>node_cpu_seconds_total</code></td>
<td><code>Counter</code></td>
<td>CPU 使用时间</td>
<td><code>node_cpu_seconds_total&#123;mode=&quot;idle&quot;&#125;</code> - CPU 空闲时间</td>
</tr>
</tbody></table>
<h3 id="统计节点-CPU-使用率"><a href="#统计节点-CPU-使用率" class="headerlink" title="统计节点 CPU 使用率"></a>统计节点 CPU 使用率</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">100 - (avg by (instance) (irate(node_cpu_seconds_total&#123;mode=&quot;idle&quot;&#125;[5m])) * 100)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h2><table>
<thead>
<tr>
<th>指标名称</th>
<th>类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>node_memory_MemTotal_bytes</code></td>
<td><code>Gauge</code></td>
<td>总的内存</td>
<td></td>
</tr>
<tr>
<td><code>node_memory_MemFree_bytes</code></td>
<td><code>Gauge</code></td>
<td>空闲内存</td>
<td></td>
</tr>
<tr>
<td><code>node_memory_Cached_bytes</code></td>
<td><code>Gauge</code></td>
<td>Cache 内存</td>
<td></td>
</tr>
<tr>
<td><code>node_memory_Buffers_bytes</code></td>
<td><code>Gauge</code></td>
<td>Buffers 内存</td>
<td></td>
</tr>
</tbody></table>
<h3 id="统计节点的-内存使用率"><a href="#统计节点的-内存使用率" class="headerlink" title="统计节点的 内存使用率"></a>统计节点的 内存使用率</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">(node_memory_MemTotal_bytes - node_memory_MemFree_bytes - node_memory_Cached_bytes - node_memory_Buffers_bytes) / node_memory_MemTotal_bytes * 100</span><br></pre></td></tr></table></figure>

<h2 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h2><table>
<thead>
<tr>
<th>指标名称</th>
<th>类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>node_network_receive_bytes_total</code></td>
<td><code>Counter</code></td>
<td>网卡<strong>接收</strong>的流量</td>
<td></td>
</tr>
<tr>
<td><code>node_network_transmit_bytes_total</code></td>
<td><code>Counter</code></td>
<td>网卡<strong>发送</strong>的流量</td>
<td></td>
</tr>
</tbody></table>
<h3 id="网卡流量带宽"><a href="#网卡流量带宽" class="headerlink" title="网卡流量带宽"></a>网卡流量带宽</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">irate(node_network_receive_bytes_total&#123;device!~&quot;cni0|docker.*|flannel.*|veth.*|virbr.*|lo&quot;,kubernetes_io_hostname=~&quot;$node&quot;&#125;[$prometheusTimeInterval])</span><br><span class="line"></span><br><span class="line">irate(node_network_transmit_bytes_total&#123;device!~&quot;cni0|docker.*|flannel.*|veth.*|virbr.*|lo&quot;,kubernetes_io_hostname=~&quot;$node&quot;&#125;[$prometheusTimeInterval])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202301191014/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202301191014/" class="post-title-link" itemprop="url">Django model 使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-19 10:14:24" itemprop="dateCreated datePublished" datetime="2023-01-19T10:14:24+08:00">2023-01-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-05 10:28:57" itemprop="dateModified" datetime="2024-04-05T10:28:57+08:00">2024-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Python/Django/" itemprop="url" rel="index"><span itemprop="name">Django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Python 3.10</li>
<li>Django 4.1</li>
</ul>
<p>在 Project&#x2F;App 的 <code>models.py</code> 文件中创建 <code>model</code>，当 model 定义完成，Django 会自动生产一个后台管理接口，允许认证用户添加、更改和删除对象，只需在管理站点上注册模型即可 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[设计模型](https://docs.djangoproject.com/zh-hans/4.1/intro/overview/#design-your-model)">[1]</span></a></sup></p>
<h1 id="创建-model"><a href="#创建-model" class="headerlink" title="创建 model"></a>创建 model</h1><p>在 Project&#x2F;App 的 <code>models.py</code> 文件中创建 <code>model</code></p>
<figure class="highlight shell"><figcaption><span>models.py</span></figcaption><table><tr><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">公司部门</span></span><br><span class="line">class Department(models.Model):</span><br><span class="line">    name = models.CharField(max_length=24, unique=True, help_text=&quot;部门名称&quot;,verbose_name=&#x27;名称&#x27;)</span><br><span class="line">    shortName = models.CharField(max_length=8, unique=True, help_text=&quot;部门名称简称&quot;,verbose_name=&#x27;简称&#x27;)</span><br><span class="line">    manager = models.ForeignKey(&#x27;Emplyee&#x27;, on_delete=models.CASCADE, help_text=&quot;部门老大&quot;)</span><br><span class="line">    comment = models.CharField(max_length=256, blank=True, help_text=&quot;备注信息&quot;,verbose_name=&#x27;备注&#x27;)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.shortName</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        # 管理后台显示的 model 名，最后面没有 &#x27;s&#x27;</span><br><span class="line">        verbose_name_plural = &quot;部门&quot;</span><br><span class="line">        </span><br><span class="line">        # 管理后台显示的 model 名，最后面有 &#x27;s&#x27;，显示为 &#x27;部门s&#x27;</span><br><span class="line">        verbose_name = &quot;部门&quot;</span><br><span class="line">        </span><br><span class="line">        # 数据库中生成的表名称 默认 app名称 + 下划线 + 类名</span><br><span class="line">        db_table = &quot;table_name&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/4.1/ref/models/fields/">Django 模型字段参考</a></p>
<p>对修改后的 <code>model</code> 进行 <code>migrate</code>，以使在数据库中变更更改。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>
<h1 id="model-注册到后台"><a href="#model-注册到后台" class="headerlink" title="model 注册到后台"></a>model 注册到后台</h1><p>在 Project&#x2F;App 的 <code>admin.py</code> 文件中注册 <code>model</code></p>
<figure class="highlight shell"><figcaption><span>admin.py</span></figcaption><table><tr><td class="code"><pre><span class="line">from django.contrib import admin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">假如 app 为 servers，导入 models</span></span><br><span class="line">from servers import models</span><br><span class="line"></span><br><span class="line">admin.site.site_header = &quot;My Admin&quot;</span><br><span class="line">admin.site.site_title = &quot;My Admin&quot;</span><br><span class="line"></span><br><span class="line">@admin.register(models.Department)</span><br><span class="line">class DepartmentAdmin(admin.ModelAdmin):</span><br><span class="line">    list_display = (&#x27;id&#x27;,&#x27;name&#x27;,&#x27;shortName&#x27;,&#x27;manager&#x27;,&#x27;comment&#x27;)</span><br><span class="line">    list_display_links = (&#x27;id&#x27;,&#x27;name&#x27;,&#x27;shortName&#x27;,&#x27;manager&#x27;,&#x27;comment&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>更多有关 admin 配置方法，请参考 <a href="/202209021312/" title="Django admin 配置">Django admin 配置</a></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202301191014/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202208101059/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202208101059/" class="post-title-link" itemprop="url">xshell 常用配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-10 10:59:53" itemprop="dateCreated datePublished" datetime="2022-08-10T10:59:53+08:00">2022-08-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-02 11:36:48" itemprop="dateModified" datetime="2024-04-02T11:36:48+08:00">2024-04-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/xshell/" itemprop="url" rel="index"><span itemprop="name">xshell</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>xshell7</li>
</ul>
<h1 id="常用配置"><a href="#常用配置" class="headerlink" title="常用配置"></a>常用配置</h1><h2 id="字体配置"><a href="#字体配置" class="headerlink" title="字体配置"></a>字体配置</h2><p>(菜单栏)查看 &gt; 工具栏 &gt; 标准按钮  </p>
<p><img src="https://i.csms.tech/img_36.png"></p>
<p>中文字体和英文字体需要单独配置，建议配置默认会话属性</p>
<p>(菜单栏)文件 &gt; 默认会话属性，找到 <code>外观</code> 分别配置 <code>字体</code> 以及 <code>亚洲字体</code>:</p>
<p><img src="https://i.csms.tech/img_225.png"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202208101059/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202403051140/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202403051140/" class="post-title-link" itemprop="url">婚礼用品</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-03-05 11:40:51 / 修改时间：11:40:56" itemprop="dateCreated datePublished" datetime="2024-03-05T11:40:51+08:00">2024-03-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8/" itemprop="url" rel="index"><span itemprop="name">生活日常</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="伴手礼选择"><a href="#伴手礼选择" class="headerlink" title="伴手礼选择"></a>伴手礼选择</h1><h2 id="伴娘伴手礼"><a href="#伴娘伴手礼" class="headerlink" title="伴娘伴手礼"></a>伴娘伴手礼</h2><table>
<thead>
<tr>
<th>类别</th>
<th>产品类别推荐</th>
<th>详情参考</th>
</tr>
</thead>
<tbody><tr>
<td>香薰、香水</td>
<td>香薰礼盒</td>
<td></td>
</tr>
<tr>
<td>化妆品</td>
<td></td>
<td></td>
</tr>
<tr>
<td>花果茶</td>
<td></td>
<td></td>
</tr>
<tr>
<td>喜糖礼盒</td>
<td>佳偶良缘 喜糖礼盒</td>
<td></td>
</tr>
</tbody></table>
<p>参考链接：<br><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/516873685">20款百元左右的高级感伴手礼</a></p>
<h2 id="伴郎伴手礼"><a href="#伴郎伴手礼" class="headerlink" title="伴郎伴手礼"></a>伴郎伴手礼</h2><table>
<thead>
<tr>
<th>类别</th>
<th>产品类别推荐</th>
<th>详情参考</th>
</tr>
</thead>
<tbody><tr>
<td>茶</td>
<td>过宋小湯四季养生礼盒<br/>UMTEA 关心茶礼盒</td>
<td></td>
</tr>
<tr>
<td>葡萄酒</td>
<td>名庄95分 蓝风铃甜白葡萄酒</td>
<td></td>
</tr>
<tr>
<td>点心</td>
<td>马卡龙甜点糕点铁盒</td>
<td></td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202403041737/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202403041737/" class="post-title-link" itemprop="url">VB</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-03-04 17:37:24 / 修改时间：17:37:29" itemprop="dateCreated datePublished" datetime="2024-03-04T17:37:24+08:00">2024-03-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8/" itemprop="url" rel="index"><span itemprop="name">生活日常</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8/%E7%90%86%E8%B4%A2/" itemprop="url" rel="index"><span itemprop="name">理财</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>根据更新的比特币价格数据和计算，如果每年元旦买入BTC，次年元旦卖出，直到2024年，每年的投资回报率（ROI）如下：</p>
<ul>
<li>2013年买入，2014年卖出的ROI：约  <strong>5390.75%</strong></li>
<li>2014年买入，2015年卖出的ROI：约  <strong>-57.01%</strong></li>
<li>2015年买入，2016年卖出的ROI：约  <strong>37.21%</strong></li>
<li>2016年买入，2017年卖出的ROI：约  <strong>131.78%</strong></li>
<li>2017年买入，2018年卖出的ROI：约  <strong>1243.49%</strong></li>
<li>2018年买入，2019年卖出的ROI：约  <strong>-72.10%</strong></li>
<li>2019年买入，2020年卖出的ROI：约  <strong>92.07%</strong></li>
<li>2020年买入，2021年卖出的ROI：约  <strong>308.63%</strong></li>
<li>2021年买入，2022年卖出的ROI：约  <strong>62.51%</strong></li>
<li>2022年买入，2023年卖出的ROI：约  <strong>-58.27%</strong></li>
<li>2023年买入，2024年卖出的ROI：约  <strong>166.06%</strong></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202301171752/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202301171752/" class="post-title-link" itemprop="url">aws cli 命令用法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-17 11:37:49" itemprop="dateCreated datePublished" datetime="2023-01-17T11:37:49+08:00">2023-01-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-01 17:40:36" itemprop="dateModified" datetime="2024-03-01T17:40:36+08:00">2024-03-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E4%BA%91%E5%B9%B3%E5%8F%B0/" itemprop="url" rel="index"><span itemprop="name">云平台</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E4%BA%91%E5%B9%B3%E5%8F%B0/Aws/" itemprop="url" rel="index"><span itemprop="name">Aws</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>aws-cli&#x2F;2.9.15</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/getting-started-install.html">aws cli 安装更新说明</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-configure-quickstart.html">aws cli 基础配置及说明</a></p>
<h1 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h1><p>查看 <code>aws</code> 帮助信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">aws help</span><br></pre></td></tr></table></figure>
<p>查看子命令帮助信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">aws ec2 help</span><br></pre></td></tr></table></figure>

<p>配置认证信息时指定鉴权信息对应的 Profile</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">aws configure --profile source-account</span><br></pre></td></tr></table></figure>

<p><code>aws</code> 命令常用选项</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>--region</code></td>
<td>指定区域，<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/general/latest/gr/rande.html">aws 区域列表</a></td>
<td><code>aws --region ap-east-1 ec2 describe-instances</code></td>
</tr>
<tr>
<td><code>--profile</code></td>
<td>指定配置文件名称。<strong>当需要同时操作多个账号上面的 S3 目标时，可以为每个账号指定 profile 名称，在后续操作时使用选项 <code>--profile</code> 指定要使用的 Profile</strong></td>
<td></td>
</tr>
</tbody></table>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202301171752/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202402201708/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202402201708/" class="post-title-link" itemprop="url">IBKR 使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-02-20 17:08:27 / 修改时间：17:08:32" itemprop="dateCreated datePublished" datetime="2024-02-20T17:08:27+08:00">2024-02-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8/" itemprop="url" rel="index"><span itemprop="name">生活日常</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8/%E7%90%86%E8%B4%A2/" itemprop="url" rel="index"><span itemprop="name">理财</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><a target="_blank" rel="noopener" href="https://www.interactivebrokers.com/cn/accounts/fees/pricing-interest-rates.php?lp=T">开户链接</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202209121102/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202209121102/" class="post-title-link" itemprop="url">kubernetes 安装配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-12 11:03:09" itemprop="dateCreated datePublished" datetime="2022-09-12T11:03:09+08:00">2022-09-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-02-14 14:30:24" itemprop="dateModified" datetime="2024-02-14T14:30:24+08:00">2024-02-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/setup/production-environment/">Kubernetes 官网文档</a></p>
<h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos 7 5.4.212-1</li>
<li>Docker 20.10.18</li>
<li>containerd.io-1.6.8</li>
<li>kubectl-1.24.7</li>
<li>kubeadm-1.24.7</li>
<li>kubelet-1.24.7</li>
</ul>
<h1 id="kubernetes-环境安装前配置"><a href="#kubernetes-环境安装前配置" class="headerlink" title="kubernetes 环境安装前配置"></a>kubernetes 环境安装前配置</h1><h2 id="升级内核版本"><a href="#升级内核版本" class="headerlink" title="升级内核版本"></a>升级内核版本</h2><p>Centos 7 默认的内核版本 3.10 在运行 kubernetes 时存在不稳定性，建议升级内核版本到新版本</p>
<a href="/202209140931/" title="Linux 升级内核">Linux 升级内核</a>

<blockquote>
<ul>
<li><p>Centos 7 默认的内核版本 3.10 使用的 cgroup 版本为 v1，Kubernetes 的部分功能必须使用 <code>cgroup v2</code> 来进行增强的资源管理和隔离 <sup id="fnref:13"><a href="#fn:13" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[About cgroup v2](https://kubernetes.io/docs/concepts/architecture/cgroups/)">[13]</span></a></sup></p>
<p>使用以下命令检查系统使用的 <code>cgroup</code> 版本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">stat -fc %T /sys/fs/cgroup/</span><br></pre></td></tr></table></figure>
<p>如果输出是 <code>cgroup2fs</code>， <strong>表示使用 cgroup v2</strong></p>
<p>如果输出是 <code>tmpfs</code>， <strong>表示使用 cgroup v1</strong></p>
</li>
<li><p><code>User Namespaces</code> 功能需要 Linux 6.3 以上版本，<code>tmpfs</code> 才能支持 <code>idmap</code> 挂载。并且其他功能（如 ServiceAccount 的挂载）也需要此功能的支持 <sup id="fnref:14"><a href="#fn:14" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[User Namespaces](https://kubernetes.io/docs/concepts/workloads/pods/user-namespaces/)">[14]</span></a></sup></p>
</li>
<li><p><strong>Kubernetes v1.32 需要 Linux Kernel &gt;&#x3D; 4.19, 建议 5.8+ 以更好的支持 cgroups v2</strong></p>
</li>
<li><p><strong>Rocky Linux 8 或者 Centos 8 默认使用 <code>cgroup v1</code>，需要升级到 <code>cgroup v2</code>，执行命令 <code>grubby --update-kernel=ALL --args=&quot;systemd.unified_cgroup_hierarchy=1&quot;</code> 后重启即可升级到 <code>cgroup v2</code> 。</strong> 使用以下命令检查：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">stat</span> -<span class="built_in">fc</span> %T /sys/fs/cgroup/</span></span><br><span class="line">cgroup2fs</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>若 CRI 使用 Containerd，需要 <a href="https://csms.tech/202212011355/#Containerd-常用配置">配置启用 CRI 以及配置其使用 <code>cgroup v2</code></a>。</strong></p>
</li>
</ul>
</blockquote>
<h2 id="关闭-SELinux"><a href="#关闭-SELinux" class="headerlink" title="关闭 SELinux"></a>关闭 SELinux</h2><p>kubernetes 目前未实现对 SELinux 的支持，因此必须要关闭 SELinux</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo setenforce 0</span><br><span class="line">sudo sed -i &#x27;s/^SELINUX=enforcing$/SELINUX=disabled/&#x27; /etc/selinux/config</span><br></pre></td></tr></table></figure>

<h2 id="集群中所有计算机之间具有完全的网络连接"><a href="#集群中所有计算机之间具有完全的网络连接" class="headerlink" title="集群中所有计算机之间具有完全的网络连接"></a>集群中所有计算机之间具有完全的网络连接</h2><p>配置集群所有节点的防火墙，确保所有集群节点之间具有完全的网络连接。</p>
<ul>
<li>放通节点之间的通信</li>
<li>确保防火墙允许 <code>FORWARD</code> 链的流量<figure class="highlight shell"><figcaption><span>/etc/sysconfig/iptables</span></figcaption><table><tr><td class="code"><pre><span class="line">*filter</span><br><span class="line">:INPUT DROP [0:0]</span><br><span class="line">:FORWARD ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [4:368]</span><br><span class="line"></span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A INPUT -i lo -j ACCEPT</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubernetes nodes</span></span><br><span class="line">-A INPUT -m comment --comment &quot;kubernetes nodes&quot; -s 172.31.5.58 -j ACCEPT</span><br><span class="line">-A INPUT -m comment --comment &quot;kubernetes nodes&quot; -s 172.31.5.68 -j ACCEPT</span><br><span class="line">-A INPUT -m comment --comment &quot;kubernetes nodes&quot; -s 172.31.0.230 -j ACCEPT</span><br><span class="line"></span><br><span class="line">-A INPUT -p tcp -m multiport --dports 80,443 -j ACCEPT -m comment --comment &quot;k8s ingress http,https&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">-A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT</span><br><span class="line">-A INPUT -p icmp -m icmp --icmp-type 0 -j ACCEPT</span><br><span class="line">-A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line">COMMIT</span><br></pre></td></tr></table></figure></li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202209121102/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202401101016/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202401101016/" class="post-title-link" itemprop="url">kubernetes 理论知识点汇总</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-01-10 10:17:01" itemprop="dateCreated datePublished" datetime="2024-01-10T10:17:01+08:00">2024-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-02-13 10:50:33" itemprop="dateModified" datetime="2024-02-13T10:50:33+08:00">2024-02-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Kubernetes 1.29</li>
</ul>
<h1 id="kubeadm-初始化集群"><a href="#kubeadm-初始化集群" class="headerlink" title="kubeadm 初始化集群"></a>kubeadm 初始化集群</h1><h2 id="Network-setup"><a href="#Network-setup" class="headerlink" title="Network setup"></a>Network setup</h2><h3 id="组件的-advertise-IP-地址选择"><a href="#组件的-advertise-IP-地址选择" class="headerlink" title="组件的 advertise IP 地址选择"></a>组件的 advertise IP 地址选择</h3><p>Kubernetes 中的组件（如 <code>Kubeadm</code>、<code>Kube-apiserver</code> 等）在初始化启动时，都需要在节点（主机）上找到一个合适的 IP 作为组件的 <code>advertising</code>&#x2F;<code>listening</code> 的地址。<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Network setup](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#network-setup)">[1]</span></a></sup></p>
<p>默认情况下，此 IP 是主机上默认路由对应的网卡所在的 IP。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ip route show</span></span><br><span class="line">default via 172.31.16.1 dev eth0 </span><br><span class="line">10.244.1.0/24 via 10.244.1.0 dev flannel.1 onlink </span><br><span class="line">10.244.2.0/24 via 10.244.2.0 dev flannel.1 onlink </span><br><span class="line">10.244.3.0/24 via 10.244.3.0 dev flannel.1 onlink </span><br><span class="line">10.244.4.0/24 via 10.244.4.0 dev flannel.1 onlink </span><br><span class="line">172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 </span><br><span class="line">172.31.16.0/20 dev eth0 proto kernel scope link src 172.31.26.11</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果系统上有多个默认路由，组件会尝试使用第一个默认路由对应的网卡所在的 IP。<strong>如果系统上没有默认路由，并且未明确为组件配置 IP，组件会初始化失败并退出</strong></p>
</blockquote>
<p>组件选择的 IP 地址将会作为 X.509 证书的 SAN(Subject Alternative Name) 的一部分。因此在系统初始化运行之后修改 IP 需要重新签发证书并重启相关组件。</p>
<h3 id="Pod-网段选择"><a href="#Pod-网段选择" class="headerlink" title="Pod 网段选择"></a>Pod 网段选择</h3><p>Pod 的网段必须不能和主机网络重叠，如果选用的网络插件的网络和主机的网段重叠，必须为网络插件选择合适的和主机不同的网段，在集群初始化时通过参数 <code>--pod-network-cidr</code> 配置，并在安装网络插件时在其 YAML 文件中修改为对应的网段。 <sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Installing a Pod network add-on](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#pod-network)">[4]</span></a></sup></p>
<h2 id="control-plane-endpoint-参数说明"><a href="#control-plane-endpoint-参数说明" class="headerlink" title="control-plane-endpoint 参数说明"></a>control-plane-endpoint 参数说明</h2><p><code>--control-plane-endpoint</code> 选项用来配置 <code>api-server</code> 的共享地址，可以是域名或者负载均衡器的 IP。 <sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Initializing your control-plane node](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#initializing-your-control-plane-node)">[2]</span></a></sup></p>
<p><em><strong>如果是单主节点的 Kubernetes 集群，想要扩展成为多个 Master 节点（高可用），初始化时没有 <code>--control-plane-endpoint</code>，是不被支持的。</strong></em></p>
<p>因此为了后期可以由单个 Master 节点扩展为多个 Master 节点，即高可用，初始化节点时，建议加上此选项配置 <code>api-server</code> 的负载均衡地址。 </p>
<p>&lt;– more –&gt;</p>
<h2 id="admin-conf-的重要性"><a href="#admin-conf-的重要性" class="headerlink" title="admin.conf 的重要性"></a>admin.conf 的重要性</h2><p><code>kubeadm init</code> 初始化集群成功后，会产生一个 <code>kubeconfig</code> 文件 <code>/etc/kubernetes/admin.conf</code>，此配置中包含了一个绑定到 <code>cluster-admin</code> 的 ClusterRole 的组，其拥有对整个集群的控制权，<em><strong>不要将其共享给任何人</strong></em>。<sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[admin.conf](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#more-information)">[3]</span></a></sup></p>
<p><code>kubeadm init</code> 初始化集群成功后，同时会生成一个名为 <code>super-admin.conf</code> 的 <code>kubeconfig</code> 文件，其中配置的超级用户可以跳过 <code>authorization layer</code>，比如 RBAC。<em><strong>不要将其共享给任何人</strong></em>。建议将其保存在一个安全的位置。</p>
<h1 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h1><h2 id="节点名称"><a href="#节点名称" class="headerlink" title="节点名称"></a>节点名称</h2><p>在 Kubernetes 集群中，节点名称（Node Name）唯一的标识一个节点。在一个集群中，不能有多个名称一样的节点，<strong>Kubernetes 系统默认同一个 <em>节点名（Node Name）</em> 的实例将具有同样的一个状态和属性</strong> <sup id="fnref:7"><a href="#fn:7" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Node name uniqueness](https://kubernetes.io/docs/concepts/architecture/nodes/#node-name-uniqueness)">[7]</span></a></sup></p>
<h2 id="配置节点为不可调度"><a href="#配置节点为不可调度" class="headerlink" title="配置节点为不可调度"></a>配置节点为不可调度</h2><p>将节点标记为 <strong>不可调度（unschedulable ）</strong> 会阻止系统调度新的 Pod 到节点上，但是不会影响节点上已有的 Pod。</p>
<h1 id="Labels-Selectors-Annotations"><a href="#Labels-Selectors-Annotations" class="headerlink" title="Labels Selectors Annotations"></a>Labels Selectors Annotations</h1><p>Label 主要用来给 Kubernetes 中的对象添加 <em><strong>可识别属性</strong></em>。 Label 可以提供高效的查询和匹配以选择 Kubernetes 中的对象，Lables 可以在对象创建时或者运行过程中随时做变更。</p>
<p><strong>不具有识别属性的信息</strong> 不建议用作 Labels，而是应该写入 Annotations 中。<sup id="fnref:5"><a href="#fn:5" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Labels and Selectors](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)">[5]</span></a></sup></p>
<p>Label Key 由 2 部分构成：</p>
<ul>
<li>（可选的）前缀。系统组件（如 <code>kube-scheduler</code>, <code>kube-controller-manager</code>, <code>kube-apiserver</code>, <code>kubectl</code>） 或者第三方自动化组件为对象添加 labels 时必须带有前缀（prefix）。<code>kubernetes.io/</code> and <code>k8s.io/</code> 是为 Kubernetes 核心系统保留的前缀</li>
<li>（必须的）名字。<blockquote>
<p>Annotations 的 Key 命名规则和 Label Key 基本一致 <sup id="fnref:6"><a href="#fn:6" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Annotations Key Syntax and character set](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/#syntax-and-character-set)">[6]</span></a></sup></p>
</blockquote>
</li>
</ul>
<p><a href="https://csms.tech/202209241108/#标签和选择算符">Label select 用法说明</a></p>
<h1 id="集群间通讯流量说明"><a href="#集群间通讯流量说明" class="headerlink" title="集群间通讯流量说明"></a>集群间通讯流量说明</h1><h2 id="API-Server-到-kubelet"><a href="#API-Server-到-kubelet" class="headerlink" title="API Server 到 kubelet"></a>API Server 到 kubelet</h2><p>API Server 请求 <code>kubelet</code> 的主要目的包括： <sup id="fnref:8"><a href="#fn:8" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[API server to kubelet](https://kubernetes.io/docs/concepts/architecture/control-plane-node-communication/#api-server-to-kubelet)">[8]</span></a></sup></p>
<ul>
<li>获取到 Pods 的日志</li>
<li>（比如使用 <code>kubectl</code>） Attach 到 Pods 中的容器</li>
<li>提供 <code>kubelet</code> 的端口转发功能。</li>
</ul>
<blockquote>
<p> 默认情况下，API 服务器不检查 <code>kubelet</code> 的服务证书。这使得此类连接容易受到中间人攻击， 在非受信网络或公开网络上运行也是 <strong>不安全的</strong>。<br>为了对这个连接进行认证，使用 <code>--kubelet-certificate-authority</code> 标志给 API 服务器提供一个根证书包，用于 <code>kubelet</code> 的服务证书。</p>
</blockquote>
<h2 id="API-Server-到-nodes-pods-和-services"><a href="#API-Server-到-nodes-pods-和-services" class="headerlink" title="API Server 到 nodes, pods 和 services"></a>API Server 到 nodes, pods 和 services</h2><p>从 API 服务器到节点、Pod 或服务的连接默认为纯 HTTP 方式，因此既没有认证，也没有加密。 这些连接可通过给 API URL 中的节点、Pod 或服务名称添加前缀 https: 来运行在安全的 HTTPS 连接上。 不过这些连接既不会验证 HTTPS 末端提供的证书，也不会提供客户端证书。 因此，虽然连接是加密的，仍无法提供任何完整性保证。 这些连接 目前还不能安全地 在非受信网络或公共网络上运行。 <sup id="fnref:8"><a href="#fn:8" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[API server to kubelet](https://kubernetes.io/docs/concepts/architecture/control-plane-node-communication/#api-server-to-kubelet)">[8]</span></a></sup></p>
<p>Kubernetes 支持使用 <a target="_blank" rel="noopener" href="https://www.ssh.com/academy/ssh/tunneling">SSH tunnels</a> 来加密从 API 到 nodes 的链接（目前已经处于废弃状态，推荐使用 <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/architecture/control-plane-node-communication/#konnectivity-service">Konnectivity service</a> 替代）。</p>
<h1 id="Leases"><a href="#Leases" class="headerlink" title="Leases"></a>Leases</h1><p>Kubernetes 使用 Lease API 来更新 <code>kubelet</code> 发送到 Kubernetes API Server 的心跳信息。Kubernetes 中的每一个节点在 <code>kube-node-lease</code> Namespace 中都有一个 <code>Lease</code> Object。<code>kubelet</code> 向系统上报心跳的过程，就是在更新对应的 <code>Lease</code> Object 的 <code>spec.renewTime</code> 字段，Kubernetes 控制平面会使用这个上报的时间戳来决定节点是否可用 <sup id="fnref:9"><a href="#fn:9" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Node heartbeats](https://kubernetes.io/docs/concepts/architecture/leases/#node-heart-beats)">[9]</span></a></sup> </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl describe lease -n kube-node-lease k8s-admin</span></span><br><span class="line">Name:         k8s-node1</span><br><span class="line">Namespace:    kube-node-lease</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line">API Version:  coordination.k8s.io/v1</span><br><span class="line">Kind:         Lease</span><br><span class="line">Metadata:</span><br><span class="line">  Creation Timestamp:  2023-09-07T09:54:15Z</span><br><span class="line">  Managed Fields:</span><br><span class="line">    API Version:  coordination.k8s.io/v1</span><br><span class="line">    Fields Type:  FieldsV1</span><br><span class="line">	...</span><br><span class="line">  Owner References:</span><br><span class="line">    API Version:     v1</span><br><span class="line">    Kind:            Node</span><br><span class="line">    Name:            k8s-node1</span><br><span class="line">    UID:             db3dafee-1232-4c07-a1c6-524f86a96fbe</span><br><span class="line">  Resource Version:  46696081</span><br><span class="line">  UID:               053d9b79-81be-4f3f-801e-09192012c822</span><br><span class="line">Spec:</span><br><span class="line">  Holder Identity:         k8s-node1</span><br><span class="line">  Lease Duration Seconds:  40</span><br><span class="line">  Renew Time:              2024-02-03T02:30:11.760176Z</span><br><span class="line">Events:                    &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p>Leases 也被用来确保 HA 的组件（类似 <code>kube-controller-manager</code> 和 <code>kube-scheduler</code>）在同一时刻只有一个实例提供服务，其他实例处于备用状态 <sup id="fnref:9"><a href="#fn:9" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Node heartbeats](https://kubernetes.io/docs/concepts/architecture/leases/#node-heart-beats)">[9]</span></a></sup></p>
<h1 id="kubelet"><a href="#kubelet" class="headerlink" title="kubelet"></a>kubelet</h1><h2 id="串行和并行拉取镜像"><a href="#串行和并行拉取镜像" class="headerlink" title="串行和并行拉取镜像"></a>串行和并行拉取镜像</h2><p>Kubelet 默认（同一个节点）串行的拉取镜像，即同一时间只发送一个拉取镜像的请求到 Registry Server，其他的拉取镜像的请求保持等待，直到当前请求处理完成。多个节点上的镜像拉取请求是隔离的，即不同的节点在同一时间是并行的拉取镜像的。 <sup id="fnref:10"><a href="#fn:10" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Serial and parallel image pulls](https://kubernetes.io/docs/concepts/containers/images/#serial-and-parallel-image-pulls)">[10]</span></a></sup></p>
<p>如果要配置一个节点上的 Kubelet 并行的拉取镜像，可以在 kubelet 的配置中配置 <code>serializeImagePulls</code> 为 <code>false</code>，前提是 Registry Server 和 CRI 支持并行拉取镜像。  </p>
<h1 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h1><h2 id="Pod-状态"><a href="#Pod-状态" class="headerlink" title="Pod 状态"></a>Pod 状态</h2><p>Pod 的状态字段（<code>status</code>） 是一个 <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.29/#podstatus-v1-core">PodStatus</a> Object。其中包含 <code>phase</code> 字段。<code>phase</code> 字段描述&#x2F;记录了 Pod 在其整个生命周期中所处的阶段 <sup id="fnref:11"><a href="#fn:11" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Pod phase](https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-phase)">[11]</span></a></sup></p>
<p><code>phase</code> 字段可以有以下值：</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>Pending</code></td>
<td>Kubernetes 集群已经接收到创建 Pod 的请求，并且开始调度到节点、下载容器镜像并启动容器，但是有一个或多个容器还未正常运行</td>
</tr>
<tr>
<td><code>Running</code></td>
<td>Pod 已经被调度到某个节点，并且 Pod 中所有的容器已经被创建，至少其中的一个容器已经处于运行状态或重启中</td>
</tr>
<tr>
<td><code>Succeeded</code></td>
<td>Pod 中所有的容器都已经成功终止，并且不会再被重启</td>
</tr>
<tr>
<td><code>Failed</code></td>
<td>Pod 中所有的容器都被终止，但至少有一个容器终止失败，也就是说，容器要么以非零状态码退出或者是被系统终止</td>
</tr>
<tr>
<td><code>Unknow</code></td>
<td>因为某些原因，Pod 的状态获取不到。这个经常发生在和 Pod 运行的节点通信异常时</td>
</tr>
</tbody></table>
<h3 id="Pod-中的容器的状态"><a href="#Pod-中的容器的状态" class="headerlink" title="Pod 中的容器的状态"></a>Pod 中的容器的状态</h3><p>Kubernetes 会跟踪 Pod 中每个容器的状态。一旦通过 Scheduler 将 Pod 分配到某个 Node，Kubernetes 会通过 CRI 创建 Pod 中的容器。</p>
<p>在 Kubernetes 中，容器可以有以下 3 种状态 <sup id="fnref:11"><a href="#fn:11" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Pod phase](https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-phase)">[11]</span></a></sup></p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>Waiting </code></td>
<td>表示容器正在进行必要的操作以正常启动，比如拉取镜像、应用 Secret 数据等。当容器处于此状态时，可以通过 <code>kubectl describe pod</code> 查看输出中对应容器的信息，一般会包含一个 <code>Reason </code> 字段简述 <code>Waiting</code> 的原因</td>
</tr>
<tr>
<td><code>Running</code></td>
<td>表示容器在正常运行</td>
</tr>
<tr>
<td><code>Terminated</code></td>
<td>表示容器运行结束或者因为某些原因失败。详细信息可以通过 <code>kubectl describe pod</code> 查看</td>
</tr>
</tbody></table>
<h1 id="QoS"><a href="#QoS" class="headerlink" title="QoS"></a>QoS</h1><p>Kubernetes 会根据 Pod 定义中的 <code>resource requests and limits</code> 将 Pod 划归到某一个 QoS 类中，Kubernetes 将会根据 QoS 类来决定在节点资源不足的情况下，哪些 Pod 将会被优先驱逐（Evict）。目前存在的 QoS 类主要有以下三个 <sup id="fnref:12"><a href="#fn:12" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Quality of Service](https://kubernetes.io/docs/concepts/workloads/pods/pod-qos/)">[12]</span></a></sup></p>
<table>
<thead>
<tr>
<th>QoS Class</th>
<th>说明</th>
<th>被驱逐权重</th>
</tr>
</thead>
<tbody><tr>
<td><code>Guaranteed</code></td>
<td>Pod 中的 <strong>每个容器必须定义</strong> CPU &amp; Mem <code>request</code> 和 <code>limit</code>，并且 <code>request</code> 的值等于 <code>limit</code> 的值，确保系统会预留定义的资源给 Pod 和其中的容器</td>
<td>最后被驱逐</td>
</tr>
<tr>
<td><code>Burstable</code></td>
<td>Pod 中 <strong>至少有一个容器定义了</strong> CPU <em><strong>或</strong></em> Mem 的 <code>request</code>。可以不定义 <code>limit</code>， <strong>如果未定义 <code>limit</code>，默认可以使用节点上所有可用的资源</strong>。</td>
<td>中间级别</td>
</tr>
<tr>
<td><code>BestEffort</code></td>
<td>未定义任何 CPU <em><strong>或</strong></em> Mem 的 <code>request</code> 或   <code>limit</code></td>
<td>最先被驱逐</td>
</tr>
</tbody></table>
<blockquote>
<p>Memory QoS 基于系统内核的 cgroup v2 实现 <sup id="fnref:12"><a href="#fn:12" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Quality of Service](https://kubernetes.io/docs/concepts/workloads/pods/pod-qos/)">[12]</span></a></sup></p>
<p>Pod 中如果有个容器因为 Limit 被 kill，系统只会 kill 掉这一个容器并重启之，不会影响其他容器</p>
</blockquote>
<h1 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#network-setup">Network setup</a><a href="#fnref:1" rev="footnote"> ↩</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#initializing-your-control-plane-node">Initializing your control-plane node</a><a href="#fnref:2" rev="footnote"> ↩</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#more-information">admin.conf</a><a href="#fnref:3" rev="footnote"> ↩</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#pod-network">Installing a Pod network add-on</a><a href="#fnref:4" rev="footnote"> ↩</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">Labels and Selectors</a><a href="#fnref:5" rev="footnote"> ↩</a></span></li><li id="fn:6"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">6.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/#syntax-and-character-set">Annotations Key Syntax and character set</a><a href="#fnref:6" rev="footnote"> ↩</a></span></li><li id="fn:7"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">7.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/architecture/nodes/#node-name-uniqueness">Node name uniqueness</a><a href="#fnref:7" rev="footnote"> ↩</a></span></li><li id="fn:8"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">8.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/architecture/control-plane-node-communication/#api-server-to-kubelet">API server to kubelet</a><a href="#fnref:8" rev="footnote"> ↩</a></span></li><li id="fn:9"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">9.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/architecture/leases/#node-heart-beats">Node heartbeats</a><a href="#fnref:9" rev="footnote"> ↩</a></span></li><li id="fn:10"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">10.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/containers/images/#serial-and-parallel-image-pulls">Serial and parallel image pulls</a><a href="#fnref:10" rev="footnote"> ↩</a></span></li><li id="fn:11"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">11.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-phase">Pod phase</a><a href="#fnref:11" rev="footnote"> ↩</a></span></li><li id="fn:12"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">12.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/workloads/pods/pod-qos/">Quality of Service</a><a href="#fnref:12" rev="footnote"> ↩</a></span></li></ol></div></div>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202209241108/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202209241108/" class="post-title-link" itemprop="url">kubernetes 对象的 yaml 描述语法说明</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-24 11:08:38" itemprop="dateCreated datePublished" datetime="2022-09-24T11:08:38+08:00">2022-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-02-08 10:31:23" itemprop="dateModified" datetime="2024-02-08T10:31:23+08:00">2024-02-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos7 5.4.212-1</li>
<li>Docker 20.10.18</li>
<li>containerd.io-1.6.8</li>
<li>kubectl-1.25.0</li>
<li>kubeadm-1.25.0</li>
<li>kubelet-1.25.0</li>
</ul>
<p>几乎所有的 Kubernetes 对象都包含两个嵌套的对象字段：</p>
<ul>
<li><code>spec</code> - 对象的期望状态（<code>desired state</code>）的描述信息</li>
<li><code>status</code> - 对象当前的状态（<code>current state</code>）</li>
</ul>
<p>Kubernetes 系统的目标就是不停的调整对象的当前状态（<code>current state</code>）直到和期望状态（<code>desired state</code>）匹配。</p>
<h1 id="常用字段说明"><a href="#常用字段说明" class="headerlink" title="常用字段说明"></a>常用字段说明</h1><h2 id="必需字段"><a href="#必需字段" class="headerlink" title="必需字段"></a>必需字段</h2><p>在想要创建的 Kubernetes 对象所对应的 <code>.yaml</code> 文件中，必须配置的字段如下：<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[必需字段](https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/kubernetes-objects/#required-fields)">[1]</span></a></sup></p>
<ul>
<li><code>apiVersion</code> - 创建该对象所使用的 Kubernetes API 的版本</li>
<li><code>kind</code> - 想要创建的对象的类别</li>
<li><code>metadata</code> - 帮助唯一标识对象的一些数据，包括一个 <code>name</code> 字符串、<code>UID</code> 和可选的 <code>namespace</code></li>
<li><code>spec</code> - 你所期望的该对象的状态</li>
</ul>
<h2 id="metadata"><a href="#metadata" class="headerlink" title="metadata"></a>metadata</h2><p>帮助唯一标识对象的一些数据，包括一个 <code>name</code> 字符串、<code>UID</code> 和可选的 <code>namespace</code> </p>
<p>集群中的每一个对象都有一个 <strong>名称</strong>（<code>name</code>）来标识在同类资源中的唯一性。<code>name</code> 也用来作为 url 中的资源名称 <sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[对象名称和 IDs](https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/names/)">[2]</span></a></sup></p>
<p>每个 Kubernetes 对象也有一个 <strong>UID</strong>（<code>uid</code>）来标识在整个集群中的唯一性。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deployment</span><br><span class="line">  labels: </span><br><span class="line">    app: nginx-deployment</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  replicas: 2 </span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:1.14.2</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure>


<h2 id="标签和选择算符"><a href="#标签和选择算符" class="headerlink" title="标签和选择算符"></a>标签和选择算符</h2><p><strong>标签（labels）</strong> 是附加到 Kubernetes 对象（比如 Pod）上的键值对。 标签旨在用于指定对用户有意义且相关的对象的标识属性，但不直接对核心系统有语义含义。 标签可以用于组织和选择对象的子集。标签可以在创建时附加到对象，随后可以随时添加和修改。 每个对象都可以定义一组键&#x2F;值标签。每个键对于给定对象必须是唯一的。<sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[标签和选择算符](https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/labels/)">[3]</span></a></sup></p>
<p>通过 <strong>标签选择算符</strong>，客户端&#x2F;用户可以识别一组对象。<strong>标签选择算符</strong> 是 Kubernetes 中的核心分组原语。</p>
<blockquote>
<p>对于某些 API 类别（例如 <code>ReplicaSet</code>）而言，两个实例的标签选择算符不得在命名空间内重叠， 否则它们的控制器将互相冲突，无法确定应该存在的副本个数。</p>
</blockquote>
<p>比较新的资源，例如 <code>Job</code>、 <code>Deployment</code>、 <code>ReplicaSet</code> 和 <code>DaemonSet</code>， 也支持基于集合的需求。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">selector:</span><br><span class="line">  matchLabels:</span><br><span class="line">    component: redis</span><br><span class="line">  matchExpressions:</span><br><span class="line">    - &#123;key: tier, operator: In, values: [cache]&#125;</span><br><span class="line">    - &#123;key: environment, operator: NotIn, values: [dev]&#125;</span><br></pre></td></tr></table></figure>
<p><code>matchLabels</code> 是由 <code>&#123;key,value&#125;</code> 对组成的映射。 <code>matchLabels</code> 映射中的单个 <code>&#123;key,value&#125;</code> 等同于 <code>matchExpressions</code> 的元素， 其 <code>key</code> 字段为 <code>key</code>，<code>operator</code> 为 <code>In</code>，而 <code>values</code> 数组仅包含 <code>value</code>。 <code>matchExpressions</code> 是 Pod 选择算符需求的列表。 有效的运算符包括 <code>In</code>、<code>NotIn</code>、<code>Exists</code> 和 <code>DoesNotExist</code>。 在 <code>In</code> 和 <code>NotIn</code> 的情况下，设置的值必须是非空的。 来自 <code>matchLabels</code> 和 <code>matchExpressions</code> 的所有要求都按 <strong>逻辑与</strong> 的关系组合到一起 – <strong>它们必须都满足才能匹配</strong>。</p>
<h3 id="字段选择器"><a href="#字段选择器" class="headerlink" title="字段选择器"></a>字段选择器</h3><p><strong>字段选择器（Field selectors）</strong> 允许你根据一个或多个资源字段的值 <strong>筛选 Kubernetes 资源</strong></p>
<p>下面是一些使用字段选择器查询的例子：</p>
<ul>
<li><code>metadata.name=my-service</code></li>
<li><code>metadata.namespace!=default</code></li>
<li><code>status.phase=Pending</code></li>
</ul>
<p>下面这个 <code>kubectl</code> 命令将筛选出 <code>status.phase</code> 字段值为 <code>Running</code> 的所有 Pod：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get pods --field-selector status.phase=Running</span><br></pre></td></tr></table></figure>

<p>不同的 Kubernetes 资源类型支持不同的字段选择器。 所有资源类型都支持 <code>metadata.name</code> 和 <code>metadata.namespace</code> 字段。 使用不被支持的字段选择器会产生错误</p>
<p>你可在字段选择器中使用 <code>=</code>、<code>==</code> 和 <code>!=</code> （<code>=</code> 和 <code>==</code> 的意义是相同的）操作符。 例如，下面这个 <code>kubectl</code> 命令将筛选所有不属于 <code>default</code> 命名空间的 Kubernetes 服务：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get services  --all-namespaces --field-selector metadata.namespace!=default</span><br></pre></td></tr></table></figure>

<p>同标签和其他选择器一样， 字段选择器可以通过使用逗号分隔的列表组成一个选择链。 下面这个 <code>kubectl</code> 命令将筛选 <code>status.phase</code> 字段不等于 <code>Running</code> 同时 <code>spec.restartPolicy</code> 字段等于 <code>Always</code> 的所有 Pod：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get pods --field-selector=status.phase!=Running,spec.restartPolicy=Always</span><br></pre></td></tr></table></figure>
<p>你能够跨多种资源类型来使用字段选择器。 下面这个 <code>kubectl</code> 命令将筛选出所有不在 <code>default</code> 命名空间中的 <code>StatefulSet</code> 和 <code>Service</code>：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get statefulsets,services --all-namespaces --field-selector metadata.namespace!=default</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202209241108/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202401221722/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202401221722/" class="post-title-link" itemprop="url">英语单词</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-01-22 17:22:53" itemprop="dateCreated datePublished" datetime="2024-01-22T17:22:53+08:00">2024-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-02-07 14:14:47" itemprop="dateModified" datetime="2024-02-07T14:14:47+08:00">2024-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8/" itemprop="url" rel="index"><span itemprop="name">生活日常</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>English Word !</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202401221722/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202307201352/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202307201352/" class="post-title-link" itemprop="url">filebeat 使用详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-07-20 13:52:48" itemprop="dateCreated datePublished" datetime="2023-07-20T13:52:48+08:00">2023-07-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-02-05 16:49:17" itemprop="dateModified" datetime="2024-02-05T16:49:17+08:00">2024-02-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/ELK/" itemprop="url" rel="index"><span itemprop="name">ELK</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Filebeat 8.8</li>
</ul>
<p>Filebeat 启动之后，会根据配置文件中配置的数据收集路径启动 1 个或者多个 <code>inputs</code>。针对匹配到的每个文件，Filebeat 都会启动一个对应的 <code>harvester</code>，每个 <code>harvester</code> 读取一个单独的文件内容，并将其中的新内容发送到 <code>libbeat</code>，<code>libbeat</code> 会整合数据并将其发送到配置的 <code>output</code> <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Filebeat 总览](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-overview.html)">[1]</span></a></sup><br><img src="https://i.csms.tech/img_201.png"></p>
<p>如果 <code>input</code> 类型为 <code>log</code>，<code>input</code> 会负责找到配置中匹配到的文件，并为每个文件启动一个 <code>harvester</code>。每个 <code>input</code> 都运行在自己独立的 <code>Go routine</code> (例程) 中。 <sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[How Filebeat works](https://www.elastic.co/guide/en/beats/filebeat/current/how-filebeat-works.html)">[4]</span></a></sup></p>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/beats/filebeat/current/how-filebeat-works.html">Filebeat 工作原理</a></p>
<p>Filebeat 会将收割(<code>harvest</code>) 的每个文件的状态存储到 <code>registry</code>。因此如果要让 Filebeat 从头开始收集数据，只需要删除 <code>registry</code> 文件即可。可以使用命令 <code>filebeat export config</code> 找到 <code>data</code> 目录，<code>registry</code> 位于其中。</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation-configuration.html">Filebeat 官方安装文档</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.8.2-x86_64.rpm</span><br><span class="line">rpm -vi filebeat-8.8.2-x86_64.rpm</span><br><span class="line"></span><br><span class="line">systemctl enable --now filebeat</span><br></pre></td></tr></table></figure>

<h1 id="filebeat-command-line-interface"><a href="#filebeat-command-line-interface" class="headerlink" title="filebeat command-line interface"></a>filebeat command-line interface</h1><p><code>filebeat</code> 命令常用功能 <sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Filebeat command reference](https://www.elastic.co/guide/en/beats/filebeat/current/command-line-options.html#command-line-options)">[3]</span></a></sup></p>
<table>
<thead>
<tr>
<th>子命令</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>help</code></td>
<td>查看命令帮助信息<br/><code>filebeat help COMMAND_NAME [FLAGS]</code></td>
<td></td>
</tr>
<tr>
<td><code>export</code></td>
<td>导出 <em>配置</em> 等信息</td>
<td><a href="#export"><code>export</code> 使用</a></td>
</tr>
<tr>
<td><code>modules</code></td>
<td>模块管理命令。用来 <code>enable</code> 或者 <code>disable</code> 位于 <code>modules.d</code> 中的 <em>模块</em> <br/><code>filebeat modules disable MODULE</code><br/><code>filebeat modules enable MODULE</code><br/><code>filebeat modules list</code></td>
<td><a href="#Data-collection-modules">Data collection modules</a></td>
</tr>
<tr>
<td><code>run</code></td>
<td>启动 filebeat</td>
<td></td>
</tr>
<tr>
<td><code>test</code></td>
<td>测试配置文件        或者到 <code>output</code> 的连接<br/><code>filebeat test config</code><br/><code>filebeat test output</code></td>
<td></td>
</tr>
<tr>
<td><code>version</code></td>
<td>显示当前版本信息</td>
<td></td>
</tr>
</tbody></table>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202307201352/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202401171333/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202401171333/" class="post-title-link" itemprop="url">和田玉知识归纳</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-01-17 13:33:39 / 修改时间：13:33:44" itemprop="dateCreated datePublished" datetime="2024-01-17T13:33:39+08:00">2024-01-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8/" itemprop="url" rel="index"><span itemprop="name">生活日常</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="和田玉的分类"><a href="#和田玉的分类" class="headerlink" title="和田玉的分类"></a>和田玉的分类</h1><h2 id="山料和籽料"><a href="#山料和籽料" class="headerlink" title="山料和籽料"></a>山料和籽料</h2><p>按照矿产分类，主要分为籽料与山料两种。</p>
<p><em><strong>山料，是籽料的前身</strong></em>。</p>
<h3 id="山料"><a href="#山料" class="headerlink" title="山料"></a>山料</h3><p><strong>和田玉山料</strong> 产自昆仑山脉之中，属于原生矿，被称为 <code>璞玉</code></p>
<p>从质地上说，有的山料的结构较为粗糙，颗粒比较明显或带石性，不带皮色，油性差，有的山料靠近外部有红糖的颜色。也有结构细密，油润度极好的优质山料。</p>
<p>山料因为没有受到河流的冲刷，自始至终都深藏在岩体中，缺乏外力的打磨，看起来比较干涩，所以外形大多平淡无奇，有棱有角，表面也比较干涩，绺裂现象明显。</p>
<h3 id="籽料"><a href="#籽料" class="headerlink" title="籽料"></a>籽料</h3><p><strong>和田玉籽料</strong> 是采自河床或者河床泥土中，经过几十万年的侵蚀打磨而得到的玉石。有时又被称为 <code>水籽</code></p>
<p>籽料是由山料在地质活动时冲刷或滚落到河里，由河水冲刷（还有风化、风干等物理反应一起作用）形成的。籽料产自 <em><strong>河流中下游</strong></em>，是次生矿。产自河流上游的被称为 <em><strong>山流水料</strong></em>。籽料因为长久受到河流的冲刷，一般为卵石形状，表面很光滑圆润，带皮色。</p>
<p><img src="https://i.csms.tech/img_224.png"></p>
<p>和山料的存在环境不同，导致籽料有了以下特性：</p>
<ul>
<li>籽料常年在河水中浸泡，水流的压力使它的肉质变得更加紧密，水流的冲刷使它变的更加温润油腻，形成了它独特的质地和油润感；</li>
<li>河水中存在很多的矿物质和微量元素，长时间的水流冲刷和加压过程中，部分矿物质会沉淀到籽料中，形成各种颜色的籽料皮子。带有皮子的籽料，价格有大大提升</li>
</ul>
<p>籽料开采出来，外观上看就与鹅卵石一般无二，各个颜色都有，只不过他是和田玉再形成的鹅卵石。仔细观察籽料表面会发现上面密密麻麻都是一些小孔，因为这些小孔跟我们皮肤上的毛孔相似被称之为毛孔或者皮孔。和田玉籽料一般有皮色和皮孔，就算没有皮色，籽料上还是能够找到均匀的毛细孔，这是籽料独有的标志。而山料则没有皮色皮孔。</p>
<p>一般情况下，籽料都会拥有或深或浅的皮色，表面还会有明显的小凹坑（也就是俗称的皮孔），这是玉石长时间在水中冲刷、浸泡和磕碰造成的。而山料由于生长环境固定，不存在皮色和皮孔。</p>
<p>同时，由于籽料长年累月泡在水中，水里的微生物和微量元素会渗入到玉石中，所以会造成局部呈现或黄或红或黑的颜色，也就是 <code>沁色</code>。而这一点在山料身上，就非常不明显。</p>
<p><strong>籽料的水润度是明显高于山料的</strong>，如果比较籽料和山料制作的成品，会很容易发现籽料表面质地非常润泽、光滑、细腻。而山料作品，即使经过抛光处理，表面仍会干涩，缺乏光滑的油润感，这一点用手触摸时尤为明显。</p>
<p>由于 <strong>和田玉籽料的密度比山料大</strong>，所以同等体积的情况下，籽料相对山料比较重</p>
<p>山料也有很多可以跟顶级籽料相媲美的。比如 1995 年于田县开采的 8 吨和田玉山料，白度细度等各个方面都是顶级。因品质极佳，入市后引起了轰动，后被称之位“95于田料”。时至今日，“95于田料” 在业内也是传说中的料子，被很多业内人士公认为 <strong>羊脂级</strong>。著名的和氏璧就是一块山料。</p>
<p>和田玉器的市场价格中羊脂玉最高、籽料高、山流水次之、山料更次之。</p>
<h1 id="和田玉结构"><a href="#和田玉结构" class="headerlink" title="和田玉结构"></a>和田玉结构</h1><p>和田玉籽料内部结构致密，用肉眼几乎看不到内部结构；而再好的山料，还是能看到其松软质地的结构。</p>
<p>籽料由于有外力的挤压、打磨，所以密度要明显高过山料。籽料的话，无论是青籽还是白籽，内部结构都是致密的，用肉眼几乎看不到内部结构。而山料，无论结构多致密，在强光手电筒下，总是能看到松软的质地结构。</p>
<h1 id="广义的籽料"><a href="#广义的籽料" class="headerlink" title="广义的籽料"></a>广义的籽料</h1><p>今天的籽料已不是传统意义上的和田籽料了。在广义和田玉的范围内，籽料也有了更多种类。</p>
<h2 id="新疆产的岫玉籽料"><a href="#新疆产的岫玉籽料" class="headerlink" title="新疆产的岫玉籽料"></a>新疆产的岫玉籽料</h2><p>新疆除了有和田玉籽料，还出产一种颜色或绿或黑绿色等，里面也有黑点存在的岫玉。岫玉中品质好的，外观与和田玉籽料很相似，并且在市场上的和田籽料中也能看到相当数量的岫玉籽料，大家要留意。</p>
<h2 id="来自俄罗斯的“籽料”"><a href="#来自俄罗斯的“籽料”" class="headerlink" title="来自俄罗斯的“籽料”"></a>来自俄罗斯的“籽料”</h2><p>俄罗斯玉，近年来随着和田料的减少而逐渐成为软玉舞台的有力竞争者。</p>
<p>从玉材来看，俄料95%都是山料，但也有籽料，只是俄料中的“籽料”并未达到籽料定义的产状玉料：籽料由于长期的冲刷搬运碰撞，玉质形态韧性都达到了特别的质感，而俄料中的“籽料”其实没有这个长期的过程，严格意义上只能算和田玉的山流水料。</p>
<h2 id="辽宁产的河磨料"><a href="#辽宁产的河磨料" class="headerlink" title="辽宁产的河磨料"></a>辽宁产的河磨料</h2><p>河磨料是国内确切命名的两种籽料之一，另一种是和田籽料。“河磨”，从河里磨出来的玉，名字起得很传神，可能因为河水的冲击力较小，河磨料多见厚皮料。</p>
<p>另外，近几年贵州罗甸也出产白度尚可的软玉，透闪石含量达95%，也是广义和田玉中的一种。罗甸玉石性很重，料子干涩，缺乏油性，其实所谓的“籽料”也只能用来骗骗小白玩友；广西大化玉则是这几年才出现的玉种，也是广义和田玉中的一种，大化玉里有籽料，质地也很细腻，有兴趣的宝友可以玩一玩。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202209131536/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202209131536/" class="post-title-link" itemprop="url">kubernetes 常用命令示例</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-13 15:36:31" itemprop="dateCreated datePublished" datetime="2022-09-13T15:36:31+08:00">2022-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-01-10 11:01:44" itemprop="dateModified" datetime="2024-01-10T11:01:44+08:00">2024-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos-7 3.10.0-1062.9.1</li>
<li>Docker 19.03.15</li>
<li>containerd.io-1.4.13</li>
<li>kubectl-1.25.0</li>
<li>kubeadm-1.25.0</li>
<li>kubelet-1.25.0</li>
</ul>
<h1 id="kubeadm-常用命令"><a href="#kubeadm-常用命令" class="headerlink" title="kubeadm 常用命令"></a>kubeadm 常用命令</h1><p><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/">kubeadm 命令官方参考文档</a></p>
<h2 id="创建集群"><a href="#创建集群" class="headerlink" title="创建集群"></a>创建集群</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubeadm init --pod-network-cidr=10.244.0.0/16 --cri-socket=unix:///var/run/cri-dockerd.sock</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>--pod-network-cidr</code></td>
<td>指定 pod 的 cidr，安装 CNI 插件时，配置的 CIDR 要和此处一致</td>
<td></td>
</tr>
<tr>
<td><code>--service-cidr</code></td>
<td><code>service</code> 使用的 CIDR</td>
<td></td>
</tr>
<tr>
<td><code>--cri-socket</code></td>
<td>配置集群使用的 CRI，不指定时系统会扫描主机，如果有多个可用 CRI，会出现提示</td>
<td></td>
</tr>
<tr>
<td><code>--apiserver-advertise-address</code></td>
<td>手动配置 <code>api-server</code> 的 Advertise IP 地址。<br/>不配置的情况下，系统默认选择主机上的默认路由对应网卡上面的 IP</td>
<td></td>
</tr>
<tr>
<td><code>--control-plane-endpoint</code></td>
<td>配置  <code>api-server</code> 的共享地址，可以是域名或者负载均衡器的 IP<br/>单节点的 Master 后期需要扩展为多节点（高可用）时，需要有此配置，否则不支持(<code>kubeadm</code>)扩展</td>
<td></td>
</tr>
</tbody></table>
<h2 id="添加节点到集群"><a href="#添加节点到集群" class="headerlink" title="添加节点到集群"></a>添加节点到集群</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubeadm join 172.31.10.19:6443 --token 8ca35s.butdpihinkdczvqb --discovery-token-ca-cert-hash sha256:b2793f9a6bea44a64640f99042f11c4ff6 \ </span><br><span class="line">        --cri-socket=unix:///var/run/cri-dockerd.sock</span><br></pre></td></tr></table></figure>
<p>其中的 <code>token</code> 可以在 master 上使用以下命令查看</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubeadm token list</span></span><br><span class="line">TOKEN                     TTL         EXPIRES                USAGES                   DESCRIPTION                                                EXTRA GROUPS</span><br><span class="line">8ca35s.butdpihinkdczvqb   19h         2022-09-14T02:54:55Z   authentication,signing   The default bootstrap token generated by &#x27;kubeadm init&#x27;.   system:bootstrappers:kubeadm:default-node-token</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>默认情况下，令牌会在 24 小时后过期。如果要在当前令牌过期后将节点加入集群， 则可以通过在控制平面节点上运行以下命令来创建新令牌：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubeadm token create</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如果你没有 <code>--discovery-token-ca-cert-hash</code> 的值，则可以通过在控制平面节点上执行以下命令链来获取它<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[使用 kubeadm 创建集群](https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#join-nodes)">[1]</span></a></sup>：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | \</span><br><span class="line">   openssl dgst -sha256 -hex | sed &#x27;s/^.* //&#x27;</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202209131536/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202312151503/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202312151503/" class="post-title-link" itemprop="url">ELK 常见错误</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-12-15 15:03:20 / 修改时间：15:03:25" itemprop="dateCreated datePublished" datetime="2023-12-15T15:03:20+08:00">2023-12-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/ELK/" itemprop="url" rel="index"><span itemprop="name">ELK</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="filebeat-上传数据到-elasticsearch-问题汇总"><a href="#filebeat-上传数据到-elasticsearch-问题汇总" class="headerlink" title="filebeat 上传数据到 elasticsearch 问题汇总"></a>filebeat 上传数据到 elasticsearch 问题汇总</h1><h2 id="filebeat-上传数据到-elasticsearch-报错"><a href="#filebeat-上传数据到-elasticsearch-报错" class="headerlink" title="filebeat 上传数据到 elasticsearch 报错"></a>filebeat 上传数据到 elasticsearch 报错</h2><blockquote>
<p>适用版本信息说明</p>
<ul>
<li>filebeat 7</li>
<li>elasticsearch 7</li>
</ul>
</blockquote>
<p>filebeat 7.5.2 上传数据到 Elasticsearch 报错：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">journalctl -f -u filebeat</span></span><br><span class="line">&#123;&quot;type&quot;:&quot;illegal_argument_exception&quot;,&quot;reason&quot;:&quot;Validation Failed: 1: this action would add [2] total shards, but this cluster currently has [6924]/[3000] maximum shards open;&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>此错误原因是由于 Elasticsearch 的集群中打开的分片数量超过了集群的最大分片限制。在 Elasticsearch 中，每个索引由多个分片组成，而集群有一个设置的最大分片数限制。这个限制是为了防止分片数过多导致性能问题。</p>
<p>错误消息 <code>&#123;&quot;type&quot;:&quot;illegal_argument_exception&quot;,&quot;reason&quot;:&quot;Validation Failed: 1: this action would add [2] total shards, but this cluster currently has [6924]/[3000] maximum shards open;&quot;&#125;</code> 显示当前集群已有 6924 个分片，超过了 3000 个的限制。</p>
<p>要解决这个问题，可以考虑以下几个选项：</p>
<ol>
<li><p><em><strong>调整 Elasticsearch 集群设置，增加最大分片数限制</strong></em></p>
<p> 可以通过更改 Elasticsearch 配置来增加最大分片数的限制。但请注意，这可能会导致性能问题，尤其是如果硬件资源有限的话。</p>
<p>   这可以通过修改 <code>cluster.max_shards_per_node</code> 设置来实现</p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PUT /_cluster/settings</span><br><span class="line">&#123;</span><br><span class="line">  &quot;persistent&quot;: &#123;</span><br><span class="line">    &quot;cluster.max_shards_per_node&quot;: &quot;新的分片数限制&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>获取  Elasticsearch 集群的最大分片数限制</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X GET &quot;http://[your_elasticsearch_host]:9200/_cluster/settings?include_defaults=true&amp;pretty&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p><em><strong>删除一些不必要的索引</strong></em> :如果有些索引不再需要，可以删除它们来减少分片数。</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X DELETE &quot;localhost:9200/my_index&quot;</span><br><span class="line">curl -X DELETE &quot;localhost:9200/logstash-2021.11.*&quot;</span><br></pre></td></tr></table></figure></li>
<li><p><em><strong>合并一些小索引</strong></em>：如果有很多小的索引，可以考虑将它们合并为更大的索引，以减少总分片数。</p>
</li>
<li><p><em><strong>优化现有索引的分片策略</strong></em>：可以优化索引的分片数量，例如，通过减少每个索引的主分片数量。</p>
</li>
</ol>
<h1 id="filebeat-错误"><a href="#filebeat-错误" class="headerlink" title="filebeat 错误"></a>filebeat 错误</h1><h2 id="filebeat-配置上传数据到-elasticsearch-报错"><a href="#filebeat-配置上传数据到-elasticsearch-报错" class="headerlink" title="filebeat 配置上传数据到 elasticsearch 报错"></a>filebeat 配置上传数据到 elasticsearch 报错</h2><blockquote>
<p>适用版本信息说明</p>
<ul>
<li>filebeat 7</li>
<li>elasticsearch 7</li>
</ul>
</blockquote>
<p>使用以下 filebeat 配置文件</p>
<figure class="highlight shell"><figcaption><span>/etc/filebeat/filebeat.yml</span></figcaption><table><tr><td class="code"><pre><span class="line">filebeat.inputs:</span><br><span class="line">- type: log</span><br><span class="line">  paths:</span><br><span class="line">    - /home/logs/laravel-2023*</span><br><span class="line">  tags: [&quot;admin-log&quot;]</span><br><span class="line">  close_timeout: 3h</span><br><span class="line">  clean_inactive: 72h</span><br><span class="line">  ignore_older: 70h</span><br><span class="line">  close_inactive: 5m</span><br><span class="line"></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [&quot;1.56.219.122:9200&quot;, &quot;1.57.115.214:9200&quot;, &quot;1.52.53.31:9200&quot;]</span><br><span class="line">  username: &quot;elastic&quot;</span><br><span class="line">  password: &quot;passwd&quot;</span><br><span class="line">  index: &quot;logstash-admin-%&#123;+yyyy.MM.dd&#125;&quot;</span><br><span class="line">setup.template.enabled: true</span><br><span class="line">setup.template.name: &quot;logstash-admin&quot;</span><br><span class="line">setup.template.pattern: &quot;logstash-admin-*&quot;</span><br></pre></td></tr></table></figure>
<p>filebeat 启动后报错，elasticsearch 上未创建相应的索引，关键错误信息 <code>Failed to connect to backoff(elasticsearch(http://1.57.115.214:9200)): Connection marked as failed because the onConnect callback failed: resource &#39;filebeat-7.5.2&#39; exists, but it is not an alias</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">journalctl -f -u filebeat</span><br><span class="line">INFO        [index-management]        idxmgmt/std.go:269        ILM policy successfully loaded.</span><br><span class="line">ERROR        pipeline/output.go:100        Failed to connect to backoff(elasticsearch(http://1.57.115.214:9200)): Connection marked as failed because the onConnect callback failed: resource &#x27;filebeat-7.5.2&#x27; exists, but it is not an alias</span><br><span class="line">INFO        pipeline/output.go:93        Attempting to reconnect to backoff(elasticsearch(http://1.57.115.214:9200)) with 3 reconnect attempt(s)</span><br><span class="line">INFO        elasticsearch/client.go:753        Attempting to connect to Elasticsearch version 7.6.2</span><br><span class="line">INFO        [index-management]        idxmgmt/std.go:256        Auto ILM enable success.</span><br><span class="line">INFO        [index-management.ilm]        ilm/std.go:138        do not generate ilm policy: exists=true, overwrite=false</span><br><span class="line">INFO        [index-management]        idxmgmt/std.go:269        ILM policy successfully loaded.</span><br><span class="line">ERROR        pipeline/output.go:100        Failed to connect to backoff(elasticsearch(http://1.56.219.122:9200)): Connection marked as failed because the onConnect callback failed: resource &#x27;filebeat-7.5.2&#x27; exists, but it is not an alias</span><br><span class="line">INFO        pipeline/output.go:93        Attempting to reconnect to backoff(elasticsearch(http://1.56.219.122:9200)) with 3 reconnect attempt(s)</span><br></pre></td></tr></table></figure>

<p>这表明 Filebeat 无法正常连接到 Elasticsearch 集群。出现这个问题的主要原因可能为： </p>
<ul>
<li><p><em><strong>索引&#x2F;别名冲突</strong></em>: Filebeat 试图创建或使用一个名为 <code>filebeat-7.5.2</code> 的索引或别名，但这个资源在 Elasticsearch 中已存在且不是一个别名。解决方法为 <em><strong>删除或重命名冲突索引</strong></em></p>
</li>
<li><p><em><strong>ILM 配置问题</strong></em> </p>
<p>使用此配置文件，解决 <em><strong>索引&#x2F;别名冲突</strong></em> 问题后，filebeat 运行正常，但是 Elasticsearch 上未创建配置中的索引 <code>logstash-admin-*</code>，而是将数据上传到了索引 <code>filebeat-7.5.2-*</code>。这个问题是由 <code>ILM</code> 导致，可以禁用 <code>ILM</code>。参考以下配置，禁用 <code>ILM</code> (<code>setup.ilm.enabled: false</code>)</p>
 <figure class="highlight shell"><figcaption><span>/etc/filebeat/filebeat.yml</span></figcaption><table><tr><td class="code"><pre><span class="line">filebeat.inputs:</span><br><span class="line">- type: log</span><br><span class="line">  paths:</span><br><span class="line">    - /home/logs/laravel-2023*</span><br><span class="line">  tags: [&quot;admin-log&quot;]</span><br><span class="line">  close_timeout: 3h</span><br><span class="line">  clean_inactive: 72h</span><br><span class="line">  ignore_older: 70h</span><br><span class="line">  close_inactive: 5m</span><br><span class="line"></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [&quot;1.56.219.122:9200&quot;, &quot;1.57.115.214:9200&quot;, &quot;1.52.53.31:9200&quot;]</span><br><span class="line">  username: &quot;elastic&quot;</span><br><span class="line">  password: &quot;passwd&quot;</span><br><span class="line">  index: &quot;logstash-admin-%&#123;+yyyy.MM.dd&#125;&quot;</span><br><span class="line">setup.ilm.enabled: false</span><br><span class="line">setup.template.enabled: true</span><br><span class="line">setup.template.name: &quot;logstash-admin&quot;</span><br><span class="line">setup.template.pattern: &quot;logstash-admin-*&quot;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202302201557/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202302201557/" class="post-title-link" itemprop="url">curl 命令常见用法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-02-20 15:57:27" itemprop="dateCreated datePublished" datetime="2023-02-20T15:57:27+08:00">2023-02-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-15 15:59:31" itemprop="dateModified" datetime="2023-11-15T15:59:31+08:00">2023-11-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos 7 3.10.0-1062</li>
</ul>
<h1 id="curl-命令示例"><a href="#curl-命令示例" class="headerlink" title="curl 命令示例"></a>curl 命令示例</h1><p>常见选项 </p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-v</code></td>
<td>输出详细信息</td>
<td></td>
</tr>
<tr>
<td><code>-0</code></td>
<td>内容输出到指定文件或设备</td>
<td><code>curl -o /dev/null</code></td>
</tr>
<tr>
<td><code>-s</code></td>
<td>不输出任何信息（http 响应内容除外）</td>
<td></td>
</tr>
<tr>
<td><code>-w</code></td>
<td>自定义输出内容</td>
<td><code>curl -s -o /dev/null -w %&#123;http_code&#125; https://csms.tech</code></td>
</tr>
<tr>
<td><code>-I</code></td>
<td>只获取响应头部信息</td>
<td><code>curl -I https://csms.tech</code></td>
</tr>
<tr>
<td><code>--resolve yourdomain.com:443:source_ip</code></td>
<td>将 <code>domain:port</code> 解析为指定的 IP</td>
<td><a href="#SSL_ERROR_BAD_CERT_DOMAIN">使用方法参考</a><br/><code>curl -v -H &quot;Host: admin.test.com&quot; --resolve admin.test.com:443:52.52.2.9 https://admin.test.com</code></td>
</tr>
<tr>
<td><code>-H, --header</code></td>
<td>自定义 http 请求头部</td>
<td><code>-H &quot;Host: admin.test.com&quot;</code></td>
</tr>
</tbody></table>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202302201557/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202208050928/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202208050928/" class="post-title-link" itemprop="url">Dockerfile 简介</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-05 09:29:02" itemprop="dateCreated datePublished" datetime="2022-08-05T09:29:02+08:00">2022-08-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-01 15:33:59" itemprop="dateModified" datetime="2023-11-01T15:33:59+08:00">2023-11-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Dockerfile 是一个文本文件，其内包含了一条条的 <code>指令(Instruction)</code>，每一条指令构建一层，因此每一条指令的内容，就是描述该层应当如何构建。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202208050928/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202210241127/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202210241127/" class="post-title-link" itemprop="url">tcp/udp 端口连通性测试</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-24 10:51:32" itemprop="dateCreated datePublished" datetime="2021-10-24T10:51:32+08:00">2021-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-27 16:28:09" itemprop="dateModified" datetime="2023-10-27T16:28:09+08:00">2023-10-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="Centos-下安装"><a href="#Centos-下安装" class="headerlink" title="Centos 下安装"></a>Centos 下安装</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y nc</span><br></pre></td></tr></table></figure>

<h3 id="Windows-下安装"><a href="#Windows-下安装" class="headerlink" title="Windows 下安装"></a>Windows 下安装</h3><p>Windows 下需要 <a target="_blank" rel="noopener" href="https://eternallybored.org/misc/netcat/">下载 netcat 运行程序</a></p>
<p>下载后直接解压，将 <code>nc.exe</code> 复制到 <code>C:\Windows\System32</code> 目录或将 <code>nc.exe</code> 添加到系统 path 环境变量中</p>
<h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-v</code> <br/><code>-vvv</code></td>
<td>打印详细信息</td>
<td></td>
</tr>
<tr>
<td><code>-t</code></td>
<td>使用 TCP 协议，默认为 TCP 协议</td>
<td></td>
</tr>
<tr>
<td><code>-u</code></td>
<td>使用 UDP 协议，默认为 TCP 协议</td>
<td></td>
</tr>
<tr>
<td><code>-z</code></td>
<td>不发送数据，效果为立即关闭连接，快速得出测试结果</td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p><em><strong>注意事项</strong></em>：客户端测试使用 <code>localhost</code> 作为主机名时，会优先被解析为 IPv6 地址，如果端口监听在 IPv4 地址，会导致测试结果不可达</p>
</blockquote>
<h3 id="测试-udp-端口连通性"><a href="#测试-udp-端口连通性" class="headerlink" title="测试 udp 端口连通性"></a>测试 udp 端口连通性</h3><p>以下输出表示端口<strong>可达</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nc -vuz ip/domain 8472</span></span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Connected to ip:8472.</span><br><span class="line">Ncat: UDP packet sent successfully</span><br><span class="line">Ncat: 1 bytes sent, 0 bytes received in 2.01 seconds.</span><br></pre></td></tr></table></figure>
<p>以下输出表示端口<strong>不可达</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nc -vuz 127.0.0.1 8473</span></span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Connected to 127.0.0.1:8473.</span><br><span class="line">Ncat: Connection refused.</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="../4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../4/">4</a><span class="page-number current">5</span><a class="page-number" href="../6/">6</a><span class="space">&hellip;</span><a class="page-number" href="../13/">13</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="../6/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">COSMOS</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.3" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="../../js/comments.js"></script><script src="../../js/utils.js"></script><script src="../../js/motion.js"></script><script src="../../js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="../../js/third-party/search/local-search.js"></script>




  <script src="../../js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"fl9999","repo":"fl9999.github.io","client_id":"a11bf6f7860762b725b5","client_secret":"a99046105f8bddc72ec718d54dc3fd7f22070821","admin_user":"fl9999","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d41d8cd98f00b204e9800998ecf8427e"}</script>
<script src="../../js/third-party/comments/gitalk.js"></script>

</body>
</html>
