<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png">
  <link rel="mask-icon" href="../../images/logo.svg" color="#222">

<link rel="stylesheet" href="../../css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"csms.tech","root":"/","images":"../../images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"../../search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="../../js/config.js"></script>

    <meta name="description" content="得 能 莫 忘">
<meta property="og:type" content="website">
<meta property="og:title" content="L B T">
<meta property="og:url" content="http://csms.tech/page/2/index.html">
<meta property="og:site_name" content="L B T">
<meta property="og:description" content="得 能 莫 忘">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="COSMOS">
<meta property="article:tag" content="博客, 记录，技术">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://csms.tech/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>L B T</title>
  








  <noscript>
    <link rel="stylesheet" href="../../css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">L B T</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记 录 过 去 的 经 验</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="../../index.html" rel="section"><i class="fa fa-earth-americas fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="../../categories/" rel="section"><i class="fa fa-folder-tree fa-fw"></i>总目录<span class="badge">50</span></a></li><li class="menu-item menu-item-linux"><a href="../../categories/Linux" rel="section"><i class="fa fa-brands fa-linux fa-fw"></i>Linux</a></li><li class="menu-item menu-item-python"><a href="../../categories/Python" rel="section"><i class="fa fa-brands fa-python fa-fw"></i>Python</a></li><li class="menu-item menu-item-docker"><a href="../../categories/Docker" rel="section"><i class="fa fa-brands fa-docker fa-fw"></i>Docker</a></li><li class="menu-item menu-item-kubernetes"><a href="../../categories/Kubernetes" rel="section"><i class="fa fa-dharmachakra fa-fw"></i>Kubernetes</a></li><li class="menu-item menu-item-tags"><a href="../../tags/" rel="section"><i class="fa fa-tornado fa-fw"></i>标签<span class="badge">78</span></a></li><li class="menu-item menu-item-archives"><a href="../../archives/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>列表<span class="badge">241</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章总目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">COSMOS</p>
  <div class="site-description" itemprop="description">得 能 莫 忘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="../../archives/">
          <span class="site-state-item-count">241</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="../../categories/">
        <span class="site-state-item-count">50</span>
        <span class="site-state-item-name">目录</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="../../tags/">
        <span class="site-state-item-count">78</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/d5da7d5e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../d5da7d5e/" class="post-title-link" itemprop="url">Django 常见错误</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-12 13:55:03" itemprop="dateCreated datePublished" datetime="2022-07-12T13:55:03+08:00">2022-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-02 16:10:00" itemprop="dateModified" datetime="2024-10-02T16:10:00+08:00">2024-10-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Python/Django/" itemprop="url" rel="index"><span itemprop="name">Django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>centos7</li>
<li>python3</li>
<li>Django 4</li>
</ul>
<h2 id="ModuleNotFoundError-No-module-named-‘MySQLdb’"><a href="#ModuleNotFoundError-No-module-named-‘MySQLdb’" class="headerlink" title="ModuleNotFoundError: No module named ‘MySQLdb’"></a>ModuleNotFoundError: No module named ‘MySQLdb’</h2><blockquote>
<p>ModuleNotFoundError: No module named ‘MySQLdb’<br>…<br>django.core.exceptions.ImproperlyConfigured: Error loading MySQLdb module.</p>
</blockquote>
<p><strong>解决方法</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip3 install pymysql</span><br></pre></td></tr></table></figure>

<p>编辑文件<code>./python36/lib/python3.6/site-packages/django/db/backends/mysql/__init__.py</code>, 输入以下内容</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql </span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../d5da7d5e/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/7d1a39d2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../7d1a39d2/" class="post-title-link" itemprop="url">Django+uwsgi+nginx 配置示例</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-19 10:55:03" itemprop="dateCreated datePublished" datetime="2022-07-19T10:55:03+08:00">2022-07-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-02 15:10:00" itemprop="dateModified" datetime="2024-10-02T15:10:00+08:00">2024-10-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Python/Django/" itemprop="url" rel="index"><span itemprop="name">Django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>centos 7</li>
<li>Python 3.10</li>
<li>Django 4.0</li>
<li>uwsgi 2.0.20</li>
<li>nginx 1.20.1</li>
<li>venv<blockquote>
<p>示例中虚拟环境位于 <code>/opt/vb/</code>, Django工程目录位于 <code>/opt/vb/vb/</code> , 工程名称为vb</p>
</blockquote>
</li>
</ul>
<h1 id="uwsgi-配置文件-uwsgi-ini-配置示例"><a href="#uwsgi-配置文件-uwsgi-ini-配置示例" class="headerlink" title="uwsgi 配置文件 (uwsgi.ini) 配置示例"></a>uwsgi 配置文件 (uwsgi.ini) 配置示例</h1><figure class="highlight shell"><figcaption><span>uwsgi.ini</span></figcaption><table><tr><td class="code"><pre><span class="line">[uwsgi]</span><br><span class="line">socket = 127.0.0.1:8081</span><br><span class="line">chdir = /opt/vb/vb</span><br><span class="line">wsgi-file = ./vb/wsgi.py</span><br><span class="line">master = true         //主进程</span><br><span class="line">vhost = true          //多站模式</span><br><span class="line">no-site = true        //多站模式时不设置入口模块和文件</span><br><span class="line">workers = 2           //子进程数</span><br><span class="line">reload-mercy = 10     </span><br><span class="line">vacuum = true         //退出、重启时清理文件</span><br><span class="line">max-requests = 1000   </span><br><span class="line">limit-as = 512</span><br><span class="line">buffer-size = 30000</span><br><span class="line">pidfile = uwsgi-8081.pid</span><br><span class="line">daemonize = uwsgi-8081.log</span><br><span class="line">pythonpath = /opt/vb/env/lib/python3.10/site-packages/</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../7d1a39d2/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202207261420/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202207261420/" class="post-title-link" itemprop="url">Nginx 服务常用配置说明</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-26 14:21:02" itemprop="dateCreated datePublished" datetime="2022-07-26T14:21:02+08:00">2022-07-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-30 14:09:00" itemprop="dateModified" datetime="2024-09-30T14:09:00+08:00">2024-09-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">常用服务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Nginx-服务配置"><a href="#Nginx-服务配置" class="headerlink" title="Nginx 服务配置"></a>Nginx 服务配置</h1><h2 id="全局通用配置"><a href="#全局通用配置" class="headerlink" title="全局通用配置"></a>全局通用配置</h2><figure class="highlight shell"><figcaption><span>nginx.conf</span></figcaption><table><tr><td class="code"><pre><span class="line">user nginx nginx;    </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">建议设置为 cpu 核心数或者 cpu 核心数的 2 倍，进程会包含一个 `master process`，多个 `worker process`</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">master process 负责绑定端口、调度进程等，不负责业务的处理</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">worker process 是业务进程，负责业务的处理</span></span><br><span class="line">worker_processes auto;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一个 worker 进程可以打开的最大的 fd 个数，受 Linux 内核限制</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">理论值应该是系统最多打开文件数（<span class="built_in">ulimit</span> -n）与 nginx 进程数相除</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可通过 <span class="built_in">ulimit</span> 设置或修改系统文件：`/etc/securit/limits.conf`</span></span><br><span class="line">worker_rlimit_nofile 1024；</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">cpu 亲和性设置</span> </span><br><span class="line">worker_cpu_affinity    0001 0010 0100 1000;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">工作进程调度优先级，-20 到 19 之间的值，值越小越优先调用。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果系统同时运行多个任务，你可能需要提高 nginx 的工作进程的优先级</span> </span><br><span class="line">worker_priority 0；              </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ssl 硬件加速服务器，需要硬件支持</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ssl_engine ssl_engine device;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nginx 是否以守护进程运行，是否让 nignx 运行于后台；调试时可为 off，使得所有信息直接输出在控制台</span></span><br><span class="line">daemon      on | off;         </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">events 模块中包含 nginx 中所有处理连接的设置。</span></span><br><span class="line">events &#123;</span><br><span class="line">    # 每个 worker 进程允许的最多连接数, </span><br><span class="line">    # nginx 服务最大连接数：worker_processes * worker_connections (受 worker_rlimit_nofile 限制)</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">    use epoll;</span><br><span class="line">    </span><br><span class="line">    # 是否允许一次性地响应多个用户请求</span><br><span class="line">    multi_accept on;                    </span><br><span class="line"></span><br><span class="line">    # 是否打开 nginx 的 accept 锁；此锁能够让多个 worker 进行轮流地、序列化地与新的客户端建立连接；</span><br><span class="line">    # 而通常当一个 worker 进程的负载达到其上限的 7/8，master 就尽可能不将请求调度至 worker.</span><br><span class="line">	accept_mutex on | off;              </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HTTP 模块控制着 nginx http 处理的所有核心特性</span></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # 是否在错误页面中显示和响应头字段中发出 nginx 版本号。</span><br><span class="line">    # 安全考虑建议关闭</span><br><span class="line">    server_tokens on | off | string; </span><br><span class="line">    </span><br><span class="line">    # 是否启用 sendfile 内核复制模式功能。作为静态服务器可以提供最大的 IO 访问速度。</span><br><span class="line">    sendfile on | off; </span><br><span class="line">    </span><br><span class="line">    # 尽快发送数据，否则会在数据包达到一定大小后再发送数据。这样会减少网络通信次数，降低阻塞概率，但也会影响响应及时性。</span><br><span class="line">    # 比较适合于文件下载这类的大数据通信场景。</span><br><span class="line">    tcp_nodelay on|off; </span><br><span class="line">    </span><br><span class="line">    # 单位s，适当降低此值可以提高响应连接数量</span><br><span class="line">    keepalive_timeout  65; </span><br><span class="line">    </span><br><span class="line">    # 一次长连接上允许的最大请求数</span><br><span class="line">    keepalive_requests 100；       </span><br><span class="line">    </span><br><span class="line">    # 禁止指定浏览器使用 keepalive</span><br><span class="line">    keepalive_disable msie6|none；    </span><br><span class="line">    </span><br><span class="line">    # 读取 http 请求首部的超时时长。如果客户端在此时间内未传输整个头，则会向客户端返回 408（请求超时）错误</span><br><span class="line">    client_header_timeout 1;     </span><br><span class="line">    </span><br><span class="line">    # 读取 http 请求包体的超时时间。</span><br><span class="line">    client_body_timeout 2;</span><br><span class="line">    </span><br><span class="line">    # 发送响应的超时时长。超时后连接将关闭。</span><br><span class="line">    send_timeout 5;  </span><br><span class="line">    </span><br><span class="line">    # http 请求包体的最大值，常用于限定客户端所能够请求的最大包体，根据请求首部中的 Content-Length 来检查，以避免无用的传输。</span><br><span class="line">    client_max_body_size 1m;</span><br><span class="line">    </span><br><span class="line">    # 限制客户端每秒传输的字节数，默认为0，表示没有限制。单位 Byte/s</span><br><span class="line">    limit_rate 0;</span><br><span class="line">    </span><br><span class="line">    # nginx 向客户端发送响应报文时，如果大小超过了此处指定的值，则后续的发送过程开始限速，单位 Byte</span><br><span class="line">    limit_rate_after 0;</span><br><span class="line">    </span><br><span class="line">    # 是否忽略不合法的 http 首部，默认为 on，off 意味着请求首部中出现不合规的首部将拒绝响应。</span><br><span class="line">    ignore_invalid_headers on|off;</span><br><span class="line">    </span><br><span class="line">    # 用户访问的文件不存在时，是否将其记录到错误日志中。</span><br><span class="line">    log_not_found on|off;   </span><br><span class="line">    </span><br><span class="line">    # nginx 使用的 dns 地址，及缓存解析结果的时间               </span><br><span class="line">    resolver 8.8.8.8 [valid=time] [ipv6=on|off];</span><br><span class="line">    </span><br><span class="line">    # dns 解析超时时间 </span><br><span class="line">    resolver_timeout 2；     </span><br><span class="line">    </span><br><span class="line">    # 是否打开文件缓存功能，max：用于缓存条目的最大值，</span><br><span class="line">    # inactive：某缓存条目在指定时长内没有被访问过时，将自动被删除，即缓存有效期，通常默认为 60s。</span><br><span class="line">    open_file_cache off;  </span><br><span class="line">    open_file_cache max=N [inactive=time];    </span><br><span class="line">    </span><br><span class="line">    # 是否缓存文件找不到或没有权限访问等相关信息。</span><br><span class="line">    open_file_cache_errors on | off; </span><br><span class="line">    </span><br><span class="line">    # 多长时间检查一次缓存中的条目是否超出非活动时长。</span><br><span class="line">    # 建议值：小于等于 open_file_cache inactive</span><br><span class="line">    open_file_cache_valid 60;   </span><br><span class="line">    </span><br><span class="line">    # 在 open_file_cache inactive指 定的时长内被访问超过此处指定的次数时，才不会被删除（删除低命中率的缓存）。</span><br><span class="line">    open_file_cache_min_uses 2;     </span><br><span class="line">    </span><br><span class="line">    # 开启内容压缩，可以有效降低客户端的访问流量和网络带宽</span><br><span class="line">    gzip on | off;</span><br><span class="line">    </span><br><span class="line">    # 内容超过最少长度后才开启压缩，太短的内容压缩效果不佳，且会浪费系统资源。</span><br><span class="line">    # 压缩长度会作为 http 响应头 Content-Length 字段返回给客户端。 建议值：64</span><br><span class="line">    gzip_min_length length;</span><br><span class="line">    </span><br><span class="line">    # 压缩级别，默认值为 1。范围为1～9级，压缩级别越高压缩率越高，但对系统性能要求越高。建议值：4</span><br><span class="line">    gzip_comp_level 1~9;</span><br><span class="line">    </span><br><span class="line">    # 压缩内容类型，默认为 text/html;。只压缩 html 文本，一般我们都会压缩 js、css、json 之类的，可以把这些常见的文本数据都配上。</span><br><span class="line">    如：text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;</span><br><span class="line">    gzip_types mime-type …;     </span><br><span class="line">    </span><br><span class="line">    # 自动显示目录</span><br><span class="line">    autoindex on;</span><br><span class="line">    </span><br><span class="line">    # off ： 以人类易读的方式显示文件大小，on：以 bytes 显示文件大小</span><br><span class="line">    autoindex_exact_size off;</span><br><span class="line">    </span><br><span class="line">    # 定义限制区域，imit_req_zone 只能放在 http &#123;&#125; 内，使用此限制可以在 http &#123;&#125; （对服务器内所有的网站生效）、server &#123;&#125; （对具体的一个网站生效）或 location &#123;&#125; （对具体的一个网址生效）</span><br><span class="line">    # 此区域名称为 test，可根据需求自定义； 10m 表示此区域存储 key（$binary_remote_addr）使用的大小</span><br><span class="line">    # 存储大小，一般 1m 空间大约能保存 1.6 万条 IP 地址，空间满了新数据会覆盖旧数据</span><br><span class="line">    # rate=1r/m ，限制访问请求频率为每分钟 1 次，可根据需要自行设置，1r/s 是 1 秒 1 次，时间单位只能选择 s (秒)或 m (分)，最低频率限制是每分钟 1 次访问请求</span><br><span class="line">    # rate=10r/m，1分钟最多访问 10 次，同时不能超过 1r/6s，即 6s 内最多访问 1 次。超过 1r/6s 返回 503</span><br><span class="line">    limit_req_zone $binary_remote_addr zone=test:10m rate=1r/m;</span><br><span class="line">    </span><br><span class="line">    # 定义日志格式</span><br><span class="line">    log_format main &#x27;&#123; time: $time_iso8601|&#x27;</span><br><span class="line">                    &#x27;http_host:$http_host|&#x27;</span><br><span class="line">                    &#x27;cdn_ip:$remote_addr|&#x27;</span><br><span class="line">                    &#x27;request:$request|&#x27;</span><br><span class="line">                    &#x27;request_method:$request_method|&#x27;</span><br><span class="line">                    &#x27;http_user_agent:$http_user_agent|&#x27;</span><br><span class="line">                    &#x27;size:$body_bytes_sent|&#x27;</span><br><span class="line">                    &#x27;responsetime:$request_time|&#x27;</span><br><span class="line">                    &#x27;upstreamtime:$upstream_response_time|&#x27;</span><br><span class="line">                    &#x27;upstreamhost:$upstream_addr|&#x27;</span><br><span class="line">                    &#x27;upstreamstatus:$upstream_status|&#x27;</span><br><span class="line">                    &#x27;url:$http_host$uri|&#x27;</span><br><span class="line">                    &#x27;http_x_forwarded_for:$clientRealIp|&#x27;</span><br><span class="line">                    &#x27;status:$status&#125;&#x27;;</span><br><span class="line">    </span><br><span class="line">    # server 负责具体的 http 服务器实现</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80 [default_server]  [rcvbuf=SIZE]  [sndbuf=SIZE] [ssl];</span><br><span class="line">        </span><br><span class="line">        # 可使用通配符*或正则表达式(~开头)，多个域名先精确匹配，再通配，再正则,&#x27;_&#x27;表示空主机头</span><br><span class="line">        server_name  _  ;</span><br><span class="line">        </span><br><span class="line">        access_log logs/access.log main;</span><br><span class="line">        error_log logs/access.err.log;</span><br><span class="line">        </span><br><span class="line">        # 跨域配置</span><br><span class="line">        add_header Access-Control-Allow-Origin *;</span><br><span class="line">        add_header Access-Control-Allow-Headers &#x27;Origin, No-Cache, X-Requested-With, If-Modified-Since, Pragma, Last-Modified, Cache-Control, Expires, Content-Type, X-E4M-With&#x27;;</span><br><span class="line">        add_header Access-Control-Allow-Methods GET,POST,OPTIONS;</span><br><span class="line">        add_header Access-Control-Allow-Credentials: true;</span><br><span class="line">        </span><br><span class="line">        location / &#123;       </span><br><span class="line">            # web 资源路径             </span><br><span class="line">            root   html;          </span><br><span class="line">            </span><br><span class="line">            # 定义默认页面，从左往右匹配           </span><br><span class="line">            index  index.html index.htm;   </span><br><span class="line">            </span><br><span class="line">            # 自左向右读取指定路径，找到即停止，如果都不存在，返回一个错误码</span><br><span class="line">            try_files $uri $uri.html $uri/index.html =404;        </span><br><span class="line">            </span><br><span class="line">            # 自左向右读取指定路径，找到即停止，如果都不存在，返回一个 uri</span><br><span class="line">            try_files $uri $uri.html $uri/index.html /404.html; </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        location /i/ &#123; </span><br><span class="line">            # 路径别名，只能用于 location 中。</span><br><span class="line">            # 访问 http://a.com/i/a.html, 资源路径为：/data/www/html/a.html</span><br><span class="line">            # 若是root指令，访问 http://a.com/i/a.html，资源路径为：/data/www/html/i/a.html</span><br><span class="line">		    alias /data/www/html/;          </span><br><span class="line">	    &#125;</span><br><span class="line">	    </span><br><span class="line">	    # 对于某个请求发生错误，如果匹配到错误码，重定向到新的 url</span><br><span class="line">	    error_page  404              /404.html; </span><br><span class="line">	    error_page   500 502 503 504  /50x.html;</span><br><span class="line">	    </span><br><span class="line">	    # 对于某个请求发生错误，如果匹配到错误码，重定向到新的 url,同时可以更改返回码</span><br><span class="line">	    error_page 404 =200 /404.html;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    # 包含其他配置文件</span><br><span class="line">    include vhosts/*.conf;        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202207261420/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20240904170014/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20240904170014/" class="post-title-link" itemprop="url">Linux nftables 防火墙</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-04 17:09:00" itemprop="dateCreated datePublished" datetime="2024-09-04T17:09:00+08:00">2024-09-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-27 09:09:00" itemprop="dateModified" datetime="2024-09-27T09:09:00+08:00">2024-09-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">常用服务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>nftables</code> 是一个 <code>netfilter</code> 项目，旨在替换现有的 <code>&#123;ip,ip6,arp,eb&#125;tables</code> 框架，为 <code>&#123;ip,ip6&#125;tables</code> 提供一个新的包过滤框架、一个新的用户空间实用程序（<code>nft</code>）和一个兼容层(<code>iptables-nft</code>)。它使用现有的钩子、链接跟踪系统、用户空间排队组件和 <code>netfilter</code> 日志子系统。</p>
<blockquote>
<p><em>在 Linux 内核版本高于 3.13 时可用</em></p>
</blockquote>
<p>它由三个主要组件组成：</p>
<ul>
<li>内核实现: 内核提供了一个 <code>netlink</code> 配置接口以及运行时规则集评估</li>
<li><code>libnl netlink</code> : <code>libnl</code> 包含了与内核通信的基本函数</li>
<li><code>nftables</code> : 用户空间前端。<code>nftables</code> 的用户空间实用程序 <code>nft</code> 评估大多数规则集并传递到内核。规则存储在链中，链存储在表中。</li>
</ul>
<p><strong>与 <code>iptables</code> 不同点</strong></p>
<ul>
<li><code>nftables</code> 在用户空间中运行，<code>iptables</code> 中的每个模块都运行在内核（空间）中</li>
<li><strong>表和链是完全可配置的</strong>。在 <code>nftables</code> 中，表是没有特定语义的链的容器。<code>iptables</code> 附带了具有预定义数量的基链的表，即使您只需要其中之一，所有链都已注册，未使用的基础链也会损害性能。</li>
<li><strong>可以在一个规则中指定多个操作</strong>。在 <code>iptables</code> 中，您只能指定一个目标。这是一个长期存在的局限性，用户可以通过跳到自定义链来解决，但代价是使规则集结构稍微复杂一些。</li>
<li><strong>每个链和规则没有内置计数器</strong>。在 <code>nftables</code> 中，这些是可选的，因此您可以按需启用计数器。由于 <code>iptables</code> 内置了一个数据包计数器，所以即使这些内置的链是空的，也会带来性能损耗</li>
<li><strong>更好地支持动态规则集更新</strong>。在 <code>nftables</code> 中，如果添加新规则，则剩余的现有规则将保持不变，因为规则集以链表形式表示，这与整体式 blob 表示相反，后者在执行规则集更新时内部状态信息的维护很复杂。</li>
<li><strong>简化的双堆栈 IPv4&#x2F;IPv6 管理</strong>，通过新的 <code>inet</code> 系列，可让您注册同时查看 IPv4 和 IPv6 流量的基链。 因此，您不再需要依赖脚本来复制规则集。</li>
</ul>
<p><strong>服务名称默认为 <code>nftables</code>，默认配置文件为 <code>/etc/nftables.conf</code></strong> ，其中已经包含一个名为 <code>inet filter</code> 的简单 <code>ipv4/ipv6</code> 防火墙列表。</p>
<figure class="highlight shell"><figcaption><span>/etc/nftables.conf</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/sbin/nft -f</span></span><br><span class="line"></span><br><span class="line">flush ruleset</span><br><span class="line"></span><br><span class="line">table inet filter &#123;</span><br><span class="line">	chain input &#123;</span><br><span class="line">		type filter hook input priority 0;</span><br><span class="line">	&#125;</span><br><span class="line">	chain forward &#123;</span><br><span class="line">		type filter hook forward priority 0;</span><br><span class="line">	&#125;</span><br><span class="line">	chain output &#123;</span><br><span class="line">		type filter hook output priority 0;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>nftables</code> 服务的 <code>systemd</code> 配置文件如下：</p>
<figure class="highlight shell"><figcaption><span>/lib/systemd/system/nftables.service</span></figcaption><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nftables</span><br><span class="line">Documentation=man:nft(8) http://wiki.nftables.org</span><br><span class="line">Wants=network-pre.target</span><br><span class="line">Before=network-pre.target shutdown.target</span><br><span class="line">Conflicts=shutdown.target</span><br><span class="line">DefaultDependencies=no</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=oneshot</span><br><span class="line">RemainAfterExit=yes</span><br><span class="line">StandardInput=null</span><br><span class="line">ProtectSystem=full</span><br><span class="line">ProtectHome=true</span><br><span class="line">ExecStart=/usr/sbin/nft -f /etc/nftables.conf</span><br><span class="line">ExecReload=/usr/sbin/nft -f /etc/nftables.conf</span><br><span class="line">ExecStop=/usr/sbin/nft flush ruleset</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=sysinit.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>nftables</code> 使用的内核模块如下，加载这些模块，服务才能正常运行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">lsmod | grep nf</span></span><br><span class="line">nf_log_syslog          20480  1</span><br><span class="line">nft_chain_nat          16384  17</span><br><span class="line">nf_nat                 49152  3 xt_nat,nft_chain_nat,xt_MASQUERADE</span><br><span class="line">nf_conntrack_netlink    49152  0</span><br><span class="line">nft_counter            16384  142</span><br><span class="line">nf_reject_ipv4         16384  1 ipt_REJECT</span><br><span class="line">nf_conntrack          172032  6 xt_conntrack,nf_nat,xt_state,xt_nat,nf_conntrack_netlink,xt_MASQUERADE</span><br><span class="line">nf_defrag_ipv6         24576  1 nf_conntrack</span><br><span class="line">nf_defrag_ipv4         16384  1 nf_conntrack</span><br><span class="line">nft_compat             20480  143</span><br><span class="line">nf_tables             249856  570 nft_compat,nft_counter,nft_chain_nat</span><br><span class="line">nfnetlink              20480  5 nft_compat,nf_conntrack_netlink,nf_tables,ip_set</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../20240904170014/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20240926135814/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20240926135814/" class="post-title-link" itemprop="url">Outline VPN 使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-26 13:09:00" itemprop="dateCreated datePublished" datetime="2024-09-26T13:09:00+08:00">2024-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/VPN/" itemprop="url" rel="index"><span itemprop="name">VPN</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://getoutline.org/">Outline 官网</a></p>
<p>Outline 是由附属于 Google 的 Jigsaw 开发的开源的 VPN 软件。它的设计目标是为了实现 VPN 的简单部署和管理以及安全。Outline 提供了强加密、用户管理工具、并支持多平台，包括 Windows, macOS, Linux, iOS, 和 Android。</p>
<p>Outline 主要由 2 部分组成：</p>
<ul>
<li><code>Outline Manager</code> : 用来部署 VPN 服务器，以及管理用户、限速等</li>
<li><code>Outline Client</code> ： 连接 VPN 的客户端，支持多平台</li>
</ul>
<p><strong>本文示例基本环境信息</strong> ：</p>
<ul>
<li>Ubuntu 22.04.4 LTS (Jammy Jellyfish)</li>
<li>Outline Manager Version 1.15.2</li>
</ul>
<h1 id="Outline-环境-部署"><a href="#Outline-环境-部署" class="headerlink" title="Outline 环境 部署"></a>Outline 环境 部署</h1><h2 id="Outline-Manager-部署"><a href="#Outline-Manager-部署" class="headerlink" title="Outline Manager 部署"></a>Outline Manager 部署</h2><p>Outline Manager 部署非常的简单，只需要下载可执行文件，添加可执行权限并启动即可</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">wget https://s3.amazonaws.com/outline-releases/manager/linux/stable/Outline-Manager.AppImage</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">chmod</span> +x Outline-Manager.AppImage</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./Outline-Manager.AppImage</span> </span><br><span class="line">Outline Manager is starting</span><br><span class="line">libva error: vaGetDriverNameByIndex() failed with unknown libva error, driver_name = (null)</span><br><span class="line">[42740:0925/174650.529715:ERROR:viz_main_impl.cc(186)] Exiting GPU process due to errors during initialization</span><br><span class="line">Launching web app from outline://web_app/index.html?version=1.15.2&amp;sentryDsn=https%3A%2F%2F9df8c810bf1b482d979da996e3e63c40%40o74047.ingest.sentry.io%2F215496</span><br><span class="line">libva error: vaGetDriverNameByIndex() failed with unknown libva error, driver_name = (null)</span><br><span class="line">[42774:0925/174651.006194:ERROR:viz_main_impl.cc(186)] Exiting GPU process due to errors during initialization</span><br><span class="line">libva error: vaGetDriverNameByIndex() failed with unknown libva error, driver_name = (null)</span><br><span class="line">[42800:0925/174651.310808:ERROR:gpu_memory_buffer_support_x11.cc(44)] dri3 extension not supported.</span><br><span class="line">Checking for update</span><br><span class="line">Generated new staging user ID: c5db7469-3a5b-5365-a374-7e29a6e0c71a</span><br><span class="line">Update for version 1.15.2 is not available (latest version: 1.15.2, downgrade is disallowed).</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><p>为安全起见，Outline Manager 不支持以 <code>root</code> 用户执行，请以普通用户身份执行</p>
</li>
<li><p>Outline Manager 依赖于 <code>fuse</code>，执行命令 <code>sudo apt install fuse</code> 安装</p>
</li>
<li><p>Outline VPN Server 依赖于 Docker 和 <code>curl</code>，请提前安装</p>
</li>
</ul>
</blockquote>
<p>Outline Manager 运行后会启动 UI<br><img src="https://i.csms.tech/img_263.png"></p>
<h2 id="Outline-VPN-Server-部署"><a href="#Outline-VPN-Server-部署" class="headerlink" title="Outline VPN Server 部署"></a>Outline VPN Server 部署</h2><p>Outline 环境中，VPN Server 负责具体的 VPN 节点实现。要部署 VPN Server，选择合适的服务器环境，比如使用自己的本地服务器则选择 <code>Set up Outline anywhere</code>，然后根据提示在具体的 VPN Server 上部署程序即可<br><img src="https://i.csms.tech/img_264.png"></p>
<ol>
<li><p>根据提示，执行以下命令，部署 VPN Server 环境程序</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sudo bash -c <span class="string">&quot;<span class="subst">$(wget -qO- https://raw.githubusercontent.com/Jigsaw-Code/outline-server/master/src/server_manager/install_scripts/install_server.sh)</span>&quot;</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Verifying that Docker is installed .......... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Verifying that Docker daemon is running ..... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Setting PUBLIC_HOSTNAME to external IP ...... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Creating persistent state <span class="built_in">dir</span> ............... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Generating secret key ....................... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Generating TLS certificate .................. OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Generating SHA-256 certificate fingerprint .. OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Writing config .............................. OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Starting Shadowbox .......................... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Starting Watchtower ......................... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Removing watchtower container ............... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Restarting watchtower ....................... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Waiting <span class="keyword">for</span> Outline server to be healthy .... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Creating first user ......................... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Adding API URL to config .................... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Checking host firewall ...................... OK</span></span><br><span class="line"></span><br><span class="line">CONGRATULATIONS! Your Outline server is up and running.</span><br><span class="line"></span><br><span class="line">To manage your Outline server, please copy the following line (including curly</span><br><span class="line">brackets) into Step 2 of the Outline Manager interface:</span><br><span class="line"></span><br><span class="line">&#123;&quot;apiUrl&quot;:&quot;https://66.26.90.25:50472/Q6XjXdbbVbetfAV0TK2cyw&quot;,&quot;certSha256&quot;:&quot;67695819036A0FA4CE3C9E4AFAA0466D3C4BE4D9B04DBF7D8BA820FB379C0E4C&quot;&#125;</span><br><span class="line"></span><br><span class="line">If you have connection problems, it may be that your router or cloud provider</span><br><span class="line">blocks inbound connections, even though your machine seems to allow them.</span><br><span class="line"></span><br><span class="line">Make sure to open the following ports on your firewall, router or cloud provider:</span><br><span class="line">- Management port 50472, for TCP</span><br><span class="line">- Access key port 13279, for TCP and UDP</span><br></pre></td></tr></table></figure>
<p>根据提示 <code>Management port 50472, for TCP</code>、<code>Access key port 13279, for TCP and UDP</code>，防火墙放通对应的端口</p>
<blockquote>
<p>默认情况下，<code>Management port</code> 和 <code>Access key port</code> 使用随机端口，要使用自定义的固定端口，使用以下命令配置 VPN Server 环境</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash install_server.sh --api-port 65530 --keys-port 65531</span><br></pre></td></tr></table></figure>
<p><strong>如果在同一台主机上重复执行 <code>install_server.sh</code>，请删除持久化数据目录，默认为 <code>/opt/outline/</code></strong> ，否则可能出现重复部署后某些配置依然是旧的。</p>
</blockquote>
<p><img src="https://i.csms.tech/img_265.png"></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://getoutline.org/get-started/#step-3">下载客户端程序</a>，COPY ACCESS KEY 到客户端测试连接。<br> <img src="https://i.csms.tech/img_266.png"></p>
</li>
</ol>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../20240926135814/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202404241336/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202404241336/" class="post-title-link" itemprop="url">SSL Certbot 使用方法汇总</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-04-24 13:36:18" itemprop="dateCreated datePublished" datetime="2024-04-24T13:36:18+08:00">2024-04-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-25 14:09:00" itemprop="dateModified" datetime="2024-09-25T14:09:00+08:00">2024-09-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/SSL/" itemprop="url" rel="index"><span itemprop="name">SSL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Certbot 是 Let’s Encrypt SSL 官方推荐的 ACME 协议客户端，它是一个 Python 程序，且包含模块化插件支持。Let’s Encrypt 的根证书浏览器支持广泛，且支持泛域名。但单个证书的有效期为 90 天，以防止滥用。</p>
<h1 id="安装-Certbot"><a href="#安装-Certbot" class="headerlink" title="安装 Certbot"></a>安装 Certbot</h1><p><a target="_blank" rel="noopener" href="https://eff-certbot.readthedocs.io/en/stable/install.html#installation">官方安装步骤参考</a></p>
<p>以下步骤演示在 Python3 环境中安装 Certbot 及其相关依赖</p>
<ol>
<li>安装 <code>certbot</code> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install certbot</span><br></pre></td></tr></table></figure></li>
<li>申请证书时，要使用 DNS 方式验证域名所有权并且 DNS 使用 Cloudflare 的情况下，可以安装 <code>certbot-dns-cloudflare</code> 插件实现自动验证，参考以下命令安装 <code>certbot-dns-cloudflare</code>，此模块需要 <code>cloudflare</code> 模块的支持 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install cloudflare</span><br><span class="line">pip install certbot-dns-cloudflare</span><br></pre></td></tr></table></figure>
安装完成后检查相关模块和版本。其中 <code>cloudflare</code> 版本需要最低为 <code>2.3.1</code> <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[certbot-dns-cloudflare’s documentation](https://certbot-dns-cloudflare.readthedocs.io/en/stable/#welcome-to-certbot-dns-cloudflare-s-documentation)">[1]</span></a></sup> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pip list</span></span><br><span class="line">certbot                2.10.0</span><br><span class="line">certbot-dns-cloudflare 2.10.0</span><br><span class="line">cloudflare             2.19.2</span><br></pre></td></tr></table></figure>
以上模块安装完成后，即可使用 <code>certbot</code> 申请域名证书，并支持 Cloudflare DNS 的自动验证。</li>
</ol>
<h1 id="基于-Cloudflare-DNS-的自动验证申请域名证书"><a href="#基于-Cloudflare-DNS-的自动验证申请域名证书" class="headerlink" title="基于 Cloudflare DNS 的自动验证申请域名证书"></a>基于 Cloudflare DNS 的自动验证申请域名证书</h1><p><a href="#%E5%AE%89%E8%A3%85-Certbot">参考步骤安装 <code>certbot</code> 及 Cloudflare DNS 插件后</a> 即可使用 <code>certbot</code> 自动请求 Cloudflare DNS 创建申请证书时需要的 DNS 记录自动完成域名归属权的验证过程。</p>
<p><code>certbot</code> 支持的 Cloudflare 相关的参数如下</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>--dns-cloudflare</code></td>
<td>使用 Cloudflare 的 DNS 插件自动验证域名归属权</td>
<td></td>
</tr>
<tr>
<td><code>--dns-cloudflare-credentials</code></td>
<td>请求 Cloudflare 的授权配置文件</td>
<td></td>
</tr>
<tr>
<td><code>--dns-cloudflare-propagation-seconds</code></td>
<td>请求 Cloudflare DNS 添加相关 DNS 记录后，让 ACME 服务等待多少秒再验证 DNS 记录。主要用来防止 DNS 记录添加后，缓存 DNS 服务器未来得及更新最新记录。 <br/>默认为 10</td>
<td></td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://certbot-dns-cloudflare.readthedocs.io/en/stable/#credentials">Cloudflare Credentials 说明</a></p>
<p>假设有 Cloudflare 账号的 Global API Key，则 Credentials 配置文件内容参考如下</p>
<figure class="highlight shell"><figcaption><span>cloudflare.ini</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Cloudflare API credentials used by Certbot</span></span><br><span class="line">dns_cloudflare_email = cloudflare@example.com</span><br><span class="line">dns_cloudflare_api_key = 0123456789abcdef0123456789abcdef01234</span><br></pre></td></tr></table></figure>

<p>申请证书的具体命令如下，如果是第一次申请，需要根据提示填写自己的邮箱信息并同意许可协议，邮箱用于接受之后系统发送的错误或者域名证书过期等信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">certbot certonly \</span><br><span class="line">  --dns-cloudflare \</span><br><span class="line">  --dns-cloudflare-credentials ~/.secrets/certbot/cloudflare.ini \</span><br><span class="line">  --dns-cloudflare-propagation-seconds 60 \</span><br><span class="line">  -d example.com \</span><br><span class="line">  -d www.example.com</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果是非交互式环境,可以使用参数 <code>--email your-email@example.com</code> 和 <code>--agree-tos</code> 自动绑定邮箱并同意许可</p>
</blockquote>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202404241336/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20240924092814/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20240924092814/" class="post-title-link" itemprop="url">Shadowsocks VPN 使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-24 09:09:00" itemprop="dateCreated datePublished" datetime="2024-09-24T09:09:00+08:00">2024-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/VPN/" itemprop="url" rel="index"><span itemprop="name">VPN</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><a target="_blank" rel="noopener" href="https://shadowsocks.org/doc/what-is-shadowsocks.html">Shadowsocks 官网简介</a></p>
<h1 id="基于-Python3-环境的-Shadowsocks-部署"><a href="#基于-Python3-环境的-Shadowsocks-部署" class="headerlink" title="基于 Python3 环境的 Shadowsocks 部署"></a>基于 Python3 环境的 Shadowsocks 部署</h1><p>执行以下命令之一安装 Shadowsocks (Python3 版本)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip3 install git+https://github.com/shadowsocks/shadowsocks.git@master</span><br><span class="line"></span><br><span class="line">pip3 install shadowsocks</span><br></pre></td></tr></table></figure>

<h1 id="配置-Shadowsocks"><a href="#配置-Shadowsocks" class="headerlink" title="配置 Shadowsocks"></a>配置 Shadowsocks</h1><p>创建一个配置文件，比如放在 <code>/etc/shadowsocks/config.json</code> 目录下。配置文件的内容如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;server&quot;: &quot;0.0.0.0&quot;, </span><br><span class="line">    &quot;server_port&quot;: 8388,</span><br><span class="line">    &quot;local_address&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">    &quot;local_port&quot;: 1080,</span><br><span class="line">    &quot;password&quot;: &quot;your_password&quot;,</span><br><span class="line">    &quot;timeout&quot;: 300,</span><br><span class="line">    &quot;method&quot;: &quot;aes-256-cfb&quot;, </span><br><span class="line">    &quot;fast_open&quot;: false</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>配置选项说明</strong> ：</p>
<ul>
<li><code>server</code> ： 服务器监听的 IP 地址，<code>0.0.0.0</code> 表示监听所有接口。</li>
<li><code>server_port</code> ： 服务器监听的端口，客户端连接到这个端口。</li>
<li><code>password</code> ： 用于加密流量的密码，请设置一个强密码。</li>
<li><code>method</code> ： 加密方法。<a target="_blank" rel="noopener" href="https://shadowsocks.org/doc/configs.html">其他加密算法请参考官网</a></li>
<li><code>timeout</code> ： 超时时间（秒）。</li>
<li><code>fast_open</code> ： 如果启用 TCP Fast Open，请将其设置为 <code>true</code>，但需要内核支持。</li>
</ul>
<h1 id="启动-Shadowsocks-服务"><a href="#启动-Shadowsocks-服务" class="headerlink" title="启动 Shadowsocks 服务"></a>启动 Shadowsocks 服务</h1><p>使用以下命令启动 Shadowsocks 服务，该命令会以后台进程的方式启动 Shadowsocks：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssserver -c /etc/shadowsocks/config.json -d start</span><br></pre></td></tr></table></figure>

<p><strong>常用选项</strong> ：</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-h, --help</code></td>
<td>打印帮助信息</td>
<td></td>
</tr>
<tr>
<td><code>-d [start / stop / restart ]</code></td>
<td>以 Daemon 方式（后台）运行</td>
<td></td>
</tr>
<tr>
<td><code>--pid-file</code></td>
<td>Daemon 模式启动时的 PID 文件路径</td>
<td></td>
</tr>
<tr>
<td><code>--log-file</code></td>
<td>Daemon 模式启动时日志文件路径</td>
<td></td>
</tr>
<tr>
<td><code>--user</code></td>
<td>运行服务的用户</td>
<td></td>
</tr>
<tr>
<td><code>-v, -vv</code></td>
<td><code>verbose</code> 模式</td>
<td></td>
</tr>
<tr>
<td><code>-q, -qq</code></td>
<td><code>quite</code> 模式</td>
<td></td>
</tr>
<tr>
<td><code>-c</code></td>
<td>配置文件路径</td>
<td><code>ssserver -c /etc/shadowsocks/config.json -d start</code></td>
</tr>
<tr>
<td><code>-s</code></td>
<td>指定服务端监听地址，默认为 <code>0.0.0.0</code> 。等同于配置文件中的 <code>server</code></td>
<td></td>
</tr>
<tr>
<td><code>-p</code></td>
<td>指定服务端监听端口，默认为 <code>8388</code> 。等同于配置文件中的 <code>server_port</code></td>
<td></td>
</tr>
<tr>
<td><code>-k</code></td>
<td>指定密码 。等同于配置文件中的 <code>password</code></td>
<td></td>
</tr>
<tr>
<td><code>-m</code></td>
<td>加密方法，默认为 <code>aes-256-cfb</code>   。 等同于配置文件中的 <code>method</code></td>
<td></td>
</tr>
<tr>
<td><code>-t</code></td>
<td>超时时间（单位为 <code>秒</code>），默认 300s 。 等同于配置文件中的 <code>timeout</code></td>
<td></td>
</tr>
<tr>
<td><code>--fast-open</code></td>
<td>启用 <code>TCP_FASTOPEN</code>，需要 <code>Linux 3.7+</code></td>
<td></td>
</tr>
<tr>
<td><code>--workers</code></td>
<td><code>workers</code> 数量，Linux&#x2F;Unix 可用</td>
<td></td>
</tr>
<tr>
<td><code>--forbidden-ip</code></td>
<td><code>,</code> 分割的 IP 列表，在此列表中的 IP 禁止连接，即黑名单</td>
<td></td>
</tr>
<tr>
<td><code>--manager-address</code></td>
<td>服务端 UDP 管理地址</td>
<td></td>
</tr>
</tbody></table>
<h2 id="为-Shadowsocks-配置-systemd-services-文件"><a href="#为-Shadowsocks-配置-systemd-services-文件" class="headerlink" title="为 Shadowsocks 配置 systemd services 文件"></a>为 Shadowsocks 配置 systemd services 文件</h2><p>参考以下内容，为 Shadowsocks 配置 systemd services 文件</p>
<figure class="highlight shell"><figcaption><span>/etc/systemd/system/shadowsocks.service</span></figcaption><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Shadowsocks Proxy Server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/bin/ssserver -c /etc/shadowsocks/config.json</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>启用并启动 Shadowsocks 服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl enable shadowsocks</span><br><span class="line">sudo systemctl start shadowsocks</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h1><p>在客户端（如 Windows、macOS、iOS 或 Android）上，使用 Shadowsocks 客户端进行连接。</p>
<p><strong>客户端配置</strong>：</p>
<ul>
<li><code>服务器地址</code> ： 填写你服务器的公网 IP。</li>
<li><code>服务器端口</code> ：填写 <code>config.json</code> 中的 <code>server_port</code>，如 <code>8388</code>。</li>
<li><code>密码</code> ： 填写配置文件中的 <code>password</code>。</li>
<li><code>加密方法</code> ： 选择 <code>method</code> 中配置的加密方法，如 <code>aes-256-cfb</code>。</li>
</ul>
<p>如果需要调试或查看运行日志，可以通过以下命令查看 Shadowsocks 的日志：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">journalctl -u shadowsocks</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20240923151710/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20240923151710/" class="post-title-link" itemprop="url">Linux ss 命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-23 15:09:00" itemprop="dateCreated datePublished" datetime="2024-09-23T15:09:00+08:00">2024-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><code>ss</code> 命令是一个查看 Linux 系统 <code>socket</code> 统计信息的工具，类似于 <code>netstat</code>，但是能显示更多的 TCP 和状态信息。</p>
<p><strong>常用选项</strong> ，可查看 <code>man ss</code></p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-h, --help</code></td>
<td>输出选项的简要说明</td>
<td></td>
</tr>
<tr>
<td><code>-V, --version</code></td>
<td>打印版本信息</td>
<td></td>
</tr>
<tr>
<td><code>-H, --no-header</code></td>
<td>不打印首行（<code>Netid State  Recv-Q Send-Q                                                                      Local Address:Port            Peer Address:Port    Process</code>）</td>
<td></td>
</tr>
<tr>
<td><code>-n, --numeric</code></td>
<td>不对服务名进行解析，直接输出端口（数值类型）</td>
<td></td>
</tr>
<tr>
<td><code>-r, --resolve</code></td>
<td>尝试解析 IP 和 端口 为对应的名称，默认行为</td>
<td></td>
</tr>
<tr>
<td><code>-a, --all</code></td>
<td>列出正在监听的端口以及已经建立连接的端口</td>
<td></td>
</tr>
<tr>
<td><code>-l, --listening</code></td>
<td>仅列出正在监听的端口，默认不列出。</td>
<td></td>
</tr>
<tr>
<td><code>-m, --memory</code></td>
<td>显示 <code>socket</code> 的 <code>内存</code> 使用情况</td>
<td></td>
</tr>
<tr>
<td><code>-p, --processes</code></td>
<td>显示使用此 <code>socket</code> 的进程</td>
<td></td>
</tr>
<tr>
<td><code>-s, --summary</code></td>
<td>显示简略的统计信息</td>
<td></td>
</tr>
<tr>
<td><code>-4, --ipv4</code></td>
<td>只显示 IPv4 相关的 <code>socket</code></td>
<td></td>
</tr>
<tr>
<td><code>-6, --ipv6</code></td>
<td>只显示 IPv6 相关的 <code>socket</code></td>
<td></td>
</tr>
<tr>
<td><code>-t, --tcp</code></td>
<td>只显示 TCP 相关 <code>socket</code></td>
<td></td>
</tr>
<tr>
<td><code>-u, --udp</code></td>
<td>只显示 UDP 相关 <code>socket</code></td>
<td></td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202306081314/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202306081314/" class="post-title-link" itemprop="url">Linux 常见错误集锦</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-08 13:08:43" itemprop="dateCreated datePublished" datetime="2023-06-08T13:08:43+08:00">2023-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-20 14:09:00" itemprop="dateModified" datetime="2024-09-20T14:09:00+08:00">2024-09-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos 7</li>
</ul>
<h1 id="automake"><a href="#automake" class="headerlink" title="automake"></a>automake</h1><p>编译安装软件报错</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">error: require Automake 1.14, but have 1.13.4</span><br></pre></td></tr></table></figure>
<p>Automake 版本不匹配，需要安装 Automake 1.14</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">rpm -qa | grep automake</span></span><br><span class="line">automake-1.13.4-3.el7.noarch</span><br></pre></td></tr></table></figure>

<p>以下步骤安装 <code>automake-1.14.1</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget http://ftp.gnu.org/gnu/automake/automake-1.14.1.tar.gz</span><br><span class="line">tar -xf automake-1.14.1.tar.gz</span><br><span class="line">cd automake-1.14.1</span><br><span class="line">./bootstrap.sh</span><br></pre></td></tr></table></figure>
<p>以上步骤执行完成后，会生成 <code>configure</code> 可执行文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>安装完成后，执行以下命令验证版本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">automake --version</span></span><br><span class="line">automake (GNU automake) 1.14.1</span><br><span class="line">Copyright (C) 2013 Free Software Foundation, Inc.</span><br><span class="line">License GPLv2+: GNU GPL version 2 or later &lt;http://gnu.org/licenses/gpl-2.0.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line"></span><br><span class="line">Written by Tom Tromey &lt;tromey@redhat.com&gt;</span><br><span class="line">       and Alexandre Duret-Lutz &lt;adl@gnu.org&gt;.</span><br></pre></td></tr></table></figure>

<h1 id="makeinfo"><a href="#makeinfo" class="headerlink" title="makeinfo"></a>makeinfo</h1><p>编译安装软件报错</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">makeinfo: command not found</span><br></pre></td></tr></table></figure>
<p><code>makeinfo</code> 命令不存在，执行以下命令安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install texinfo</span><br></pre></td></tr></table></figure>

<h1 id="gcc"><a href="#gcc" class="headerlink" title="gcc"></a>gcc</h1><h2 id="no-acceptable-C-compiler-found-in-PATH"><a href="#no-acceptable-C-compiler-found-in-PATH" class="headerlink" title="no acceptable C compiler found in $PATH"></a>no acceptable C compiler found in $PATH</h2><p>缺少 <code>gcc</code> 编译器，安装即可</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y gcc</span><br></pre></td></tr></table></figure>

<h2 id="A-compiler-with-support-for-C-11-language-features-is-required"><a href="#A-compiler-with-support-for-C-11-language-features-is-required" class="headerlink" title="A compiler with support for C++11 language features is required"></a>A compiler with support for C++11 language features is required</h2><p>编译安装软件时报错</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">configure: error: *** A compiler with support for C++11 language features is required.</span><br></pre></td></tr></table></figure>
<p>错误原因为 gcc 版本太低。查看当前 gcc 版本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gcc -v</span></span><br><span class="line">Using built-in specs.</span><br><span class="line">COLLECT_GCC=gcc</span><br><span class="line">COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/4.8.5/lto-wrapper</span><br><span class="line">Target: x86_64-redhat-linux</span><br><span class="line">Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --disable-libgcj --with-isl=/builddir/build/BUILD/gcc-4.8.5-20150702/obj-x86_64-redhat-linux/isl-install --with-cloog=/builddir/build/BUILD/gcc-4.8.5-20150702/obj-x86_64-redhat-linux/cloog-install --enable-gnu-indirect-function --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux</span><br><span class="line">Thread model: posix</span><br><span class="line">gcc version 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC)</span><br></pre></td></tr></table></figure>

<h3 id="安装-gcc-8-3-0"><a href="#安装-gcc-8-3-0" class="headerlink" title="安装 gcc-8.3.0"></a>安装 gcc-8.3.0</h3><p>以下步骤演示安装 gcc-8.3.0 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[升级 GCC 支持C++11](https://www.cnblogs.com/gyfluck/p/10537383.html)
">[1]</span></a></sup></p>
<ol>
<li>下载安装包，<a target="_blank" rel="noopener" href="http://ftp.gnu.org/gnu/gcc/">官方下载地址</a> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget ftp://ftp.irisa.fr/pub/mirrors/gcc.gnu.org/gcc/releases/gcc-8.3.0/gcc-8.3.0.tar.gz</span><br><span class="line">tar -xf gcc-8.3.0.tar.gz</span><br><span class="line">cd gcc-8.3.0</span><br></pre></td></tr></table></figure></li>
<li>编译安装。编译依赖 <code>GMP 4.2+</code>, <code>MPFR 2.4.0+</code> and <code>MPC 0.8.0+</code>，需要先按照顺序安装这 3 个依赖。依赖安装参考： <a href="#%E5%AE%89%E8%A3%85-GMP">安装 GMP</a>，<a href="#%E5%AE%89%E8%A3%85-MPFR">安装 MPFR</a>，<a href="%E5%AE%89%E8%A3%85-MPC">安装 MPC</a> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./configure --prefix=/usr/local/gcc-8.3.0 --disable-multilib</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make install</span></span><br></pre></td></tr></table></figure></li>
<li>安装完成后，需要更新系统标准库 查看当前系统使用的 gcc 库文件，可以看到版本为 <code>libstdc++.so.6.0.19</code> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> /usr/lib64/libstdc++.so.6</span></span><br><span class="line">libstdc++.so.6       libstdc++.so.6.0.19 </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> /usr/lib64/libstdc++.so.6 -l</span></span><br><span class="line">lrwxrwxrwx 1 root root 19 May 30 08:05 /usr/lib64/libstdc++.so.6 -&gt; libstdc++.so.6.0.19</span><br></pre></td></tr></table></figure>
 执行以下操作，更新 <code>libstdc++.so.6</code> 到最新安装的版本 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">rm</span> -rf /usr/lib64/libstdc++.so.6</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ln</span> -s /usr/local/gcc-8.3.0/lib64/libstdc++.so.6.0.25 /usr/lib64/libstdc++.so.6</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> /usr/lib64/libstdc++.so.6 -l</span></span><br><span class="line">lrwxrwxrwx 1 root root 46 Jun  9 09:31 /usr/lib64/libstdc++.so.6 -&gt; /usr/local/gcc-8.3.0/lib64/libstdc++.so.6.0.25</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="安装-GMP"><a href="#安装-GMP" class="headerlink" title="安装 GMP"></a>安装 GMP</h2><p><a href="ftp://gcc.gnu.org/pub/gcc/infrastructure/">安装包下载地址</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget ftp://gcc.gnu.org/pub/gcc/infrastructure/gmp-6.1.0.tar.bz2</span><br><span class="line">tar -jxvf gmp-6.1.0.tar.bz2</span><br><span class="line">cd gmp-6.1.0</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h2 id="安装-MPFR"><a href="#安装-MPFR" class="headerlink" title="安装 MPFR"></a>安装 MPFR</h2><p><a href="ftp://gcc.gnu.org/pub/gcc/infrastructure/">安装包下载地址</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget ftp://gcc.gnu.org/pub/gcc/infrastructure/mpfr-3.1.4.tar.bz2</span><br><span class="line">tar -jxvf mpfr-3.1.4.tar.bz2</span><br><span class="line">cd mpfr-3.1.4</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h2 id="安装-MPC"><a href="#安装-MPC" class="headerlink" title="安装 MPC"></a>安装 MPC</h2><p><a href="ftp://gcc.gnu.org/pub/gcc/infrastructure/">安装包下载地址</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget ftp://gcc.gnu.org/pub/gcc/infrastructure/mpc-1.0.3.tar.gz</span><br><span class="line">tar -zxvf mpc-1.0.3.tar.gz</span><br><span class="line">cd mpc-1.0.3</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202306081314/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20240913141948/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20240913141948/" class="post-title-link" itemprop="url">Linux nftables 防火墙常见错误</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-13 14:09:00" itemprop="dateCreated datePublished" datetime="2024-09-13T14:09:00+08:00">2024-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">常用服务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>环境信息</strong></p>
<ul>
<li>Ubuntu 24.04.1 LTS (Noble Numbat)</li>
<li>nftables v1.0.9 (Old Doc Yak #3)</li>
</ul>
<h1 id="配置错误"><a href="#配置错误" class="headerlink" title="配置错误"></a>配置错误</h1><h2 id="Statement-after-terminal-statement-has-no-effect"><a href="#Statement-after-terminal-statement-has-no-effect" class="headerlink" title="Statement after terminal statement has no effect"></a>Statement after terminal statement has no effect</h2><p>有以下配置：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip daddr 127.0.0.11 jump DOCKER_OUTPUT counter;</span><br><span class="line"></span><br><span class="line">meta l4proto tcp ip daddr 127.0.0.11 tcp dport 53 dnat to 127.0.0.11:45143 counter;</span><br></pre></td></tr></table></figure>
<p>加载配置时报错： <code>Error: Statement after terminal statement has no effect</code></p>
<p><strong>错误原因</strong> ： <code>nftables</code> 规则中在 <strong>终止语句（<code>terminal statement</code>）</strong>（如 <code>jump</code> 或 <code>dnat</code>）后添加的语句（如 <code>counter</code>）没有作用，因为 <code>jump</code> 或 <code>dnat</code> 语句已经处理了数据包，不会再执行后续的语句。</p>
<blockquote>
<p>在 <code>nftables</code> 中，<strong>终止语句（<code>terminal statement</code>）</strong> 是那些一旦执行后就结束了该数据包的处理，例如 <code>jump</code>、<code>accept</code>、<code>drop</code>、<code>dnat</code>、<code>snat</code> 等。因为这些语句会决定数据包的最终去向，所以在这些语句后面再添加如 <code>counter</code> 这样的语句是无效的。</p>
</blockquote>
<p><strong>解决方法</strong> : 要正确配置计数器，你需要 <strong>将 <code>counter</code> 放在终止语句</strong> 之前，这样在执行 <code>jump</code> 或 <code>dnat</code> 之前，数据包会先经过计数器。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip daddr 127.0.0.11 counter jump DOCKER_OUTPUT;</span><br><span class="line"></span><br><span class="line">meta l4proto tcp ip daddr 127.0.0.11 tcp dport 53 counter dnat to 127.0.0.11:45143;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="syntax-error"><a href="#syntax-error" class="headerlink" title="syntax error"></a>syntax error</h2><h3 id="一次性配置多个端口"><a href="#一次性配置多个端口" class="headerlink" title="一次性配置多个端口"></a>一次性配置多个端口</h3><p>假如要在一个规则中同时放通 HTTP 和 HTTPS （<code>80</code> 和 <code>443</code> 端口），以下是错误语句</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nft insert inet filter input handle 11 tcp dport 80,443 counter accept comment \&quot;<span class="keyword">for</span> nginx\&quot;</span></span><br><span class="line">Error: syntax error, unexpected inet, expecting rule</span><br><span class="line">insert inet filter input handle 11 tcp dport 80,443 counter accept comment for nginx</span><br><span class="line">       ^^^^</span><br></pre></td></tr></table></figure>

<p>在 <code>nftables</code> 中，<strong>多个端口</strong> 在指定时不能直接用逗号分隔。对于多个端口，应该使用集合（<code>&#123;&#125;</code>）的语法来指定。以下为正确语法</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nft insert rule inet filter input handle 11 tcp dport &#123; 80,443 &#125; counter accept comment \&quot;<span class="keyword">for</span> nginx\&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><em><strong>注意</strong></em>： 使用 <strong>集合</strong> （<code>&#123;&#125;</code>）语法时要注意其中的空格，<code>&#123; 80,443 &#125;</code> 是正确格式，如果写成 <code>&#123;80,443&#125;</code> 则是错误格式</p>
</blockquote>
<h3 id="cmd-中添加注释报错"><a href="#cmd-中添加注释报错" class="headerlink" title="cmd 中添加注释报错"></a>cmd 中添加注释报错</h3><p>使用以下语句添加规则报错：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nft insert rule inet filter input handle 11 tcp dport &#123; 80,443 &#125; counter accept comment <span class="string">&quot;for nginx&quot;</span></span> </span><br><span class="line">Error: syntax error, unexpected string, expecting end of file or newline or semicolon</span><br><span class="line">insert rule inet filter input handle 11 tcp dport &#123; 80,443 &#125; counter accept comment for nginx</span><br><span class="line">                                                                                        ^^^^^</span><br></pre></td></tr></table></figure>

<p>正确格式如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nft insert rule inet filter input handle 11 tcp dport &#123; 80,443 &#125; counter accept comment \&quot;<span class="keyword">for</span> nginx\&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><em><strong>注意</strong></em>： 在 cmd 中交互式操作时，注释中使用的 <strong>双引号（<code>&quot;&quot;</code>）</strong> 要使用 <strong>转义（<code>\</code>）</strong></p>
</blockquote>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../20240913141948/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202208301536/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202208301536/" class="post-title-link" itemprop="url">docker 网络</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-30 15:36:14" itemprop="dateCreated datePublished" datetime="2022-08-30T15:36:14+08:00">2022-08-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-10 17:09:00" itemprop="dateModified" datetime="2024-09-10T17:09:00+08:00">2024-09-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos 7.9.2009</li>
<li>docker-ce-19.03.15</li>
</ul>
<h1 id="Docker-网络模式"><a href="#Docker-网络模式" class="headerlink" title="Docker 网络模式"></a>Docker 网络模式</h1><h2 id="Bridge-模式"><a href="#Bridge-模式" class="headerlink" title="Bridge 模式"></a>Bridge 模式</h2><p>bridge 模式是 docker 的默认网络模式，不使用 <code>--network</code> 参数，就是 bridge 模式。</p>
<p>当 Docker 进程启动时，会在主机上创建一个名为 docker0 的虚拟网桥，默认主机上启动的 Docker 容器会连接到这个虚拟网桥上。</p>
<p>容器启动时，docker 会从 docker0 网桥的子网中分配一个 IP 地址给容器中的网卡。大体流程为在主机上创建一个 <a href="/202304251611/" title="&#96;veth pair&#96;">&#96;veth pair&#96;</a>，Docker 将 <code>veth pair</code> 的一端放在容器中，命名为 <code>eth0</code> 并配置 IP，网关，路由等信息，将 <code>veth pair</code> 的另一端加入 docker0 网桥。</p>
<p><strong>通过这种方式，主机可以跟容器通信，容器之间也可以相互通信。</strong></p>
<h2 id="Host-模式"><a href="#Host-模式" class="headerlink" title="Host 模式"></a>Host 模式</h2><p><strong>如果启动容器的时候使用 host 模式，那么这个容器将不会获得一个独立的 Network Namespace，而是和宿主机一样在 Root Network Namespace，容器中看到的网络方面的信息和宿主机一样，容器使用的网络资源在整个 Root Network Namespace 不能出现冲突</strong>。容器将不会虚拟出自己的网卡，配置自己的 IP 等，而是使用宿主机的 IP 和端口，主机名也是使用宿主机的。但是，容器的其他方面，如文件系统、进程列表等还是和宿主机隔离的。</p>
<p><strong>host 模式下的容器可以看到宿主机上的所有网卡信息，可以直接使用宿主机 IP 或主机名与外界通信，无需额外的 NAT，也无需通过 Linux bridge 进行转发或者数据包的封装，可以访问主机上的其他任一容器</strong>。</p>
<p>使用如下命令参数启动 host 网络模式的容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --network host --name test1 -p 80:80 -d -it centos:centos7.9.2009</span><br></pre></td></tr></table></figure>
<p>host 模式的容器，没有自己的 network namespace，在 root network namespace 中。进入测试容器 <code>test1</code>，查看网卡、 IP 信息及端口、主机名信息，会看到和宿主机一样的信息。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ip <span class="built_in">link</span></span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:e7:c0:27 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default </span><br><span class="line">    link/ether 02:42:f2:1b:dc:ea brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ip add</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:e7:c0:27 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.142.10/24 brd 192.168.142.255 scope global noprefixroute ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::20c:29ff:fee7:c027/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:f2:1b:dc:ea brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever    </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">[root@test1 /]<span class="comment"># netstat -anutp</span></span></span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      -                   </span><br><span class="line">tcp        0      0 0.0.0.0:81              0.0.0.0:*               LISTEN      124/nginx: master p </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   </span><br><span class="line">tcp        0     36 192.168.142.10:22       192.168.142.1:61396     ESTABLISHED -                   </span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      -                   </span><br><span class="line">tcp6       0      0 :::81                   :::*                    LISTEN      124/nginx: master p </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      -          </span><br></pre></td></tr></table></figure>

<p><strong>host 模式的缺点</strong></p>
<ul>
<li>容器没有自己的 <code>network namespace</code> ，网络和宿主机或其他使用 <code>host</code> 模式的容器未隔离，容易出现资源冲突，比如同一个宿主机上，使用 <code>host</code> 模式的容器中启动的端口不能相同。</li>
</ul>
<h2 id="None-模式"><a href="#None-模式" class="headerlink" title="None 模式"></a>None 模式</h2><p>使用 <code>none</code> 模式，Docker 容器拥有自己的 <code>Network Namespace</code>，但是，系统并不为 Docker 容器进行任何网络配置。也就是说，这个 Docker 容器没有网卡（<code>lo</code> 回环网卡除外）、IP、路由等信息。需要我们自己为 Docker 容器添加网卡、配置 IP 等。</p>
<p>参考以下命令创建 <code>none</code> 模式的容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --network none --name test-none -p 82:80 -d -it centos7:my</span><br></pre></td></tr></table></figure>
<p>容器创建后，进入容器中，查看网卡和 IP 等信息，容器中默认只存在 <code>lo</code> 网卡，不存在其他网卡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ip add</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ip <span class="built_in">link</span></span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00       </span><br></pre></td></tr></table></figure>
<p>以下操作演示手动为容器配置网络</p>
<ol>
<li><p>创建 <code>veth pair</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip link add veth0 type veth peer name veth0_p</span><br></pre></td></tr></table></figure></li>
<li><p>将 <code>veth pair</code> 的一端 <code>veth0</code> 放入 docker 默认的网桥 <code>docker0</code>，另一端 <code>veth0_p</code> 放入容器中</p>
<p>首先使用命令 <code>docker inspect test-none | grep &quot;Pid&quot;</code> 找到容器对应的 PID，此处为 84040，根据此 PID 将 veth 的一端放入容器的 network namespace 中</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip link set dev veth0 master docker0</span><br><span class="line"></span><br><span class="line">ip link set dev veth0 up</span><br><span class="line"></span><br><span class="line">ip link set veth0_p netns 84040</span><br></pre></td></tr></table></figure>
<p>在宿主机上面检查 <code>veth0</code>，确定其已经加入网桥 <code>docker0</code>，并且 <code>veth0_p</code> 已不在 <code>root network namespace</code> 中</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ip <span class="built_in">link</span></span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:e7:c0:27 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default </span><br><span class="line">    link/ether 02:42:f2:1b:dc:ea brd ff:ff:ff:ff:ff:ff</span><br><span class="line">12: veth0@if11: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue master docker0 state LOWERLAYERDOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link/ether 16:7f:98:d8:9d:dc brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br></pre></td></tr></table></figure>
<p>重新进入容器，检查网卡信息，可以看到容器中已经有了网卡 <code>veth0_p</code>，状态为 <code>DOWN</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ip -d <span class="built_in">link</span></span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 promiscuity 0 addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 </span><br><span class="line">11: veth0_p@if12: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link/ether be:f1:94:9f:b8:c9 brd ff:ff:ff:ff:ff:ff link-netnsid 0 promiscuity 0 </span><br><span class="line">    veth addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535</span><br></pre></td></tr></table></figure>
</li>
<li><p>为容器中的网卡配置 IP 及网关等信息</p>
<p>为了能在宿主机对容器的 <code>network namespace</code> 进行操作，首先需要将容器的 <code>network namespace</code> 暴露出来，之后可以在宿主机通过 <code>network namespace</code> 名称(此处为 84040，可以自定义)操作 <code>network namespace</code> 。<a href="/202304031317/" title="Linux network namespace 参考">Linux network namespace 参考</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ln</span> -s /proc/84040/ns/net /var/run/netns/84040</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ip netns <span class="built_in">ls</span></span></span><br><span class="line">84040 (id: 0)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>通过 <code>network namespace</code> 名称(此处为 84040)配置容器中网卡的 IP 地址信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip netns exec 84040 ip link set dev veth0_p name eth0</span><br><span class="line">ip netns exec 84040 ip link set dev eth0 up</span><br><span class="line"></span><br><span class="line">ip netns exec 84040 ip add add 172.17.0.10/16 dev eth0</span><br><span class="line"></span><br><span class="line">ip netns exec 84040 ip route add default via 172.17.0.1</span><br></pre></td></tr></table></figure>
<p>进入容器检查网络信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ip add</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">15: eth0@if16: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link/ether 7e:36:b3:20:a1:8c brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.10/16 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ip route show</span></span><br><span class="line">default via 172.17.0.1 dev eth0 </span><br><span class="line">172.17.0.0/16 dev eth0 proto kernel scope link src 172.17.0.10       </span><br></pre></td></tr></table></figure>

<p>进入容器测试网络连接</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ping 8.8.8.8</span></span><br><span class="line">PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.</span><br><span class="line">64 bytes from 8.8.8.8: icmp_seq=1 ttl=127 time=37.4 ms</span><br><span class="line">64 bytes from 8.8.8.8: icmp_seq=2 ttl=127 time=37.0 ms</span><br><span class="line">^C</span><br><span class="line">--- 8.8.8.8 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 1000ms</span><br><span class="line">rtt min/avg/max/mdev = 37.047/37.234/37.422/0.269 ms</span><br></pre></td></tr></table></figure></li>
</ol>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202208301536/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202208041317/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202208041317/" class="post-title-link" itemprop="url">docker 安装及常用命令介绍</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-04 13:13:13" itemprop="dateCreated datePublished" datetime="2022-08-04T13:13:13+08:00">2022-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-31 17:08:00" itemprop="dateModified" datetime="2024-08-31T17:08:00+08:00">2024-08-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos 7.9.2009</li>
<li>docker-ce-19.03.15</li>
<li>docker-20.10.9</li>
</ul>
<h1 id="Docker-安装"><a href="#Docker-安装" class="headerlink" title="Docker 安装"></a>Docker 安装</h1><h2 id="yum-安装-docker"><a href="#yum-安装-docker" class="headerlink" title="yum 安装 docker"></a>yum 安装 docker</h2><p>安装 yum 源，<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">docker官方 centos 安装文档</a>  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y yum-utils</span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p>安装 <code>docker</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure>

<h2 id="yum-离线安装-docker"><a href="#yum-离线安装-docker" class="headerlink" title="yum 离线安装 docker"></a>yum 离线安装 docker</h2><p><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5">参考链接</a>下载rpm安装包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-19.03.15-3.el7.x86_64.rpm</span><br><span class="line">wget https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-cli-19.03.15-3.el7.x86_64.rpm</span><br><span class="line">wget https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.4.13-3.1.el7.x86_64.rpm</span><br><span class="line">wget https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-compose-plugin-2.3.3-3.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>
<p>安装 docker</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum localinstall -y containerd.io-1.4.13-3.1.el7.x86_64.rpm \</span><br><span class="line">                    docker-ce-cli-19.03.15-3.el7.x86_64.rpm \</span><br><span class="line">                    docker-ce-19.03.15-3.el7.x86_64.rpm \</span><br><span class="line">                    docker-compose-plugin-2.3.3-3.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p>以上 2 条命令可以使用以下 1 条命令完成</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum localinstall -y https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-19.03.15-3.el7.x86_64.rpm \</span><br><span class="line">                    https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-cli-19.03.15-3.el7.x86_64.rpm \</span><br><span class="line">                    https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.4.13-3.1.el7.x86_64.rpm \</span><br><span class="line">                    https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-compose-plugin-2.3.3-3.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p>启动docker</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable docker --now</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202208041317/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202210241051/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202210241051/" class="post-title-link" itemprop="url">iptables 服务使用说明</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-10-24 10:51:32" itemprop="dateCreated datePublished" datetime="2020-10-24T10:51:32+08:00">2020-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-31 16:08:00" itemprop="dateModified" datetime="2024-08-31T16:08:00+08:00">2024-08-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">常用服务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>iptables 的底层实现是 <code>netfilter</code>，<code>netfilter</code> 的架构是在整个网络流程(TCP&#x2F;IP 协议栈)的若干位置放置一些钩子，并在每个钩子上挂载一些处理函数进行处理。</p>
<p>IP 层的 5 个钩子点的位置，对应就是 <code>iptables</code> 的 5 条内置链，分别是</p>
<ul>
<li><code>PREROUTING</code></li>
<li><code>FORWARD</code></li>
<li><code>INPUT</code></li>
<li><code>OUTPUT</code></li>
<li><code>POSTROUTING</code></li>
</ul>
<p><img src="https://i.csms.tech/img_133.png"><br>当网卡收到一个网络报文送达协议栈时，最先经过的 <code>netfilter</code> 钩子是 <code>PREROUTING</code>，此处常见的钩子函数是 <code>目的地址转换 (DNAT)</code>。无论 <code>PREROUTING</code> 是否存在钩子处理网络数据包，下一步内核都会通过 <strong>查询本地路由表</strong> 决定这个数据包的流向</p>
<ul>
<li>如果是发送给本地进程，则进入 <code>INPUT</code> 链传给本地进程</li>
<li>如果是发送给其他机器（或者其他 <code>network namespace</code>），则经过 <code>netfilter</code> 的 <code>FORWARD</code> 钩子传送出去，相当于将本地机器当作路由器</li>
</ul>
<p>所有马上要发送到网络协议栈之外的数据包，都会经过 <code>POSTROUTING</code> 钩子，这里常见的处理函数是 <code>源地址转换(SNAT)</code> 或者 <code>源地址伪装(Masquerade, 简称 Masq)</code></p>
<p>除了 5 条内置的链，<code>iptables</code> 还有 5 张表，这 5 张表主要是用来给 <code>iptables</code> 中的规则（rule）分类，系统中所有的 <code>iptables</code> 规则都被划分到不同的表集合中。5 张表分别为</p>
<ul>
<li><code>raw</code> - <code>iptables</code> 是有状态的，即 <code>iptables</code> 对数据包有连接追踪 (<code>connection trackong</code>) 机制，而 <code>raw</code> 可以用来去除这种追踪机制</li>
<li><code>mangle</code> - 用于修改数据包的 IP 头信息</li>
<li><code>nat</code> - 用于修改数据包的源或者目的地址</li>
<li><code>filter</code> - 用于控制到达某条链上面的数据包是继续放行、直接丢弃(<code>drop</code>)、或拒绝(<code>reject</code>)</li>
<li><code>security</code> - 用于在数据包上面应用 SELinux</li>
</ul>
<p>表是有优先级的，5 张表的优先级从高到低是: <code>raw</code>、<code>mangle</code>、<code>nat</code>、<code>filter</code>、<code>security</code>，<code>iptables</code> 不支持自定义表。不是每个链上都能挂表，<code>iptables</code> 表与链的对应关系如下图</p>
<table>
<thead>
<tr>
<th>-</th>
<th>PREROUTING</th>
<th>FORWARD</th>
<th>INPUT</th>
<th>OUTPUT</th>
<th>POSTROUTING</th>
</tr>
</thead>
<tbody><tr>
<td><code>raw</code></td>
<td>Y</td>
<td>N</td>
<td>N</td>
<td>Y</td>
<td>N</td>
</tr>
<tr>
<td><code>mangle</code></td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td><code>nat (SNAT)</code></td>
<td>N</td>
<td>N</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
</tr>
<tr>
<td><code>nat (DNAT)</code></td>
<td>Y</td>
<td>N</td>
<td>N</td>
<td>Y</td>
<td>N</td>
</tr>
<tr>
<td><code>filter</code></td>
<td>N</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>N</td>
</tr>
<tr>
<td><code>security</code></td>
<td>N</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>N</td>
</tr>
</tbody></table>
<p><code>iptables</code> 表和链的工作流程图如下</p>
<p><img src="https://i.csms.tech/img_134.png"></p>
<h1 id="iptables-命令"><a href="#iptables-命令" class="headerlink" title="iptables 命令"></a>iptables 命令</h1><p>常用选项说明</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-F ,--flush</code></td>
<td>清除所有规则，默认规则除外</td>
<td></td>
</tr>
<tr>
<td><code>-P ,--policy</code></td>
<td>设置默认规则</td>
<td></td>
</tr>
<tr>
<td><code>-t ,--table</code></td>
<td>指定要操作的表，默认为 <code>filter</code> 表</td>
<td><code>iptables -t nat -P INPUT ACCEPT</code></td>
</tr>
<tr>
<td><code>--list ,-L [chain [rulenum]]</code></td>
<td>列出（指定的链或所有链）的规则</td>
<td><code>iptables -t nat -L -v -n --line-numbers</code></td>
</tr>
<tr>
<td><code>--verbose	,-v</code></td>
<td>verbose mode</td>
<td></td>
</tr>
<tr>
<td><code>--numeric	,-n</code></td>
<td>不解析协议和端口号，以数字的形式显示</td>
<td></td>
</tr>
<tr>
<td><code>--line-numbers</code></td>
<td>显示规则的行号，可以根据行号对具体的规则进行操作</td>
<td></td>
</tr>
<tr>
<td><code>--jump	,-j</code></td>
<td>匹配的规则的处理 target</td>
<td><code>iptables -A INPUT  -j LOG</code></td>
</tr>
<tr>
<td><code>--append  ,-A chain</code></td>
<td>像指定的链中追加规则</td>
<td><code>-A INPUT -i lo -j ACCEPT</code></td>
</tr>
<tr>
<td><code>--insert  ,-I chain [rulenum]</code></td>
<td>向指定的链中指定的位置插入规则</td>
<td><code>iptables -I INPUT 10 -p tcp --dport 80 -j ACCEPT</code></td>
</tr>
<tr>
<td><code>--delete  ,-D chain rulenum</code></td>
<td>删除指定链中的指定位置的规则</td>
<td><code>iptables -D INPUT 10 </code></td>
</tr>
<tr>
<td><code>--replace ,-R chain rulenum</code></td>
<td>更新指定链中的指定位置的规则</td>
<td></td>
</tr>
<tr>
<td><code>-S, --list-rules [chain]</code></td>
<td>按照类似 <code>iptables-save</code> 的输出打印规则</td>
<td></td>
</tr>
</tbody></table>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202210241051/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202208191317/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202208191317/" class="post-title-link" itemprop="url">linux logrotate 服务</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-19 13:17:42" itemprop="dateCreated datePublished" datetime="2020-08-19T13:17:42+08:00">2020-08-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-23 11:08:00" itemprop="dateModified" datetime="2024-08-23T11:08:00+08:00">2024-08-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">常用服务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos 7</li>
</ul>
<p><code>logrotate</code> 程序是一个日志文件管理工具。用于分割日志文件，压缩转存、删除旧的日志文件，并创建新的日志文件  </p>
<p><code>logrotate</code> 是基于 <code>crond</code> 来运行的，其脚本是 <code>/etc/cron.daily/logrotate</code>，日志轮转是系统自动完成的。<br>实际运行时，<code>logrotate</code> 会调用配置文件 <code>/etc/logrotate.conf</code>。<br><code>/etc/cron.daily/logrotate</code> 文件内容如下：</p>
<figure class="highlight shell"><figcaption><span>/etc/cron.daily/logrotate</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">/usr/sbin/logrotate -s /var/lib/logrotate/logrotate.status /etc/logrotate.conf</span><br><span class="line">EXITVALUE=$?</span><br><span class="line">if [ $EXITVALUE != 0 ]; then</span><br><span class="line">    /usr/bin/logger -t logrotate &quot;ALERT exited abnormally with [$EXITVALUE]&quot;</span><br><span class="line">fi</span><br><span class="line">exit 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>可以执行以下命令手动执行日志切割：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">logrotate -f /etc/logrotate.conf</span><br></pre></td></tr></table></figure>
<p>以下命令可以检测配置文件是否正确：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">logrotate -d /etc/logrotate.conf</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202208191317/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20240822111015/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20240822111015/" class="post-title-link" itemprop="url">Linux systemd</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-22 11:08:00" itemprop="dateCreated datePublished" datetime="2024-08-22T11:08:00+08:00">2024-08-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>systemd</code> 是一种用于 Linux 操作系统的系统和服务管理器。它被广泛应用于许多现代 Linux 发行版中，如 CentOS、Fedora、Ubuntu 等。<code>systemd</code> 旨在替代传统的 <code>SysV</code> 和 <code>LSB init</code> 系统，并提供更强大、灵活的系统启动和服务管理功能。</p>
<p><code>systemd</code> 的关键概念和组件</p>
<ul>
<li><p><strong>Unit 文件</strong>：</p>
<ul>
<li><strong><code>systemd</code> 使用单元（<code>Unit</code>）文件来描述系统资源</strong>。常见的单元类型包括：<ul>
<li><code>Service Unit (*.service)</code> ： 用于定义和管理服务。</li>
<li><code>Target Unit (*.target)</code> ： 用于分组和同步一组单元的启动，如 <code>multi-user.target</code>。</li>
<li><code>Timer Unit (*.timer)</code> ： 用于定时任务，相当于 <code>cron</code> 的替代品。</li>
<li><code>Socket Unit (*.socket)</code> ：用于管理网络或 IPC 套接字。</li>
<li><code>Mount Unit (*.mount)</code> ： 用于定义挂载点。</li>
<li><code>Path Unit (*.path)</code> : 监控文件或者目录的变化。当监控的文件或目录发生变化时，可以触发相应的 <code>service</code> 单元。</li>
</ul>
</li>
<li><strong>单元（<code>Unit</code>）文件通常存储在以下目录</strong><ul>
<li>&#96;&#x2F;etc&#x2F;systemd&#x2F;system&#x2F; ：系统管理员定义的单位文件，优先级较高。</li>
<li><code>/lib/systemd/system/</code> ：发行版提供的单位文件，优先级较低。</li>
<li><code>/run/systemd/system/</code> ：运行时生成的单位文件，临时的。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Target 文件</strong></p>
<ul>
<li><code>systemd</code> 使用 <code>target</code> 取代传统的运行级别（<code>runlevel</code>）。常见的目标包括：<ul>
<li><code>multi-user.target</code> ： 相当于传统的运行级别 3，支持多用户、无图形界面。</li>
<li><code>graphical.target</code> ： 相当于传统的运行级别 5，支持多用户和图形界面。</li>
<li><code>rescue.target</code> ： 相当于传统的单用户模式，提供基本的系统恢复环境。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>日志管理</strong></p>
<ul>
<li><code>systemd</code> <a href="/202211211437/" title="使用 &#96;journald&#96;">使用 &#96;journald&#96;</a> 来管理系统日志。你可以使用 <code>journalctl</code> 命令查看日志</li>
</ul>
</li>
<li><p><strong>服务间的依赖关系</strong></p>
<ul>
<li><code>systemd</code> 处理服务间的依赖关系。你可以通过 <code>After=</code>、<code>Before=</code>、<code>Requires=</code> 等指令在单元文件中定义这些依赖。</li>
</ul>
</li>
</ul>
<p><strong><code>systemd</code> 的优势：</strong></p>
<ul>
<li><strong>并行启动</strong>： <code>systemd</code> 可以并行启动服务，减少启动时间。</li>
<li><strong>依赖管理</strong> ： 能够自动处理服务间的依赖关系，保证系统按需启动服务。</li>
<li><strong>日志记录</strong> ： <code>systemd</code> 的日志管理功能强大，提供了统一的接口查看和分析日志。</li>
<li><strong>定时任务管理</strong> ： 通过 <code>timer</code> 单元文件可以灵活地配置定时任务，作为 <code>cron</code> 的替代方案。</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../20240822111015/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202306051707/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202306051707/" class="post-title-link" itemprop="url">Grafana 使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-05 17:07:23" itemprop="dateCreated datePublished" datetime="2023-06-05T17:07:23+08:00">2023-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-19 14:08:00" itemprop="dateModified" datetime="2024-08-19T14:08:00+08:00">2024-08-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Grafana 是一款用 GO 语言开发的开源数据可视化工具，可以做数据监控和数据统计，带有告警功能。</p>
<h1 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h1><h2 id="组织-Organization-与用户-User"><a href="#组织-Organization-与用户-User" class="headerlink" title="组织(Organization) 与用户(User)"></a>组织(Organization) 与用户(User)</h2><p><strong>Organization</strong> 相当于一个 Namespace，一个 Organization 完全独立于另一个 Organization，包括 <code>datasource</code>、<code>dashboard</code> 等，创建一个 Organization 就相当于打开了一个全新的视图，所有的 <code>datasource</code>、<code>dashboard</code> 等都需要重新创建。一个用户(User) 可以属于多个 Organization。</p>
<p><strong>User</strong> 是 Grafana 里面的用户，用户可以有以下 <strong>角色</strong></p>
<ul>
<li><code>admin</code> - 管理员权限，可以执行任何操作。</li>
<li><code>editor</code> - <em>p</em>不可以创建用户<strong>、</strong>不可以新增 <code>Datasource</code><strong>、</strong>可以创建 Dashboard**</li>
<li><code>viewer</code> - 仅可以查看 Dashboard</li>
<li><code>read only editor</code> - 允许用户修改 Dashboard，但是 <strong>不允许保存</strong></li>
</ul>
<h2 id="数据源-Datasource"><a href="#数据源-Datasource" class="headerlink" title="数据源 Datasource"></a>数据源 Datasource</h2><p>Grafana 中操作的数据集、可视化数据的来源</p>
<h2 id="Dashboard"><a href="#Dashboard" class="headerlink" title="Dashboard"></a>Dashboard</h2><p>在 Dashboard 页面中，可以组织可视化数据图表。</p>
<ul>
<li><code>Panel</code> - 在一个 Dashboard 中，Panel 是最基本的可视化单元。通过 Panel 的 <code>Query Editor</code> 可以为每一个 Panel 添加查询的数据源以及数据查询方式。每一个 Panel 都是独立的，可以选择一种或者多种数据源进行查询。<strong>一个 Panel 中可以有多个 <code>Query Editor</code> 来汇聚多个可视化数据集</strong></li>
<li><code>Row</code> - 在 Dashboard 中，可以定义一个 <code>Row</code>，来组织和管理一组相关的 <code>Panel</code></li>
</ul>
<h3 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h3><p>在 Dashboard 的设置页面中，有 <code>Variables</code> 页面，在其中可以为 Dashboard 配置变量，之后可以在 Panel 的 <code>Query Editor</code> 中使用这些预定义的变量。<strong>变量的值也可以是通过表达式获取的值</strong>。也可以在 <strong>Panel 的标题中使用变量</strong></p>
<p>例如以下 Variables 配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Node    label_values(kubernetes_io_hostname)</span><br></pre></td></tr></table></figure>

<p><img src="https://i.csms.tech/img_169.png"></p>
<p><img src="https://i.csms.tech/img_168.png"></p>
<p>在 Dashboard 中定义了这些变量后，可以在 Panel 的 <code>Query Editor</code> 中使用，在 <code>Query Editor</code> 中使用了 Variables 中定义的变量后，在 Dashboard 的顶部下拉菜单中可以选择预定义的变量的值（<strong>需要在定义 Variables 时配置 <code>Show on dashboard</code> 为 <code>Label and Value</code> 以使在 Dashboard 顶部显示下拉菜单</strong>），Panel 中的 <code>Query</code> 表达式就会使用这些变量的值进行计算以及显示图表。<br><img src="https://i.csms.tech/img_170.png"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202306051707/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202306161614/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202306161614/" class="post-title-link" itemprop="url">Python 错误集锦</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-16 10:25:08" itemprop="dateCreated datePublished" datetime="2023-06-16T10:25:08+08:00">2023-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-14 14:08:00" itemprop="dateModified" datetime="2024-08-14T14:08:00+08:00">2024-08-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Python 3.10.12</li>
</ul>
<h1 id="certificate-verify-failed-unable-to-get-local-issuer-certificate"><a href="#certificate-verify-failed-unable-to-get-local-issuer-certificate" class="headerlink" title="certificate verify failed: unable to get local issuer certificate"></a>certificate verify failed: unable to get local issuer certificate</h1><p>报错信息如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssl.SSLCertVerificationError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1007)</span><br><span class="line">...</span><br><span class="line">urllib.error.URLError: &lt;urlopen error [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1007)&gt;</span><br></pre></td></tr></table></figure>

<p><strong>问题原因</strong> ： 本地 CA 证书不存在</p>
<p><strong>解决方法</strong></p>
<ol>
<li>查看默认证书位置 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; import ssl</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; <span class="built_in">print</span>(ssl.get_default_verify_paths())</span></span><br><span class="line">DefaultVerifyPaths(cafile=None, capath=&#x27;/usr/local/openssl/ssl/certs&#x27;, openssl_cafile_env=&#x27;SSL_CERT_FILE&#x27;, openssl_cafile=&#x27;/usr/local/openssl/ssl/cert.pem&#x27;, openssl_capath_env=&#x27;SSL_CERT_DIR&#x27;, openssl_capath=&#x27;/usr/local/openssl/ssl/certs&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
根据输出内容，可以看到 Python 使用的 <code>openssl</code> 位于 <code>/usr/local/openssl/</code>，CA 证书路径为 <code>/usr/local/openssl/ssl/cert.pem</code>，检查 CA 证书路径，发现 CA 证书不存在 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> /usr/local/openssl/ssl/</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">certs  ct_log_list.cnf  ct_log_list.cnf.dist  misc  openssl.cnf  openssl.cnf.dist  private</span><br></pre></td></tr></table></figure></li>
<li>下载 CA 证书文件 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget http://curl.haxx.se/ca/cacert.pem --no-check-certificate</span><br><span class="line">mv cacert.pem cert.pem</span><br></pre></td></tr></table></figure>
下载 CA 证书文件后，重新尝试，SSl 连接正常。</li>
</ol>
<h1 id="can’t-start-new-thread"><a href="#can’t-start-new-thread" class="headerlink" title="can’t start new thread"></a>can’t start new thread</h1><h2 id="环境信息-1"><a href="#环境信息-1" class="headerlink" title="环境信息"></a>环境信息</h2><ul>
<li>Docker 1.13</li>
<li>Python3.9</li>
</ul>
<p>在 Docker 中运行 <code>python</code> 后，使用 <code>pip</code> 报错 <code>RuntimeError: can&#39;t start new thread</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pip install --upgrade pip</span></span><br><span class="line">Requirement already satisfied: pip in /usr/local/lib/python3.9/site-packages (23.0.1)</span><br><span class="line">Collecting pip</span><br><span class="line">  Downloading pip-23.2.1-py3-none-any.whl (2.1 MB)</span><br><span class="line">     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 0.0/2.1 MB ? eta -:--:--ERROR: Exception:</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/usr/local/lib/python3.9/site-packages/pip/_internal/cli/base_command.py&quot;, line 160, in exc_logging_wrapper</span><br><span class="line">    status = run_func(*args)</span><br><span class="line">  File &quot;/usr/local/lib/python3.9/site-packages/pip/_internal/cli/req_command.py&quot;, line 247, in wrapper</span><br><span class="line">    return func(self, options, args)</span><br><span class="line">  </span><br><span class="line">  ...</span><br><span class="line">  File &quot;/usr/local/lib/python3.9/site-packages/pip/_internal/operations/prepare.py&quot;, line 107, in get_http_url</span><br><span class="line">    from_path, content_type = download(link, temp_dir.path)</span><br><span class="line">  File &quot;/usr/local/lib/python3.9/site-packages/pip/_internal/network/download.py&quot;, line 147, in __call__</span><br><span class="line">    for chunk in chunks:</span><br><span class="line">  File &quot;/usr/local/lib/python3.9/site-packages/pip/_internal/cli/progress_bars.py&quot;, line 52, in _rich_progress_bar</span><br><span class="line">    with progress:</span><br><span class="line">  File &quot;/usr/local/lib/python3.9/site-packages/pip/_vendor/rich/progress.py&quot;, line 1169, in __enter__</span><br><span class="line">    self.start()</span><br><span class="line">  File &quot;/usr/local/lib/python3.9/site-packages/pip/_vendor/rich/progress.py&quot;, line 1160, in start</span><br><span class="line">    self.live.start(refresh=True)</span><br><span class="line">  File &quot;/usr/local/lib/python3.9/site-packages/pip/_vendor/rich/live.py&quot;, line 132, in start</span><br><span class="line">    self._refresh_thread.start()</span><br><span class="line">  File &quot;/usr/local/lib/python3.9/threading.py&quot;, line 899, in start</span><br><span class="line">    _start_new_thread(self._bootstrap, ())</span><br><span class="line">RuntimeError: can&#x27;t start new thread</span><br><span class="line"></span><br><span class="line">[notice] A new release of pip is available: 23.0.1 -&gt; 23.2.1</span><br><span class="line">[notice] To update, run: pip install --upgrade pip</span><br></pre></td></tr></table></figure>

<p><em><strong>问题原因</strong></em> Docker 版本太低，升级版本到 18.06 以上。<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/70087344/python-in-docker-runtimeerror-cant-start-new-thread">参考说明</a></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202306161614/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202307031141/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202307031141/" class="post-title-link" itemprop="url">Ubuntu 系列软件包管理命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-07-03 11:41:59" itemprop="dateCreated datePublished" datetime="2023-07-03T11:41:59+08:00">2023-07-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-14 11:08:00" itemprop="dateModified" datetime="2024-08-14T11:08:00+08:00">2024-08-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>在 Ubuntu 上安装软件包主要通过使用 <code>apt</code> 命令来完成。<code>apt</code> 是高级包装工具（Advanced Package Tool）的缩写，提供了一个易用的命令行界面，用于处理软件包的安装、更新和删除等操作。</p>
<h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Ubuntu 22</li>
</ul>
<h1 id="apt"><a href="#apt" class="headerlink" title="apt"></a>apt</h1><h2 id="查看软件包信息"><a href="#查看软件包信息" class="headerlink" title="查看软件包信息"></a>查看软件包信息</h2><ul>
<li><p>查看系统已安装的软件包</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt list --installed</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>apt list</code> 列出系统上所有可用的软件包，包括<strong>已安装的软件包</strong>和<strong>可供安装的软件包</strong></p>
</blockquote>
</li>
<li><p>列出特定的软件包</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt list &lt;package-name&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>搜索特定软件包是否已安装</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt list --installed  &lt;package-name&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>查看软件包的依赖关系</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt depends &lt;package_name&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="下载软件包"><a href="#下载软件包" class="headerlink" title="下载软件包"></a>下载软件包</h2><ul>
<li>下载软件包但不安装  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt download &lt;package_name&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="安装软件包"><a href="#安装软件包" class="headerlink" title="安装软件包"></a>安装软件包</h2><ul>
<li><p>更新软件包列表。在安装新软件包之前，最好先更新本地软件包列表，以确保你安装的是最新版本的软件包。</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure>
<p>此命令会从配置的源中检索新的软件包列表。</p>
</li>
<li><p>安装软件包。安装软件包的基本命令格式为：</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install &lt;package_name&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>安装特定版本的软件包</p>
<p>  如果你需要安装软件包的特定版本，可以通过指定版本号来完成安装。首先，使用 <code>apt policy</code> 命令查找可用版本</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt policy &lt;package_name&gt;</span><br></pre></td></tr></table></figure>
<p>  然后，安装特定版本的软件包</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install &lt;package_name&gt;=&lt;version&gt;</span><br><span class="line"></span><br><span class="line">sudo apt install nginx=1.18.0-0ubuntu1</span><br></pre></td></tr></table></figure></li>
<li><p>安装推荐的软件包。</p>
<p>  当安装某些软件包时，APT 可能会建议安装一些推荐的软件包以增强功能。<em><strong>默认情况下，<code>apt install</code> 命令会安装推荐的软件包。</strong></em> 如果你不想安装推荐的软件包，可以使用 <code>--no-install-recommends</code> 选项</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install --no-install-recommends &lt;package_name&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="卸载软件包"><a href="#卸载软件包" class="headerlink" title="卸载软件包"></a>卸载软件包</h2><ul>
<li><p>卸载软件包但保留配置文件</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt remove &lt;package_name&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>卸载软件包并删除配置文件。<strong>如果相关目录不为空，将不会删除，会输出提示</strong></p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt purge &lt;package_name&gt;</span><br></pre></td></tr></table></figure>
<p>或者</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt remove --purge &lt;package_name&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>清理未使用的依赖包</p>
<p>  当你卸载一个软件包时，它可能会留下一些不再需要的依赖软件包。为了清理这些不再使用的依赖，可以执行：</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt autoremove</span><br></pre></td></tr></table></figure>
<p>这个命令会检查并自动删除那些被安装为其他软件包依赖但现在不再被任何已安装软件包需要的软件包。</p>
</li>
</ul>
<h1 id="dpkg"><a href="#dpkg" class="headerlink" title="dpkg"></a>dpkg</h1><p>列出系统上已安装的软件包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dpkg -l</span><br></pre></td></tr></table></figure>

<p>查找文件所属的软件包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dpkg -S /path/to/file</span><br></pre></td></tr></table></figure>

<h1 id="APT-仓库管理"><a href="#APT-仓库管理" class="headerlink" title="APT 仓库管理"></a>APT 仓库管理</h1><p>APT 通过读取配置文件（主要是 <code>/etc/apt/sources.list</code> 和 <code>/etc/apt/sources.list.d/*.list</code>）来获取软件包仓库（repository）的信息。</p>
<p>APT 的软件源配置文件是 <code>/etc/apt/sources.list</code> ，此外还可以包含 <code>/etc/apt/sources.list.d/</code> 目录下的 <code>.list</code> 文件。这些文件定义了 APT 从哪里下载软件包和更新信息。</p>
<p>一个典型的 <code>sources.list</code> 条目格式如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deb [options] url distribution component1 component2 component3</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>deb</code>：表示这是一个二进制软件包的仓库，对应的 <code>deb-src</code> 表示源代码仓库。</li>
<li><code>options</code>：可选项，例如可以指定架构。</li>
<li><code>url</code>：仓库的 URL。</li>
<li><code>distribution</code>：发行版的代号，如 <code>focal</code>、<code>buster</code> 等。</li>
<li><code>component</code> ：仓库中的组成部分，如 <code>main</code>、<code>restricted</code> 等。</li>
</ul>
<h2 id="Repository-的类型"><a href="#Repository-的类型" class="headerlink" title="Repository 的类型"></a>Repository 的类型</h2><p>在 APT 的上下文中，软件包仓库是网络或本地的存储位置，它们存储了软件包及其元数据。主要有以下几种类型的仓库：</p>
<ul>
<li><code>Main</code>：官方支持的免费软件。</li>
<li><code>Universe</code>：社区维护的免费软件。</li>
<li><code>Restricted</code>：官方支持的非自由软件。</li>
<li><code>Multiverse</code>：非自由软件，不包括官方支持。</li>
</ul>
<h2 id="添加新的软件源"><a href="#添加新的软件源" class="headerlink" title="添加新的软件源"></a>添加新的软件源</h2><p>要添加新的软件源，你可以直接编辑 <code>sources.list</code> 文件或在 <code>sources.list.d/</code> 目录下创建一个新的 <code>.list</code> 文件。例如，添加一个新的 PPA（Personal Package Archive）：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:&lt;repository_name&gt;</span><br></pre></td></tr></table></figure>
<p>这个命令不仅会添加软件源，还会自动导入仓库的公钥，确保软件包的安全性。</p>
<h2 id="删除软件源"><a href="#删除软件源" class="headerlink" title="删除软件源"></a>删除软件源</h2><p>要删除软件源，可以直接编辑 <code>sources.list</code> 文件或删除 <code>sources.list.d/</code> 目录下相应的 <code>.list</code> 文件。之后，运行 <code>sudo apt update</code> 来更新软件包列表。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20240814105214/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../20240814105214/" class="post-title-link" itemprop="url">Linux  X Window System 和 Gnome</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-08-14 10:52:20 / 修改时间：10:52:25" itemprop="dateCreated datePublished" datetime="2024-08-14T10:52:20+08:00">2024-08-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Linux-X-Window-System"><a href="#Linux-X-Window-System" class="headerlink" title="Linux X Window System"></a>Linux X Window System</h1><p>早期的 Linux 桌面都是基于来自 X.Org Foundation(<a target="_blank" rel="noopener" href="http://www.x.org/">http://www.x.org</a>) 的 X Window System 的接口。一个 X.Org 的替代者是 Wayland (<a target="_blank" rel="noopener" href="http://wayland.freedesktop.org)./">http://wayland.freedesktop.org)。</a></p>
<p>X Window System（简称 X）在 Linux 之前就存在，甚至早于 Microsoft Windows,它是一个轻量的、基于网络的桌面框架。</p>
<p>X Window System 是一种 Client&#x2F;Server 模型。X Server 运行于本地操作系统中，为屏幕（Screen）、鼠标（Mouse）、键盘（Keyboard）提供对外的接口，X Client 可以在本地或者任何基于网络的远端系统上面运行。</p>
<p>X Server 本身只提供了一个简单的灰色背景和一个 X 型鼠标光标，没有菜单、面板、图标等，如果只是单纯的启动 X Client 展示 X Server 的内容，它展示的内容中不会包含 <strong>可以移动的边框、最大化、最小化按钮以及关闭窗口的按钮等</strong> ，这些特性是由 <strong>Window Manager</strong> 提供的。 </p>
<p><strong>Window Manager</strong> 添加了可以操作程序的很多特性，如菜单、边框、常用按钮等。</p>
<p>Linux 中常见的桌面环境包括：</p>
<ul>
<li>GNOME ： 最初是为了模仿 MacOS 桌面<ul>
<li>Gnome 2</li>
<li>Gnome 3 ： 完全和 Gnome 2 的设计思路和理念不同，是一个全新的版本</li>
</ul>
</li>
<li>K Desktop Environment （KDE） ： 模拟了 Microsoft Windows 桌面</li>
<li>Xfce ： 第一个轻量版的桌面环境，可以在系统资源（CPU,Mem）较少的环境中运行</li>
<li>LXDE ： The Lightweight X11 Desktop Environment. 是一个高性能、节能的桌面环境。</li>
</ul>
<h1 id="Gnome3-相关常用操作"><a href="#Gnome3-相关常用操作" class="headerlink" title="Gnome3 相关常用操作"></a>Gnome3 相关常用操作</h1><p>Gnome 3 提供了很多可用的插件来满足不同的需求，并提供了工具 <strong>Gnome Tweaks</strong> 用于调整 Gnome 的配置</p>
<p>Gnome Shell Extensions 可以控制 Gnome 桌面的外形和行为方式。GNOME Shell Extensions site (<a target="_blank" rel="noopener" href="http://extensions.gnome.org/">http://extensions.gnome.org</a>)</p>
<h2 id="查看-Gnome-版本"><a href="#查看-Gnome-版本" class="headerlink" title="查看 Gnome 版本"></a>查看 Gnome 版本</h2><h3 id="方法-1：通过设置查看"><a href="#方法-1：通过设置查看" class="headerlink" title="方法 1：通过设置查看"></a>方法 1：通过设置查看</h3><ol>
<li><p>打开 “设置”：</p>
<p> 点击屏幕左下角的 “显示应用程序” 按钮（或按 Super 键，也就是通常的 Windows 键）。<br> 输入 <code>Settings</code> 或 <code>设置</code>，然后点击出现的应用图标。<br> 查看 “关于” 信息：</p>
</li>
<li><p>在左侧面板中，向下滚动并选择 “关于”（About）。<br>在“关于”页面中，你会看到 GNOME 版本信息以及其他系统详细信息。</p>
</li>
</ol>
<h3 id="方法-2：通过终端查看"><a href="#方法-2：通过终端查看" class="headerlink" title="方法 2：通过终端查看"></a>方法 2：通过终端查看</h3><p>你也可以通过终端命令查看 GNOME 版本：</p>
<ol>
<li><p>打开终端：</p>
<p> 按 <code>Ctrl + Alt + T</code> 打开终端。</p>
</li>
<li><p>使用以下命令</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gnome-shell --version</span></span><br><span class="line">GNOME Shell 42.9</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="隐藏-Gnome-桌面顶部的工具栏"><a href="#隐藏-Gnome-桌面顶部的工具栏" class="headerlink" title="隐藏 Gnome 桌面顶部的工具栏"></a>隐藏 Gnome 桌面顶部的工具栏</h2><p><strong>版本信息</strong>：</p>
<ul>
<li>Ubuntu 22.04.4 LTS (Jammy Jellyfish)</li>
<li>Gnome Shell 42.9</li>
</ul>
<p>参考以下步骤：</p>
<ol>
<li>安装 <code> gnome-shell-extension-manager</code> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install gnome-shell-extension-manager</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>打开 Extension-Manager<br> <img src="https://i.csms.tech/img_259.png"></li>
<li>点击 <code>Browse</code>，搜索 <code>hidetopbar</code> 这个插件并安装（<strong>注意选择 <code>Downloads</code>!!，要不然搜不到插件</strong>）<br> <img src="https://i.csms.tech/img_260.png"></li>
</ol>
<p>安装好了 <code>hidetopbar</code> 这个插件之后，上方的任务栏&#x2F;状态栏 <strong>在窗口全屏时就会自动隐藏</strong>。<strong>按 <code>Super</code> 键或者窗口非全屏时会重新显示</strong></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../20240814105214/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202303071126/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="../../202303071126/" class="post-title-link" itemprop="url">python requests 使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-03-07 11:26:54" itemprop="dateCreated datePublished" datetime="2023-03-07T11:26:54+08:00">2023-03-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-08-05 15:27:46" itemprop="dateModified" datetime="2024-08-05T15:27:46+08:00">2024-08-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../../categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Python 3.11.2</li>
</ul>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install requests</span><br></pre></td></tr></table></figure>

<h1 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h1><h2 id="get-请求"><a href="#get-请求" class="headerlink" title="get 请求"></a>get 请求</h2><p><code>get</code> 请求及响应中常用的属性</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">&#x27;https://csms.tech&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(r)</span><br><span class="line">[..., <span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;cookies&#x27;</span>, <span class="string">&#x27;elapsed&#x27;</span>, <span class="string">&#x27;encoding&#x27;</span>, <span class="string">&#x27;headers&#x27;</span>, <span class="string">&#x27;history&#x27;</span>, </span><br><span class="line"><span class="string">&#x27;is_permanent_redirect&#x27;</span>, <span class="string">&#x27;is_redirect&#x27;</span>, <span class="string">&#x27;iter_content&#x27;</span>, <span class="string">&#x27;iter_lines&#x27;</span>, </span><br><span class="line"><span class="string">&#x27;json&#x27;</span>, <span class="string">&#x27;links&#x27;</span>, <span class="string">&#x27;next&#x27;</span>, <span class="string">&#x27;ok&#x27;</span>, <span class="string">&#x27;raise_for_status&#x27;</span>, <span class="string">&#x27;raw&#x27;</span>, <span class="string">&#x27;reason&#x27;</span>, </span><br><span class="line"><span class="string">&#x27;request&#x27;</span>, <span class="string">&#x27;status_code&#x27;</span>, <span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;url&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="带参数的-get-请求"><a href="#带参数的-get-请求" class="headerlink" title="带参数的 get 请求"></a>带参数的 get 请求</h3><p>要在 <code>get</code> 请求中携带请求参数，可以使用以下方法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">help</span>(requests.get)</span><br><span class="line">get(url, params=<span class="literal">None</span>, **kwargs)</span><br><span class="line">    Sends a GET request.</span><br><span class="line">    </span><br><span class="line">    :param url: URL <span class="keyword">for</span> the new :<span class="keyword">class</span>:`Request` <span class="built_in">object</span>.</span><br><span class="line">    :param params: (optional) Dictionary, <span class="built_in">list</span> of tuples <span class="keyword">or</span> <span class="built_in">bytes</span> to send</span><br><span class="line">        <span class="keyword">in</span> the query string <span class="keyword">for</span> the :<span class="keyword">class</span>:`Request`.</span><br><span class="line">    :param \*\*kwargs: <span class="type">Optional</span> arguments that ``request`` takes.</span><br><span class="line">    :<span class="keyword">return</span>: :<span class="keyword">class</span>:`Response &lt;Response&gt;` <span class="built_in">object</span></span><br><span class="line">    :rtype: requests.Response</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>params = &#123;<span class="string">&#x27;k1&#x27;</span>: <span class="string">&#x27;v1&#x27;</span>, <span class="string">&#x27;k2&#x27;</span>: <span class="string">&#x27;v2&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">&#x27;https://csms.tech&#x27;</span>, params=params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置请求头</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36&quot;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response = requests.get(<span class="string">&quot;https://csms.tech&quot;</span>, params = params, headers = headers)</span><br></pre></td></tr></table></figure>
<p><code>get</code> 方法本质上是通过创建了一个 <code>requests.Request</code> 对象，因此 <code>**kwargs</code> 可用的值可以通过查看 <code>requests.Request</code> 的帮助信息。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">help</span>(requests.Request)</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="../../202303071126/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="../../"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="page-number current">2</span><a class="page-number" href="../3/">3</a><span class="space">&hellip;</span><a class="page-number" href="../13/">13</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="../3/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">COSMOS</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.3" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="../../js/comments.js"></script><script src="../../js/utils.js"></script><script src="../../js/motion.js"></script><script src="../../js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="../../js/third-party/search/local-search.js"></script>




  <script src="../../js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"fl9999","repo":"fl9999.github.io","client_id":"a11bf6f7860762b725b5","client_secret":"a99046105f8bddc72ec718d54dc3fd7f22070821","admin_user":"fl9999","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d41d8cd98f00b204e9800998ecf8427e"}</script>
<script src="../../js/third-party/comments/gitalk.js"></script>

</body>
</html>
