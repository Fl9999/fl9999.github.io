<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16-next.png">
  <link rel="mask-icon" href="../images/logo.svg" color="#222">

<link rel="stylesheet" href="../css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"csms.tech","root":"/","images":"../images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"../search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="../js/config.js"></script>

    <meta name="description" content="环境信息 ansible-core 2.16 Docker image python:3.12.3  Ansible 安装部署参考    Ansible templates 使用介绍    Ansible Playbook 语法Playbooks 使用 YAML 语法定义（描述）。一个 playbook 由一个或多个 play 依序组成。每个 play 运行一个或多个 task，每个 task 也">
<meta property="og:type" content="article">
<meta property="og:title" content="Ansible playbooks 使用介绍">
<meta property="og:url" content="http://csms.tech/202405231459/index.html">
<meta property="og:site_name" content="L B T">
<meta property="og:description" content="环境信息 ansible-core 2.16 Docker image python:3.12.3  Ansible 安装部署参考    Ansible templates 使用介绍    Ansible Playbook 语法Playbooks 使用 YAML 语法定义（描述）。一个 playbook 由一个或多个 play 依序组成。每个 play 运行一个或多个 task，每个 task 也">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-05-23T06:59:10.000Z">
<meta property="article:modified_time" content="2025-02-12T01:02:00.000Z">
<meta property="article:author" content="COSMOS">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="ansible">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://csms.tech/202405231459/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://csms.tech/202405231459/","path":"202405231459/","title":"Ansible playbooks 使用介绍"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Ansible playbooks 使用介绍 | L B T</title>
  








  <noscript>
    <link rel="stylesheet" href="../css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">L B T</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记 录 过 去 的 经 验</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="../index.html" rel="section"><i class="fa fa-earth-americas fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="../categories/" rel="section"><i class="fa fa-folder-tree fa-fw"></i>总目录<span class="badge">51</span></a></li><li class="menu-item menu-item-linux"><a href="../categories/Linux" rel="section"><i class="fa fa-brands fa-linux fa-fw"></i>Linux</a></li><li class="menu-item menu-item-python"><a href="../categories/Python" rel="section"><i class="fa fa-brands fa-python fa-fw"></i>Python</a></li><li class="menu-item menu-item-docker"><a href="../categories/Docker" rel="section"><i class="fa fa-brands fa-docker fa-fw"></i>Docker</a></li><li class="menu-item menu-item-kubernetes"><a href="../categories/Kubernetes" rel="section"><i class="fa fa-dharmachakra fa-fw"></i>Kubernetes</a></li><li class="menu-item menu-item-tags"><a href="../tags/" rel="section"><i class="fa fa-tornado fa-fw"></i>标签<span class="badge">79</span></a></li><li class="menu-item menu-item-archives"><a href="../archives/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>列表<span class="badge">249</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章总目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF"><span class="nav-number">1.</span> <span class="nav-text">环境信息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible-Playbook-%E8%AF%AD%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">Ansible Playbook 语法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E6%9C%BA%E4%B8%8E%E7%94%A8%E6%88%B7"><span class="nav-number">2.1.</span> <span class="nav-text">主机与用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sudo-%E6%8F%90%E6%9D%83%E6%93%8D%E4%BD%9C"><span class="nav-number">2.2.</span> <span class="nav-text">sudo 提权操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#register"><span class="nav-number">2.3.</span> <span class="nav-text">register</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%98%E9%87%8F"><span class="nav-number">2.4.</span> <span class="nav-text">变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E7%A4%BA%E5%91%BD%E4%BB%A4%E6%88%96%E8%80%85%E6%A8%A1%E5%9D%97%E5%9C%A8%E6%9C%AC%E5%9C%B0%E8%BF%90%E8%A1%8C"><span class="nav-number">2.5.</span> <span class="nav-text">指示命令或者模块在本地运行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#module"><span class="nav-number">2.6.</span> <span class="nav-text">module</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#handlers"><span class="nav-number">2.7.</span> <span class="nav-text">handlers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#notify"><span class="nav-number">2.7.1.</span> <span class="nav-text">notify</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#when-%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.8.</span> <span class="nav-text">when 语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%95%E7%94%A8-Facts-%E5%8F%98%E9%87%8F%E5%80%BC"><span class="nav-number">2.9.</span> <span class="nav-text">引用 Facts 变量值</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ansible-playbook-%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83"><span class="nav-number">3.</span> <span class="nav-text">ansible playbook 常用模块参考</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#iptables"><span class="nav-number">3.1.</span> <span class="nav-text">iptables</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lineinfile"><span class="nav-number">3.2.</span> <span class="nav-text">lineinfile</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#playbook-%E7%A4%BA%E4%BE%8B"><span class="nav-number">4.</span> <span class="nav-text">playbook 示例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="nav-number">4.1.</span> <span class="nav-text">修改主机名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%87%E4%BB%BD%E7%9B%AE%E5%BD%95%E5%B9%B6%E5%88%A0%E9%99%A4"><span class="nav-number">4.2.</span> <span class="nav-text">备份目录并删除</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5-Nginx-%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">4.3.</span> <span class="nav-text">同步 Nginx 服务配置文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="nav-number">5.</span> <span class="nav-text">参考链接</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%84%9A%E6%B3%A8"><span class="nav-number">6.</span> <span class="nav-text">脚注</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">COSMOS</p>
  <div class="site-description" itemprop="description">得 能 莫 忘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="../archives/">
          <span class="site-state-item-count">249</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="../categories/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">目录</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="../tags/">
        <span class="site-state-item-count">79</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202405231459/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Ansible playbooks 使用介绍 | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Ansible playbooks 使用介绍
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-05-23 14:59:10" itemprop="dateCreated datePublished" datetime="2024-05-23T14:59:10+08:00">2024-05-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-02-12 09:02:00" itemprop="dateModified" datetime="2025-02-12T09:02:00+08:00">2025-02-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>ansible-core 2.16</li>
<li>Docker image python:3.12.3</li>
</ul>
<a href="/202308311109/" title="Ansible 安装部署参考">Ansible 安装部署参考</a>  

<a href="/202405241042/" title="Ansible templates 使用介绍">Ansible templates 使用介绍</a>  

<h1 id="Ansible-Playbook-语法"><a href="#Ansible-Playbook-语法" class="headerlink" title="Ansible Playbook 语法"></a>Ansible Playbook 语法</h1><p>Playbooks 使用 YAML 语法定义（描述）。一个 <code>playbook</code> 由一个或多个 <code>play</code> 依序组成。每个 <code>play</code> 运行一个或多个 <code>task</code>，每个 <code>task</code> 也称为一个 <code>module</code></p>
<p>每一个 <code>play</code> 中包含了一个 <code>tasks</code> 列表，<code>tasks</code> 列表中的每个 <code>task</code> 在其对应的 <code>hosts</code> 上 <em><strong>依次执行</strong></em>。<strong>即一个 <code>task</code> 执行完毕，下一个 <code>task</code> 才会执行</strong>。</p>
<p>在运行 playbook 的过程中，<strong>如果一个 <code>host</code> 执行 <code>task</code> 失败，这个 <code>host</code> 将从整个 playbook 中移除</strong>。如果发生执行失败的情况，需要修正 <code>playbook</code> 中的错误，重新执行。</p>
<p>Ansible playbook 示例：</p>
<figure class="highlight shell"><figcaption><span>playbook.yml</span></figcaption><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">- name: Update web servers</span><br><span class="line">  hosts: webservers</span><br><span class="line">  remote_user: root</span><br><span class="line"></span><br><span class="line">  tasks:</span><br><span class="line">  - name: Ensure apache is at the latest version</span><br><span class="line">    ansible.builtin.yum:</span><br><span class="line">      name: httpd</span><br><span class="line">      state: latest</span><br><span class="line"></span><br><span class="line">  - name: Write the apache config file</span><br><span class="line">    ansible.builtin.template:</span><br><span class="line">      src: /srv/httpd.j2</span><br><span class="line">      dest: /etc/httpd.conf</span><br><span class="line"></span><br><span class="line">- name: Update db servers</span><br><span class="line">  hosts: databases</span><br><span class="line">  remote_user: root</span><br><span class="line">  vars:</span><br><span class="line">    port: 8080</span><br><span class="line"></span><br><span class="line">  tasks:</span><br><span class="line">  - name: Ensure postgresql is at the latest version</span><br><span class="line">    ansible.builtin.yum:</span><br><span class="line">      name: postgresql</span><br><span class="line">      state: latest</span><br><span class="line"></span><br><span class="line">  - name: Ensure that postgresql is started</span><br><span class="line">    ansible.builtin.service:</span><br><span class="line">      name: postgresql</span><br><span class="line">      state: started</span><br><span class="line">      </span><br><span class="line">---</span><br><span class="line">- name: Install multiple packages</span><br><span class="line">  hosts: webservers</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Install packages</span><br><span class="line">      apt:</span><br><span class="line">        name: &quot;&#123;&#123; item &#125;&#125;&quot;</span><br><span class="line">        state: present</span><br><span class="line">      loop:</span><br><span class="line">        - nginx</span><br><span class="line">        - git</span><br><span class="line">        - curl      </span><br></pre></td></tr></table></figure>

<p>一个 Ansible playbook 由一个或多个 <code>plays</code> 组成，每个 <code>play</code> 包含以下部分：</p>
<ul>
<li><code>name</code> : 描述性的名称</li>
<li><code>hosts</code> : 指定目标主机</li>
<li><code>become</code> : 提升权限（默认是使用 <code>sudo</code> 提升到 <code>root</code> 用户）</li>
<li><code>remote_user</code> : 用于连接到远程主机的账户。(<strong>如果 Inventory 中定义了远程连接的用户，会覆盖此处的配置</strong>)</li>
<li><code>tasks</code> : 要执行的一系列任务列表</li>
<li><code>vars</code> : 用于定义变量，便于管理和重用</li>
<li><code>gather_facts</code> : 收集 <code>Facts</code>， 默认值为 <code>yes</code></li>
</ul>
<p><code>tasks</code> 是一个任务列表，每个任务执行特定的操作。任务包含以下元素：</p>
<ul>
<li><code>name</code> : 描述任务的目的。</li>
<li><code>module_name</code> : Ansible 模块名称，如 <code>apt</code>、<code>service</code> 等。</li>
<li><code>module_options</code> : 模块的参数，以键值对的形式提供。</li>
<li><code>when</code> : 条件语句，控制任务是否执行。</li>
<li><code>loop</code> : 循环执行任务</li>
</ul>
<p>执行以下命令运行 <code>playbook.yml</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ansible-playbook playbook.yml -f 10</span><br></pre></td></tr></table></figure>

<p>常用选项说明</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-f</code><br/><code>--forks</code></td>
<td>指定并发执行的数量，默认为 5</td>
<td></td>
</tr>
<tr>
<td><code>-v</code><br/><code>--verbose</code> <br/><code>-vvvvvv</code></td>
<td>打印 debug 信息，详细程度从 <code>-v</code> 到 <code>-vvvvvv</code></td>
<td></td>
</tr>
<tr>
<td><code>-C</code><br/><code>--check</code></td>
<td><code>Check mode</code>，不执行任何实际操作，而是对要执行的操作进行验证</td>
<td></td>
</tr>
<tr>
<td><code>-D</code><br/><code>--diff</code></td>
<td>- <strong>只使用 <code>--diff</code> 会执行 play 定义的实际操作</strong>，并对所有受影响的文件或者模板显示其变更前后的具体差异<br/>- <strong>和 <code>--check</code> 一起使用，不会执行 play 定义的实际操作，只显示变更前后的差异</strong>，可以在实际执行前，调试&#x2F;预览将要进行的变更，防止意外配置变更或文件修改<br/>主要用于文件或者模板的变更，对于其他类型的任务（如包安装、服务管理、修改主机名等），不会显示具体的差异（ <strong>配合 <code>--check</code> 使用时，结果会显示为 <code>skipping</code>，实际执行时结果为 <code>changed</code></strong> ）。</td>
<td></td>
</tr>
<tr>
<td><code>--list-hosts</code></td>
<td>不执行任何实际操作，只列出符合 <code>pattern</code> 的目标主机</td>
<td></td>
</tr>
<tr>
<td><code>--list-tasks</code></td>
<td>不执行任何实际操作，只列出将要执行的 <code>task</code></td>
<td></td>
</tr>
<tr>
<td><code>--syntax-check</code></td>
<td>不执行任何实际操作，只检查 playbook 文件是否有语法错误</td>
<td></td>
</tr>
</tbody></table>
<span id="more"></span>

<h2 id="主机与用户"><a href="#主机与用户" class="headerlink" title="主机与用户"></a>主机与用户</h2><p><code>play</code> 中一般都需要选择要操作的目标主机，也可能需要指明以哪个用户身份来执行 <code>tasks</code></p>
<ul>
<li><code>hosts</code> 一个或多个组或主机的 patterns，以 <code>,</code> 分割</li>
<li><code>remote_user</code> 用户名。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: webservers</span><br><span class="line">  remote_user: root</span><br></pre></td></tr></table></figure>

<p>在每一个 <code>task</code> 中，也可以定义自己的远程账号</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">- hosts: webservers</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - name: test connection</span><br><span class="line">      ping:</span><br><span class="line">      remote_user: user1</span><br></pre></td></tr></table></figure>

<h2 id="sudo-提权操作"><a href="#sudo-提权操作" class="headerlink" title="sudo 提权操作"></a>sudo 提权操作</h2><p>在需要提权操作的场景下，需要切换到更高权限的用户，可以使用 <code>become</code> 指令。<code>become</code> 可以在全局（<code>play</code>）级别使用或者 <code>task</code> 级别使用。</p>
<p>如果要提权到其他用户而非 <code>root</code>，可以使用指令 <code>become_user</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: master-nodes</span><br><span class="line">  become: yes</span><br><span class="line">  tasks:</span><br><span class="line">    - name: ping</span><br><span class="line">      ping:</span><br><span class="line">     </span><br><span class="line">    - name: cat authorize</span><br><span class="line">      command: cat /root/.ssh/authorized_keys</span><br><span class="line">      become: yes</span><br><span class="line">      become_user: centos</span><br></pre></td></tr></table></figure>

<h2 id="register"><a href="#register" class="headerlink" title="register"></a>register</h2><p>在 Ansible 中，register 用于捕获任务执行的输出，并存储在一个变量中，以便后续任务使用。假设你的任务如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tasks:</span><br><span class="line">  - name: Fetch remote file list with MD5</span><br><span class="line">    shell: |</span><br><span class="line">      find &#123;&#123; remote_dir &#125;&#125; -type f -exec md5sum &#123;&#125; + | sed &quot;s|&#123;&#123; remote_dir &#125;&#125;||&quot;</span><br><span class="line">    register: remote_file_list</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这表示：</p>
<ol>
<li><strong>执行 <code>find &#123;&#123; remote_dir &#125;&#125; -type f -exec md5sum &#123;&#125; + | sed &quot;s|&#123;&#123; remote_dir &#125;&#125;||&quot;</code> 命令</strong> 在远程主机上获取目录下的文件列表以及其 md5 值。</li>
<li><strong>使用 <code>register</code> 关键字</strong> 把命令的执行结果存储到 <code>remote_file_list</code> 变量中。</li>
</ol>
<p><strong><code>register</code> 变量是一个字典（dict）</strong> ，其主要字段包括：</p>
<ul>
<li><strong>stdout</strong> ： 标准输出（命令执行的结果）</li>
<li><strong>stderr</strong> ： 标准错误输出</li>
<li><strong>rc</strong> ： 返回码（0 表示成功）</li>
<li><strong>stdout_lines</strong> ： 标准输出的列表格式（按行拆分）</li>
<li><strong>stderr_lines</strong> ： 标准错误输出的列表格式（按行拆分）</li>
</ul>
<p>可以使用 <code>debug</code> 模块调试变量值</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">- debug:</span><br><span class="line">    msg: &quot;远程文件列表: &#123;&#123; remote_file_list.stdout_lines &#125;&#125;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>在 <code>task</code> 中可以使用变量。假设在 <code>vars</code> 那里定义了变量，可以这样使用它:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">- hosts: webservers</span><br><span class="line">  vars:</span><br><span class="line">    http_port: 80</span><br><span class="line">    max_clients: 200</span><br><span class="line">  tasks:</span><br><span class="line">    - name: create a web for port &#123;&#123; http_port &#125;&#125;</span><br><span class="line">      template: src=somefile.j2 dest=/etc/httpd/conf.d/&#123;&#123; http_port &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>playbook 执行之前，默认会执行 <code>setup</code> 收集目标主机的 <code>facts</code> 信息，这是 <code>play</code> 中默认的第一个 <code>task</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ansible-playbook test.yml</span> </span><br><span class="line"></span><br><span class="line">PLAY [k8s-master-nodes] ******************************************************************************************************************</span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts] **************************************************************************************************************************</span><br><span class="line"></span><br><span class="line">ok: [k8s-master1]</span><br><span class="line"></span><br><span class="line">ok: [k8s-master3]</span><br><span class="line"></span><br><span class="line">ok: [k8s-master2]</span><br></pre></td></tr></table></figure>

<p>playbook 中的 <code>task</code> 可以使用 <code>facts</code> 中的变量的值</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ansible k8s-master-nodes[0] -m setup -a <span class="string">&quot;filter=ansible_distribution&quot;</span></span></span><br><span class="line"></span><br><span class="line">k8s-master1 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;ansible_distribution&quot;: &quot;CentOS Linux&quot;, </span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: false</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> test.yml</span></span><br><span class="line">---</span><br><span class="line">- hosts: k8s-master-nodes</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">become: <span class="built_in">yes</span></span></span><br><span class="line">  tasks:</span><br><span class="line">    - name: ping</span><br><span class="line">      ping:</span><br><span class="line">     </span><br><span class="line">    - name: test os distribution</span><br><span class="line">      debug:</span><br><span class="line">        msg: &quot;This is Centos&quot;</span><br><span class="line">      when: ansible_distribution == &quot;CentOS Linux&quot;</span><br><span class="line">	  </span><br><span class="line">	  </span><br><span class="line">	  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ansible-playbook test.yml</span> </span><br><span class="line"></span><br><span class="line">PLAY [k8s-master-nodes] ******************************************************************************************************************</span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts] **************************************************************************************************************************</span><br><span class="line"></span><br><span class="line">ok: [k8s-master1]</span><br><span class="line"></span><br><span class="line">ok: [k8s-master3]</span><br><span class="line"></span><br><span class="line">ok: [k8s-master2]</span><br><span class="line"></span><br><span class="line">TASK [ping] *************************************************************************************************************************************</span><br><span class="line">ok: [k8s-master2]</span><br><span class="line">ok: [k8s-master1]</span><br><span class="line">ok: [k8s-master3]</span><br><span class="line"></span><br><span class="line">TASK [test os distribution] *********************************************************************************************************************</span><br><span class="line">ok: [k8s-master1] =&gt; &#123;</span><br><span class="line">    &quot;msg&quot;: &quot;This is Centos&quot;</span><br><span class="line">&#125;</span><br><span class="line">ok: [k8s-master2] =&gt; &#123;</span><br><span class="line">    &quot;msg&quot;: &quot;This is Centos&quot;</span><br><span class="line">&#125;</span><br><span class="line">ok: [k8s-master3] =&gt; &#123;</span><br><span class="line">    &quot;msg&quot;: &quot;This is Centos&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PLAY RECAP **************************************************************************************************************************************</span><br><span class="line">k8s-master1            : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br><span class="line">k8s-master2            : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br><span class="line">k8s-master3            : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0	  </span><br></pre></td></tr></table></figure>

<h2 id="指示命令或者模块在本地运行"><a href="#指示命令或者模块在本地运行" class="headerlink" title="指示命令或者模块在本地运行"></a>指示命令或者模块在本地运行</h2><p>在很多场景中，Ansible Playbook 中的某个任务需要在本地主机运行，而不是在远处主机上执行，要达到此目的，可以参考以下方法</p>
<ul>
<li><strong>local_action</strong> 。 <code>local_action</code> 是 Ansible 任务（Task）中的一个特殊关键字，它用于 <strong>在控制节点（localhost）</strong> 执行任务，而 <strong>不是在远程主机上执行</strong> 。通常，Ansible 任务默认是在 <code>hosts</code> 指定的远程主机上执行，但 <code>local_action</code> 让任务强制在本地执行，相当于 <code>delegate_to: localhost</code> 的简写。<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">- name: 将远程文件列表写入本地文件</span><br><span class="line">  local_action:</span><br><span class="line">    module: copy</span><br><span class="line">    content: &quot;&#123;&#123; remote_file_list.stdout_lines | join(&#x27;\n&#x27;) &#125;&#125;&quot;</span><br><span class="line">    dest: &quot;./remote_files.txt&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<code>local_action</code> 基本语法<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">- name: 在本地执行任务</span><br><span class="line">  local_action:</span><br><span class="line">    module: &lt;模块名&gt;</span><br><span class="line">    参数1: 值1</span><br><span class="line">    参数2: 值2</span><br></pre></td></tr></table></figure>
等效于：<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">- name: 在本地执行任务</span><br><span class="line">  action: &lt;模块名&gt; 参数1=值1 参数2=值2</span><br><span class="line">  delegate_to: localhost</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>delegate_to</strong> 指令。 <code>delegate_to: localhost</code> <strong>让任务在本地控制节点（localhost）执行，而不是远程主机</strong> 。<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">- name: 将远程文件列表写入本地文件</span><br><span class="line">  copy:</span><br><span class="line">    content: &quot;&#123;&#123; remote_file_list.stdout_lines | join(&#x27;\n&#x27;) &#125;&#125;&quot;</span><br><span class="line">    dest: &quot;./remote_files.txt&quot;</span><br><span class="line">  delegate_to: localhost</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="module"><a href="#module" class="headerlink" title="module"></a>module</h2><p><code>palybook</code> 中的每个 <code>task</code> 都是为了运行某个 <code>module</code>。在 <code>task</code> 中配置 <code>module</code>，是以 <code>module: options</code> 的格式</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">- hosts: webservers</span><br><span class="line">  tasks:</span><br><span class="line">    - name: test connection</span><br><span class="line">      ping:</span><br><span class="line">    - name: make sure apache is running</span><br><span class="line">      service: name=httpd state=running</span><br><span class="line">    - name: disable selinux</span><br><span class="line">      shell: setenforce 0</span><br></pre></td></tr></table></figure>

<h2 id="handlers"><a href="#handlers" class="headerlink" title="handlers"></a>handlers</h2><p><code>handlers</code> 中定义了在发生改动时执行的操作。</p>
<p>Handlers 也是一些 <code>task</code> 的列表，通过名字来引用，它们和一般的 <code>task</code> 并没有什么区别。Handlers 是由通知者进行 <code>notify</code>， 如果没有被 <code>notify</code>，handlers 不会执行。不管有多少个通知者进行了 <code>notify</code>，等到 play 中的所有 <code>task</code> 执行完成之后,handlers 也只会被执行一次。</p>
<p><em><strong>handlers 会按照声明的顺序执行</strong></em></p>
<p><strong>Handlers 最佳的应用场景是用来重启服务，或者触发系统重启操作</strong></p>
<h3 id="notify"><a href="#notify" class="headerlink" title="notify"></a>notify</h3><p>（当发生改动时）<code>notify</code> actions 会在 playbook 的每一个 <code>task</code> 结束时被触发，而且即使有多个不同的 <code>task</code> 通知改动的发生, <code>notify</code> actions 只会被触发一次。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">- name: template configuration file</span><br><span class="line">  template: src=template.j2 dest=/etc/foo.conf</span><br><span class="line">  notify:</span><br><span class="line">     - restart memcached</span><br><span class="line">     - restart apache</span><br></pre></td></tr></table></figure>




<h2 id="when-语句"><a href="#when-语句" class="headerlink" title="when 语句"></a>when 语句</h2><p>在 Ansible playbook 中，<code>when</code> 关键字用于条件执行任务。它允许你根据特定的条件来决定是否执行某个任务。这个功能非常强大，可以帮助你在不同的主机、不同的环境或不同的配置下灵活地执行任务。</p>
<p><code>when</code> 表达式基于 Jinja2 模板语言，其中的变量主要来自： <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Where to set variables](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_variables.html#where-to-set-variables)">[1]</span></a></sup></p>
<ul>
<li><code>inventory</code> 定义的 <a href="https://csms.tech/202308311109/#变量">主机变量或者组变量</a></li>
<li>目标主机的 <code>facts</code> </li>
<li>Playbook 中定义的变量</li>
<li>Playbook 中使用 <code>register</code> 注册的变量 <sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Registering variables](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_variables.html#registering-variables)">[3]</span></a></sup></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_variables.html#where-to-set-variables"><strong>变量优先级</strong> 参考说明</a></p>
<p><strong><code>when</code> 关键字后面跟随一个条件表达式，当条件为真时，任务会执行；当条件为假时，任务会被跳过。</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tasks:</span><br><span class="line">  - name: Install nginx on Debian</span><br><span class="line">    apt:</span><br><span class="line">      name: nginx</span><br><span class="line">      state: present</span><br><span class="line">    when: ansible_facts[&#x27;os_family&#x27;] == &#x27;Debian&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>when</code> 关键字支持多种表达式，包括：</p>
<ul>
<li><p><strong>简单条件</strong>：</p>
<ul>
<li><p><strong>基于变量</strong> 的条件：<code>when: variable == &#39;value&#39;</code></p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- name: Install nginx only if nginx_install is true</span><br><span class="line">  apt:</span><br><span class="line">    name: nginx</span><br><span class="line">    state: present</span><br><span class="line">  when: nginx_install</span><br></pre></td></tr></table></figure>
<p>  在这个示例中，<code>nginx_install</code> 是一个布尔变量。当 <code>nginx_install</code> 为真时，任务将执行。</p>
</li>
<li><p><strong>基于事实(facts)</strong> 的条件：<code>when: ansible_facts[&#39;os_family&#39;] == &#39;Debian&#39;</code></p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- name: Install nginx on Debian systems</span><br><span class="line">  apt:</span><br><span class="line">    name: nginx</span><br><span class="line">    state: present</span><br><span class="line">  when: ansible_facts[&#x27;os_family&#x27;] == &#x27;Debian&#x27;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>逻辑操作</strong>：</p>
<ul>
<li><strong>与操作</strong>： <code>when: condition1 and condition2</code>    <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- name: Install nginx on Debian systems</span><br><span class="line">  apt:</span><br><span class="line">    name: nginx</span><br><span class="line">    state: present</span><br><span class="line">  when: ansible_facts[&#x27;os_family&#x27;] == &#x27;Debian&#x27; or ansible_facts[&#x27;os_family&#x27;] == &#x27;Ubuntu&#x27;</span><br></pre></td></tr></table></figure>
当使用多个条件时，也先当于 <code>and</code> 操作<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tasks:</span><br><span class="line">  - name: Shut down CentOS 6 systems</span><br><span class="line">    ansible.builtin.command: /sbin/shutdown -t now</span><br><span class="line">    when:</span><br><span class="line">      - ansible_facts[&#x27;distribution&#x27;] == &quot;CentOS&quot;</span><br><span class="line">      - ansible_facts[&#x27;distribution_major_version&#x27;] == &quot;6&quot;</span><br></pre></td></tr></table></figure></li>
<li><strong>或操作</strong>：<code>when: condition1 or condition2</code></li>
<li><strong>非操作</strong>：<code>when: not condition</code></li>
</ul>
</li>
<li><p><strong>列表和字典操作</strong>：</p>
<ul>
<li><strong>列表包含</strong>：<code>when: &#39;item&#39; in mylist</code><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- name: Ensure package is installed if it is in the list</span><br><span class="line">  apt:</span><br><span class="line">    name: &quot;&#123;&#123; item &#125;&#125;&quot;</span><br><span class="line">    state: present</span><br><span class="line">  loop:</span><br><span class="line">    - nginx</span><br><span class="line">    - git</span><br><span class="line">  when: item in packages_to_install</span><br></pre></td></tr></table></figure></li>
<li><strong>字典键存在</strong>：<code>when: &#39;key&#39; in mydict</code><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- name: Run only if the key &#x27;run_task&#x27; is present in mydict and its value is true</span><br><span class="line">  debug:</span><br><span class="line">    msg: &quot;Running task&quot;</span><br><span class="line">  when: mydict.get(&#x27;run_task&#x27;, False)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
这个任务仅在 <code>mydict</code> 中存在键 <code>run_task</code> 且其值为真时执行。<blockquote>
<p><code>when: mydict.get(&#39;run_task&#39;, False)</code> 中 <code>False</code> 为默认值，如果 <code>mydict</code> 字典中不存在 <code>run_task</code> 键，<code>mydict.get(&#39;run_task&#39;, False)</code> 将返回 <code>False</code>。这种用法确保了在键不存在时，条件判断不会抛出错误。</p>
</blockquote>
</li>
</ul>
</li>
<li><p><strong>复杂条件</strong>：</p>
<ul>
<li><strong>组合多个条件</strong>：<code>when: (condition1 and condition2) or condition3</code></li>
</ul>
</li>
</ul>
<p>以下是一个完整的示例</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">- name: Example playbook using when conditions</span><br><span class="line">  hosts: all</span><br><span class="line">  become: yes</span><br><span class="line"></span><br><span class="line">  vars:</span><br><span class="line">    nginx_install: true</span><br><span class="line">    packages_to_install:</span><br><span class="line">      - nginx</span><br><span class="line">      - git</span><br><span class="line">    mydict:</span><br><span class="line">      run_task: true</span><br><span class="line"></span><br><span class="line">  tasks:</span><br><span class="line">    - name: Install nginx only if nginx_install is true</span><br><span class="line">      apt:</span><br><span class="line">        name: nginx</span><br><span class="line">        state: present</span><br><span class="line">      when: nginx_install</span><br><span class="line"></span><br><span class="line">    - name: Install nginx on Debian or Ubuntu</span><br><span class="line">      apt:</span><br><span class="line">        name: nginx</span><br><span class="line">        state: present</span><br><span class="line">      when: ansible_facts[&#x27;os_family&#x27;] == &#x27;Debian&#x27; or ansible_facts[&#x27;os_family&#x27;] == &#x27;Ubuntu&#x27;</span><br><span class="line"></span><br><span class="line">    - name: Ensure package is installed if it is in the list</span><br><span class="line">      apt:</span><br><span class="line">        name: &quot;&#123;&#123; item &#125;&#125;&quot;</span><br><span class="line">        state: present</span><br><span class="line">      loop: &quot;&#123;&#123; packages_to_install &#125;&#125;&quot;</span><br><span class="line">      when: item in packages_to_install</span><br><span class="line"></span><br><span class="line">    - name: Run only if the key &#x27;run_task&#x27; is present in mydict and its value is true</span><br><span class="line">      debug:</span><br><span class="line">        msg: &quot;Running task&quot;</span><br><span class="line">      when: mydict.get(&#x27;run_task&#x27;, False)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="引用-Facts-变量值"><a href="#引用-Facts-变量值" class="headerlink" title="引用 Facts 变量值"></a>引用 Facts 变量值</h2><p>Ansible-playbook 运行过程中，默认会收集目标主机的 Facts 信息。可以在 Playbook 定义中引用这些值 <sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Discovering variables: facts and magic variables](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_vars_facts.html)">[2]</span></a></sup></p>
<p>原始的 <code>facts</code> 信息可以通过 <code>setup</code> 模块获取</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ansible &lt;hostname&gt; -m ansible.builtin.setup</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ansible all[0] -m setup -a <span class="string">&#x27;filter=*hostname*&#x27;</span></span></span><br><span class="line">172.31.2.13 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;ansible_hostname&quot;: &quot;nginx1&quot;,</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: false</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>要在 <code>playbook</code> 或者 <code>template</code> 中引用，可以参考以下方法：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;&#123; ansible_facts[&#x27;devices&#x27;][&#x27;xvda&#x27;][&#x27;model&#x27;] &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; ansible_facts[&#x27;hostname&#x27;] &#125;&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>需要注意在 Playbook 引用 Facts 变量时，变量前缀无需 <code>ansible_</code> ，否则会找不到变量</p>
</blockquote>
<h1 id="ansible-playbook-常用模块参考"><a href="#ansible-playbook-常用模块参考" class="headerlink" title="ansible playbook 常用模块参考"></a>ansible playbook 常用模块参考</h1><h2 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h2><p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/iptables_module.html">ansible iptables 模块官方文档</a></p>
<ul>
<li><code>iptables</code> 模块用于配置 Linux iptables 防火墙 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Where to set variables](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_variables.html#where-to-set-variables)">[1]</span></a></sup></li>
<li><em><strong><code>iptables</code> 模块只修改当前系统生效的 <code>iptables</code> 规则（动态），不会将规则写入 <code>iptables</code> 服务的配置文件以实现静态（持久）配置，它的行为和 <code>iptables</code> 命令相同</strong></em></li>
</ul>
<p><code>iptables</code> 模块参数参考 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Where to set variables](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_variables.html#where-to-set-variables)">[1]</span></a></sup></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>action </code></td>
<td>rule 是被 append 到最后还是插入到最前面。<br/><strong>默认 <code>append</code></strong><br/>如果 rule 已经存在，不会做变更</td>
<td></td>
</tr>
<tr>
<td><code>chain</code></td>
<td>要操作的 chain。<br/>可以是自定义的 chain 或者默认存在的 chain 如 <code>INPUT</code>, <code>FORWARD</code>, <code>OUTPUT</code>, <code>PREROUTING</code>, <code>POSTROUTING</code>, <code>SECMARK</code> or <code>CONNSECMARK</code></td>
<td></td>
</tr>
<tr>
<td><code>table </code></td>
<td>This option specifies the packet matching table which the command should operate on</td>
<td></td>
</tr>
<tr>
<td><code>chain_management </code></td>
<td>If <code>true</code> and <code>state</code> is <code>present</code>, the chain will be created if needed. <br/>If <code>true</code> and <code>state</code> is <code>absent</code>, the chain will be deleted if the only other parameter passed are <code>chain</code> and optionally <code>table</code>. 默认为 <code>false</code></td>
<td></td>
</tr>
<tr>
<td><code>comment </code></td>
<td>规则的注释说明</td>
<td></td>
</tr>
<tr>
<td><code>ctstate </code><br/><code>list / elements=string</code></td>
<td>A list of the connection states to match in the conntrack module.<br/>Possible values are <code>INVALID</code>, <code>NEW</code>, <code>ESTABLISHED</code>, <code>RELATED</code>, <code>UNTRACKED</code>, <code>SNAT</code>, <code>DNAT</code>.<br/>Default: <code>[]</code></td>
<td></td>
</tr>
<tr>
<td><code>source </code></td>
<td>Source specification</td>
<td></td>
</tr>
<tr>
<td><code>destination</code> <br/><code>string</code></td>
<td>Destination specification.<br/>Address can be either a network name, a hostname, a network IP address (with &#x2F;mask), or a plain IP address.<br/>Hostnames will be resolved once only, before the rule is submitted to the kernel. Please note that specifying any name to be resolved with a remote query such as DNS is a really bad idea.<br/>The mask can be either a network mask or a plain number, specifying the number of 1’s at the left side of the network mask. Thus, a mask of 24 is equivalent to 255.255.255.0. A ! argument before the address specification inverts the sense of the address.</td>
<td></td>
</tr>
<tr>
<td><code>destination_port </code><br/><code>string</code></td>
<td>Destination port or port range specification</td>
<td></td>
</tr>
<tr>
<td><code>destination_ports </code><br/><code>list / elements=string</code></td>
<td>This specifies multiple destination port numbers or port ranges to match in the <code>multiport</code> module</td>
<td></td>
</tr>
<tr>
<td><code>dst_range </code><br/><code>string</code></td>
<td>Specifies the destination IP range to match in the iprange module.</td>
<td></td>
</tr>
<tr>
<td><code>source_port </code></td>
<td>Source port or port range specification.</td>
<td></td>
</tr>
<tr>
<td><code>flush</code><br/><code>boolean</code></td>
<td>Flushes the specified <code>table</code> and <code>chain</code> of all rules.<br/>If no <code>chain</code> is specified then the <strong>entire table is purged</strong>.<br/>       默认值 <code>false</code></td>
<td></td>
</tr>
<tr>
<td><code>jump </code></td>
<td>This specifies the target of the rule</td>
<td></td>
</tr>
<tr>
<td><code>protocol </code></td>
<td>The protocol of the rule or of the packet to check.<br/>The specified protocol can be one of <code>tcp</code>, <code>udp</code>, <code>udplite</code>, <code>icmp</code>, <code>ipv6-icmp</code> or <code>icmpv6</code>, <code>esp</code>, <code>ah</code>, <code>sctp</code> or the special keyword <code>all</code></td>
<td></td>
</tr>
<tr>
<td><code>rule_num </code></td>
<td>Insert the rule as the given rule number.<br/>This works only with <code>action=insert</code>.</td>
<td></td>
</tr>
</tbody></table>
<h2 id="lineinfile"><a href="#lineinfile" class="headerlink" title="lineinfile"></a>lineinfile</h2><p><code>lineinfile</code> 用于以下场景：</p>
<ul>
<li>确定文件中存在特定的一行，替换存在的行</li>
<li>修改文件中特定的一行</li>
</ul>
<p>常用参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>state</code></td>
<td>指定的行是否应该存在。<br/> - <code>absent</code><br/> - <code>present</code> 默认值</td>
<td></td>
</tr>
<tr>
<td><code>path</code><br/>aliases: <code>dest</code>, <code>destfile</code>, <code>name</code><br/><em><strong>required</strong></em></td>
<td>要修改的目标文件</td>
<td></td>
</tr>
<tr>
<td><code>line</code>     <br/>aliases: <code>value</code></td>
<td>要插入或者替换修改的行<br/><code>state=present</code> 时为必须参数 <br/>如果 <code>backrefs=true</code>，可以使用 <code>regexp</code> 正则表达式捕获的值，使用 <code>\g&lt;1&gt;</code>、<code>\g&lt;2&gt;</code> 的方式引用捕获到的内容</td>
<td></td>
</tr>
<tr>
<td><code>backup</code>               <br/>boolean</td>
<td>默认值 <code>false</code> 。是否创建备份文件</td>
<td></td>
</tr>
</tbody></table>
<p>修改防火墙中某个 IP 示例</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">- name: Modify iptables rule in /etc/sysconfig/iptables</span><br><span class="line">  hosts: nginx_1</span><br><span class="line">  become: yes</span><br><span class="line">  tasks:</span><br><span class="line"></span><br><span class="line">    - name: Replace the IP address in iptables rule</span><br><span class="line">      lineinfile:</span><br><span class="line">        path: /etc/sysconfig/iptables</span><br><span class="line">        regexp: (.*)18\.32\.100\.90(.*)</span><br><span class="line">        line: \g&lt;1&gt;180.232.100.99\g&lt;2&gt;</span><br><span class="line"></span><br><span class="line">        state: present</span><br><span class="line">        backup: yes</span><br><span class="line">        backrefs: true</span><br></pre></td></tr></table></figure>


<h1 id="playbook-示例"><a href="#playbook-示例" class="headerlink" title="playbook 示例"></a>playbook 示例</h1><h2 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h2><p>以下示例展示修改主机名可使用的 <code>playbook</code>，主机名称修改为 Inventory 中主机的主机名（Alias）</p>
<p>假设 Inventory 文件内容如下：</p>
<figure class="highlight shell"><figcaption><span>/etc/ansible/inventory/hosts</span></figcaption><table><tr><td class="code"><pre><span class="line">test_target1:</span><br><span class="line">  hosts:</span><br><span class="line">    ansible-target-centos79-1:</span><br><span class="line">      ansible_host: ansible-target-centos79-1</span><br><span class="line">      ansible_user: root</span><br><span class="line">    ansible-target-centos79-2:</span><br><span class="line">      ansible_host: ansible-target-centos79-2</span><br><span class="line">      ansible_port: 22</span><br><span class="line">      ansible_user: root</span><br></pre></td></tr></table></figure>
<p>Playbook 内容如下</p>
<figure class="highlight shell"><figcaption><span>change_hostname.yml</span></figcaption><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">- name: Change hostname based on inventory alias</span><br><span class="line">  hosts: test_target1</span><br><span class="line">  become: yes</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Set hostname from alias</span><br><span class="line">      hostname:</span><br><span class="line">        name: &quot;&#123;&#123; inventory_hostname &#125;&#125;&quot;</span><br><span class="line"></span><br><span class="line">    - name: Update /etc/hosts file with new hostname</span><br><span class="line">      lineinfile:</span><br><span class="line">        path: /etc/hosts</span><br><span class="line">        regexp: &#x27;^(127\.0\.1\.1\s+).*&#x27;</span><br><span class="line">        line: &quot;127.0.1.1 &#123;&#123; inventory_hostname &#125;&#125;&quot;</span><br><span class="line">        state: present</span><br><span class="line">      when: ansible_facts[&#x27;distribution&#x27;] == &#x27;Ubuntu&#x27;</span><br><span class="line"></span><br><span class="line">    - name: Update /etc/sysconfig/network with new hostname (CentOS/RedHat)</span><br><span class="line">      lineinfile:</span><br><span class="line">        path: /etc/sysconfig/network</span><br><span class="line">        regexp: &#x27;^HOSTNAME=.*&#x27;</span><br><span class="line">        line: &quot;HOSTNAME=&#123;&#123; inventory_hostname &#125;&#125;&quot;</span><br><span class="line">        state: present</span><br><span class="line">      when: ansible_facts[&#x27;distribution&#x27;] in [&#x27;CentOS&#x27;, &#x27;RedHat&#x27;]</span><br><span class="line"></span><br><span class="line">    - name: Set hostname using hostnamectl</span><br><span class="line">      command: &quot;hostnamectl set-hostname &#123;&#123; inventory_hostname &#125;&#125;&quot;</span><br><span class="line">      when: ansible_facts[&#x27;distribution&#x27;] in [&#x27;CentOS&#x27;, &#x27;RedHat&#x27;, &#x27;Ubuntu&#x27;]</span><br><span class="line"></span><br><span class="line">    - name: Reboot the system to apply changes</span><br><span class="line">      reboot:</span><br><span class="line">        msg: &quot;Rebooting to apply hostname changes&quot;</span><br><span class="line">        pre_reboot_delay: 5</span><br><span class="line">        post_reboot_delay: 30</span><br><span class="line">        reboot_timeout: 300</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>相关模板变量说明</p>
<table>
<thead>
<tr>
<th>模板变量</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>inventory_hostname</code></td>
<td>引用 Inventory 中的主机名称（Alias）</td>
<td><code>&#123;&#123; inventory_hostname &#125;&#125;</code></td>
</tr>
</tbody></table>
<p>相关模块使用参考</p>
<table>
<thead>
<tr>
<th>模块</th>
<th>参考链接</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>hostname</code></td>
<td><a href="https://csms.tech/202308311109/#hostname"><code>hostname</code></a></td>
<td></td>
</tr>
<tr>
<td><code>lineinfile</code></td>
<td><a href="https://csms.tech/202308311109/#lineinfile"><code>lineinfile</code></a></td>
<td></td>
</tr>
<tr>
<td><code>reboot</code></td>
<td><a href="https://csms.tech/202308311109/#reboot"><code>reboot</code></a></td>
<td></td>
</tr>
<tr>
<td><code>command</code></td>
<td><a href="https://csms.tech/202308311109/#command"><code>command</code></a></td>
<td></td>
</tr>
</tbody></table>
<h2 id="备份目录并删除"><a href="#备份目录并删除" class="headerlink" title="备份目录并删除"></a>备份目录并删除</h2><p>假如需要删除某个指定目录，可以参考以下配置，为保险起见，删除之前进行备份，并保留指定数量的备份文件</p>
<figure class="highlight shell"><figcaption><span>ansile_playbook_del_dir.yml</span></figcaption><table><tr><td class="code"><pre><span class="line">- name: Backup and Remove Directory</span><br><span class="line">  hosts: all</span><br><span class="line">  become: yes  # 提升权限（如果需要）</span><br><span class="line">  vars:</span><br><span class="line">    target_dir: &quot;/opt/data&quot;     # 需要删除的目录</span><br><span class="line">    backup_dir: &quot;/opt/backup&quot;   # 备份存放位置</span><br><span class="line">    keep_backups: 3             # 需要保留的备份数量</span><br><span class="line"></span><br><span class="line">  tasks:</span><br><span class="line">    - name: Ensure backup directory exists</span><br><span class="line">      file:</span><br><span class="line">        path: &quot;&#123;&#123; backup_dir &#125;&#125;&quot;</span><br><span class="line">        state: directory</span><br><span class="line">        mode: &#x27;0755&#x27;</span><br><span class="line"></span><br><span class="line">    - name: Backup directory before deletion</span><br><span class="line">      archive:</span><br><span class="line">        path: &quot;&#123;&#123; target_dir &#125;&#125;&quot;</span><br><span class="line">        dest: &quot;&#123;&#123; backup_dir &#125;&#125;/backup-&#123;&#123; ansible_date_time.iso8601_basic &#125;&#125;.tar.gz&quot;</span><br><span class="line">        format: gz</span><br><span class="line">      register: backup_result</span><br><span class="line">      when: target_dir is directory</span><br><span class="line"></span><br><span class="line">    - name: Remove the original directory</span><br><span class="line">      file:</span><br><span class="line">        path: &quot;&#123;&#123; target_dir &#125;&#125;&quot;</span><br><span class="line">        state: absent</span><br><span class="line"></span><br><span class="line">    - name: Clean up old backups (keep latest &#123;&#123; keep_backups &#125;&#125;)</span><br><span class="line">      shell: &quot;ls -t &#123;&#123; backup_dir &#125;&#125;/backup-*.tar.gz | tail -n +&#123;&#123; keep_backups + 1 &#125;&#125; | xargs -r rm -f&quot;</span><br><span class="line">      args:</span><br><span class="line">        executable: /bin/bash</span><br><span class="line">      when: keep_backups | int &gt; 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="同步-Nginx-服务配置文件"><a href="#同步-Nginx-服务配置文件" class="headerlink" title="同步 Nginx 服务配置文件"></a>同步 Nginx 服务配置文件</h2><p>以下示例是一个 Ansible Playbook，用于 <strong>备份并同步 Nginx 配置</strong> 、 <strong>检查 Nginx 配置是否正确 (<code>nginx -t</code>)</strong> ，如果 <strong>配置正确，则重载 Nginx (<code>nginx -s reload</code>)</strong> 。</p>
<figure class="highlight shell"><figcaption><span>ansible_playbook_sync_nginx_conf.yaml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Nginx 配置到其他 Nginx</span></span><br><span class="line">- name: Backup And Sync Nginx Conf</span><br><span class="line">  hosts: nginx_server</span><br><span class="line">  become: yes  # 提升权限（如果需要）</span><br><span class="line">  vars:</span><br><span class="line">    nginx_home: &quot;/usr/local/nginx-1.24.0/&quot;     # 需要删除的目录</span><br><span class="line">    nginx_conf_dir: &quot;&#123;&#123; nginx_home &#125;&#125;conf/&quot;</span><br><span class="line">    backup_dir: &quot;/opt/backup/&quot;   # 备份存放位置</span><br><span class="line">    keep_backups: 5             # 需要保留的备份数量</span><br><span class="line"></span><br><span class="line">  tasks:</span><br><span class="line">    - name: Ensure backup directory exists</span><br><span class="line">      file:</span><br><span class="line">        path: &quot;&#123;&#123; backup_dir &#125;&#125;&quot;</span><br><span class="line">        state: directory</span><br><span class="line">        mode: &#x27;0755&#x27;</span><br><span class="line"></span><br><span class="line">    - name: Backup nginx conf dir before sync</span><br><span class="line">      archive:</span><br><span class="line">        path: &quot;&#123;&#123; nginx_conf_dir &#125;&#125;&quot;</span><br><span class="line">        dest: &quot;&#123;&#123; backup_dir &#125;&#125;&#123;&#123; ansible_facts[&#x27;hostname&#x27;] &#125;&#125;_nginx_conf_backup-&#123;&#123; ansible_date_time.iso8601_basic &#125;&#125;.tar.gz&quot;</span><br><span class="line">        format: gz</span><br><span class="line">      register: backup_result</span><br><span class="line">      when: nginx_conf_dir is directory</span><br><span class="line"></span><br><span class="line">    - name: Clean up old backups (keep latest &#123;&#123; keep_backups &#125;&#125;)</span><br><span class="line">      shell: &quot;ls -t &#123;&#123; backup_dir &#125;&#125; | tail -n +&#123;&#123; keep_backups + 1 &#125;&#125; | xargs -r rm -f&quot;</span><br><span class="line">      args:</span><br><span class="line">        executable: /bin/bash</span><br><span class="line">      when: keep_backups | int &gt; 0</span><br><span class="line"></span><br><span class="line">    - name: Sync nginx conf</span><br><span class="line">      copy:</span><br><span class="line">        src: &quot;&#123;&#123; nginx_conf_dir &#125;&#125;&quot;</span><br><span class="line">        dest: &quot;&#123;&#123; nginx_conf_dir &#125;&#125;&quot;</span><br><span class="line">      when: nginx_conf_dir is directory</span><br><span class="line"></span><br><span class="line">    - name: Check nginx config</span><br><span class="line">      command: &quot;&#123;&#123; nginx_home &#125;&#125;sbin/nginx -t&quot;</span><br><span class="line">      register: nginx_conf_test_result</span><br><span class="line">      ignore_errors: yes       # 忽略错误，继续执行</span><br><span class="line">      notify: restart nginx service</span><br><span class="line"></span><br><span class="line">    - name: Debug nginx conf test</span><br><span class="line">      debug:</span><br><span class="line">        msg: &quot;nginx config test result: &#123;&#123; nginx_conf_test_result &#125;&#125;&quot;</span><br><span class="line"></span><br><span class="line">  handlers:</span><br><span class="line">    - name: restart nginx service</span><br><span class="line">      when: nginx_conf_test_result.rc == 0</span><br><span class="line">      service:</span><br><span class="line">        name: &quot;nginx&quot;</span><br><span class="line">        state: &quot;reloaded&quot;</span><br></pre></td></tr></table></figure>

<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_intro.html#ansible-playbooks">Ansible playbooks</a><br><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#control-node-requirements">ansible 官方文档</a><br><a target="_blank" rel="noopener" href="https://ansible-tran.readthedocs.io/en/latest/docs/intro_adhoc.html">Ansible中文权威指南</a></p>
<h1 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_variables.html#where-to-set-variables">Where to set variables</a><a href="#fnref:1" rev="footnote"> ↩</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_vars_facts.html">Discovering variables: facts and magic variables</a><a href="#fnref:2" rev="footnote"> ↩</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_variables.html#registering-variables">Registering variables</a><a href="#fnref:3" rev="footnote"> ↩</a></span></li></ol></div></div>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="../tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
              <a href="../tags/ansible/" rel="tag"><i class="fa fa-tag"></i> ansible</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="../202405171109/" rel="prev" title="YAML 语法格式">
                  <i class="fa fa-chevron-left"></i> YAML 语法格式
                </a>
            </div>
            <div class="post-nav-item">
                <a href="../202405241042/" rel="next" title="Ansible templates 使用介绍">
                  Ansible templates 使用介绍 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">COSMOS</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.3" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="../js/comments.js"></script><script src="../js/utils.js"></script><script src="../js/motion.js"></script><script src="../js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="../js/third-party/search/local-search.js"></script>




  <script src="../js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"fl9999","repo":"fl9999.github.io","client_id":"a11bf6f7860762b725b5","client_secret":"a99046105f8bddc72ec718d54dc3fd7f22070821","admin_user":"fl9999","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d41d8cd98f00b204e9800998ecf8427e"}</script>
<script src="../js/third-party/comments/gitalk.js"></script>

</body>
</html>
