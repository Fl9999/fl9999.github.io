<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16-next.png">
  <link rel="mask-icon" href="../images/logo.svg" color="#222">

<link rel="stylesheet" href="../css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"csms.tech","root":"/","images":"../images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"../search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="../js/config.js"></script>

    <meta name="description" content="EKS é›†ç¾¤ç‰¹æ€§æ€»ç»“  èŠ‚ç‚¹çš„ IP åœ°å€ï¼ˆEXTERNAL-IP å’Œ INTERNAL-IPï¼‰ä¸å›ºå®šï¼Œä¼šå˜åŒ–ã€‚ç‰¹åˆ«æ˜¯åœ¨è‡ªæ²»æ¨¡å¼ä¸­ï¼ŒèŠ‚ç‚¹è¢«è§†ä¸º ä¸´æ—¶èµ„æºï¼ˆEphemeralï¼‰ ï¼Œå¯èƒ½ä¼šé¢‘ç¹åœ°è¿›è¡ŒèŠ‚ç‚¹æ± ä¼˜åŒ–ã€‚ å¦‚æœé›†ç¾¤éœ€è¦å›ºå®šçš„å‡ºå£ IPï¼Œæœ€æ¨èï¼Œæœ€æ ‡å‡†çš„åšæ³•æ˜¯ ä½¿ç”¨ NAT ç½‘å…³ ï¼Œå°† EKS èŠ‚ç‚¹éƒ¨ç½²åœ¨ç§æœ‰å­ç½‘ä¸­ï¼Œæ‰€æœ‰è®¿é—®å¤–éƒ¨ç½‘ç»œçš„æµé‡éƒ½ä¼šç»è¿‡ NAT ç½‘å…³    é€šè¿‡ AWS ç®¡ç†æ§åˆ¶å°éƒ¨ç½²">
<meta property="og:type" content="article">
<meta property="og:title" content="aws EKS é…ç½®åŠç›¸å…³æ“ä½œ">
<meta property="og:url" content="http://csms.tech/20260206155210/index.html">
<meta property="og:site_name" content="L B T">
<meta property="og:description" content="EKS é›†ç¾¤ç‰¹æ€§æ€»ç»“  èŠ‚ç‚¹çš„ IP åœ°å€ï¼ˆEXTERNAL-IP å’Œ INTERNAL-IPï¼‰ä¸å›ºå®šï¼Œä¼šå˜åŒ–ã€‚ç‰¹åˆ«æ˜¯åœ¨è‡ªæ²»æ¨¡å¼ä¸­ï¼ŒèŠ‚ç‚¹è¢«è§†ä¸º ä¸´æ—¶èµ„æºï¼ˆEphemeralï¼‰ ï¼Œå¯èƒ½ä¼šé¢‘ç¹åœ°è¿›è¡ŒèŠ‚ç‚¹æ± ä¼˜åŒ–ã€‚ å¦‚æœé›†ç¾¤éœ€è¦å›ºå®šçš„å‡ºå£ IPï¼Œæœ€æ¨èï¼Œæœ€æ ‡å‡†çš„åšæ³•æ˜¯ ä½¿ç”¨ NAT ç½‘å…³ ï¼Œå°† EKS èŠ‚ç‚¹éƒ¨ç½²åœ¨ç§æœ‰å­ç½‘ä¸­ï¼Œæ‰€æœ‰è®¿é—®å¤–éƒ¨ç½‘ç»œçš„æµé‡éƒ½ä¼šç»è¿‡ NAT ç½‘å…³    é€šè¿‡ AWS ç®¡ç†æ§åˆ¶å°éƒ¨ç½²">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.csms.tech/img_387.png">
<meta property="og:image" content="https://i.csms.tech/img_398.png">
<meta property="og:image" content="https://i.csms.tech/img_399.png">
<meta property="og:image" content="https://i.csms.tech/img_400.png">
<meta property="article:published_time" content="2026-02-06T03:37:49.000Z">
<meta property="article:modified_time" content="2026-02-08T09:40:36.000Z">
<meta property="article:author" content="COSMOS">
<meta property="article:tag" content="Aws">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.csms.tech/img_387.png">


<link rel="canonical" href="http://csms.tech/20260206155210/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://csms.tech/20260206155210/","path":"20260206155210/","title":"aws EKS é…ç½®åŠç›¸å…³æ“ä½œ"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>aws EKS é…ç½®åŠç›¸å…³æ“ä½œ | L B T</title>
  








  <noscript>
    <link rel="stylesheet" href="../css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">L B T</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">è®° å½• è¿‡ å» çš„ ç» éªŒ</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="../index.html" rel="section"><i class="fa fa-earth-americas fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-categories"><a href="../categories/" rel="section"><i class="fa fa-folder-tree fa-fw"></i>æ€»ç›®å½•<span class="badge">53</span></a></li><li class="menu-item menu-item-linux"><a href="../categories/Linux" rel="section"><i class="fa fa-brands fa-linux fa-fw"></i>Linux</a></li><li class="menu-item menu-item-python"><a href="../categories/Python" rel="section"><i class="fa fa-brands fa-python fa-fw"></i>Python</a></li><li class="menu-item menu-item-docker"><a href="../categories/Docker" rel="section"><i class="fa fa-brands fa-docker fa-fw"></i>Docker</a></li><li class="menu-item menu-item-kubernetes"><a href="../categories/Kubernetes" rel="section"><i class="fa fa-dharmachakra fa-fw"></i>Kubernetes</a></li><li class="menu-item menu-item-tags"><a href="../tags/" rel="section"><i class="fa fa-tornado fa-fw"></i>æ ‡ç­¾<span class="badge">78</span></a></li><li class="menu-item menu-item-archives"><a href="../archives/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>åˆ—è¡¨<span class="badge">308</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« æ€»ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%80%9A%E8%BF%87-AWS-%E7%AE%A1%E7%90%86%E6%8E%A7%E5%88%B6%E5%8F%B0%E9%83%A8%E7%BD%B2-EKS-%E9%9B%86%E7%BE%A4"><span class="nav-number">1.</span> <span class="nav-text">é€šè¿‡ AWS ç®¡ç†æ§åˆ¶å°éƒ¨ç½² EKS é›†ç¾¤</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#aws-eks-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">1.1.</span> <span class="nav-text">aws eks å¸¸ç”¨å‘½ä»¤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%97%E5%87%BA%E9%9B%86%E7%BE%A4"><span class="nav-number">1.1.1.</span> <span class="nav-text">åˆ—å‡ºé›†ç¾¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E9%9B%86%E7%BE%A4%E5%88%9B%E5%BB%BA%E6%88%96%E6%9B%B4%E6%96%B0-kubeconfig-%E6%96%87%E4%BB%B6%E7%94%A8%E4%BA%8E%E5%92%8C%E9%9B%86%E7%BE%A4%E9%80%9A%E4%BF%A1"><span class="nav-number">1.1.2.</span> <span class="nav-text">ä¸ºé›†ç¾¤åˆ›å»ºæˆ–æ›´æ–° kubeconfig æ–‡ä»¶ç”¨äºå’Œé›†ç¾¤é€šä¿¡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF"><span class="nav-number">1.2.</span> <span class="nav-text">å¸¸è§é”™è¯¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E8%A7%92%E8%89%B2%E7%BC%BA%E5%B0%91%E5%BB%BA%E8%AE%AE%E7%9A%84%E6%89%98%E7%AE%A1%E7%AD%96%E7%95%A5"><span class="nav-number">1.2.1.</span> <span class="nav-text">é›†ç¾¤è§’è‰²ç¼ºå°‘å»ºè®®çš„æ‰˜ç®¡ç­–ç•¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E8%A7%92%E8%89%B2%E4%BF%A1%E4%BB%BB%E7%AD%96%E7%95%A5%E7%BC%BA%E5%B0%91%E5%BF%85%E9%9C%80%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-number">1.2.2.</span> <span class="nav-text">é›†ç¾¤è§’è‰²ä¿¡ä»»ç­–ç•¥ç¼ºå°‘å¿…éœ€çš„æ“ä½œ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#EKS-%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E5%8F%8A%E6%93%8D%E4%BD%9C"><span class="nav-number">2.</span> <span class="nav-text">EKS é›†ç¾¤ç›¸å…³é…ç½®åŠæ“ä½œ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#EKS-%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E6%93%8D%E4%BD%9C"><span class="nav-number">2.1.</span> <span class="nav-text">EKS ç›¸å…³é…ç½®æ“ä½œ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E9%9B%86%E7%BE%A4%E5%88%86%E9%85%8D%E5%8F%AA%E8%AF%BB%E6%9D%83%E9%99%90%E7%9A%84%E8%B4%A6%E6%88%B7"><span class="nav-number">2.1.1.</span> <span class="nav-text">ä¸ºé›†ç¾¤åˆ†é…åªè¯»æƒé™çš„è´¦æˆ·</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E6%A1%88%E4%BE%8B%E6%88%96%E9%94%99%E8%AF%AF%E6%8E%92%E6%9F%A5"><span class="nav-number">2.2.</span> <span class="nav-text">ç›¸å…³æ¡ˆä¾‹æˆ–é”™è¯¯æ’æŸ¥</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E6%B2%BB%E6%A8%A1%E5%BC%8F%E5%88%9B%E5%BB%BA%E7%9A%84%E9%9B%86%E7%BE%A4%E6%97%A0%E6%B3%95%E9%83%A8%E7%BD%B2-Pod-%E4%B8%8A%E5%8E%BB"><span class="nav-number">2.2.1.</span> <span class="nav-text">è‡ªæ²»æ¨¡å¼åˆ›å»ºçš„é›†ç¾¤æ— æ³•éƒ¨ç½² Pod ä¸Šå»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EKS-%E9%83%A8%E7%BD%B2-Nginx-%E6%9C%8D%E5%8A%A1%E5%B9%B6%E5%9C%A8%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%8A%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE"><span class="nav-number">2.2.2.</span> <span class="nav-text">EKS éƒ¨ç½² Nginx æœåŠ¡å¹¶åœ¨äº’è”ç½‘ä¸Šå¯ä»¥è®¿é—®</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">COSMOS</p>
  <div class="site-description" itemprop="description">å¾— èƒ½ è« å¿˜</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="../archives/">
          <span class="site-state-item-count">308</span>
          <span class="site-state-item-name">æ–‡ç« </span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="../categories/">
        <span class="site-state-item-count">53</span>
        <span class="site-state-item-name">ç›®å½•</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="../tags/">
        <span class="site-state-item-count">78</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20260206155210/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="aws EKS é…ç½®åŠç›¸å…³æ“ä½œ | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          aws EKS é…ç½®åŠç›¸å…³æ“ä½œ
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-02-06 11:37:49" itemprop="dateCreated datePublished" datetime="2026-02-06T11:37:49+08:00">2026-02-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-02-08 17:40:36" itemprop="dateModified" datetime="2026-02-08T17:40:36+08:00">2026-02-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../categories/%E4%BA%91%E5%B9%B3%E5%8F%B0/" itemprop="url" rel="index"><span itemprop="name">äº‘å¹³å°</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../categories/%E4%BA%91%E5%B9%B3%E5%8F%B0/Aws/" itemprop="url" rel="index"><span itemprop="name">Aws</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>EKS é›†ç¾¤ç‰¹æ€§æ€»ç»“</p>
<ul>
<li>èŠ‚ç‚¹çš„ IP åœ°å€ï¼ˆEXTERNAL-IP å’Œ INTERNAL-IPï¼‰ä¸å›ºå®šï¼Œä¼šå˜åŒ–ã€‚ç‰¹åˆ«æ˜¯åœ¨è‡ªæ²»æ¨¡å¼ä¸­ï¼ŒèŠ‚ç‚¹è¢«è§†ä¸º <strong>ä¸´æ—¶èµ„æºï¼ˆEphemeralï¼‰</strong> ï¼Œå¯èƒ½ä¼šé¢‘ç¹åœ°è¿›è¡ŒèŠ‚ç‚¹æ± ä¼˜åŒ–ã€‚<blockquote>
<p>å¦‚æœé›†ç¾¤éœ€è¦å›ºå®šçš„å‡ºå£ IPï¼Œæœ€æ¨èï¼Œæœ€æ ‡å‡†çš„åšæ³•æ˜¯ <strong>ä½¿ç”¨ NAT ç½‘å…³</strong> ï¼Œå°† EKS èŠ‚ç‚¹éƒ¨ç½²åœ¨ç§æœ‰å­ç½‘ä¸­ï¼Œæ‰€æœ‰è®¿é—®å¤–éƒ¨ç½‘ç»œçš„æµé‡éƒ½ä¼šç»è¿‡ <strong>NAT ç½‘å…³</strong></p>
</blockquote>
</li>
</ul>
<h1 id="é€šè¿‡-AWS-ç®¡ç†æ§åˆ¶å°éƒ¨ç½²-EKS-é›†ç¾¤"><a href="#é€šè¿‡-AWS-ç®¡ç†æ§åˆ¶å°éƒ¨ç½²-EKS-é›†ç¾¤" class="headerlink" title="é€šè¿‡ AWS ç®¡ç†æ§åˆ¶å°éƒ¨ç½² EKS é›†ç¾¤"></a>é€šè¿‡ AWS ç®¡ç†æ§åˆ¶å°éƒ¨ç½² EKS é›†ç¾¤</h1><ul>
<li>Kubernetes ç‰ˆæœ¬ï¼š v1.35</li>
</ul>
<p>æœ¬ç¤ºä¾‹ä¸­ä½¿ç”¨ <strong>EKS è‡ªæ²»æ¨¡å¼ï¼ˆEKS Auto Modeï¼‰</strong></p>
<blockquote>
<p><strong>EKS è‡ªæ²»æ¨¡å¼</strong> æ¥ç®¡äº†åŸæœ¬éœ€è¦æ‰‹åŠ¨ç®¡ç†çš„èŠ‚ç‚¹ã€å­˜å‚¨å’Œç½‘ç»œé…ç½®ï¼Œå› æ­¤å®ƒéœ€è¦ä¸€ç»„éå¸¸å…·ä½“ä¸”å¼ºå¤§çš„æƒé™</p>
<p><strong>EKS è‡ªæ²»æ¨¡å¼</strong> æœ‰é¢å¤–çš„è´¹ç”¨ï¼Œå¤§æ¦‚æ¯” EC2 ä»·æ ¼é«˜ 12%</p>
<p><strong>EKS è‡ªæ²»æ¨¡å¼</strong> åœ¨é›†ç¾¤åˆ›å»ºå®Œæˆåå¯ä¿®æ”¹ï¼ˆç¼–è¾‘ï¼‰ä¸ºéè‡ªæ²»æ¨¡å¼</p>
<p><strong>EKS è‡ªæ²»æ¨¡å¼</strong> ä¸­çš„ Worker Nodes é…ç½® <strong>ä¸èƒ½åœ¨æ§åˆ¶å°ä¿®æ”¹å‚æ•°ã€ä¸èƒ½è‡ªå®šä¹‰</strong> ï¼Œå…·ä½“çš„é…ç½®å¯ä»¥é€šè¿‡ API æ¥å£æŸ¥çœ‹ <code>nodepool</code> èµ„æº</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># kubectl describe nodepool general-purpose</span><br><span class="line">Name:         general-purpose</span><br><span class="line">Namespace:    </span><br><span class="line">Labels:       app.kubernetes.io/managed-by=eks</span><br><span class="line">Annotations:  karpenter.sh/nodepool-hash: 4012513481623584108</span><br><span class="line">              karpenter.sh/nodepool-hash-version: v3</span><br><span class="line">API Version:  karpenter.sh/v1</span><br><span class="line">Kind:         NodePool</span><br><span class="line">Metadata:</span><br><span class="line">  Creation Timestamp:  2026-02-06T09:38:18Z</span><br><span class="line">  Generation:          1</span><br><span class="line">  Resource Version:    784637</span><br><span class="line">  UID:                 e85261b9-3a4b-41b0-ac5...</span><br><span class="line">Spec:</span><br><span class="line">  Disruption:</span><br><span class="line">    Budgets:</span><br><span class="line">      Nodes:               10%      # è¿™æ˜¯ä¸€ä¸ªå®‰å…¨é˜€ã€‚åœ¨åŒä¸€æ—¶é—´å†…ï¼Œç”±äºç¼©å®¹æˆ–æ›´æ–°å¯¼è‡´çš„èŠ‚ç‚¹ç¦»çº¿æ¯”ä¾‹ä¸èƒ½è¶…è¿‡ 10%ã€‚è¿™ä¿è¯äº†ä½ çš„é›†ç¾¤ä¸ä¼šå› ä¸ºè‡ªåŠ¨ä¼˜åŒ–è€Œå¯¼è‡´ä¸šåŠ¡å¤§é¢ç§¯ä¸­æ–­ã€‚</span><br><span class="line">    Consolidate After:     30s      # èŠ‚ç‚¹è¾¾åˆ°ä¸Šè¿°çŠ¶æ€ 30 ç§’åï¼ŒEKS å°±ä¼šè€ƒè™‘å°†å…¶å…³é—­ï¼Œå¹¶æŠŠä¸Šé¢çš„ Pod è¿ç§»åˆ°æ›´åˆ’ç®—çš„èŠ‚ç‚¹ä¸Šã€‚</span><br><span class="line">    Consolidation Policy:  WhenEmptyOrUnderutilized    # å½“èŠ‚ç‚¹å˜ä¸ºç©ºé—²ï¼ˆæ²¡æœ‰ Podï¼‰æˆ–è€…åˆ©ç”¨ç‡è¾ƒä½ï¼ˆæ¯”å¦‚ä¸€ä¸ªå¤§èŠ‚ç‚¹åªè·‘äº†ä¸€ä¸ªå° Podï¼‰æ—¶ï¼ŒEKS ä¼šè‡ªåŠ¨è§¦å‘èŠ‚ç‚¹åˆå¹¶ã€‚</span><br><span class="line">  limits:      # èµ„æºé™åˆ¶</span><br><span class="line">    cpu: &quot;1000&quot;</span><br><span class="line">    memory: 1000Gi</span><br><span class="line">  Template:</span><br><span class="line">    Metadata:</span><br><span class="line">    Spec:</span><br><span class="line">      Expire After:  336h   # èŠ‚ç‚¹çš„æœ€å¤§â€œå¯¿å‘½â€æ˜¯ 14 å¤©ï¼ˆ336 å°æ—¶ï¼‰ï¼Œå¼ºåˆ¶èŠ‚ç‚¹å®šæœŸæ›´æ¢ï¼Œä»¥ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹éƒ½è¿è¡Œåœ¨æœ€æ–°çš„å®‰å…¨è¡¥ä¸å’Œ Bottlerocket é•œåƒä¸Šï¼Œé˜²æ­¢å‡ºç°é•¿æœŸæœªé‡å¯çš„â€œåƒµå°¸èŠ‚ç‚¹â€ã€‚</span><br><span class="line">      Node Class Ref:     # nodeclass ä¿¡æ¯ï¼Œå¯é€šè¿‡ kubectl get nodeclass æŸ¥çœ‹</span><br><span class="line">        Group:  eks.amazonaws.com</span><br><span class="line">        Kind:   NodeClass</span><br><span class="line">        Name:   default</span><br><span class="line">      Requirements:        # èŠ‚ç‚¹é€‰æ‹©æ ‡å‡† (Requirements)</span><br><span class="line">        Key:       karpenter.sh/capacity-type     # å®ä¾‹ç±»å‹ï¼Œon-demand ä¸º æŒ‰éœ€å®ä¾‹</span><br><span class="line">        Operator:  In</span><br><span class="line">        Values:</span><br><span class="line">          on-demand</span><br><span class="line">        Key:       eks.amazonaws.com/instance-category     # é™å®šäº†å®ä¾‹ç³»åˆ—   c: è®¡ç®—ä¼˜åŒ–å‹ï¼ˆé€‚åˆé«˜å¹¶å‘ï¼‰ï¼› m: é€šç”¨å‹ï¼ˆå¹³è¡¡ CPU å’Œå†…å­˜ï¼‰ï¼› r: å†…å­˜ä¼˜åŒ–å‹ï¼ˆé€‚åˆæ•°æ®åº“æˆ–ç¼“å­˜ï¼‰ã€‚   </span><br><span class="line">        Operator:  In</span><br><span class="line">        Values:</span><br><span class="line">          c</span><br><span class="line">          m</span><br><span class="line">          r</span><br><span class="line">        Key:       eks.amazonaws.com/instance-generation     # åªä½¿ç”¨ 4 ä»£ä»¥åçš„æœºå‹ï¼ˆå¦‚ c5, m6i ç­‰ï¼‰ã€‚è¿™ç¡®ä¿äº†èŠ‚ç‚¹æ‹¥æœ‰è¾ƒæ–°çš„ç¡¬ä»¶ç‰¹æ€§å’Œæ€§èƒ½ã€‚</span><br><span class="line">        Operator:  Gt</span><br><span class="line">        Values:</span><br><span class="line">          4</span><br><span class="line">        Key:       kubernetes.io/arch    # CPU æ¶æ„ã€‚å¦‚æœä½ æƒ³å°è¯•æ€§ä»·æ¯”æ›´é«˜çš„ ARM æ¶æ„ï¼ˆGravitonï¼‰ï¼Œéœ€è¦åœ¨è¿™é‡Œæ·»åŠ  arm64</span><br><span class="line">        Operator:  In</span><br><span class="line">        Values:</span><br><span class="line">          amd64</span><br><span class="line">        Key:       kubernetes.io/os   # èŠ‚ç‚¹æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰ç±»å‹</span><br><span class="line">        Operator:  In</span><br><span class="line">        Values:</span><br><span class="line">          linux</span><br><span class="line">      Termination Grace Period:  24h0m0s</span><br></pre></td></tr></table></figure>
<p><strong>EKS è‡ªæ²»æ¨¡å¼é™åˆ¶èµ„æºä¸Šé™</strong> ç¼–è¾‘ NodePoolï¼Œä¿®æ”¹ <code>spec.limits.cpu</code> å’Œ <code>spec.limits.memory</code> ã€‚è¿™å†³å®šäº†è¯¥æ± å­æœ€å¤šèƒ½â€œçƒ§â€æ‰å¤šå°‘ EC2 èµ„æºã€‚</p>
<p><strong>å¼ºåˆ¶å›æ”¶èŠ‚ç‚¹</strong> ï¼š å¦‚æœä½ æƒ³è®© EKS é‡æ–°å¹³è¡¡èŠ‚ç‚¹ï¼ˆä¾‹å¦‚ä½ æ›´æ”¹äº†å®ä¾‹é™åˆ¶ï¼‰ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ é™¤èŠ‚ç‚¹ï¼ŒAuto Mode ä¼šè‡ªåŠ¨æ ¹æ® Pod éœ€æ±‚æ‹‰èµ·ç¬¦åˆæ–°è§„çš„æ–°èŠ‚ç‚¹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl delete node &lt;node-name&gt;</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶è¦å…³æ³¨ <code>nodeclass</code> èµ„æºï¼Œå…¶ä¸­å®šä¹‰äº† <strong>å­ç½‘ï¼ˆSubnetï¼‰å’Œå®‰å…¨ç»„ï¼ˆSecurity Groupï¼‰ç­‰ä¿¡æ¯</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl get nodeclass</span></span><br><span class="line">NAME      ROLE          READY   AGE</span><br><span class="line">default   eksNodeRole   True    44h</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl  describe nodeclass default</span></span><br><span class="line">Name:         default</span><br><span class="line">Namespace:    </span><br><span class="line">Labels:       app.kubernetes.io/managed-by=eks</span><br><span class="line">Annotations:  eks.amazonaws.com/nodeclass-hash: 13740036326424352917</span><br><span class="line">              eks.amazonaws.com/nodeclass-hash-version: v2</span><br><span class="line">API Version:  eks.amazonaws.com/v1</span><br><span class="line">Kind:         NodeClass</span><br><span class="line">Metadata:</span><br><span class="line">  Creation Timestamp:  2026-02-06T09:38:18Z</span><br><span class="line">  Finalizers:</span><br><span class="line">    eks.amazonaws.com/termination</span><br><span class="line">  Generation:        2</span><br><span class="line">  Resource Version:  827607</span><br><span class="line">  UID:               5065b0f3-3795-4347-893a-338ae6fa882d</span><br><span class="line">Spec:</span><br><span class="line">  Ephemeral Storage:</span><br><span class="line">    Iops:                     3000</span><br><span class="line">    Size:                     80Gi</span><br><span class="line">    Throughput:               125</span><br><span class="line">  Network Policy:             DefaultAllow</span><br><span class="line">  Network Policy Event Logs:  Disabled</span><br><span class="line">  Role:                       eksNodeRole</span><br><span class="line">  Security Group Selector Terms:</span><br><span class="line">    Id:         sg-058bd1ef...</span><br><span class="line">  Snat Policy:  Random</span><br><span class="line">  Subnet Selector Terms:</span><br><span class="line">    Id:  subnet-07963d9b...</span><br><span class="line">    Id:  subnet-0e359aac...</span><br><span class="line">    Id:  subnet-0e76c601...</span><br></pre></td></tr></table></figure>
</blockquote>
<span id="more"></span>

<ol>
<li><p><strong>åˆ›å»º EKS é›†ç¾¤ IAM è§’è‰²</strong></p>
<blockquote>
<p>æ¯ä¸ªé›†ç¾¤éƒ½éœ€è¦ä¸€ä¸ª Amazon EKS é›†ç¾¤ IAM è§’è‰²ã€‚ç”± Amazon EKS ç®¡ç†çš„ Kubernetes é›†ç¾¤ä¼šä½¿ç”¨æ­¤è§’è‰²æ¥ç®¡ç†èŠ‚ç‚¹<br>AWS å®˜æ–¹å‚è€ƒæ–‡æ¡£ï¼š <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/eks/latest/userguide/cluster-iam-role.html#create-service-role">https://docs.aws.amazon.com/zh_cn/eks/latest/userguide/cluster-iam-role.html#create-service-role</a></p>
</blockquote>
<ol>
<li><p>è¿›å…¥ IAM æ§åˆ¶å° -&gt; è§’è‰² -&gt; åˆ›å»ºè§’è‰²ã€‚</p>
</li>
<li><p>é€‰æ‹© AWS æœåŠ¡ï¼Œæ‰¾åˆ° EKSã€‚</p>
</li>
<li><p>é€‰æ‹© EKS - Cluster ç”¨ä¾‹ã€‚</p>
</li>
<li><p>ç¡®ä¿å…³è”äº†ä»¥ä¸‹æƒé™ç­–ç•¥ã€‚</p>
<ul>
<li><code>AmazonEKSClusterPolicy</code></li>
<li><code>AmazonEKSComputePolicy</code></li>
<li><code>AmazonEKSBlockStoragePolicy</code></li>
<li><code>AmazonEKSNetworkingPolicy</code></li>
<li><code>AmazonEKSLoadBalancingPolicy</code></li>
</ul>
</li>
<li><p>ä¿®æ”¹è§’è‰² <strong>ä¿¡ä»»å…³ç³» (Trust relationships)</strong> ï¼Œåœ¨ <code>Action</code> åˆ—è¡¨ä¸­æ·»åŠ  <code>sts:TagSession</code></p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Principal&quot;: &#123;</span><br><span class="line">                &quot;Service&quot;: &quot;eks.amazonaws.com&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Action&quot;: [&quot;sts:AssumeRole&quot;,</span><br><span class="line">            &quot;sts:TagSession&quot;</span><br><span class="line">        ]&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‘½åä¸º <code>eksClusterRole</code> å¹¶ä¿å­˜ã€‚</p>
</li>
</ol>
</li>
<li><p><strong>åˆ›å»º EKS èŠ‚ç‚¹ IAM è§’è‰²</strong></p>
<blockquote>
<p>Amazon EKS èŠ‚ç‚¹ kubelet å®ˆæŠ¤è¿›ç¨‹ä»£è¡¨æ‚¨è°ƒç”¨ AWS APIã€‚èŠ‚ç‚¹é€šè¿‡ IAM å®ä¾‹é…ç½®æ–‡ä»¶å’Œå…³è”çš„ç­–ç•¥è·å¾—è¿™äº› API è°ƒç”¨çš„æƒé™ã€‚æ‚¨å¿…é¡»å…ˆä¸ºèŠ‚ç‚¹åˆ›å»º IAM è§’è‰²ä»¥åœ¨å¯åŠ¨å®ƒä»¬æ—¶ä½¿ç”¨ï¼Œç„¶åæ‰èƒ½å¯åŠ¨è¿™äº›èŠ‚ç‚¹å¹¶åœ¨é›†ç¾¤ä¸­æ³¨å†Œå®ƒä»¬ã€‚<br>AWS å®˜æ–¹å‚è€ƒæ–‡æ¡£ï¼š <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/eks/latest/userguide/create-node-role.html">https://docs.aws.amazon.com/zh_cn/eks/latest/userguide/create-node-role.html</a></p>
</blockquote>
<ol>
<li><p>é€šè¿‡ <a target="_blank" rel="noopener" href="https://console.aws.amazon.com/iam/">https://console.aws.amazon.com/iam/</a> æ‰“å¼€ IAM æ§åˆ¶å°ã€‚</p>
</li>
<li><p>åœ¨å·¦ä¾§å¯¼èˆªçª—æ ¼ä¸­ï¼Œé€‰æ‹© <strong>Rolesï¼ˆè§’è‰²ï¼‰</strong> ã€‚</p>
</li>
<li><p>åœ¨ Rolesï¼ˆè§’è‰²ï¼‰é¡µé¢ä¸Šï¼Œé€‰æ‹© <code>Create roleï¼ˆåˆ›å»ºè§’è‰²ï¼‰</code> ã€‚</p>
</li>
<li><p>åœ¨ <code>Select trusted entityï¼ˆé€‰æ‹©å—ä¿¡ä»»çš„å®ä½“ï¼‰</code> é¡µé¢ä¸Šï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>åœ¨å¯ä¿¡å®ä½“ç±»å‹éƒ¨åˆ†ä¸­ï¼Œé€‰æ‹© AWS æœåŠ¡ã€‚<br>  2, åœ¨ Use caseï¼ˆä½¿ç”¨æ¡ˆä¾‹ï¼‰ä¸‹ï¼Œé€‰æ‹© EC2ã€‚</li>
<li>é€‰æ‹©ä¸‹ä¸€æ­¥ã€‚</li>
</ol>
</li>
<li><p>åœ¨æ·»åŠ æƒé™é¡µé¢ä¸Šï¼Œé™„åŠ è‡ªå®šä¹‰ç­–ç•¥æˆ–æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>åœ¨ <code>Filter policies (ç­›é€‰å™¨ç­–ç•¥) </code> æ¡†ä¸­ï¼Œè¾“å…¥ <code>AmazonEKSWorkerNodePolicy</code> ã€‚</li>
<li>é€‰ä¸­æœç´¢ç»“æœä¸­çš„ <code>AmazonEKSWorkerNodePolicy</code> å·¦ä¾§çš„å¤é€‰æ¡†ã€‚</li>
<li>è¯·é€‰æ‹© <strong>Clear filtersï¼ˆæ¸…é™¤ç­›é€‰æ¡ä»¶ï¼‰</strong> ã€‚</li>
<li>åœ¨ <strong>Filter policies (ç­›é€‰å™¨ç­–ç•¥)</strong> æ¡†ä¸­ï¼Œè¾“å…¥ <code>AmazonEC2ContainerRegistryPullOnly</code> ã€‚</li>
<li>é€‰ä¸­æœç´¢ç»“æœä¸­çš„ <code>AmazonEC2ContainerRegistryPullOnly</code> å·¦ä¾§çš„å¤é€‰æ¡†ã€‚</li>
<li>é€‰æ‹©ä¸‹ä¸€æ­¥ã€‚</li>
</ol>
</li>
<li><p>åœ¨ <strong>Name, review, and createï¼ˆå‘½åã€æŸ¥çœ‹å’Œåˆ›å»ºï¼‰é¡µé¢ä¸­</strong> ï¼Œå¯¹è§’è‰²ï¼ˆRoleï¼‰å‘½åï¼Œæœ¬ç¤ºä¾‹ä½¿ç”¨ <code>eksNodeRole</code>ã€‚</p>
</li>
<li><p>é€‰æ‹© <strong>åˆ›å»ºè§’è‰²</strong> ã€‚</p>
</li>
</ol>
</li>
<li><p>å¯ä»¥æ ¹æ®éœ€æ±‚ä¸º EKS é›†ç¾¤ä¸­çš„å·¥ä½œèŠ‚ç‚¹ï¼ˆNodesï¼‰æ–°å»º <strong>ç§æœ‰å­ç½‘ (Private Subnet)</strong> å¹¶é…ç½® NAT Gateway ä»¥ä½¿é›†ç¾¤ Nodes çš„å‡ºå£ IP å›ºå®šã€‚</p>
<blockquote>
<p>EKS å…è®¸ä½ åŠ¨æ€æ›´æ–°é›†ç¾¤å…³è”çš„å­ç½‘ã€‚è¿™ä¸€æ­¥ä¼šå‘Šè¯‰ EKS æ§åˆ¶å¹³é¢ä»¥ååœ¨æ–°çš„ Subnets ä¸­å·¥ä½œã€‚</p>
<p><a href="https://csms.tech/20260207135211/#éƒ¨ç½²-NAT-Gateway-ç½‘å…³å¹¶å…³è”å­ç½‘">æ–°å»º <strong>ç§æœ‰å­ç½‘ (Private Subnet)</strong> å¹¶é…ç½® NAT Gateway æ“ä½œå‚è€ƒæ–‡æ¡£</a></p>
</blockquote>
</li>
<li><p><strong>åˆ›å»ºé›†ç¾¤æ§åˆ¶å¹³é¢</strong></p>
<ol>
<li>è¿›å…¥ EKS æ§åˆ¶å° -&gt; é›†ç¾¤ -&gt; æ·»åŠ é›†ç¾¤ -&gt; åˆ›å»ºã€‚</li>
<li>é…ç½®é›†ç¾¤ï¼šè¾“å…¥åç§°ï¼Œé€‰æ‹© Kubernetes ç‰ˆæœ¬ï¼Œå¹¶é€‰æ‹©å·²ç»åˆ›å»ºçš„ <strong>é›†ç¾¤ IAM è§’è‰²</strong> <code>eksClusterRole</code> å’Œ <strong>èŠ‚ç‚¹ IAM è§’è‰²</strong> <code>eksNodeRole</code></li>
<li>å…¶ä»–é…ç½®ä½¿ç”¨é»˜è®¤å³å¯ã€‚</li>
</ol>
</li>
<li><p>è‹¥è¦é€šè¿‡å‘½ä»¤è¡Œæ¥ç®¡ç† Amazon EKS é›†ç¾¤ï¼Œå‚è€ƒ <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/eks/latest/userguide/setting-up.html">å®˜æ–¹æ–‡æ¡£å®‰è£… <code>aws cli</code> ã€ <code>kubectl</code> å’Œ <code>eksctl</code></a></p>
</li>
</ol>
<h2 id="aws-eks-å¸¸ç”¨å‘½ä»¤"><a href="#aws-eks-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="aws eks å¸¸ç”¨å‘½ä»¤"></a>aws eks å¸¸ç”¨å‘½ä»¤</h2><h3 id="åˆ—å‡ºé›†ç¾¤"><a href="#åˆ—å‡ºé›†ç¾¤" class="headerlink" title="åˆ—å‡ºé›†ç¾¤"></a>åˆ—å‡ºé›†ç¾¤</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">aws eks list-clusters</span></span><br><span class="line">&#123;</span><br><span class="line">    &quot;clusters&quot;: [</span><br><span class="line">        &quot;my_eks_cluster&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºé›†ç¾¤åˆ›å»ºæˆ–æ›´æ–°-kubeconfig-æ–‡ä»¶ç”¨äºå’Œé›†ç¾¤é€šä¿¡"><a href="#ä¸ºé›†ç¾¤åˆ›å»ºæˆ–æ›´æ–°-kubeconfig-æ–‡ä»¶ç”¨äºå’Œé›†ç¾¤é€šä¿¡" class="headerlink" title="ä¸ºé›†ç¾¤åˆ›å»ºæˆ–æ›´æ–° kubeconfig æ–‡ä»¶ç”¨äºå’Œé›†ç¾¤é€šä¿¡"></a>ä¸ºé›†ç¾¤åˆ›å»ºæˆ–æ›´æ–° kubeconfig æ–‡ä»¶ç”¨äºå’Œé›†ç¾¤é€šä¿¡</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">aws eks update-kubeconfig --region region-code --name my-cluster</span></span><br><span class="line">Added new context arn:aws:eks:ap-east-1:252345564999:cluster/my-cluster to /root/.kube/config</span><br></pre></td></tr></table></figure>

<p>æ›´æ–° <code>kubeconfig</code> æ–‡ä»¶æˆåŠŸåï¼Œä¼šåˆ›å»º <code>~/.kube/config</code> æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«é›†ç¾¤çš„ API ä¿¡æ¯å’Œè®¤è¯ä¿¡æ¯ï¼Œå‡­æ­¤å¯ä»¥å’Œ Kubernetes é›†ç¾¤è¿›è¡Œé€šä¿¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl get nodes -o wide</span></span><br><span class="line">NAME                  STATUS   ROLES    AGE   VERSION               INTERNAL-IP     EXTERNAL-IP      OS-IMAGE                                                              KERNEL-VERSION   CONTAINER-RUNTIME</span><br><span class="line">i-08430a2c906bc4c67   Ready    &lt;none&gt;   16h   v1.35.0-eks-ac2d5a0   172.31.45.250   18.166.67.169    Bottlerocket (EKS Auto, Standard) 2026.1.28 (aws-k8s-1.35-standard)   6.12.64          containerd://2.1.6+bottlerocket</span><br><span class="line">i-0da674836789d8862   Ready    &lt;none&gt;   16h   v1.35.0-eks-ac2d5a0   172.31.29.11    43.198.109.233   Bottlerocket (EKS Auto, Standard) 2026.1.28 (aws-k8s-1.35-standard)   6.12.64          containerd://2.1.6+bottlerocket</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="å¸¸è§é”™è¯¯"><a href="#å¸¸è§é”™è¯¯" class="headerlink" title="å¸¸è§é”™è¯¯"></a>å¸¸è§é”™è¯¯</h2><h3 id="é›†ç¾¤è§’è‰²ç¼ºå°‘å»ºè®®çš„æ‰˜ç®¡ç­–ç•¥"><a href="#é›†ç¾¤è§’è‰²ç¼ºå°‘å»ºè®®çš„æ‰˜ç®¡ç­–ç•¥" class="headerlink" title="é›†ç¾¤è§’è‰²ç¼ºå°‘å»ºè®®çš„æ‰˜ç®¡ç­–ç•¥"></a>é›†ç¾¤è§’è‰²ç¼ºå°‘å»ºè®®çš„æ‰˜ç®¡ç­–ç•¥</h3><p><strong>EKS è‡ªæ²»æ¨¡å¼</strong> çš„é›†ç¾¤åˆ›å»ºè¿‡ç¨‹ä¸­ç¼ºå°‘å¿…è¦çš„æƒé™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">é›†ç¾¤è§’è‰²ç¼ºå°‘å»ºè®®çš„æ‰˜ç®¡ç­–ç•¥</span><br><span class="line">é›†ç¾¤è§’è‰²å¿…é¡»å…·æœ‰ä»¥ä¸‹æ‰˜ç®¡ç­–ç•¥æˆ–ç­‰æ•ˆæƒé™æ‰èƒ½ä½¿ç”¨ EKS è‡ªæ²»æ¨¡å¼ï¼š</span><br><span class="line">    - AmazonEKSBlockStoragePolicy</span><br><span class="line">    - AmazonEKSComputePolicy</span><br><span class="line">    - AmazonEKSLoadBalancingPolicy</span><br><span class="line">    - AmazonEKSNetworkingPolicy</span><br></pre></td></tr></table></figure>
<p><strong>EKS è‡ªæ²»æ¨¡å¼</strong> æ¥ç®¡äº†åŸæœ¬éœ€è¦æ‰‹åŠ¨ç®¡ç†çš„èŠ‚ç‚¹ã€å­˜å‚¨å’Œç½‘ç»œé…ç½®ï¼Œå› æ­¤å®ƒéœ€è¦ä¸€ç»„éå¸¸å…·ä½“ä¸”å¼ºå¤§çš„æƒé™. è§£å†³æ–¹æ³•å¦‚ä¸‹</p>
<ol>
<li><p>ç™»å½• IAM æ§åˆ¶å°ï¼Œæ‰¾åˆ°â€œè§’è‰² (Roles)â€ã€‚</p>
</li>
<li><p>æœç´¢å¹¶ç‚¹å‡»ä½ ä¸º EKS é›†ç¾¤åˆ›å»ºçš„è§’è‰²åç§°ï¼Œæœ¬ç¤ºä¾‹ä¸­ä¸º <code>eksClusterRole</code>ã€‚</p>
</li>
<li><p>åœ¨ <strong>æƒé™ (Permissions)</strong> é€‰é¡¹å¡ä¸‹ï¼Œç‚¹å‡» <code>æ·»åŠ æƒé™ (Add permissions) -&gt; é™„åŠ ç­–ç•¥ (Attach policies)</code> ã€‚</p>
</li>
<li><p>åœ¨æœç´¢æ¡†ä¸­åˆ†åˆ«æœç´¢å¹¶å‹¾é€‰ä¸Šè¿°å››ä¸ªç­–ç•¥ï¼š</p>
<ul>
<li><code>AmazonEKSComputePolicy</code></li>
<li><code>AmazonEKSBlockStoragePolicy</code></li>
<li><code>AmazonEKSNetworkingPolicy</code></li>
<li><code>AmazonEKSLoadBalancingPolicy</code></li>
</ul>
</li>
</ol>
<p>æœ€ç»ˆçš„ <strong>æƒé™ç­–ç•¥</strong> å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://i.csms.tech/img_387.png"></p>
<h3 id="é›†ç¾¤è§’è‰²ä¿¡ä»»ç­–ç•¥ç¼ºå°‘å¿…éœ€çš„æ“ä½œ"><a href="#é›†ç¾¤è§’è‰²ä¿¡ä»»ç­–ç•¥ç¼ºå°‘å¿…éœ€çš„æ“ä½œ" class="headerlink" title="é›†ç¾¤è§’è‰²ä¿¡ä»»ç­–ç•¥ç¼ºå°‘å¿…éœ€çš„æ“ä½œ"></a>é›†ç¾¤è§’è‰²ä¿¡ä»»ç­–ç•¥ç¼ºå°‘å¿…éœ€çš„æ“ä½œ</h3><p><strong>EKS è‡ªæ²»æ¨¡å¼</strong> çš„é›†ç¾¤åˆ›å»ºè¿‡ç¨‹ä¸­ç¼ºå°‘å¿…è¦çš„æƒé™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">é›†ç¾¤è§’è‰²ä¿¡ä»»ç­–ç•¥ç¼ºå°‘å¿…éœ€çš„æ“ä½œ</span><br><span class="line">é›†ç¾¤è§’è‰²å¿…é¡»å…·æœ‰å…¶ä¿¡ä»»ç­–ç•¥ä¸­æŒ‡å®šçš„ä»¥ä¸‹æ“ä½œæ‰èƒ½ä½¿ç”¨ EKS è‡ªæ²»æ¨¡å¼ï¼š</span><br><span class="line">    - sts:TagSession</span><br></pre></td></tr></table></figure>

<p>åœ¨ EKS è‡ªæ²»æ¨¡å¼ä¸‹ï¼ŒEKS éœ€è¦ä½¿ç”¨ <code>sts:TagSession</code> æ¥ä¸ºå®ƒæ›¿ä½ åˆ›å»ºçš„èµ„æºï¼ˆå¦‚è‡ªåŠ¨ç”Ÿæˆçš„èŠ‚ç‚¹ï¼‰è¿›è¡Œèº«ä»½æ ‡è¯†å’Œè¿½è¸ªã€‚</p>
<p>ä¿®æ”¹ IAM è§’è‰²çš„ <strong>ä¿¡ä»»å…³ç³» (Trust relationships)</strong> ï¼Œå°† <code>sts:TagSession</code> æ“ä½œæ·»åŠ åˆ°å…è®¸åˆ—è¡¨ä¸­ã€‚</p>
<ol>
<li>è¿›å…¥ IAM æ§åˆ¶å° -&gt; è§’è‰² (Roles)ã€‚</li>
<li>æœç´¢å¹¶ç‚¹å‡»ä½ çš„ EKS é›†ç¾¤è§’è‰²,æœ¬ç¤ºä¾‹ä¸­ä¸º <code>eksClusterRole</code>ã€‚</li>
<li>ç‚¹å‡» <strong>ä¿¡ä»»å…³ç³» (Trust relationships)</strong> é€‰é¡¹å¡ã€‚</li>
<li>ç‚¹å‡» <strong>ç¼–è¾‘ä¿¡ä»»ç­–ç•¥ (Edit trust policy)</strong> ã€‚é»˜è®¤å†…å®¹å¦‚ä¸‹ <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Principal&quot;: &#123;</span><br><span class="line">                &quot;Service&quot;: &quot;eks.amazonaws.com&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Action&quot;: &quot;sts:AssumeRole&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼Œåœ¨ <code>Action</code> åˆ—è¡¨ä¸­æ·»åŠ  <code>sts:TagSession</code> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Principal&quot;: &#123;</span><br><span class="line">                &quot;Service&quot;: &quot;eks.amazonaws.com&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Action&quot;: [&quot;sts:AssumeRole&quot;,</span><br><span class="line">            &quot;sts:TagSession&quot;</span><br><span class="line">        ]&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>ä¿®æ”¹å®Œæˆåï¼Œç‚¹å‡» <strong>æ›´æ–°ç­–ç•¥ (Update policy)</strong></li>
</ol>
<h1 id="EKS-é›†ç¾¤ç›¸å…³é…ç½®åŠæ“ä½œ"><a href="#EKS-é›†ç¾¤ç›¸å…³é…ç½®åŠæ“ä½œ" class="headerlink" title="EKS é›†ç¾¤ç›¸å…³é…ç½®åŠæ“ä½œ"></a>EKS é›†ç¾¤ç›¸å…³é…ç½®åŠæ“ä½œ</h1><h2 id="EKS-ç›¸å…³é…ç½®æ“ä½œ"><a href="#EKS-ç›¸å…³é…ç½®æ“ä½œ" class="headerlink" title="EKS ç›¸å…³é…ç½®æ“ä½œ"></a>EKS ç›¸å…³é…ç½®æ“ä½œ</h2><h3 id="ä¸ºé›†ç¾¤åˆ†é…åªè¯»æƒé™çš„è´¦æˆ·"><a href="#ä¸ºé›†ç¾¤åˆ†é…åªè¯»æƒé™çš„è´¦æˆ·" class="headerlink" title="ä¸ºé›†ç¾¤åˆ†é…åªè¯»æƒé™çš„è´¦æˆ·"></a>ä¸ºé›†ç¾¤åˆ†é…åªè¯»æƒé™çš„è´¦æˆ·</h3><p>EKS è´¦æˆ·æƒé™æ˜¯ <strong>AWS IAM æƒé™ + Kubernetes RBAC</strong> ä¸¤å±‚æƒé™ä¸€èµ·ç®¡ã€‚</p>
<p>æœ¬ç¤ºä¾‹ç›®æ ‡æ˜¯ï¼šç”¨æˆ·èƒ½çœ‹é›†ç¾¤èµ„æºï¼ˆ <code>kubectl get/describe</code> ï¼‰ï¼Œä½†ä¸èƒ½æ”¹ï¼ˆ <code>create/update/delete</code> ï¼‰ã€‚</p>
<p>åœ¨ EKS é‡Œå®ç° <strong>åªè¯»</strong>ï¼š</p>
<ul>
<li>IAM ç”¨æˆ· &#x2F; è§’è‰²ï¼š ğŸ‘‰ åªéœ€è¦èƒ½ <code>eks:DescribeCluster</code> ï¼ˆä¸éœ€è¦ç®¡ç†å‘˜ï¼‰</li>
<li>aws-auth ConfigMap ï¼š ğŸ‘‰ æŠŠè¿™ä¸ª IAM èº«ä»½æ˜ å°„åˆ° K8S ç”¨æˆ·</li>
<li>Kubernetes RBACï¼š ğŸ‘‰ ç»‘å®šåˆ° view æˆ–è‡ªå®šä¹‰åªè¯» ClusterRole</li>
</ul>
<ol>
<li><p>åœ¨ AWS IAM ä¸­åˆ›å»ºç”¨æˆ·å¦‚ <code>EKSReadOnlyUSER</code> ï¼Œç¡®ä¿è¯¥ IAM ç”¨æˆ·æˆ–è§’è‰²åœ¨ AWS å±‚é¢èƒ½å¤Ÿâ€œçœ‹åˆ°â€é›†ç¾¤ã€‚åˆ›å»ºä¸€ä¸ªåä¸º <code>EKSReadOnlyPolicy</code> çš„ç­–ç•¥å¹¶å…³è”ç»™è¯¥ç”¨æˆ·</p>
 <figure class="highlight json"><figcaption><span>EKSReadOnlyPolicy</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2012-10-17&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Statement&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;eks:DescribeCluster&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;eks:ListClusters&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>ä½¿ç”¨ EKS çš„ <strong>Access Entries (è®¿é—®æ¡ç›®)</strong> æœºåˆ¶ä¸ºé›†ç¾¤è®¿é—®åˆ›å»º <strong>è®¿é—®æ¡ç›® (Access Entry)</strong> </p>
<blockquote>
<p>æ–°ç‰ˆæœ¬çš„ EKS é›†ç¾¤å¯ç”¨äº† <strong>API èº«ä»½éªŒè¯æ¨¡å¼ (API Authentication Mode)</strong> ã€‚å¯ä»¥ç›´è§‚çš„é€šè¿‡ <strong>è®¿é—®æ¡ç›® (Access Entry)</strong> æ§åˆ¶å¯¹é›†ç¾¤çš„è®¿é—®<br><img src="https://i.csms.tech/img_398.png"></p>
<p>AWS Consoleï¼ˆæ§åˆ¶å°ï¼‰æŸ¥çœ‹ Access Entry<br><img src="https://i.csms.tech/img_399.png"></p>
<p><code>aws</code> å‘½ä»¤æŸ¥çœ‹ Access Entry</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">aws eks list-access-entries --cluster-name MY_CLUSTER</span></span><br><span class="line">&#123;</span><br><span class="line">    &quot;accessEntries&quot;: [</span><br><span class="line">        &quot;arn:aws:iam::25291...:role/aws-service-role/eks.amazonaws.com/AWSServiceRoleForAmazonEKS&quot;,</span><br><span class="line">        &quot;arn:aws:iam::25291...:role/eksNodeRole&quot;,</span><br><span class="line">        &quot;arn:aws:iam::252910...:user/CLUSTER_USER&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<p> EKS çš„ Access Policies ä¸­æœ‰ä¸ªå†…ç½®çš„ç­–ç•¥ <code>AmazonEKSViewPolicy</code> ï¼Œå·²ç»å®ç°äº†åªè¯»æ•ˆæœï¼ˆèƒ½ <code>get / list / watch</code> ä¸èƒ½ <code>create / update / delete</code> ï¼‰ï¼Œå› æ­¤åªéœ€è¦åˆ›å»ºæ–°çš„ <strong>IAM access entry</strong> å¹¶å°† <code>AmazonEKSViewPolicy</code> ç­–ç•¥é™„åŠ å…¶ä¸Šå³å¯ã€‚</p>
<p> <img src="https://i.csms.tech/img_400.png"></p>
</li>
<li><p>åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ IAM ç”¨æˆ· <code>EKSReadOnlyUSER</code> çš„èº«ä»½å‡­è¯ç™»é™†å³å¯è¿›è¡ŒéªŒè¯</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl get nodes</span></span><br><span class="line">Error from server (Forbidden): nodes is forbidden: User &quot;arn:aws:iam::25....:user/EKSReadOnlyUSER&quot; cannot list resource &quot;nodes&quot; in API group &quot;&quot; at the cluster scope</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl get pods</span></span><br><span class="line">NAME                                READY   STATUS    RESTARTS   AGE</span><br><span class="line">netshoot-daemonset-s5sbr            1/1     Running   0          6h42m</span><br><span class="line">nginx-deployment-5746cdf7c8-9vw9w   1/1     Running   0          4h49m</span><br><span class="line">nginx-deployment-5746cdf7c8-j772t   1/1     Running   0          4h49m</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="ç›¸å…³æ¡ˆä¾‹æˆ–é”™è¯¯æ’æŸ¥"><a href="#ç›¸å…³æ¡ˆä¾‹æˆ–é”™è¯¯æ’æŸ¥" class="headerlink" title="ç›¸å…³æ¡ˆä¾‹æˆ–é”™è¯¯æ’æŸ¥"></a>ç›¸å…³æ¡ˆä¾‹æˆ–é”™è¯¯æ’æŸ¥</h2><h3 id="è‡ªæ²»æ¨¡å¼åˆ›å»ºçš„é›†ç¾¤æ— æ³•éƒ¨ç½²-Pod-ä¸Šå»"><a href="#è‡ªæ²»æ¨¡å¼åˆ›å»ºçš„é›†ç¾¤æ— æ³•éƒ¨ç½²-Pod-ä¸Šå»" class="headerlink" title="è‡ªæ²»æ¨¡å¼åˆ›å»ºçš„é›†ç¾¤æ— æ³•éƒ¨ç½² Pod ä¸Šå»"></a>è‡ªæ²»æ¨¡å¼åˆ›å»ºçš„é›†ç¾¤æ— æ³•éƒ¨ç½² Pod ä¸Šå»</h3><p>è‡ªæ²»æ¨¡å¼ï¼ˆEKS Auto Modeï¼‰çš„é›†ç¾¤èŠ‚ç‚¹ä¸Šï¼Œé»˜è®¤ä¼šä¸ºèŠ‚ç‚¹é…ç½®ç‰¹å®šçš„ <strong>æ±¡ç‚¹ï¼ˆTaintsï¼‰</strong> ï¼Œå¦‚æœ Pod é…ç½®ä¸­æ²¡æœ‰è®¾ç½®å¯¹åº”çš„ Tolerationsï¼ˆå®¹å¿åº¦ï¼‰ï¼ŒPod ä¼šæ— æ³•è°ƒåº¦åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä¸Šå»ã€‚</p>
<p>æ¯”å¦‚ä»¥ä¸‹ DaemonSet é…ç½®ï¼Œåœ¨ EKS é›†ç¾¤ä¸Šå¯èƒ½æ— æ³•æˆåŠŸéƒ¨ç½²</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">netshoot-daemonset</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">netshoot</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">netshoot</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">netshoot</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># å¦‚æœä½ éœ€è¦è°ƒè¯•èŠ‚ç‚¹ä¸»æœºçš„ç½‘ç»œï¼ˆå¦‚æŸ¥çœ‹ NAT è·¯ç”±ï¼‰ï¼Œå¼€å¯ä¸‹é¢è¿™è¡Œ</span></span><br><span class="line">      <span class="comment"># hostNetwork: true </span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">netshoot</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nicolaka/netshoot</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;/bin/bash&quot;</span>]</span><br><span class="line">        <span class="attr">args:</span> [<span class="string">&quot;-c&quot;</span>, <span class="string">&quot;while true; do sleep 30; done&quot;</span>]</span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">128Mi</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">10m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">64Mi</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ DaemonSet çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl describe daemonset netshoot-daemonset</span></span><br><span class="line">Name:           netshoot-daemonset</span><br><span class="line">Namespace:      default</span><br><span class="line">Selector:       name=netshoot</span><br><span class="line">Node-Selector:  &lt;none&gt;</span><br><span class="line">Labels:         app=netshoot</span><br><span class="line">Annotations:    deprecated.daemonset.template.generation: 1</span><br><span class="line">Desired Number of Nodes Scheduled: 0</span><br><span class="line">Current Number of Nodes Scheduled: 0</span><br><span class="line">Number of Nodes Scheduled with Up-to-date Pods: 0</span><br><span class="line">Number of Nodes Scheduled with Available Pods: 0</span><br><span class="line">Number of Nodes Misscheduled: 0</span><br><span class="line">Pods Status:  0 Running / 0 Waiting / 0 Succeeded / 0 Failed</span><br><span class="line">Pod Template:</span><br><span class="line">  Labels:  name=netshoot</span><br><span class="line">  Containers:</span><br><span class="line">   netshoot:</span><br><span class="line">    Image:      nicolaka/netshoot</span><br><span class="line">    Port:       &lt;none&gt;</span><br><span class="line">    Host Port:  &lt;none&gt;</span><br><span class="line">    Command:</span><br><span class="line">      /bin/bash</span><br><span class="line">    Args:</span><br><span class="line">      -c</span><br><span class="line">      while true; do sleep 30; done</span><br><span class="line">    Limits:</span><br><span class="line">      cpu:     100m</span><br><span class="line">      memory:  128Mi</span><br><span class="line">    Requests:</span><br><span class="line">      cpu:         10m</span><br><span class="line">      memory:      64Mi</span><br><span class="line">    Environment:   &lt;none&gt;</span><br><span class="line">    Mounts:        &lt;none&gt;</span><br><span class="line">  Volumes:         &lt;none&gt;</span><br><span class="line">  Node-Selectors:  &lt;none&gt;</span><br><span class="line">  Tolerations:     &lt;none&gt;</span><br><span class="line">Events:            &lt;none&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­æ²¡æœ‰å¯è°ƒåº¦çš„èŠ‚ç‚¹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Desired Number of Nodes Scheduled: 0</span><br><span class="line">Current Number of Nodes Scheduled: 0</span><br></pre></td></tr></table></figure>

<p>æ£€æŸ¥èŠ‚ç‚¹çš„ Taints ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°èŠ‚ç‚¹é…ç½®äº† Taints <code>effect:NoSchedule key:CriticalAddonsOnly</code> </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl get nodes -o custom-columns=NAME:.metadata.name,TAINTS:.spec.taints</span></span><br><span class="line">NAME                  TAINTS</span><br><span class="line">i-008751c   [map[effect:NoSchedule key:CriticalAddonsOnly]]</span><br><span class="line">i-0256d1d   [map[effect:NoSchedule key:CriticalAddonsOnly]]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†è®© Pod èƒ½è°ƒåº¦åˆ°æ­¤èŠ‚ç‚¹ä¸Šå»ï¼Œå¯ä»¥ä¸º DaemonSet é…ç½®æ·»åŠ  Tolerations</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">netshoot-daemonset</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">netshoot</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">netshoot</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># --- æ·»åŠ ä»¥ä¸‹å®¹å¿åº¦ä»¥åŒ¹é…ä½ çš„èŠ‚ç‚¹æ±¡ç‚¹ ---</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;CriticalAddonsOnly&quot;</span></span><br><span class="line">        <span class="attr">operator:</span> <span class="string">&quot;Exists&quot;</span></span><br><span class="line">      <span class="comment"># å¦‚æœä½ å¸Œæœ›å®ƒæ›´â€œå¼ºæ‚â€ï¼Œèƒ½ä¸Šä»»ä½•èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªå…¨èƒ½é…ç½®ï¼š</span></span><br><span class="line">      <span class="comment"># - operator: &quot;Exists&quot; </span></span><br><span class="line">      <span class="comment"># ---------------------------------------</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">netshoot</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nicolaka/netshoot</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;/bin/bash&quot;</span>]</span><br><span class="line">        <span class="attr">args:</span> [<span class="string">&quot;-c&quot;</span>, <span class="string">&quot;while true; do sleep 30; done&quot;</span>]</span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">128Mi</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">10m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">64Mi</span></span><br></pre></td></tr></table></figure>

<h3 id="EKS-éƒ¨ç½²-Nginx-æœåŠ¡å¹¶åœ¨äº’è”ç½‘ä¸Šå¯ä»¥è®¿é—®"><a href="#EKS-éƒ¨ç½²-Nginx-æœåŠ¡å¹¶åœ¨äº’è”ç½‘ä¸Šå¯ä»¥è®¿é—®" class="headerlink" title="EKS éƒ¨ç½² Nginx æœåŠ¡å¹¶åœ¨äº’è”ç½‘ä¸Šå¯ä»¥è®¿é—®"></a>EKS éƒ¨ç½² Nginx æœåŠ¡å¹¶åœ¨äº’è”ç½‘ä¸Šå¯ä»¥è®¿é—®</h3><p>æœ¬ç¤ºä¾‹ä¸­çš„ Worker Nodes å’Œ Pod å­ç½‘ä¸º <strong>ç§æœ‰å­ç½‘ (Private Subnet)ï¼Œé€šè¿‡ NAT Gateway è®¿é—®äº’è”ç½‘</strong> ã€‚</p>
<ol>
<li><p>ä¸ºäº†è®© EKS è‡ªåŠ¨è¯†åˆ«å“ªäº›å­ç½‘ç”¨äºå­˜æ”¾è´Ÿè½½å‡è¡¡å™¨ï¼Œå“ªäº›ç”¨äºå­˜æ”¾ Podï¼Œä½ éœ€è¦ç¡®ä¿å­ç½‘æ‹¥æœ‰æ­£ç¡®çš„æ ‡ç­¾ï¼š</p>
<ul>
<li><p><strong>å…¬æœ‰å­ç½‘ (NAT Gateway æ‰€åœ¨çš„å­ç½‘)</strong> ï¼š</p>
<ul>
<li>æ ‡ç­¾ï¼š <code>kubernetes.io/role/elb = 1</code></li>
</ul>
</li>
<li><p><strong>ç§æœ‰å­ç½‘ (EKS èŠ‚ç‚¹æ‰€åœ¨çš„å­ç½‘)</strong> ï¼š</p>
<ul>
<li>æ ‡ç­¾ï¼š<code>kubernetes.io/role/internal-elb = 1</code></li>
</ul>
</li>
</ul>
</li>
<li><p>åœ¨é›†ç¾¤ä¸­ä½¿ç”¨ AWS LoadBalance å‘äº’è”ç½‘æä¾› EKS é›†ç¾¤ä¸­çš„æœåŠ¡ï¼Œéœ€è¦åœ¨é›†ç¾¤ä¸­å®‰è£… <strong>AWS Load Balancer Controller (LBC)</strong> ï¼Œç±»ä¼¼è¦ä½¿ç”¨ Ingress Nginx åˆ™éœ€è¦åœ¨é›†ç¾¤ä¸­å®‰è£… Ingress Nginx Controller ä¸€æ ·ã€‚</p>
</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/eks/latest/userguide/aws-load-balancer-controller.html">AWS è´Ÿè½½å‡è¡¡å™¨æ§åˆ¶å™¨ï¼ˆAWS Load Balancer Controllerï¼‰å®˜æ–¹æ–‡æ¡£</a></p>
<p>LBC ä¼šåœ¨æ‚¨åˆ›å»º Kubernetes Ingress æ—¶åˆ›å»º AWS åº”ç”¨ç¨‹åºè´Ÿè½½å‡è¡¡å™¨ï¼ˆALBï¼‰ã€‚</p>
<p>æ£€æŸ¥é›†ç¾¤ä¸­æ˜¯å¦å®‰è£…äº† AWS Load Balancer Controller</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get pods -n kube-system | grep -i controller</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/eks/latest/userguide/lbc-helm.html">ä½¿ç”¨ Helm å’Œ eksctl å®‰è£… AWS Load Balancer Controllerï¼ˆè´Ÿè½½å‡è¡¡å™¨æ§åˆ¶å™¨ï¼‰</a></p>
<p><a target="_blank" rel="noopener" href="https://helm.sh/docs/intro/install">å®‰è£… Helm</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-4</span><br><span class="line">chmod 700 get_helm.sh</span><br><span class="line">./get_helm.sh</span><br></pre></td></tr></table></figure>



    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="../tags/Aws/" rel="tag"><i class="fa fa-tag"></i> Aws</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="../20260122164301/" rel="prev" title="Docker compose éƒ¨ç½² Confluence ç ´è§£ç‰ˆ">
                  <i class="fa fa-chevron-left"></i> Docker compose éƒ¨ç½² Confluence ç ´è§£ç‰ˆ
                </a>
            </div>
            <div class="post-nav-item">
                <a href="../20260207135211/" rel="next" title="Amazon AWS æ¦‚å¿µåŠç›¸å…³æ“ä½œæ­¥éª¤">
                  Amazon AWS æ¦‚å¿µåŠç›¸å…³æ“ä½œæ­¥éª¤ <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">COSMOS</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.3" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="../js/comments.js"></script><script src="../js/utils.js"></script><script src="../js/motion.js"></script><script src="../js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="../js/third-party/search/local-search.js"></script>




  <script src="../js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"fl9999","repo":"fl9999.github.io","client_id":"a11bf6f7860762b725b5","client_secret":"a99046105f8bddc72ec718d54dc3fd7f22070821","admin_user":"fl9999","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d41d8cd98f00b204e9800998ecf8427e"}</script>
<script src="../js/third-party/comments/gitalk.js"></script>

</body>
</html>
