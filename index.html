<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"csms.tech","root":"/","images":"images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="js/config.js"></script>

    <meta name="description" content="得 能 莫 忘">
<meta property="og:type" content="website">
<meta property="og:title" content="L B T">
<meta property="og:url" content="http://csms.tech/index.html">
<meta property="og:site_name" content="L B T">
<meta property="og:description" content="得 能 莫 忘">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="COSMOS">
<meta property="article:tag" content="博客, 记录，技术">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://csms.tech/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>L B T</title>
  








  <noscript>
    <link rel="stylesheet" href="css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">L B T</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记 录 过 去 的 经 验</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="index.html" rel="section"><i class="fa fa-earth-americas fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-folder-tree fa-fw"></i>总目录<span class="badge">49</span></a></li><li class="menu-item menu-item-linux"><a href="/categories/Linux" rel="section"><i class="fa fa-brands fa-linux fa-fw"></i>Linux</a></li><li class="menu-item menu-item-python"><a href="/categories/Python" rel="section"><i class="fa fa-brands fa-python fa-fw"></i>Python</a></li><li class="menu-item menu-item-docker"><a href="/categories/Docker" rel="section"><i class="fa fa-brands fa-docker fa-fw"></i>Docker</a></li><li class="menu-item menu-item-kubernetes"><a href="/categories/Kubernetes" rel="section"><i class="fa fa-dharmachakra fa-fw"></i>Kubernetes</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tornado fa-fw"></i>标签<span class="badge">78</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>列表<span class="badge">234</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章总目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">COSMOS</p>
  <div class="site-description" itemprop="description">得 能 莫 忘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">234</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">目录</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">78</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202301171137/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202301171137/" class="post-title-link" itemprop="url">linux 系统状态查看</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-17 11:37:49" itemprop="dateCreated datePublished" datetime="2023-01-17T11:37:49+08:00">2023-01-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-18 14:10:00" itemprop="dateModified" datetime="2024-10-18T14:10:00+08:00">2024-10-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos 7 kernel 5.4.221</li>
</ul>
<h1 id="查看内存信息"><a href="#查看内存信息" class="headerlink" title="查看内存信息"></a>查看内存信息</h1><p>内存相关概念说明：</p>
<ul>
<li>VSS ,Virtual Set Size , VERT - 虚拟耗用内存（包含共享库占用的内存）</li>
<li>RSS , Resident Set Size , RES- 实际使用物理内存（包含共享库占用的内存）</li>
<li>PSS , Proportional Set Size - 实际使用的物理内存（比例分配共享库占用的内存）</li>
<li>USS , Unique Set Size - 进程独自占用的物理内存（不包含共享库占用的内存）</li>
</ul>
<h2 id="系统内存使用量统计"><a href="#系统内存使用量统计" class="headerlink" title="系统内存使用量统计"></a>系统内存使用量统计</h2><h3 id="free"><a href="#free" class="headerlink" title="free"></a>free</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">free -h</span></span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            15Gi       7.8Gi       707Mi       449Mi       7.0Gi       6.9Gi</span><br><span class="line">Swap:           30Gi       1.0Gi        29Gi</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h3><p>例如查看使用内存排名前十的进程：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ps aux | sort -k4,4nr | head -n 10</span><br></pre></td></tr></table></figure>

<h3 id="sar-命令"><a href="#sar-命令" class="headerlink" title="sar 命令"></a>sar 命令</h3><p><a href="#sar-%E6%A3%80%E6%9F%A5%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AD%98%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE">使用 <code>sar</code> 命令检查系统上的内存及 Swap 使用情况</a></p>
<h2 id="查看某个进程使用的内存量"><a href="#查看某个进程使用的内存量" class="headerlink" title="查看某个进程使用的内存量"></a>查看某个进程使用的内存量</h2><p>比如检查 <code>docker</code> 使用的内存量，首先通过 <code>ps</code> 命令查询到 <code>docker</code> 的 PID 信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ps -elf | grep docker</span></span><br><span class="line">4 S root      1243     1  4  80   0 - 1067527 futex_ Jan03 ?      15:14:45 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br></pre></td></tr></table></figure>
<p>例如此处的 <code>docker</code> 进程的 PID 为 1243</p>
<ul>
<li><p>使用 <code>top</code> 命令动态查看 <code>docker</code> 使用的内存信息</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">top -p 1243</span></span><br><span class="line">top - 11:47:40 up 14 days,  2:09,  3 users,  load average: 0.65, 1.42, 1.70</span><br><span class="line">Tasks:   1 total,   0 running,   1 sleeping,   0 stopped,   0 zombie</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">Cpu(s):  1.0 us,  0.6 sy,  0.0 ni, 98.3 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span></span><br><span class="line">KiB Mem : 32068748 total,  2494500 free, 18536188 used, 11038060 buff/cache</span><br><span class="line">KiB Swap:        0 total,        0 free,        0 used.  9586340 avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                           </span><br><span class="line"> 1243 root      20   0 4270108   1.4g  53956 S   1.0  4.6 914:55.80 dockerd</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>ps aux</code> 命令查看内存使用量</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ps aux | grep 1243</span></span><br><span class="line">root      1243  4.5  4.6 4270108 1486460 ?     Ssl  Jan03 914:57 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br></pre></td></tr></table></figure>

<p>  输出结果中</p>
<ul>
<li>第 3、4 列 (<code>4.5  4.6</code>) 分别表示 <code>cpu 使用率</code>、<code>内存使用率</code>。</li>
<li>第 5、6 列 (<code>4270108 1486460</code>) 分别表示 <code>虚拟内存使用量</code>、<code>物理内存使用量</code>，单位为 <code>k</code>。</li>
</ul>
</li>
<li><p>通过进程的 <code>status</code> 文件查看内存使用</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> /proc/1243/status</span></span><br><span class="line">Name:	dockerd</span><br><span class="line">Umask:	0022</span><br><span class="line">State:	S (sleeping)</span><br><span class="line">Pid:	1243</span><br><span class="line">PPid:	1</span><br><span class="line">VmPeak:	 4270364 kB</span><br><span class="line">VmSize:	 4270108 kB</span><br><span class="line">VmLck:	       0 kB</span><br><span class="line">VmPin:	       0 kB</span><br><span class="line">VmHWM:	 1562204 kB</span><br><span class="line">VmRSS:	 1492340 kB</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>其中，<code>VmRSS</code> 为进程使用的物理内存</p>
</li>
<li><p>使用 <code>pmap</code> 命令查看进程使用的内存信息</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pmap -x 1243</span><br><span class="line">pmap -p 1243</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202301171137/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241018132717/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20241018132717/" class="post-title-link" itemprop="url">Linux 系统安全加固</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-18 13:10:00" itemprop="dateCreated datePublished" datetime="2024-10-18T13:10:00+08:00">2024-10-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>Linux 系统安全加固常用方法</p>
<h1 id="服务网络安全"><a href="#服务网络安全" class="headerlink" title="服务网络安全"></a>服务网络安全</h1><ul>
<li>启用防火墙，并确保入口流量都是必须的，禁止无关的 IP 访问目标主机上的服务（端口）</li>
</ul>
<h1 id="系统软件安全检测"><a href="#系统软件安全检测" class="headerlink" title="系统软件安全检测"></a>系统软件安全检测</h1><ul>
<li><p>定期扫描系统上安装的软件，确保关键系统命令未被篡改，例如使用 <code>rpm -Va</code> 对所有系统上的软件进行校验，检查是否有软件被篡改</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rpm -Va</span></span><br><span class="line">.......T.    /usr/src/kernels/3.10.0-1160.114.2.el7.x86_64/virt/lib/Kconfig</span><br><span class="line">.......T.    /usr/src/kernels/3.10.0-1160.114.2.el7.x86_64/virt/lib/Makefile</span><br><span class="line">S.5....T.  c /root/.bash_profile</span><br><span class="line">S.5....T.  c /root/.bashrc</span><br><span class="line">.M.......    /var/run/supervisor</span><br><span class="line">missing     /etc/filebeat/fields.yml</span><br><span class="line">SM5....T.  c /etc/filebeat/filebeat.yml</span><br><span class="line">....L....  c /etc/pam.d/fingerprint-auth</span><br><span class="line">....L....  c /etc/pam.d/password-auth</span><br><span class="line">....L....  c /etc/pam.d/postlogin</span><br><span class="line">....L....  c /etc/pam.d/smartcard-auth</span><br><span class="line">....L....  c /etc/pam.d/system-auth</span><br></pre></td></tr></table></figure>
<p>  输出的每一行对应一个文件，前 9 个字符的字符串显示了该文件的属性状态。每个字符的位置代表了特定的属性检查结果。<code>rpm -Va</code> 对比的是当前系统中文件的状态与 RPM 数据库中记录的文件状态。</p>
<p>  每个字符的含义:</p>
<ul>
<li>第 1 位 ： 文件类型 (S).<br>  如果文件丢失了，则会显示 <code>S</code>（代表文件缺失，”File is missing”）。</li>
<li>第 2 位：文件大小 (5)<br>  如果文件大小与 RPM 数据库中的记录不一致，则会显示 <code>5</code>  </li>
<li>第 3 位：文件权限（模式&#x2F;权限位，M）<br>  如果文件的权限与 RPM 数据库记录的不一致，则会显示 <code>M</code>。  </li>
<li>第 4 位：文件的所有者 (U)<br>  如果文件的所有者与 RPM 数据库记录的不一致，则会显示 <code>U</code>  </li>
<li>第 5 位：文件所属的组 (G)<br>  如果文件的所属组与 RPM 数据库记录的不一致，则会显示 <code>G</code>  </li>
<li>第 6 位：文件的设备类型 (D)<br>  如果文件的设备类型（如块设备或字符设备）与 RPM 数据库记录的不一致，则会显示 <code>D</code>  </li>
<li>第 7 位：文件的时间戳 (T)<br>  如果文件的修改时间与 RPM 数据库中的记录不一致，则会显示 <code>T</code>。  </li>
<li>第 8 位：文件的校验和 (5)<br>  如果文件内容的校验和与 RPM 数据库记录的不一致，则会显示 <code>5</code>。</li>
<li>第 9 位：文件的符号链接 (L)<br>  如果文件是一个符号链接，并且符号链接目标发生变化，则会显示 <code>L</code>。</li>
<li>如果是配置文件，会被标记为 <code>c</code></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241018095609/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20241018095609/" class="post-title-link" itemprop="url">Linux 文件系统</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-18 09:10:00" itemprop="dateCreated datePublished" datetime="2024-10-18T09:10:00+08:00">2024-10-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>传统的 PC 架构计算机使用 <strong>Master Boot Record（MBR）分区表（Partition Tables）</strong> 来存储计算机上的 <strong>磁盘分区（Disks Partitions）</strong> 信息。MBR 有以下特点：</p>
<ul>
<li>MBR 的分区最大支持 2TB 的容量。</li>
</ul>
<p>最新的 UEFI 计算机架构使用 <strong>GUID（Globally Unique Identifier） Partition Tables（GPT）</strong> 标准来替代旧的 BIOS 方法启动计算机操作系统。相比于 MBR，GPT 有以下优势及特性：</p>
<ul>
<li>GPT 的分区最大能支持到 9.4ZB</li>
</ul>
<p><strong>传统的基于 MBR Partition Tables 的最重要的分区工具是 <code>fdisk</code>，但是它目前不支持 GPT Partitions</strong> ，新的工具 <code>parted</code> 正在顶替 <code>fdisk</code> 的功能。</p>
<h1 id="parted-用法"><a href="#parted-用法" class="headerlink" title="parted 用法"></a>parted 用法</h1><p>要查看 <code>parted</code> 常见用法，可以参考 <code>parted --help</code> 或在交互模式中使用 <code>help</code> 指令</p>
<h2 id="查看分区表信息"><a href="#查看分区表信息" class="headerlink" title="查看分区表信息"></a>查看分区表信息</h2><p>要查看系统上的分区信息，使用以下方式之一</p>
<ul>
<li><code>parted -l</code>  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">parted -l</span></span><br><span class="line">Model: Amazon Elastic Block Store (nvme)</span><br><span class="line">Disk /dev/nvme0n1: 85.9GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    File system  Name  Flags</span><br><span class="line">14      1049kB  5243kB  4194kB                     bios_grub</span><br><span class="line">15      5243kB  116MB   111MB   fat32              boot, esp</span><br><span class="line"> 1      116MB   85.9GB  85.8GB  ext4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Model: Amazon Elastic Block Store (nvme)</span><br><span class="line">Disk /dev/nvme1n1: 107GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    Type     File system  Flags</span><br><span class="line"> 1      1049kB  53.7GB  53.7GB  primary  ext4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Model: Unknown (unknown)</span><br><span class="line">Disk /dev/zram0: 33.2GB</span><br><span class="line">Sector size (logical/physical): 4096B/4096B</span><br><span class="line">Partition Table: loop</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start  End     Size    File system     Flags</span><br><span class="line"> 1      0.00B  33.2GB  33.2GB  linux-swap(v1)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><code>parted</code> 交互模式，在交互模式中使用指令 <code>p</code>  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">parted</span> </span><br><span class="line">GNU Parted 3.4</span><br><span class="line">Using /dev/nvme0n1</span><br><span class="line">Welcome to GNU Parted! Type &#x27;help&#x27; to view a list of commands.</span><br><span class="line"></span><br><span class="line">(parted) p                                                                </span><br><span class="line">Model: Amazon Elastic Block Store (nvme)</span><br><span class="line">Disk /dev/nvme0n1: 85.9GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    File system  Name  Flags</span><br><span class="line">14      1049kB  5243kB  4194kB                     bios_grub</span><br><span class="line">15      5243kB  116MB   111MB   fat32              boot, esp</span><br><span class="line"> 1      116MB   85.9GB  85.8GB  ext4</span><br><span class="line"></span><br><span class="line">(parted)                                                              </span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="创建-GPT-分区格式的硬盘"><a href="#创建-GPT-分区格式的硬盘" class="headerlink" title="创建 GPT 分区格式的硬盘"></a>创建 GPT 分区格式的硬盘</h2><p>要使用 <code>parted</code> 对硬盘指定其分区表类型，假设硬盘为 <code>/dev/nvme1n1</code> (默认表示第二个 NVM（NVMe, NonVolatile Memory Disks express, NVM 磁盘设备专用的通信接口协议） 硬盘的第一个 Namespace)，参考以下步骤：</p>
<ol>
<li><code>parted /dev/nvme1n1</code> ，进入交互模式并对指定的硬盘进行分区操作， <strong>以下步骤会导致硬盘上所有的分区及数据丢失</strong></li>
<li>在交互模式中使用 <code>mklabel gpt</code> 命令，配置硬盘使用 GPT 类型的分区表，而不是 MBR <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">(parted) mklabel gpt</span><br><span class="line">Warning: The existing disk label on /dev/nvme1n1 will be destroyed and all data</span><br><span class="line">on this disk will be lost. Do you want to continue?</span><br><span class="line">Yes/No? Yes</span><br><span class="line">(parted) </span><br></pre></td></tr></table></figure></li>
<li>在交互模式中使用 <code>mkpart</code> 命令进行分区操作，分区完成后使用 <code>p</code> 指令检查分区 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">(parted) mkpart</span><br><span class="line">Partition name? []? alldisk</span><br><span class="line">File system type? [ext2]? xfs</span><br><span class="line">Start? 1</span><br><span class="line">End? 123GB</span><br><span class="line"></span><br><span class="line">(parted) p</span><br><span class="line">Model: SanDisk Ultra (scsi)</span><br><span class="line">Disk /dev/nvme1n1: 123GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags:</span><br><span class="line">Number Start End Size File system Name Flags</span><br><span class="line">1 1049kB 123GB 123GB xfs alldisk </span><br></pre></td></tr></table></figure></li>
<li>使用 <code>quit</code> 指令退出 <code>parted</code> 交互模式。<blockquote>
<p><strong><code>fdisk</code> 交互模式中，只有最终执行了 <code>w</code> 命令保存，对硬盘的操作才会最终生效，和 <code>fdisk</code> 不同，<code>parted</code> 命令对硬盘的更改立即生效</strong></p>
</blockquote>
</li>
<li>对分区进行格式化并挂载使用，如果需要持久化挂载（系统重启后依然生效），可以将挂载信息写入 <code>/etc/fstab</code> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkfs -t xfs /dev/nvme1n1p1</span><br><span class="line">mount /dev/nvme1n1p1 /mnt/</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202306261438/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202306261438/" class="post-title-link" itemprop="url">Linux 文件相关操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-26 14:39:00" itemprop="dateCreated datePublished" datetime="2023-06-26T14:39:00+08:00">2023-06-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-17 13:10:00" itemprop="dateModified" datetime="2024-10-17T13:10:00+08:00">2024-10-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">常用命令</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h1><p>在 Linux 系统中，普通的文件权限控制通过关联身份三元组 (<code>user</code>, <code>group</code>,<code>other</code>) 和权限三元组 (<code>r</code>, <code>w</code>, <code>x</code>) 来实现访问控制。</p>
<p>系统存在一个 <code>umask</code> 值（针对用户），<code>umask</code> 是一个权限掩码，它决定了新建的文件或者目录的默认权限，使用 <code>umask</code> 命令可以查看当前(用户) 的  <code>umask</code> 值</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">umask</span></span></span><br><span class="line">0022</span><br></pre></td></tr></table></figure>
<p>比如如上所示的 <code>umask</code> 值，决定了当前(用户)创建的文件和目录的默认权限</p>
<ul>
<li><code>目录</code> - 默认权限为 <code>0755</code> （<code>777-022</code>），即 <code>rwxr-xr-x</code></li>
<li><code>文件</code> - 默认权限为 <code>644</code> (<code>666-022</code>)，即 <code>rw-r--r--</code></li>
</ul>
<p>因此要配置当前(用户)创建的文件或者目录的默认权限，只需要配置合适的 <code>umask</code> 值即可。配置 <code>umask</code> 值可以通过以下方法</p>
<ul>
<li>临时方法  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">umask 027</span><br></pre></td></tr></table></figure></li>
<li>永久方法<br>  根据需求将 <code>umask 027</code> 配置添加到配置文件中，如 <code>/etc/profile</code>、<code>~/.bashrc</code>、<code>~/.bash_profile</code> 等</li>
</ul>
<p>如果需要更进一步的权限控制，需要使用到 <code>Sticky Bit</code> 和 ACL，更细力度的控制还包括 SELinux. 相关扩展权限标志如下：</p>
<ul>
<li><strong>文件&#x2F;目录 权限最后会包含一个 <code>.</code></strong> ： 表示 SELinux （Security Enhanced Linux）扩展权限。可以使用命令 <code>ls -l -Z</code> 查看具体权限。</li>
<li><strong>文件&#x2F;目录 权限最后会包含一个 <code>+</code></strong> ： 表示 <strong>文件&#x2F;目录</strong> 有 <strong>ACL（Access Control List）</strong> 扩展权限，<a href="#ACL">相关操作及命令参考</a></li>
<li><strong>目录 权限最后会包含一个 <code>t</code></strong> ： 表示此 <strong>目录</strong> 有 <strong>Sticky Bit</strong> 扩展权限，<a href="#Sticky-Bit">相关操作及命令参考</a></li>
<li><strong>可执行文件 权限中属主（Owner）的 <code>x</code> 位变为 <code>s</code></strong> ： 表示此 <strong>可执行文件</strong> 配置了 <a href="#Set-UID"> <strong>Set UID</strong> 扩展权限</a></li>
<li><strong>可执行文件&#x2F;目录 权限中属组（Group）的 <code>x</code> 位变为 <code>s</code></strong> ： 表示此 <strong>目录</strong> 配置了 <a href="#Set-GID"> <strong>Set GID</strong> 扩展权限</a></li>
</ul>
<h2 id="Set-UID"><a href="#Set-UID" class="headerlink" title="Set UID"></a>Set UID</h2><ul>
<li>只有 <strong>可执行的二进制程序和可执行的代码</strong> 才能设定 SUID 权限。</li>
<li>命令执行者首先要对该程序拥有 <code>x</code>（执行）权限。</li>
<li>命令执行者在执行该程序时获得该程序文件 <strong>属主（Owner）</strong> 的身份。</li>
<li>SetUID 权限只在该程序 <strong>执行过程中</strong> 有效，也就是说身份改变只在执行过程中有效。</li>
</ul>
<p>设定 SUID 和 SGID 时，传统的 3 元组权限方式（如 <code>rwxrwxrwx</code> &#x3D; <code>777</code>） 变为 4 元组（<code>Srwxrwxrwx</code>），其中的 <code>S</code> 选项包括： </p>
<ul>
<li><code>4</code> 代表 SUID，如 <code>4777</code></li>
<li><code>2</code> 代表 GID，如 <code>2777</code></li>
<li><code>1</code> 代表 Sticky BIT，如 <code>1777</code></li>
<li><code>7</code> 代表全部设置， 如 <code>7777</code></li>
</ul>
<p>SUID 设定命令格式：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 4777 可执行文件名</span><br><span class="line"></span><br><span class="line">chmod u+s 可执行文件名</span><br></pre></td></tr></table></figure>

<p>取消 SUID 设置：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 777 可执行文件名</span><br></pre></td></tr></table></figure>

<blockquote>
<p>假如某个可执行文件的属主为 <code>root</code>，其设置了 SUID，普通用户运行此可执行文件时会暂时拥有 <code>root</code> 的权限，有一定的风险存在，因此要谨慎设置，为系统安全考虑，要定期查找系统上拥有 SUID 权限的可执行文件并核对其是否存在风险。</p>
</blockquote>
<h2 id="Set-GID"><a href="#Set-GID" class="headerlink" title="Set GID"></a>Set GID</h2><p>对 <strong>可执行文件</strong> 来说，SGID 拥有和 SUID 同样的作用，只不过 **命令执行者在执行该程序时获得该程序文件 <strong>属组（Group）</strong> 的身份。</p>
<p>SGID 设定方法：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 2777 可执行文件名</span><br><span class="line"></span><br><span class="line">chmod g+s  可执行文件名</span><br></pre></td></tr></table></figure>


<h2 id="Sticky-Bit"><a href="#Sticky-Bit" class="headerlink" title="Sticky Bit"></a>Sticky Bit</h2><p>粘滞位 (<code>Sticky Bit</code>) 只能用于目录，并对其中的文件有特殊的权限控制。他的主要作用是确保只有文件的所有者才能够删除或者修改文件。要给某个目录配置 <strong>粘滞位 (<code>Sticky Bit</code>)</strong> ，使用以下命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod +t directoryname</span><br></pre></td></tr></table></figure>
<p>这将为目录 <code>directoryname</code> 配置粘滞位 (<code>Sticky Bit</code>)，以下命令可以验证 粘滞位 (<code>Sticky Bit</code>)是否存在。如果目录的权限列表中有 <code>t</code> 标志，表示目录设置了 粘滞位 (<code>Sticky Bit</code>)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> -l directoryname</span></span><br><span class="line">drwxrwxrwt  2 owner group   4096 Jun 26 10:15 directoryname</span><br></pre></td></tr></table></figure>

<p><strong>设置粘滞位后，只有文件的所有者才能删除或修改该文件。其他用户即使有写权限（<code>w</code>），也无法删除其他用户的文件。</strong></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202306261438/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241017100414/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20241017100414/" class="post-title-link" itemprop="url">Linux GRUB2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-17 10:10:00" itemprop="dateCreated datePublished" datetime="2024-10-17T10:10:00+08:00">2024-10-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><code>boot loader</code> 在计算机启动的时候决定如何运行（启动）安装于硬盘上的操作系统，GRand Unified Bootloader（GRUB）是 Linux 中最流行的 Bootloader 程序。目前主要有 2 个 GRUB 版本：</p>
<ul>
<li>GRUB ： 遗留版本 GRUB v1，在较旧的 Linux 发行版中使用</li>
<li>GRUB 2 ： 当前最新版本，较新的 Linux 发行版中默认的 Bootloader. GRUB 2 的主要功能依旧是 <strong>查找并启动已安装在计算机上的操作系统</strong> 。同时 <strong>通过内嵌了一些工具和配置文件提供了更强大的功能以及灵活性</strong> 。</li>
</ul>
<p>GRUB 2 的配置文件是 <code>/boot/grub/grub.cfg</code> 或者 <code>/boot/grub2/grub.cfg</code>，关于其配置文件，要注意以下事项：</p>
<ul>
<li><code>grub.cfg</code> 的内容是由工具 <code>grub-mkconfig</code> 根据 <code>/etc/default/grub</code> 和 <code>/etc/grub.d/</code> 中的内容自动生成，最好不要手动改动</li>
<li><code>grub.cfg</code> 中可以包含 Shell 脚本语法，如 函数，循环，变量等</li>
<li>用于定位内核（Kernels）和 <code>Initial RAM</code> 位置的设备名称，最好是使用更加可靠的 <strong>标签（Labels）</strong> 或者是 <strong>UUIDs（Universally Unique Identifiers）</strong> ，而不是类似于 <code>/dev/sda</code> 的设备名称，这可以防止计算机系统新增硬盘后，<code>/dev/sda</code> 变成了 <code>/dev/sdb</code> 而导致系统启动时内核无法找到。</li>
</ul>
<h1 id="GRUB-2-常用指令说明"><a href="#GRUB-2-常用指令说明" class="headerlink" title="GRUB 2 常用指令说明"></a>GRUB 2 常用指令说明</h1><p>下表列出了 GRUB 2 Boot Menu 中常用的指令说明，更详细信息可以参考 <code>info grub</code> 或者 <code>info grub2</code></p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
<th>Examples</th>
</tr>
</thead>
<tbody><tr>
<td><code>linux file ...</code></td>
<td>从指定的文件中加载 Linux 内核镜像（Linux Kernel Image）<br/>后面跟随的内容会被当作内核指令（Kernel Command）一字不差的传递给内核</td>
<td><code>linux	/boot/vmlinuz-6.8.0-1016-aws root=PARTUUID=00c91e58-1b26-492f-a75f-c5159138dd1a ro  console=tty1 console=ttyS0</code></td>
</tr>
<tr>
<td><code>initrd file [file ...]</code></td>
<td>仅用于 <code>linux</code> 指令之后。为 Linux Kernel Image 按顺序加载 <code>initial RAM Disks</code>，并在其中设置合适的参数</td>
<td><code>initrd	/boot/microcode.cpio /boot/initrd.img-6.8.0-1016-aws</code></td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202211211437/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202211211437/" class="post-title-link" itemprop="url">Linux systemd-journald 服务说明</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-11-21 14:37:46" itemprop="dateCreated datePublished" datetime="2022-11-21T14:37:46+08:00">2022-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-16 13:10:00" itemprop="dateModified" datetime="2024-10-16T13:10:00+08:00">2024-10-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">常用服务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="systemd-journald-服务简介"><a href="#systemd-journald-服务简介" class="headerlink" title="systemd-journald 服务简介"></a>systemd-journald 服务简介</h1><p><code>systemd-journald</code> 服务是 <code>systemd init</code> 系统提供的收集系统日志的服务。它会根据从内核、用户进程、标准输入和系统服务错误收到的日志记录信息，维护结构化的索引日记，并以此方式来收集和储存日志记录数据。<code>systemd-journald</code> 服务默认处于启用状态。</p>
<p>默认情况下，<code>systemd-journald</code> 在 <code>/run/log/journal/</code> 中储存日志数据。由于 <code>/run/</code> 目录具有易失本性，因此，在重引导时会丢失日志数据。要永久保存日志数据，<code>/var/log/journal/</code> 目录必须存在且具有正确的所有权和权限，如此，<code>systemd-journald</code> 服务便可在其中储存其数据。</p>
<p>要在终端中查看日志信息，可以使用命令 <code>journalctl</code></p>
<h1 id="systemd-journald-服务常用配置"><a href="#systemd-journald-服务常用配置" class="headerlink" title="systemd-journald 服务常用配置"></a>systemd-journald 服务常用配置</h1><h2 id="持久化日志存储"><a href="#持久化日志存储" class="headerlink" title="持久化日志存储"></a>持久化日志存储</h2><p>默认情况下，日志位于 <code>/run/log/journal/</code>，重启后日志会丢失，为了持久化日志，可按照以下 2 种方法之一配置</p>
<ul>
<li><p>方法 1</p>
<ol>
<li>以 <code>root</code> 身份打开 <code>/etc/systemd/journald.conf</code> 进行编辑 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi /etc/systemd/journald.conf</span><br></pre></td></tr></table></figure></li>
<li>将包含 <code>Storage=</code> 的行取消注释，并将它更改为 <code>Storage=persistent</code><figure class="highlight shell"><figcaption><span>/etc/systemd/journald.conf</span></figcaption><table><tr><td class="code"><pre><span class="line">[Journal]</span><br><span class="line">Storage=persistent</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Compress=<span class="built_in">yes</span></span></span><br><span class="line">SystemMaxUse=50M</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure></li>
<li>重启 <code>systemd-journald</code> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">systemctl restart systemd-journald</span><br></pre></td></tr></table></figure>
之后日志会持久化存储于 <code>/var/log/journal</code>。这些数据最多会占用 <code>/var/log/journal</code> 所在文件系统空间的 10%，要更改此限制，可以修改选项 <code>SystemMaxUse=50M</code></li>
</ol>
</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202211211437/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202406260952/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202406260952/" class="post-title-link" itemprop="url">Linux 进程管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-26 09:52:30" itemprop="dateCreated datePublished" datetime="2024-06-26T09:52:30+08:00">2024-06-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-15 16:10:00" itemprop="dateModified" datetime="2024-10-15T16:10:00+08:00">2024-10-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><strong><code>Program</code></strong> 是一个静态实体，只是存储在操作系统中的文件（集合）</p>
<p><strong><code>Process</code></strong> 是操作系统上的活动（Active）实体，是 <strong><code>Program</code></strong> 由操作系统加载到内存并运行之后的实体。</p>
<p><strong><code>Process</code></strong> 运行过程中需要操作系统为其分配各种资源，如 CPU、Memory、Files、IO 等来完成其运行。</p>
<p>如果一个 <strong><code>Program</code></strong> 被操作系统运行（启动）了多次，那么其产生的多个 <strong><code>Process</code></strong>  属于分割（单独）的实体。</p>
<p>Linux 系统中调度的进程&#x2F;线程，通常被称为任务（Task）</p>
<p>Linux 中常见的进程状态如下表：</p>
<table>
<thead>
<tr>
<th>状态标识</th>
<th>状态名称</th>
<th>状态说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>R</code></td>
<td>task_running</td>
<td>进程处于运行或就绪状态</td>
<td></td>
</tr>
<tr>
<td><code>S</code></td>
<td>task_interruptible<br/> sleeping</td>
<td>可中断的睡眠状态</td>
<td></td>
</tr>
<tr>
<td><code>D</code></td>
<td>task_uninterruptible</td>
<td>不可中断的睡眠状态<br/>1. 它是一种睡眠状态，意味着处于此状态的进程不会消耗 CPU<br/>2. 睡眠的原因是等待某些资源（比如锁或者磁盘 IO），这也是非常多 D 状态的进程都处在处理 IO 操作的原因<br/>3. 是它不能被中断，这个要区别于 <code>硬件中断</code> 的中断，是指不希望在其获取到资源或者超时前被终止。因此他不会被信号唤醒，也就不会响应 <code>kill -9</code> 这类信号。这也是它跟 <code>S（可中断睡眠）</code>状态的区别</td>
<td></td>
</tr>
<tr>
<td><code>T</code></td>
<td>task_stopped <br/> task_traced<br/>Traced</td>
<td>暂停状态或跟踪状态</td>
<td></td>
</tr>
<tr>
<td><code>Z</code></td>
<td>task_dead <br/> exit_zombie<br/>zombie</td>
<td>退出状态，进程成为僵尸进程</td>
<td></td>
</tr>
<tr>
<td><code>X</code></td>
<td>task_dead <br/> exit_dead</td>
<td>退出状态，进程即将被销毁</td>
<td></td>
</tr>
<tr>
<td><code>I</code></td>
<td>idle</td>
<td>空闲状态</td>
<td></td>
</tr>
<tr>
<td><code>+</code></td>
<td></td>
<td>表示关联了前台操作（Foreground Operation），比如前台运行的进程</td>
<td></td>
</tr>
</tbody></table>
<h1 id="进程调度"><a href="#进程调度" class="headerlink" title="进程调度"></a>进程调度</h1><p>Linux 中任务（Task）调度算法默认使用 CFS（Completely Fair Scheduler，内核版本 &gt;&#x3D; 2.6.23）.</p>
<p>CFS 调度算法没有使用固定的进程（此处的进程可能是进程或者线程，Linux 中统称为 Task）优先级（Priority），而是根据进程的 <code>nice value</code> 为进程分配一定比例的（Proportional） CPU 计算时间。 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Operating System Concepts v10 Online](https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf)  5.7.1 Example: Linux Scheduling">[1]</span></a></sup></p>
<p><strong><code>nice</code> 的取值从 <code>-20</code> - <code>+19</code>，值越小，优先级越高，默认值为 <code>0</code></strong> 。优先级高的进程会被分配到更高比例的 CPU 处理时间。</p>
<p>在 Linux 内核中，优先级分为两种：静态优先级和动态优先级。CFS 使用的是动态优先级，它是根据 <code>nice</code> 值计算出来的。</p>
<p>CFS Scheduler 不会直接设定 Priorities，而是为每个 Task 维护变量 <code>vruntime（virtual runtime）</code>（可以检查系统 <code>/proc/&lt;PID&gt;/sched</code>），这个值记录了每个 task 使用了多少 CPU 时间。</p>
<p>CFS 通过将进程的虚拟运行时间（<code>vruntime</code>）与其他进程的虚拟运行时间进行比较来决定调度优先级。权重越大，<code>vruntime</code> 增长越慢，意味着进程的优先级越高，能够更频繁地被调度。</p>
<p>假入一个任务有默认的 Priority（<code>nice=0</code>），那么他的 <code>vruntime</code> 和实际使用的 CPU 时间相同。例如一个 <code>nice=0</code> 的进程使用了 CPU 200ms，那么他的 <code>vruntime=200ms</code>。<strong>低优先级（low priority，<code>nice&gt;0</code>）</strong> 的任务在 CPU 上运行了 200ms，那么他的 <code>vruntime&gt;200ms</code>，相反的，一个 <strong>高优先级（high priority,<code>nice&lt;0</code>）</strong> 的任务在 CPU 上运行了 200ms，那么他的 <code>vruntime&lt;200ms</code>。<strong>基于此，CFS Scheduler 在选择下一个要执行的任务时，会选择 <code>vruntime</code> 最小的任务来运行</strong>。如果有高优先级的任务就绪（可执行），它会抢占（preemptive）正在执行的低优先级的任务。</p>
<p>假如 Linux 中有 2 个优先级一样的任务（<code>nice=0</code>），一个进程为 I&#x2F;O-bound，另一个为 CPU-bound。通常情况下，在一个 CPU 周期内，I&#x2F;O-bound 的任务会使用很少的 CPU 时间就会因等待 IO 而中断在 CPU 上的执行并进入 CPU 的等待调度队列（schedule queue），而 CPU-bound 的任务会用尽分配给它的整个 CPU 周期。执行一段时间之后， I&#x2F;O-bound 的任务的 <code>vruntime</code> 的值会显著的小于 CPU-bound 的任务的 <code>vruntime</code>，导致 I&#x2F;O-bound 的任务拥有比 CPU-bound 的任务更高的优先级，当 I&#x2F;O-bound 的任务就绪（IO 返回数据）时，它会立即抢占 CPU 开始执行。</p>
<blockquote>
<p><code>nice</code> 只能针对单一的进程调整优先级，无法同时将优先级配置关联到相关进程，如 子进程或者同一个服务中的其他进程</p>
</blockquote>
<h2 id="修改-nice-的值"><a href="#修改-nice-的值" class="headerlink" title="修改 nice 的值"></a>修改 nice 的值</h2><p>在 Linux 中，<code>nice</code> 值用于调整进程的优先级，数值范围从 <code>-20</code>（ <strong>最高优先级</strong> ）到 <code>19</code>（ <strong>最低优先级</strong> ）。较低的 <code>nice</code> 值表示进程有更高的优先级，会更频繁地获得 CPU 时间，而较高的 <code>nice</code> 值表示进程有较低的优先级。</p>
<p>你可以使用 <code>nice</code> 和 <code>renice</code> 命令来修改进程的 <code>nice</code> 值</p>
<blockquote>
<p>普通用户（<code>root</code> 之外的用户）启动应用程序时默认只能配置初始 <code>nice</code> 值 <code>0-19</code></p>
<p>普通用户（<code>root</code> 之外的用户）修改正在运行的应用程序的 <code>nice</code> 值，只能改大，不能改小。比如进程启动时，其 <code>nice</code> 为 <code>10</code>，拥有权限的普通用户只能将其 <code>nice</code> 值改为大于 <code>10</code> 的值。 </p>
</blockquote>
<h3 id="nice-命令"><a href="#nice-命令" class="headerlink" title="nice 命令"></a>nice 命令</h3><p><strong><code>nice</code> 命令用于在启动进程时指定 <code>nice</code> 值</strong> 。如果不指定，默认 <code>nice</code> 值为 <code>0</code>。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nice -n 10 command</span><br></pre></td></tr></table></figure>

<h3 id="renice-命令"><a href="#renice-命令" class="headerlink" title="renice 命令"></a>renice 命令</h3><p><code>renice</code> 命令可以修改已经在运行的进程的 <code>nice</code> 值。需要提供进程 ID（ <strong>PID</strong> ）来指定要修改的进程。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">renice &lt;nice_value&gt; -p &lt;PID&gt;</span><br></pre></td></tr></table></figure>
<p>如果想要一次修改多个进程的 <code>nice</code> 值，可以传递多个 PID：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo renice 10 -p 1234 2345 3456</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Linux-进程资源控制-cgroups"><a href="#Linux-进程资源控制-cgroups" class="headerlink" title="Linux 进程资源控制 cgroups"></a>Linux 进程资源控制 cgroups</h1><p><code>cgroups</code> 可以将一个任务（<code>task</code>）标识（绑定）到一个特殊的 <strong>控制组（<code>Control Group</code>）</strong> ，此任务启动的子进程可以继承父进程的 <strong>控制组（<code>Control Group</code>）</strong> </p>
<p><strong>控制组（<code>Control Group</code>）</strong> 可以限制的资源类型如下：</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>blkio</code></td>
<td><strong>Storage</strong> <br/>限制到存储设备（如 Hard Disk、USB Drivers等）的请求</td>
</tr>
<tr>
<td><code>cpu</code></td>
<td><strong>CPU</strong> <br/>限制 CPU 调度</td>
</tr>
<tr>
<td><code>cpuacct</code></td>
<td><strong>Process Accounting</strong> <br/>上报 CPU 使用状态，可以用于统计客户端使用的处理量并进行收费</td>
</tr>
<tr>
<td><code>cpuset</code></td>
<td><strong>CPU Assignment</strong> <br/>在多处理器的系统上，将 Task 分配到特定的处理器以及关联的内存</td>
</tr>
<tr>
<td><code>devices</code></td>
<td><strong>Device Access</strong> <br/>限制 <strong>控制组（<code>Control Group</code>）</strong> 中的 Task 对目标设备类型的使用</td>
</tr>
<tr>
<td><code>freezer</code></td>
<td><strong>Suspend&#x2F;Resume</strong> <br/>暂停&#x2F;恢复  <strong>控制组（<code>Control Group</code>）</strong> 中的 Task</td>
</tr>
<tr>
<td><code>memory</code></td>
<td><strong>Memory Usage</strong>  <br/>限制并报告  <strong>控制组（<code>Control Group</code>）</strong> 中的 Task 使用的内存</td>
</tr>
<tr>
<td><code>net_cls</code></td>
<td><strong>Network Bandwidth</strong> <br/> 制并报告  <strong>控制组（<code>Control Group</code>）</strong> 中的 Task 使用的网络流量，主要通过对网络流量打上 <code>cgroups</code> 相关标签实现</td>
</tr>
<tr>
<td><code>net_prio</code></td>
<td><strong>Network Traffic</strong> <br/> 控制  <strong>控制组（<code>Control Group</code>）</strong> 中的网络流量的优先级</td>
</tr>
<tr>
<td><code>ns</code></td>
<td><strong>Namespaces</strong> <br/> 将 <code>cgroups</code> 分配到不同的 Namespaces，如此同一个 <code>cgroups</code> 中的进程只能看到本 Namespace 中的进程</td>
</tr>
</tbody></table>
<h1 id="Linux-进程管理"><a href="#Linux-进程管理" class="headerlink" title="Linux 进程管理"></a>Linux 进程管理</h1><h2 id="top-命令"><a href="#top-命令" class="headerlink" title="top 命令"></a>top 命令</h2><p>使用 <code>top</code> 命令可以查看系统负载、CPU 和 内存使用情况。也可以查看单个进程的具体信息。</p>
<p><code>top</code> 命令常用选项</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-H</code></td>
<td><code>Threads Mode</code>，线程模式。默认情况 <code>top</code> 展示进程的简要信息，使用此选项显示进程中的线程状态。<br/>对应交互式命令 <code>H</code></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>显示单个进程的（线程）详细信息  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">top -H -p 1423</span></span><br><span class="line">top - 09:44:42 up 54 days, 23:53,  2 users,  load average: 8.82, 6.84, 7.21</span><br><span class="line">Threads:  15 total,   0 running,  15 sleeping,   0 stopped,   0 zombie</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">Cpu(s): 40.9 us, 10.8 sy,  0.0 ni, 48.1 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.2 si,  0.0 st</span></span><br><span class="line">KiB Mem : 15790488 total,   466056 free,  7761544 used,  7562888 buff/cache</span><br><span class="line">KiB Swap:        0 total,        0 free,        0 used.  3895716 avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND                                                                                  </span><br><span class="line"> 1423 root      20   0 1477368 778788   4260 S 39.5  4.9  11999:41 [watchdog:1:6]                                                                           </span><br><span class="line"> 2572 root      20   0 1477368 778788   4260 S 37.9  4.9  11363:48 [watchdog:1:6]                                                                           </span><br><span class="line"> 1436 root      20   0 1477368 778788   4260 S 34.2  4.9  11286:08 [watchdog:1:6]                                                                           </span><br><span class="line"> 1435 root      20   0 1477368 778788   4260 S 33.9  4.9  12059:53 [watchdog:1:6]                                                                           </span><br><span class="line"> 1434 root      20   0 1477368 778788   4260 S 33.2  4.9  10249:00 [watchdog:1:6]                                                                           </span><br><span class="line"> 1437 root      20   0 1477368 778788   4260 S 30.6  4.9  11717:47 [watchdog:1:6]                                                                           </span><br><span class="line"> 1431 root      20   0 1477368 778788   4260 S 28.9  4.9  11222:06 [watchdog:1:6]                                                                           </span><br><span class="line">21378 root      20   0 1477368 778788   4260 S 27.6  4.9  12143:35 [watchdog:1:6]                                                                           </span><br><span class="line"> 1433 root      20   0 1477368 778788   4260 S 17.6  4.9   8738:21 [watchdog:1:6]                                                                           </span><br><span class="line"> 1428 root      20   0 1477368 778788   4260 S  8.0  4.9   7650:56 [watchdog:1:6]                                                                           </span><br><span class="line"> 1429 root      20   0 1477368 778788   4260 S  0.0  4.9   0:00.04 [watchdog:1:6]                                                                           </span><br><span class="line"> 1430 root      20   0 1477368 778788   4260 S  0.0  4.9   0:00.05 [watchdog:1:6]                                                                           </span><br><span class="line"> 1432 root      20   0 1477368 778788   4260 S  0.0  4.9   0:00.03 [watchdog:1:6]                                                                           </span><br><span class="line"> 1438 root      20   0 1477368 778788   4260 S  0.0  4.9  12260:30 [watchdog:1:6]                                                                           </span><br><span class="line"> 1529 root      20   0 1477368 778788   4260 S  0.0  4.9  11068:39 [watchdog:1:6]</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="进程命令名和进程可执行文件名"><a href="#进程命令名和进程可执行文件名" class="headerlink" title="进程命令名和进程可执行文件名"></a>进程命令名和进程可执行文件名</h2><p>在系统中遇到以下进程：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ps -elf | grep 18686</span></span><br><span class="line">5 S root     18686  1239  0  80   0 - 46620 pipe_w 15:50 ?        00:00:00 /usr/sbin/CROND -n</span><br><span class="line">0 R root     18694 18686  7  80   0 - 610547 -     15:50 ?        00:00:02 /usr/local/php73/bin/php /home/www/admin/artisan PullData</span><br><span class="line">0 S root     18754 18686  0  80   0 - 22453 pipe_w 15:50 ?        00:00:00 /usr/sbin/sendmail -FCronDaemon -i -odi -oem -oi -t -f root</span><br></pre></td></tr></table></figure>
<p>其中 PID 为 <code>18686</code> 的进程名为 <code>/usr/sbin/CROND</code>，其启动了另外两个子进程。但是在系统中检查，并不存在路径 <code>/usr/sbin/CROND</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> -l /usr/sbin/CROND</span></span><br><span class="line">ls: cannot access /usr/sbin/CROND: No such file or directory</span><br></pre></td></tr></table></figure>

<p>出现此种现象，主要是因为 <em><strong>在启动时，进程的命令名是根据路径传递给 <code>execve()</code> 函数的参数决定的，而不是直接与系统中的文件进行匹配</strong></em>。</p>
<p>在 Linux 系统中，<code>ps</code> 命令显示的进程信息是从 <code>/proc</code> 文件系统中获取的，而 <code>/proc</code> 文件系统包含有关正在运行的进程的信息，包括每个进程的命令名。因此，即使实际上系统中不存在 <code>/usr/sbin/CROND</code> 文件，但如果进程的命令名是 <code>/usr/sbin/CROND</code>，那么 <code>ps</code> 命令仍然会显示进程的命令名为 <code>/usr/sbin/CROND</code>。</p>
<p><em><strong>进程的命令名可以查看 <code>/proc/&lt;PID&gt;/cmdline</code> 文件</strong></em>，本示例中显示如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /proc/18686/cmdline</span> </span><br><span class="line">/usr/sbin/CROND-n</span><br></pre></td></tr></table></figure>

<p>对应的系统上的可执行文件的名称可以查看 <code>/proc/&lt;PID&gt;/stat</code>、<code>/proc/&lt;PID&gt;/comm</code>、<code>/proc/&lt;PID&gt;/status</code> 等文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /proc/900/comm</span> </span><br><span class="line">crond</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /proc/900/status</span> </span><br><span class="line">Name:	crond</span><br><span class="line">Umask:	0022</span><br><span class="line">State:	S (sleeping)</span><br><span class="line">Tgid:	900</span><br><span class="line">Ngid:	0</span><br><span class="line">Pid:	900</span><br><span class="line">PPid:	1239</span><br><span class="line">TracerPid:	0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /proc/900/stat</span></span><br><span class="line">900 (crond) S 1239 1239 1239 0 -1 4202816 1627 0 0 0 0 0 0 0 20 0 1 0 139129633 190955520 1478 18446744073709551615 94685936058368 94685936118156 140733000396032 140733000262488 140427856103840 0 0 4096 16387 18446744071797306256 0 0 17 3 0 0 0 0 0 94685938219080 94685938221648 94685948321792 140733000400770 140733000400789 140733000400789 140733000400872 0</span><br></pre></td></tr></table></figure>

<p>在本示例中，实际执行的命令为 <code>crond</code></p>
<h1 id="参考链接-Bibliography"><a href="#参考链接-Bibliography" class="headerlink" title="参考链接|Bibliography"></a>参考链接|Bibliography</h1><p><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a><br><a target="_blank" rel="noopener" href="http://lionheartwang.github.io/blog/2018/06/05/linuxjin-cheng-zhuang-tai-shuo-ming/">Linux进程状态说明</a></p>
<h1 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a>  5.7.1 Example: Linux Scheduling<a href="#fnref:1" rev="footnote"> ↩</a></span></li></ol></div></div>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202306091031/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202306091031/" class="post-title-link" itemprop="url">Linux man 使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-09 10:32:08" itemprop="dateCreated datePublished" datetime="2023-06-09T10:32:08+08:00">2023-06-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-15 11:10:00" itemprop="dateModified" datetime="2024-10-15T11:10:00+08:00">2024-10-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">常用命令</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>在 Linux 中，命令提供的 <code>man</code> 手册是一份非常详细的命令使用说明手册，要了解命令的使用方法及其工作原理，熟练参考 <code>man</code> 手册是及其必要的。</p>
<p><code>man</code> 手册中不仅包含了命令的使用方法，还包括了命令相关的 <strong>（配置）文件说明</strong> 、 <strong>System Calls</strong> 等相关信息，下表中列出了 <code>man</code> 手册不同编号对应的功能</p>
<table>
<thead>
<tr>
<th>Section Number</th>
<th>Section Name</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>1</code></td>
<td><code>User Commands</code></td>
<td>用户可以在 shell 中运行的指令说明<br/><code>man</code> 命令不指定 <code>Section Number</code> 时默认为 <code>1</code></td>
</tr>
<tr>
<td><code>2</code></td>
<td><code>System Calls</code></td>
<td>应用程序中的功能函数调用的内核函数</td>
</tr>
<tr>
<td><code>3</code></td>
<td><code>C Library Functions</code></td>
<td>应用程序针对特定的函数库提供的接口</td>
</tr>
<tr>
<td><code>4</code></td>
<td><code>Devices and Special Files</code></td>
<td>程序使用的硬件或软件</td>
</tr>
<tr>
<td><code>5</code></td>
<td><code>File Formats and Conventions</code></td>
<td>涉及的文件类型（如配置文件）及约定</td>
</tr>
<tr>
<td><code>6</code></td>
<td><code>Games</code></td>
<td></td>
</tr>
<tr>
<td><code>7</code></td>
<td><code>Miscellaneous</code></td>
<td>其他杂项，如 <strong>协议</strong> 、 <strong>文件系统</strong> 、 <strong>字符集</strong> 等</td>
</tr>
<tr>
<td><code>8</code></td>
<td><code>System Administration Tools and Daemons</code></td>
<td>需要 <code>root</code> 权限或其他管理员权限运行的命令</td>
</tr>
</tbody></table>
<p>要查看命令 <code>man</code> 的某个部分，可以使用以下命令查看 <code>passwd</code> 命令的 <code>File Formats and Conventions</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">man 5 passwd</span><br></pre></td></tr></table></figure>

<p><strong>环境信息</strong> ：</p>
<ul>
<li>Centos 7</li>
</ul>
<h1 id="为源码编译安装的软件安装-man-手册"><a href="#为源码编译安装的软件安装-man-手册" class="headerlink" title="为源码编译安装的软件安装 man 手册"></a>为源码编译安装的软件安装 man 手册</h1><p>使用源码编译安装的软件默认是没有 man 手册的，使用 man 命令会报以下错误</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">man fswatch</span></span><br><span class="line">No manual entry for fswatch</span><br></pre></td></tr></table></figure>

<p>要为源码编译安装的软件安装 man 手册，可以参考以下步骤，此处示例软件为 <code>fswatch</code>，软件编译安装到了 <code>/usr/local/fswatch-1.17.1/</code></p>
<ol>
<li><p>一般情况下，源码中会附带软件的使用文档，编译安装后，可能位于以下路径，<code>fswatch</code> 编译安装后的 man 手册位于 <code>/usr/local/fswatch-1.17.1/share/man/man7/fswatch.7</code></p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls /usr/local/fswatch-1.17.1/doc</span><br><span class="line">ls /usr/local/fswatch-1.17.1/share/doc</span><br><span class="line">ls /usr/local/fswatch-1.17.1/share/man/</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p><code>man</code> 命令使用的文档默认来源于 <code>/usr/share/man/</code></p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> /usr/share/man/</span></span><br><span class="line">cs  de  fr  hu  it  ko     man1   man1x  man2x  man3p  man4   man5   man6   man7   man8   man9   mann  pl  pt_BR  ro  sk  tr  zh_CN</span><br><span class="line">da  es  hr  id  ja  man0p  man1p  man2   man3   man3x  man4x  man5x  man6x  man7x  man8x  man9x  nl    pt  pt_PT  ru  sv  zh  zh_TW</span><br></pre></td></tr></table></figure>
<p>要为编译安装软件的安装 <code>man</code> 帮助文档，首先将 <code>fswatch</code> 的帮助文档复制到 <code>man</code> 页面的目录</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cp /usr/local/fswatch-1.17.1/share/man/man7/fswatch.7 /usr/share/man/man7/</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>更新 <code>man</code> 索引</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ mandb</span><br><span class="line">1 man subdirectory contained newer manual pages.</span><br><span class="line">47 manual pages were added.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>安装成功后，可以正常使用 <code>man fswatch</code> 查看帮助文档。</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20240816112002/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20240816112002/" class="post-title-link" itemprop="url">Linux bash 常用操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-14 10:52:20" itemprop="dateCreated datePublished" datetime="2024-08-14T10:52:20+08:00">2024-08-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-14 15:10:00" itemprop="dateModified" datetime="2024-10-14T15:10:00+08:00">2024-10-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="bash-快捷键"><a href="#bash-快捷键" class="headerlink" title="bash 快捷键"></a>bash 快捷键</h1><p><code>bash</code> 常用的快捷键总结</p>
<h2 id="删除类快捷键"><a href="#删除类快捷键" class="headerlink" title="删除类快捷键"></a>删除类快捷键</h2><table>
<thead>
<tr>
<th>快捷键</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>Ctrl + D</code></td>
<td>删除光标右侧的一个字符，等于 <code>Delete</code> 键</td>
<td></td>
</tr>
<tr>
<td><code>Ctrl + H</code></td>
<td>删除光标左侧的一个字符，等于 <code>Backspace</code> 键</td>
<td></td>
</tr>
<tr>
<td><code>Ctrl + K</code></td>
<td>删除从光标位置到行尾的所有字符。</td>
<td></td>
</tr>
<tr>
<td><code>Ctrl + U</code></td>
<td>删除从光标位置到行首的所有字符。</td>
<td></td>
</tr>
<tr>
<td><code>Ctrl + W</code></td>
<td>删除光标左侧的一个单词（以空格为分隔）。</td>
<td></td>
</tr>
<tr>
<td><code>Alt + D</code></td>
<td>删除光标右侧的一个单词。（空格，下划线，点分割）</td>
<td></td>
</tr>
<tr>
<td><code>Ctrl + C</code></td>
<td>删除整行</td>
<td></td>
</tr>
</tbody></table>
<h2 id="定位类快捷键"><a href="#定位类快捷键" class="headerlink" title="定位类快捷键"></a>定位类快捷键</h2><table>
<thead>
<tr>
<th>快捷键</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>Ctrl + F</code></td>
<td>向前挪动一个字符 ，等于 右箭头 <code>-&gt;</code></td>
<td></td>
</tr>
<tr>
<td><code>Ctrl + B</code></td>
<td>向后挪动一个字符  ，等于 左箭头 <code>&lt;-</code></td>
<td></td>
</tr>
<tr>
<td><code>Alt + F</code></td>
<td>向前挪动一个 word</td>
<td></td>
</tr>
<tr>
<td><code>Alt + B</code></td>
<td>向后挪动一个 word              。</td>
<td></td>
</tr>
<tr>
<td><code>Ctrl + A</code></td>
<td>跳到行首。</td>
<td></td>
</tr>
<tr>
<td><code>Ctrl + E</code></td>
<td>跳到行尾。</td>
<td></td>
</tr>
</tbody></table>
<h2 id="Recall-类快捷键"><a href="#Recall-类快捷键" class="headerlink" title="Recall 类快捷键"></a>Recall 类快捷键</h2><p><code>bash</code> 中执行过的命令都保存在了历史记录中，可以通过 <code>history</code> 命令查看。为了快速重新执行或者修改之前的命令并执行，<code>bash</code> 提供了以下快捷键</p>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>Ctrl + R</code></td>
<td>搜索 <code>history</code> 中 <strong>最后一个</strong> 匹配的命令</td>
<td></td>
</tr>
<tr>
<td><code>Alt + P</code></td>
<td>搜索 <code>history</code> 中 <strong>最常使用</strong> 的命令</td>
<td></td>
</tr>
<tr>
<td><code>!100</code></td>
<td>重新执行 <code>history</code> 中的第 100 号的命令，无确认，会立即执行</td>
<td></td>
</tr>
<tr>
<td><code>!!</code></td>
<td>重新执行 <code>history</code> 中的 <strong>最后一个</strong> 命令，无确认，会立即执行</td>
<td></td>
</tr>
</tbody></table>
<h1 id="bash-环境变量"><a href="#bash-环境变量" class="headerlink" title="bash 环境变量"></a>bash 环境变量</h1><p><code>shell</code> 中的环境变量大体可以分为以下几种：</p>
<ul>
<li><p><code>Local Variables</code> : 当前 Shell 中的 <strong>所有的本地变量（<code>Local Variables</code>）</strong> ，要查看所有的 本地变量（<code>Local Variables</code>），可以使用以下命令：</p>
<ul>
<li><code>set</code></li>
<li><code>declare</code>  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">set</span> | more</span></span><br><span class="line">BASH=/bin/bash</span><br><span class="line">BASHOPTS=checkwinsize:cmdhist:complete_fullquote:expand_aliases:extglob:extquote:force_fignore:globasciiranges:histappend:interactive_comments:progcomp:promptvars:sour</span><br><span class="line">cepath</span><br><span class="line">BASH_ALIASES=()</span><br><span class="line">BASH_ARGC=([0]=&quot;0&quot;)</span><br><span class="line">BASH_ARGV=()</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><code>Environment Variables</code> ： 本地变量（<code>Local Variables</code>）的一部分子集（<code>subset</code>）被稱為 <strong>环境变量（<code>Environment Variables</code>）</strong> ， <strong>环境变量（<code>Environment Variables</code>）</strong> 会被导入到任何从当前 Shell 启动的新的 Shell，要查看 <strong>环境变量（<code>Environment Variables</code>）</strong> ，使用以下命令</p>
<ul>
<li><code>env</code></li>
<li><code>printenv</code>  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">env</span></span></span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">SESSION_MANAGER=local/U-3TSDMAL9IVFAQ:@/tmp/.ICE-unix/3396,unix/U-3TSDMAL9IVFAQ:/tmp/.ICE-unix/3396</span><br><span class="line">QT_ACCESSIBILITY=1</span><br><span class="line">COLORTERM=truecolor</span><br><span class="line">XDG_CONFIG_DIRS=/etc/xdg/xdg-ubuntu:/etc/xdg</span><br><span class="line">SSH_AGENT_LAUNCHER=gnome-keyring</span><br><span class="line">XDG_MENU_PREFIX=gnome-</span><br><span class="line">GNOME_DESKTOP_SESSION_ID=this-is-deprecated</span><br><span class="line">GTK_IM_MODULE=fcitx</span><br><span class="line">LANGUAGE=en</span><br><span class="line">LC_ADDRESS=en_US.UTF-8</span><br><span class="line">GNOME_SHELL_SESSION_MODE=ubuntu</span><br><span class="line">LC_NAME=en_US.UTF-8</span><br><span class="line">SSH_AUTH_SOCK=/run/user/408001114/keyring/ssh</span><br><span class="line">XMODIFIERS=@im=fcitx</span><br><span class="line">DESKTOP_SESSION=ubuntu</span><br><span class="line">LC_MONETARY=en_US.UTF-8</span><br><span class="line">GTK_MODULES=gail:atk-bridge</span><br><span class="line">DBUS_STARTER_BUS_TYPE=session</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
  查看单个变量  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$PATH</span></span> </span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/snap/bin</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p><strong><code>bash</code> 常用环境变量</strong> ：</p>
<table>
<thead>
<tr>
<th>环境变量</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>PATH</code></td>
<td>可执行文件查找路径变量。<br/><strong>查找顺序从左向右，找到即停止</strong></td>
<td><code>$ echo $PATH</code> <br/><code>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/snap/bin</code></td>
</tr>
<tr>
<td><code>PS1</code><br/><code>PS[234]</code></td>
<td><code>PS1</code> 环境变量定义了 <code>bash</code> 中的命令后提示符包含的内容<br/>定义中支持的元字符可以查看 <code>man bash</code> 手册</td>
<td><code>PS1=&quot;[\u@\h \W]\\$</code></td>
</tr>
</tbody></table>
<h2 id="bash-命令查找优先级"><a href="#bash-命令查找优先级" class="headerlink" title="bash 命令查找优先级"></a>bash 命令查找优先级</h2><p><code>bash</code> 中命令执行优先顺序如下：</p>
<ul>
<li><strong>Aliases</strong> ： 由 <code>alias</code> 命令配置的命令别名。</li>
<li><strong>Shell 预留的关键字</strong> ： 主要是 Shell 编程中会用到的关键字，如 <code>do</code>、<code>while</code>、<code>case</code>、<code>else</code> 等。</li>
<li><strong>Built-in  Command</strong> ： shell 内嵌的命令，如 <code>cd</code>、<code>echo</code> 等</li>
<li><strong>Filesystem Command</strong> ： 环境变量 <code>PATH</code> 中的命令。</li>
</ul>
<p>要查找命令所在位置，可以使用 <code>type</code> 和 <code>which</code> 命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">type</span> bash</span></span><br><span class="line">bash is /usr/bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">which</span> bash</span></span><br><span class="line">/usr/bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">type</span> -a <span class="built_in">ls</span></span></span><br><span class="line">ls is aliased to `ls --color=auto&#x27;</span><br><span class="line">ls is /usr/bin/ls</span><br><span class="line">ls is /bin/ls</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果要查找命令所在的所有位置，可以使用 <code>type -a ls</code>，如上所示，这会显示 <code>ls</code> 命令所在的所有位置</p>
</blockquote>
<h2 id="bash-环境变量配置优先级"><a href="#bash-环境变量配置优先级" class="headerlink" title="bash 环境变量配置优先级"></a>bash 环境变量配置优先级</h2><p>Linux 系统中的多个配置文件中可以配置环境变量，其中有些会针对所有的用户和 <code>shell</code> 生效，有些只会针对特定的用户生效。</p>
<p>以下表格中列出了常用的环境变量的配置文件：</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>/etc/profile</code></td>
<td><strong>此配置中的环境变量对所有用户生效，在用户登陆时为其配置环境变量</strong> ，它一般会加载（包含）<code>/etc/profile.d</code> 中的配置</td>
</tr>
<tr>
<td><code>/etc/bashrc</code></td>
<td><strong>此配置中的环境变量针对所有的 shell 生效，每次打开一个 <code>bash</code> 时会执行</strong> ，一般会设置包括 <strong>登陆提示</strong> 、 <strong><code>alias</code></strong> 等</td>
</tr>
<tr>
<td><code>~/.bash_profile</code></td>
<td><strong>此配置中的环境变量对 <code>当前登陆</code> 用户生效，仅在用户登陆时为其配置环境变量</strong> ，一般会加载 <code>~/.bashrc</code> 文件</td>
</tr>
<tr>
<td><code>~/.bashrc</code></td>
<td><strong>此配置中的环境变量针对 <code>当前登陆</code> 的用户 <code>bash</code> 生效，并在用户打开每个新的 <code>bash</code> 时执行</strong></td>
</tr>
<tr>
<td><code>~/.bash_logout</code></td>
<td><strong>此配置中的环境变量对 <code>当前登陆</code> 用户生效，仅在 <code>当前登陆用户登出（logout）</code> 时执行</strong></td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241010155400/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20241010155400/" class="post-title-link" itemprop="url">Linux Cockpit 服务</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-10 15:10:00" itemprop="dateCreated datePublished" datetime="2024-10-10T15:10:00+08:00">2024-10-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">常用服务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><a target="_blank" rel="noopener" href="https://cockpit-project.org/">Cockpit 服务官网说明</a></p>
<h1 id="Cockpit-安装"><a href="#Cockpit-安装" class="headerlink" title="Cockpit 安装"></a>Cockpit 安装</h1><p><strong>环境信息</strong>：</p>
<ul>
<li>CentOS Linux 7 (Core) 3.10.0</li>
<li>cockpit-195.12</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cockpit-project.org/running.html#centos">官网安装参考文档</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install cockpit</span><br><span class="line"></span><br><span class="line">sudo systemctl enable --now cockpit.socket</span><br></pre></td></tr></table></figure>

<p>Cockpit 默认监听在 <code>9090</code> 端口，请在防火墙放通此端口。服务启动后，在浏览器中通过 <code>IP:9090</code> 即可登陆。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202405311003/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202405311003/" class="post-title-link" itemprop="url">操作系统导论专业词汇表</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-05-31 10:03:37" itemprop="dateCreated datePublished" datetime="2024-05-31T10:03:37+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-09 10:10:00" itemprop="dateModified" datetime="2024-10-09T10:10:00+08:00">2024-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/OS/Operating-System-Concepts-v10/" itemprop="url" rel="index"><span itemprop="name">Operating System Concepts v10</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>Operating System Concepts v10(操作系统导论第10版)中涉及的相关专业词汇。</p>
<h1 id="memory"><a href="#memory" class="headerlink" title="memory"></a>memory</h1><h2 id="Main-Memory"><a href="#Main-Memory" class="headerlink" title="Main Memory"></a>Main Memory</h2><p><strong>Main Memory</strong> 通常是 CPU 可以直接定位和访问的唯一的大存储设备。如果 CPU 要处理磁盘上的数据，数据必须首先被传输到 <strong>Main Memory</strong>，指令要能被 CPU 执行，也必须首先载入内存中。</p>
<p><strong><code>Program</code></strong> 要能被运行，首先必须载入到内存中，并提供内存绝对地址给 CPU 以供加载指令和数据。</p>
<h2 id="Logical-Memory-Address-and-Virtual-Memory-Address"><a href="#Logical-Memory-Address-and-Virtual-Memory-Address" class="headerlink" title="Logical Memory Address and Virtual Memory Address"></a>Logical Memory Address and Virtual Memory Address</h2><p>通常情况下，CPU 生成的内存地址被称为 <code>Logical Memory Address</code>，也称为 <code>Virtual Memory Address</code>。</p>
<p>Memory-address 注册器（memory-address register）加载的地址通常称为 <code>Physical Memory Address</code>。</p>
<p>程序运行过程中，CPU 操作的是 <code>Virtual Memory Address</code>，需要由硬件设备 MMU（Memory Management Unit）负责将 <code>Virtual Memory Address space</code> 映射到对应的 <code>Physical Memory Address space</code>。程序或者是 CPU 运行过程中，不会直接操作（访问&#x2F;access）物理内存地址空间。</p>
<p><img src="https://i.csms.tech/img_243.png"></p>
<h2 id="DMA"><a href="#DMA" class="headerlink" title="DMA"></a>DMA</h2><p><code>Direct Memory Access (DMA)</code> 在 CPU 需要从存储读写大量数据到内存时，如果数据通过 CPU 中转，成本太高，为了解决这个问题，DMA 被采用，在传输大块数据时，首先在 CPU 中为数据设置好必要的 buffer、指针、计数器等资源，设备控制器（DMA Controller）直接（在磁盘和内存中）传输数据块而无须 CPU 参与实际的数据传输，只需要在数据块传输完成时，向 CPU 产生中断以指示设备控制器（DMA Controller）数据传输已完成。在 DMA 过程中，CPU 依旧可以做其他工作。 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Operating System Concepts v10 Online](https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf) 1.2.3 I/O Structure">[1]</span></a></sup></p>
<h2 id="Dynamic-Linking-and-Shared-Libraries"><a href="#Dynamic-Linking-and-Shared-Libraries" class="headerlink" title="Dynamic Linking and Shared Libraries"></a>Dynamic Linking and Shared Libraries</h2><p>DLLs(Dynamic Linked Libraries) 是程序运行期间需要链接的系统库文件（system libraries）。<sup id="fnref:6"><a href="#fn:6" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Operating System Concepts v10 Online](https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf) 9.1.5 Dynamic Linking and Shared Libraries">[6]</span></a></sup> </p>
<p>部分操作系统不支持 DLLs 机制，只能使用 <strong>静态链接</strong>（<code>static linking</code>），在这种情况下，应用程序运行过程中需要使用的系统库文件必须和应用程序一起编译进应用程序镜像（program image）中。假如多个应用程序使用了同样的库文件，那么这些库文件会同时存在于这些应用程序的程序镜像文件中，这些应用程序运行过程中也会在内存中加载多份同样的库文件。这可能会产生以下缺点：</p>
<ul>
<li>应用程序镜像较大，占用更多磁盘空间</li>
<li>应用程序运行时，因为要加载多个同样的库文件，会占用更多的内存</li>
<li>库文件升级不灵活，要升级某个库文件，要重新编译所有使用此库文件的应用程序。</li>
</ul>
<p>DLLs(Dynamic Linked Libraries) 是在运行过程中，动态加载库文件。这个特性在系统库文件（如 standard C language library）中很常用。程序编译过程中及运行过程中动态加载系统库文件，无需将系统库文件打包进应用程序镜像中，应用程序运行过程中动态加载系统库文件，如果要加载的目标系统库文件已经存在于内存中，则无需重复加载，直接共享使用即可。DLLs 有以下优势：</p>
<ul>
<li>应用程序镜像无需包含常用的库文件，减少了磁盘使用量</li>
<li>应用程序运行时，可以在多个进程中共享库文件，无需重复加载（只存在一个库实例即可），减少了内存使用率并提升了内存效率</li>
<li>共享库文件升级后，所有加载此库文件的应用程序都可以直接使用更新后的新版本。<strong>应用程序和库文件中都包含了相应的版本信息，会防止应用程序使用错误的库版本</strong></li>
<li>内存中可以加载多个版本的共享库文件，应用程序会使用自己的库文件版本信息加载正确的库文件</li>
</ul>
<h2 id="Memory-Allocation"><a href="#Memory-Allocation" class="headerlink" title="Memory Allocation"></a>Memory Allocation</h2><h3 id="Fragmentation"><a href="#Fragmentation" class="headerlink" title="Fragmentation"></a>Fragmentation</h3><p>假设在一个全新的未运行任何应用程序的操作系统中，初始情况下内存中存在一整块连续的可用地址范围（one large block of available memory），或者叫一个 <code>Hole</code>。</p>
<p>假设如下图所示情况，系统中运行了 processes 5, 8, and 2 并且占用了所有的内存地址范围。之后 process 8 退出，其所使用的内存释放，形成了一个 <code>Hole</code>，随后 process 9 开始运行并申请了一段内存，随后 process 5 退出并释放内存，导致内存中出现了 2 个地址非连续（noncontigous）的 <code>Hole</code>。<strong>随着系统中进程的运行和退出，内存中可能会存在很多大小不一，地址范围不连续的 Hole</strong>，这些 <code>Hole</code> 既是 <strong>外部内存碎片（<code>External Memory Fragmentation</code>）</strong></p>
<p><img src="https://i.csms.tech/img_244.png"></p>
<p><strong>外部内存碎片（<code>External Memory Fragmentation</code>）</strong> 存在时，可能出现系统有足够多的空闲内存（非连续的地址空间，内存碎片）但是这些内存都是内存碎片。</p>
<p>在现代的内存管理中，内存的分配一般是以 <code>block</code> 为单位进行分配，<code>block</code> 是一个固定大小的内存。在这种情况下，假如 <code>block</code> 大小为 512 bytes，应用程序申请了 600 bytes 内存，那么需要分配 2 个 <code>block</code> 给应用程序，实际分配了 1024 bytes 。申请的内存（600 bytes）和实际分配的内存（2 blocks &#x3D; 1024 bytes）之间的差值被称为 <strong><code>内部内存碎片</code>（Internal Memory Fragmentation）</strong></p>
<h2 id="Paging"><a href="#Paging" class="headerlink" title="Paging"></a>Paging</h2><p>在当前的操作系统中，解决 <strong>外部内存碎片（<code>External Memory Fragmentation</code>）</strong> 的问题，通用解决方法是采用 <strong>内存页（Memory Paging）</strong> 技术： <strong>应用程序申请的 Logical 内存&#x2F;Physical 内存地址非连续（横跨多个 Hole）</strong></p>
<p>Paging 解决了 <strong>外部内存碎片（<code>External Memory Fragmentation</code>）</strong> 的问题，没有解决 <strong><code>内部内存碎片</code>（Internal Memory Fragmentation）</strong></p>
<h2 id="Virtual-Memory"><a href="#Virtual-Memory" class="headerlink" title="Virtual Memory"></a>Virtual Memory</h2><p>Virtual Memory 提供了 <strong>允许程序运行过程中，无需将整个程序内容全部加载到内存中的技术</strong> <sup id="fnref:7"><a href="#fn:7" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Operating System Concepts v10 Online](https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf) CHAPTER 10 Virtual Memory">[7]</span></a></sup></p>
<p>主要有以下优势：</p>
<ul>
<li>程序大小可以大于物理内存空间。开发者不必再关注物理内存是否足够。</li>
<li>Virtual Memory 将 main memory 抽象成一个统一的大存储阵列，基于此，程序开发者可以不用关注物理内存的差异和限制。</li>
<li>允许进程共享文件和库，并实现了共享内存（shared memory）。</li>
</ul>
<h2 id="Page-Fault"><a href="#Page-Fault" class="headerlink" title="Page Fault"></a>Page Fault</h2><p>Virtual Memory 提供了 <strong>允许程序运行过程中，无需将整个程序内容全部加载到内存中的技术</strong>，实现此技术主要使用了 <code>Demand Paging</code> 技术，使用 <code>demand-paged virtual memory</code>，可以实现程序运行过程中，仅仅在 <strong>运行过程中必须的 pages 才会被加载到内存中，那些没有用到的 pages 永远不会加载到物理内存中</strong>，<code>Demand Pageing</code> 也是 Virtual Memory 的一个主要优势。</p>
<p><code>Demand Paging</code> 技术的实现依赖于硬件的支持和 <code>Page Fault</code> 技术。</p>
<p>根据 <code>Demand Paging</code> 方案的原则，<strong>程序运行过程中用不到的 Pages 不应该被加载到内存中</strong>。因此，当一个程序刚刚启动时，它之后运行过程中所需的 Pages 理论上都不在内存中，而是存在于次级存储（secondary storage，如磁盘或者 swap）中，如果 <strong>程序运行过程中需要内存中不存在的 Pages，这时就要有机制确保实现将程序运行所需的 Pages 加载到内存中来，并且只是加载程序运行所需的 Pages，而不会加载用不到的 Pages</strong>，实现此机制的技术叫 <code>Page Fault</code>。</p>
<p><code>Page Fault</code> 需要硬件支持，主要是内存组件中的硬件设备（Paging Hardware，负责 page table 内存地址转换），当程序运行过程中需要不存在于内存中的 Pages 时，会向 OS 产生一个 <code>Page Fault</code> 的 trap，此 trap 是一个 OS Failure（指示所需 Pages 不在内存中），硬件会注意到此 OS Failure 并进行相应处理。</p>
<p>操作系统处理 <code>Page Fault</code> 的简要工作流程如下：</p>
<ol>
<li>检查并确保此内存请求合法后，如果所需的 pages 不在内存中，开始将其加载入内存（page in）</li>
<li>在物理内存中找到空闲的 frame（free frame）</li>
<li>向次级存储（secondary storage，如磁盘或者 swap）发送读取所需 Pages 到新分配的 frame 的请求</li>
<li>当存储（Pages）读取到内存完毕后，修改程序所属的 internal table 和 page table 以指示所需的 Pages 已经在内存中 </li>
<li>重新启动因为缺少所需 Pages 而被中断（interrupted）的指令（instruction）</li>
</ol>
<p><img src="https://i.csms.tech/img_246.png"></p>
<h3 id="Major-Page-Fault"><a href="#Major-Page-Fault" class="headerlink" title="Major Page Fault"></a>Major Page Fault</h3><p><code>Major Page Fault</code> 发生于所需要的 Page 不在内存中，这是系统需要在物理内存中找到可用的 Frames，然后将数据从 <strong>次级存储（secondary storage，如磁盘或者 swap）</strong> 读取到内存中并更新对应的  <code>internal table</code> 和 <code>page table</code> 以指示所需的 Pages 已经在内存中</p>
<h3 id="Minor-Page-Fault"><a href="#Minor-Page-Fault" class="headerlink" title="Minor Page Fault"></a>Minor Page Fault</h3><p><code>Minor Page Fault</code> 发生在以下 2 中情况：</p>
<ol>
<li>应用程序需要引用共享库，此共享库已经在内存中，但是应用程序的 <code>page table</code> 中没有到此共享库所在内存页的 mapping。此种情况下，只需要更新应用程序的 <code>page table</code>，向其中添加到共享内存库所在内存页的引用。</li>
<li>Virtual Memory 中的 Page 被应用程序释放（reclaimed），对应物理内存 Frame 被标记为 <code>free-frame</code>，但是上面的数据未被 <code>zeroed out</code>，此时 Page 被分配给其他应用程序。</li>
</ol>
<p>Linux 系统中，使用 <code>ps</code> 命令的 <code>-eo min_flt,maj_flt,cmd</code> 参数可以查看进程相关的 major 和 minor page fault。</p>
<h2 id="Page-Relpacement"><a href="#Page-Relpacement" class="headerlink" title="Page Relpacement"></a>Page Relpacement</h2><p>现代的操作系统内存，一般都允许 <strong>超分配（over-allocating）</strong>，即允许操作系统分配比实际的物理内存更多的内存给应用程序，当一个应用程序运行过程中，因为 Page Fault 要 Page In 时，可能会出现物理内存不足（no free frames on the free-frame list）的情况，此时操作系统会尽最大可能的满足应用程序对内存的申请。以前的操作系统大都采用 Swap 来实现，即将当前未在 CPU 上运行的应用程序使用的内存 swap out 到 Swap 中，并将空余出来的内存分配给要运行的程序使用。<strong>Swap 技术已被当前大多数操作系统摈弃，因为其在内存和 Swap 中拷贝数据成本太高</strong>，取而代之的技术是 <code>Page Repalcement</code>。</p>
<p>使用 Page Relpacement 技术，在物理内存不足时，使用 page-replacement 算法找到物理内存中的 Frames（victim frames），将其上的内容写入（<strong>如果其上内容未改变，不用执行写入操作，如果内容改变，执行写操作</strong>）到次级存储（secondary storage），如果之后的运行过程中，应用程序需要这些数据，它会产生 Page Fault，这些数据会被重新加载回内存中。 </p>
<h2 id="Memory-Compression"><a href="#Memory-Compression" class="headerlink" title="Memory Compression"></a>Memory Compression</h2><p><code>Memory Compression</code> 是在物理内存不够时，使用的一种可替代 <code>Page Repacement</code> 的技术。在系统内存不足时，系统不执行 <code>Page Replacement</code>，而是先对选择出的 <code>victim frames</code> 执行内存压缩，将多个 frames 压缩成一个 frame 进而降低内存使用率，而无需进行 <code>Page Swapping out</code> 操作。</p>
<blockquote>
<p>移动设备操作系统，包括 Android 和 IOS 都不支持 <code>Swap</code> 和 <code>Page Repalcement</code>，都采用了 <code>Memory Compression</code> 技术作为 Memory Management strategy 的一部分</p>
<p><strong>在性能方面，<code>Memory Compression</code> 拥有比 <code>Page Repalcement</code> 更快的速度。</strong></p>
</blockquote>
<h2 id="Kernel-Memory"><a href="#Kernel-Memory" class="headerlink" title="Kernel Memory"></a>Kernel Memory</h2><p>内核（kernel）使用的内存和用户模式（user mode space）中的应用程序使用的内存分配机制不同。主要基于以下原因： <sup id="fnref:8"><a href="#fn:8" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Operating System Concepts v10 Online](https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf) 10.8 Allocating Kernel Memory">[8]</span></a></sup></p>
<ul>
<li>Kernel 中的数据结构大小差异很大，很多都比 Page Size 要小，内存使用不当会导致非常多的 <code>internal fragmentation</code>，导致内存严重浪费。而且很多操作系统并未将内核代码放置到 Paging Memory 中。</li>
<li><code>user-mode</code> 中的应用程序分配的内存在物理内存地址上没必要是连续地址空间，然而内核中包含的很多硬件设备都需要直接通过物理内存进行交互，无法使用 <code>Virtual Memory Interface</code>，因此需要内存中连续的地址空间（contiguous pages）分配</li>
</ul>
<h1 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h1><h2 id="SMP"><a href="#SMP" class="headerlink" title="SMP"></a>SMP</h2><p><code>Symmetric Multiprocessing (SMP)</code>，对称处理系统，在系统中存在多个处理器，每个处理器中包含一个或多个 CPU，每个 CPU 有自己的 L1 Cache （CPU 独享）和 Register，每个处理器有 L2 Cache（处理器中的多个 CPU 共享 L2 cache），同一个处理器中的 CPU 使用处理器内部通信系统通信，跨处理器的 CPU 之间通过系统总线（Bus）通信。 <sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Operating System Concepts v10 Online](https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf) 1.3.2 Multiprocessor Systems">[2]</span></a></sup></p>
<h2 id="NUMA"><a href="#NUMA" class="headerlink" title="NUMA"></a>NUMA</h2><p><strong>系统中的处理器不宜太多，多处理器可以提高系统的任务处理能力，但是当 CPU 过高时，对系统总线的争抢会成为系统瓶颈。</strong></p>
<p>为了避免太多 Processors 争抢系统总线造成的性能下降，一个可选的 方法是为每个 CPU（或 CPU 集）提供专用的本地内存，CPU 通过一个更小更快的本地 bus 连接专用的本地内存。所有的 CPU 通过一个 <strong>内部通信系统</strong> 进行连接，所有 CPU 共享同一个物理地址空间，这种架构被称为 <code>Non-uniform Memory Access (NUMA)</code></p>
<p><img src="https://i.csms.tech/img_236.png"></p>
<h2 id="Program-and-Process"><a href="#Program-and-Process" class="headerlink" title="Program and Process"></a>Program and Process</h2><p><strong><code>Program</code></strong> 是一个静态实体，只是存储在操作系统中的文件（集合）</p>
<p><strong><code>Process</code></strong> 是操作系统上的活动（Active）实体，是 <strong><code>Program</code></strong> 由操作系统加载运行之后的实体。</p>
<p><strong><code>Process</code></strong> 运行过程中需要操作系统为其分配各种资源，如 CPU、Memory、Files、IO 等来完成其运行。</p>
<p>如果一个 <strong><code>Program</code></strong> 被操作系统运行（启动）了多次，那么其产生的多个 <strong><code>Process</code></strong>  属于分割（单独）的实体。</p>
<h3 id="Process-Control-Block"><a href="#Process-Control-Block" class="headerlink" title="Process Control Block"></a>Process Control Block</h3><p>PCB (<code>Process Control Block</code>) 代表了 OS 中进程（Process）的各种信息，包括</p>
<ul>
<li><code>Process State</code> : 进程当前的状态</li>
<li><code>Program counter</code> : 程序计数器指针。指向了当前进程中下一个要执行的指令的地址。</li>
<li><code>CPU registers</code> : 根据计算机架构的不同，可能包括计数器、栈指针（stack pointers）、通用指针（general-purpose registers）等。</li>
<li><code>CPU-scheduling information</code> : 包括进程优先级（process priority）信息、调度队列指针（pointers to scheduling queues）以及其他调度参数等。</li>
<li><code>Memory-management information</code> : 进程使用的内存信息</li>
<li><code>Accounting information</code> : CPU 数量和 CPU 使用时间，CPU 使用限制，进程数量等信息</li>
<li><code>I/O status information</code> : 分配给进程的 IO 设备，打开的文件列表等。</li>
</ul>
<p><img src="https://i.csms.tech/img_240.png"></p>
<h2 id="Scheduling-Queues"><a href="#Scheduling-Queues" class="headerlink" title="Scheduling Queues"></a>Scheduling Queues</h2><p><img src="https://i.csms.tech/img_241.png"></p>
<ul>
<li><code>ready queue</code> : 进程开始后，会被放入 <code>ready queue</code>，等待 CPU 被分配给它。<code>ready queue</code> 是一个 <strong>链接队列</strong>，其首部包含一个指向队列中第一个 PCB 的指针，每个 PCB 都包含一个指针，指向 <code>ready queue</code> 中的下一个 PCB。</li>
<li><code>wait queue</code> : 当 <code>ready queue</code> 中的进程被分配了 CPU 后，其执行一段时间后会中止或者是等待特殊事件，如 IO，在起等待的过程中会被放入 <code>wait queue</code></li>
</ul>
<blockquote>
<p><strong>操作系统负载（system load）</strong> 衡量的就是在 Scheduling Queues 中的进程（线程）的数量。即有多少任务等待 CPU 空闲以运行。</p>
</blockquote>
<h2 id="Context-Switch"><a href="#Context-Switch" class="headerlink" title="Context Switch"></a>Context Switch</h2><p>CPU 会频繁的调度（因为 CPU Schedule 或 Interrupts）不同的进程来执行，当调度发生，OS 需要保存当前进程的上下文信息（Context）以备当前进程再次开始执行时恢复 Context，Context 信息保存在 <a href="#Process-Control-Block">PCB</a> 中</p>
<p>切换 CPU core 要保存当前进程的 Context (到 PCB)并恢复另一个进程的 Context（从 PCB），这个过程被称为 <code>Context Switch</code></p>
<p><img src="https://i.csms.tech/img_242.png"></p>
<blockquote>
<p>在现代化的操作系统上，OS 调度的更多的是 <code>kernel-level threads</code>，而不是 <strong>processes （进程）</strong></p>
</blockquote>
<h2 id="Processor-Affinity"><a href="#Processor-Affinity" class="headerlink" title="Processor Affinity"></a>Processor Affinity</h2><p>Processes 在指定的 CPU 上运行的过程中，一般会加载数据到 CPU 的 cache 中，下一次调度到同一个 CPU 运行时，仍然可以使用 Cache 中的数据（称为 <code>warm cache</code>）。 <sup id="fnref:5"><a href="#fn:5" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Operating System Concepts v10 Online](https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf) 5.5.4 Processor Affinity ">[5]</span></a></sup></p>
<p>假如后续 CPU 调度时，此进程被调度到了另一个 CPU，那么原来 CPU Cache 中的数据就要失效，新的 CPU 必须从新加载数据到 Cache 中。<strong>因为让 CPU Cache 中的数据失效和加载 Memroy 中的数据到 Cache 中是一个成本较高的操作，现代的 SMP 操作系统都会避免这类缓存迁移操作，会尽量将进程调度到同一个 CPU 以使用 <code>warm cache</code> 数据</strong>，这就是 <code>Processor Affinity</code>，一个进程对其正在运行的 CPU 拥有亲和性。</p>
<p>常见的 CPU 亲和性（Processor Affinity）有两类：</p>
<ul>
<li><code>soft affinity</code> : 尽量保证一个进程被调度到同一个 CPU，但是不保证一定，尽最大可能</li>
<li><code>hard affinity</code> : 允许配置进程只运行在选定的 CPU 集（subset of processors）</li>
</ul>
<p>大多数系统同时实现了以上两种类型。 </p>
<h1 id="Disk"><a href="#Disk" class="headerlink" title="Disk"></a>Disk</h1><p>可以将 NVS （<code>Nonvolatile Storage (NVS)</code>）根据硬盘组成划分成 2 大类</p>
<ul>
<li>机械硬盘（Mechanical）： HDDs，Optical Disks，Holographic storage，Magnetic Tape。</li>
<li>Electrical（NVM）： Flash Memory，FRAM，NRAM，SSD</li>
</ul>
<h2 id="HDD"><a href="#HDD" class="headerlink" title="HDD"></a>HDD</h2><p><img src="https://i.csms.tech/img_247.png"><br>HDD （Hard Disk Driver）的主要组成如上图。主要包括以下主要组件： <sup id="fnref:9"><a href="#fn:9" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Operating System Concepts v10 Online](https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf) 11.1.1 Hard Disk Drives">[9]</span></a></sup></p>
<ul>
<li><p><code>Platter</code><br>  Platter 的两面由磁性材料（magnetic material）覆盖组成。</p>
</li>
<li><p><code>Read-Write Head</code><br>  Platter 的两面分别有个 <code>Read-Write Head</code> (读写磁头) 负责在磁碟（Platter）上写入&#x2F;读取数据。磁头和 Platters 之间一般由一层非常薄的气体作为保护层，如氦气（helium），磁头和 Platter 表面接触会造成 Platter 表面的磁性材料损坏，这被称为 <code>Head Crash</code>，一般无法修复，磁盘上面数据会丢失。</p>
</li>
<li><p><code>Disk Arm</code><br>  Disk Arm 连接了 <code>Read-Write Head</code> (读写磁头) 和 <code>Arm Assembly</code>，<code>Read-Write Head</code> (读写磁头) 通过 Disk Arm 的移动来寻址到不同的存储单元。</p>
</li>
<li><p><code>Tracks</code><br>  Platter 的面被（逻辑&#x2F;Logically）分割成圆弧形（两个不同半径的圆分割组成的部分）</p>
</li>
<li><p><code>Sectors</code><br>  <code>Tracks</code> 被逻辑（Logically） 分割成 <code>Sectors</code>  （扇形），Sectors 是 HDD 磁盘上最小的传输单元，一般有固定大小的存储空间（2010 年前一般是 512 bytes，之后大多升级到了 4KB）。每个 Track 上面包含多个 Sectors。</p>
</li>
<li><p><code>Cylinder</code><br>  每个 Platter 上面，固定位置的 <code>Disk Arm</code> &#x2F; <code>Read-Write Head</code> 垂直组成的存储单元组成一个 <code>Cylinder</code> 。每个磁盘上面会包含很多个同心的（Concentric） Cylinder</p>
</li>
</ul>
<p>HDD 磁盘中包含一个高速旋转的 <strong>马达（disk driver motor）</strong>，HDD 磁盘的传输速度（<code>Transfer Rate</code>）和马达的旋转速度相关，通常使用 <strong><code>RPM(Rotations Per Minute)</code></strong> 来衡量 HDD 磁盘的转速，通常在 5400&#x2F;7200&#x2F;15000 RPM。有些 HDD 磁盘在电量不足或者使用频率低时会降低 RPM 来节能和提高磁盘使用寿命。</p>
<p><code>Transfer Rate</code> 是衡量数据在 HDD 磁盘和操作系统之间传输速度的指标。这个性能指标主要受到 <strong>寻址时间（Positioning Time）</strong> 或者叫 <code>Random-Access Time</code> 的影响，这个时间主要由 2 部分组成，一般在 <strong>几毫秒（several milliseconds）</strong></p>
<ol>
<li><code>Seek Time</code> : Disk Arm 移动到目标 Cylinder 的时间</li>
<li><code>Rotational Latency</code> : 目标 Sector 移动到 Disk Read Wirte Head 的延迟。</li>
</ol>
<h2 id="NVM"><a href="#NVM" class="headerlink" title="NVM"></a>NVM</h2><p> <code>Nonvolatile Memory Devices (NVM)</code> 使用电特性（Electrical）存储，而不是机械（mechanical）特性，相比 HDD，其拥有更高的可靠性和性能（没有 Seek Time 和 Rotational Latency），更加的省电，劣势是他们价格相对 HDD 更贵并且存储空间相对较小，但是随着时间推移，这些劣势也会逐渐消弭。</p>
<p>NVM 存储的 <strong>写入性能</strong> 通常和其存储可用大小相关，因为 NVM 设备内部通常会保留部分空间用于 <code>Garbage Collection</code> 和 <code>Over-Provisioning</code>（通常为 20%），如果可用空间小，会导致 <strong>写性能</strong> 下降。</p>
<p><strong>NVM 设备的寿命和其 Erase 的次数正相关</strong></p>
<h2 id="Error-Detection-and-Correction"><a href="#Error-Detection-and-Correction" class="headerlink" title="Error Detection and Correction"></a>Error Detection and Correction</h2><p><strong>Error Detection</strong> 是计算机系统中最基础的功能之一，普遍用于 Memory、Network、Storage 系统中。Error Detection 的常见功能包括：</p>
<ul>
<li>检测存储中存储的数据是否发生了（错误&#x2F;非自发&#x2F;无意的）改变，比如某个数据位由 0 变为了 1</li>
<li>网络数据在传输过程中发生了改变</li>
<li>存储设备上的数据读写不一致。<br>通过检测这些错误，可以防止在使用这些错误数据之前对其进行修正或者是发送通知给使用者。</li>
</ul>
<h3 id="Parity-Bit"><a href="#Parity-Bit" class="headerlink" title="Parity Bit"></a>Parity Bit</h3><p>Memory 长使用 <code>Parity Bit (奇偶校验位)</code> 算法进行 Error Detection，Memory 系统中的每个 Byte 都有一个对应的 <code>Parity Bit</code>，此 <code>Parity Bit</code> 记录了对应的 byte 中 <code>1</code> 出现的次数是 <strong>偶数（even，<code>Parity Bit = 0</code>）</strong> 还是 <strong>奇数(odd, <code>Parity Bit = 1</code>)</strong></p>
<p>根据 <code>Parity Bit</code> 算法的计算结果，会出现以下情况：</p>
<ul>
<li>Memory 中的一个 byte 中的一个 bit 位发生了改变，那么此 byte 计算出的 Parity Bit 值和保存的 Parity Bit 值不一样，<strong>说明数据不可靠</strong></li>
<li>Memory 中的一个 byte 中的任何 bit 都正常，但是保存的 Parity Bit 值发生了变化，那么此 byte 计算出的 Parity Bit 值和保存的 Parity Bit 值不一样，<strong>说明数据不可靠</strong></li>
<li>Memory 中的一个 byte 计算出的 Parity Bit 值和保存的 Parity Bit 值一致，<strong>说明数据可靠</strong></li>
</ul>
<p><strong>Parity Bit 无法检测 2 个 bit 位的错误，因为 2 个 bit 位的数据错误，其正确计算出来 Parity Bit 的值不变。</strong></p>
<p><strong>Parity Bit 容易实现并且计算起来非常的快，但是因为 Parity Bit 的存在，会为每个 byte 增加一个 bit 的大小</strong></p>
<h3 id="CRCs"><a href="#CRCs" class="headerlink" title="CRCs"></a>CRCs</h3><p>CRCs (Cyclic Redundancy Check) 是网络传输中常用的 Error Detection 算法。可以检测到多个 bit 位的错误。</p>
<h3 id="ECC"><a href="#ECC" class="headerlink" title="ECC"></a>ECC</h3><p>ECC (Error Correction Code) 算法不仅可以检测到数据错误，并且可以尝试恢复数据。</p>
<h2 id="EEPROM"><a href="#EEPROM" class="headerlink" title="EEPROM"></a>EEPROM</h2><p><code>EEPROM(Electrically Erasable Programmable Read-Only Memory)</code> 是主板上的一个 NVM Flash Memory Firmware。</p>
<p>服务器上电运行后启动的第一个程序是 <code>bootstrap loader program</code> （操作系统启动引导程序，如 Linux 中的 <code>grub2</code>，其启动之后会加载操作系统）。RAM 是易失性存储，不能将 <code>bootstrap program</code> 放置到 RAM 中，当下主机会使用 EEPROM 放置 <code>bootstrap program</code>。<code>bootstrap program</code> 可以被修改，但是不能频繁修改，它属于慢速存储，其中包含了不经常会使用的静态程序和数据。比如 iPhone 使用了 EEPROM 存储了设备 <code>serial numbers</code> 和 <code>hardware information</code></p>
<h2 id="RAID"><a href="#RAID" class="headerlink" title="RAID"></a>RAID</h2><p><code>RAID (Redundant Arrays of Independent Disks)</code> 。</p>
<h3 id="RAID-0-Striping-Volume"><a href="#RAID-0-Striping-Volume" class="headerlink" title="RAID 0: Striping Volume"></a>RAID 0: Striping Volume</h3><p>RAID 0，Striping Volume，条带卷，在多个存储设备上面，以 Block 为基本单位组成条带（Strip），数据分散写入到每个存储设备的对应的条带上，读取时从多个设备上的对应条带中读取。</p>
<ul>
<li><strong>不提供任何冗余（Redundancy）</strong>，任意存储设备损坏，会导致整个存储系统上的数据损坏</li>
<li><strong>有极高的读写速度</strong>，在多个设备上并发的读写</li>
<li><strong>存储设备利用率 100%</strong></li>
</ul>
<h3 id="RAID-1-Mirrored-Volume"><a href="#RAID-1-Mirrored-Volume" class="headerlink" title="RAID 1: Mirrored Volume"></a>RAID 1: Mirrored Volume</h3><p>由 2 或多块物理存储设备（physical storage device）组成一个逻辑存储设备（logical disk），每次写入数据时，同时写入到 2 个或多个物理存储设备。</p>
<ul>
<li><strong>提供冗余（Redundancy）</strong>，数据同时写入 2 个或多个物理存储设备上，只有在所有数据盘都损坏的情况下数据才会损坏</li>
<li><strong>有极高的读取速度</strong>，可以从每个镜像盘读取数据</li>
<li><strong>数据写入速度降低</strong>，因为要将数据写入多个数据盘，可能会导致写入速度下降</li>
<li><strong>存储设备利用率 50%</strong></li>
</ul>
<h3 id="RAID-4-Block-Interleaved-Parity"><a href="#RAID-4-Block-Interleaved-Parity" class="headerlink" title="RAID 4: Block-Interleaved Parity"></a>RAID 4: Block-Interleaved Parity</h3><p>RAID 4 使用 RAID 0 的 Strip（条带）作为基础，至少需要 3 块数据盘。数据存储以 Block 为单位。</p>
<p>假设由 3 块数据盘组成 RAID 4，数据写入过程如下：</p>
<ol>
<li>写入数据的第一个 block 写入到第 1 块数据盘中，第二个 block 写入到第 2 块数据盘中，对写入第一块盘和第二块盘上的这 2 个 block 做 Error Correcting Code 计算，计算结果存储在第 3 块数据盘中。</li>
<li>第三个 block 继续写入到第 1 块数据盘中，第四个 block 写入到第 2 块数据盘中，对此 2 个 block 做 Error Correcting Code 计算，计算结果存储在第 3 块数据盘中</li>
<li>依次类推，直到数据写入完成。</li>
</ol>
<ul>
<li>其中一块盘存储了 Error Correction Code</li>
<li>假如其中一个数据盘或其上的一个 Block 损坏，那么这块数据可以根据其他盘上的数据和 Error Correction Code 做计算进行恢复</li>
<li><strong>有极高的读写速度</strong>，在多个设备上并发的读写。</li>
<li><strong>存储设备利用率 (N-1)&#x2F;N</strong></li>
</ul>
<h3 id="RAID-5-Block-Interleaved-Distributed-Parity"><a href="#RAID-5-Block-Interleaved-Distributed-Parity" class="headerlink" title="RAID 5: Block-Interleaved Distributed Parity"></a>RAID 5: Block-Interleaved Distributed Parity</h3><p>和 RAID 4 唯一的不同是： <strong>RAID 4 使用一个单独的盘存储了 Error Correction Code（Parity Bit），RAID 5 将 Error Correction Code（Parity Bit）分布存储在所有数据盘上</strong>，通过将 Parity 分布到所有的数据盘上，避免了专用的 Parity Block 的盘压力太大。</p>
<h3 id="RAID-6-P-Q-redundancy-scheme"><a href="#RAID-6-P-Q-redundancy-scheme" class="headerlink" title="RAID 6: P + Q redundancy scheme"></a>RAID 6: P + Q redundancy scheme</h3><p>RAID 6 为每 4 个 Block 保留了 2 个冗余（Redundant）的 Block，使用了更复杂的算法来进行 Error Detect 和 Error Correcting，可以支持 2 块数据盘损坏。</p>
<h3 id="RAID-10"><a href="#RAID-10" class="headerlink" title="RAID 10"></a>RAID 10</h3><p><img src="https://i.csms.tech/img_248.png"><br>RAID 10 的结构：</p>
<ul>
<li>首先将硬盘分成多个镜像组（RAID 1），每个镜像组包含两个或多个硬盘。</li>
<li>然后将这些镜像组组合成一个条带组（RAID 0）。</li>
</ul>
<p>优缺点：</p>
<ul>
<li><p>高数据冗余：每个数据块都有一个镜像副本，因此可以抵抗单个硬盘故障。</p>
</li>
<li><p>高读写性能：通过条带化技术，可以提高读写速度。</p>
</li>
<li><p>成本较高：需要至少四个硬盘，而且有效存储容量只有硬盘总数的一半。</p>
</li>
</ul>
<h3 id="RAID-01"><a href="#RAID-01" class="headerlink" title="RAID 01"></a>RAID 01</h3><p>RAID 01 的结构：</p>
<ul>
<li>首先将硬盘分成多个条带组（RAID 0），每个条带组包含两个或多个硬盘。</li>
<li>然后将这些条带组组合成一个镜像组（RAID 1）。</li>
</ul>
<p>优缺点：</p>
<ul>
<li><p>高读写性能：通过条带化技术，可以提高读写速度。</p>
</li>
<li><p>数据冗余：整个条带组被镜像，因此可以抵抗硬盘故障。</p>
</li>
<li><p>成本较高：需要至少四个硬盘，而且有效存储容量只有硬盘总数的一半。</p>
</li>
<li><p>数据恢复复杂：如果一个硬盘发生故障，整个条带组都需要被重建，恢复时间较长。</p>
</li>
</ul>
<p><strong>RAID 10 和 RAID 01 在单一硬盘故障时的恢复方式基本一致，都是从对应的镜像组恢复数据到故障硬盘。</strong> 在涉及到多个硬盘的故障的情况下，RAID 10 相比 RAID 01 拥有更多的优势：</p>
<ul>
<li>RAID 10 提供了更高的冗余性和恢复灵活性，因为它允许多个独立的镜像组。</li>
<li>RAID 10 可以承受每个镜像组中的一个硬盘故障而不影响整体系统。</li>
<li>RAID 01 在任一条带组中失效的硬盘超过一个时，会导致整个 RAID 组不可用。</li>
</ul>
<h1 id="File-System"><a href="#File-System" class="headerlink" title="File System"></a>File System</h1><p><code>File Systems</code> 为访问（<code>stored</code>、<code>located</code>、<code>retrieve</code>）存储系统（Storage）上存储的文件提供了高效和便利的途径（方式）。文件系统的设计主要涉及到以下问题： <sup id="fnref:10"><a href="#fn:10" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Operating System Concepts v10 Online](https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf) 14.1 File-System Structure">[10]</span></a></sup></p>
<ul>
<li>File System 对用户（User）应该如何呈现。包括如何定义文件以及文件属性，允许哪些操作，目录结构是怎样的（如何组织）</li>
<li>使用怎样的算法来创建文件或者目录结构，以及如何将逻辑上的文件（logical files system）和物理存储（硬件）上的内容进行对应</li>
</ul>
<p>File System 通常由多个功能分层（Levels or layers）构成，其中 <strong>下层为上层提供服务，上层利用下层提供的服务来构建文件系统的功能（特性）</strong></p>
<p><img src="https://i.csms.tech/img_258.png"></p>
<p>在如上图所示的分层的文件系统架构中，主要包括以下层：</p>
<ul>
<li><code>I/O control</code> : 主要由存储设备驱动器（Device Drivers）和中断控制器（interrupt handlers）组成。主要功能是在存储设备和主内存之间传输数据。它接受更高层的指令（如 <code>retrieve block 123</code>），并将此指令转换为能被存储设备驱动器识别的针对存储硬件设备的指令。</li>
<li><code>basic file system</code> : 在 Linux 系统中被称为 <code>“block I/O subsystem</code>。这一层的主要功能是将上层的通用的读写 block 的指令发布给正确的存储设备驱动器（device driver）来读写存储设备上的 block。它发送给存储设备驱动器（device driver）的是 <strong>逻辑块地址（Logical block address）</strong>，它还负责 IO request scheduling 以及 buffers 和 caches。</li>
<li><code>file-organization module</code> : 主要存储了文件和他们对应的 <code>logical blocks</code> 的信息。还包括 <code>free-space manager</code>，用来跟踪未分配的 <code>logical blocks</code>，当 <code>file-organization module</code> 需要空闲块时提供空闲的块地址信息。</li>
<li><code>logical file system</code> : 负责管理 <code>metadata</code> 信息。Metadata 信息存储了所有的文件系统结构信息（包括 <strong>目录结构</strong>、<strong>文件名</strong>），只是不包括具体的数据。关键信息包括 FCB (<code>file-controle blocks</code>，即 <code>inode</code>)，存储了文件的具体信息如 <code>owership</code>、<code>permissions</code>、<code>locations of file contents(location of logical blocks)</code>。</li>
</ul>
<h2 id="system-wide-open-file-table-And-per-process-open-file-table"><a href="#system-wide-open-file-table-And-per-process-open-file-table" class="headerlink" title="system-wide open-file table And per-process open-file table"></a>system-wide open-file table And per-process open-file table</h2><p>大多数操作系统再打开并使用文件之前，都需要（implicitly or explicitly）系统调用 <code>open()</code>，操作系统维护了一个 <code>open-file table</code>，维护着所有的打开文件的信息。当一个文件操作（如读，写，执行等）被请求前，系统调用 <code>open()</code>，文件会通过一个 <code>index</code> 被加入到 <code>open-file table</code>，当文件不在使用时，<code>open-file table</code> 中关于此文件的条目（<code>index</code>） 被移除。</p>
<p>系统中维护了 2 中类别的 <code>open-file table</code>:</p>
<ul>
<li><code>per-process open-file table</code> : 跟踪进程打开的文件列表，此表中的列表实际是指向 <code>system-wide open-file table</code> 中相关条目（entry）的指针（pointer）。</li>
<li><code>system-wide open-file table</code> ： 维护了系统上所有的打开的文件信息，保存了如 <strong>文件路径</strong>、<strong>文件大小</strong>、<strong>文件时间属性（access time 等）</strong>、<code>open count</code> 等信息，当一个进程打开一个文件后，<code>system-wide open-file table</code> 中就会添加一个此文件相关的条目，当另一个进程打开同样的文件后，进程的 <code>per-process open-file table</code> 中只是会添加一条到 <code>system-wide open-file table</code> 中对应文件的引用（entry）。<code>system-wide open-file table</code> 中的每个条目还维护了一个 <code>open count</code>，记录了有多少进程打开了此文件，当某个进程关闭此文件后，其 <code>open count</code> 会减少，值为 <code>0</code> 时，表示没有任何进程打开了此文件，此条目可以从 <code>system-wide open-file table</code> 中移除。</li>
</ul>
<p><strong><code>system-wide open-file table</code> 里面关于文件的信息，保存的主要是 FCB 的拷贝（Copy）</strong></p>
<p><strong><code>per-process open-file table</code> 里面存储的主要是到 <code>system-wide open-file table</code> 里面的对应文件的指针（pointers）</strong></p>
<p><strong>Linux 系统中要查看 <code>open-file table</code> 相关信息，可以使用 <code>lsof</code>、<code>fuser</code>、<code>/proc/&lt;pid&gt;/fd/</code> 等方法。</strong></p>
<h1 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h1><h2 id="Encryption"><a href="#Encryption" class="headerlink" title="Encryption"></a>Encryption</h2><h3 id="Symmetric-Encryption"><a href="#Symmetric-Encryption" class="headerlink" title="Symmetric Encryption"></a>Symmetric Encryption</h3><p>在 <strong>对称加密算法(Symmetric Encryption)</strong> 中，加密和解密使用同样的密钥（Key）</p>
<h1 id="Glossary"><a href="#Glossary" class="headerlink" title="Glossary"></a>Glossary</h1><p><code>GNU</code>： GNU’s Not Unix，Richard Stallman 于 1984 年开始开发的自由（free）的类 Unix 操作系统。包括编译器、编辑器、库文件、游戏等应用，没有内核。</p>
<p><code>GNU/Linux</code>： 1991 年，Linus Torvalds 发布了最初版类 Unix 操作系统内核，并使用了 GNU 提供的编译器和工具。</p>
<p><code>FSF</code>: Free Software Foundation，自由软件基金会，由 Richard Stallman 于 1985 年成立，旨在鼓励和推动自由软件的使用和开发。<strong>自由不等于免费</strong></p>
<p><code>GPL</code>： GNU General Public License。</p>
<p><code>ELF</code>: Executable and Linkable Format.</p>
<p><code>ABI</code> : Application Binary Interface. ABI 定义了在不同架构以及不同的操作系统中，一个二进制代码（Binary Code）提供的接口的差异性。ABI 定义了二进制代码的底层细节，如地址宽度、向系统调用（system calls）提供参数的方法、运行时的堆栈（stack）的组织方式、系统库的二进制格式、数据类型等信息。ABI 是架构级别（architecture-level）的定义，如果一个二进制文件是根据特点的架构（如 ARMv8 processor）编译（链接）而成，那将他迁移到支持此 ABI 的另外的系统上，理论上它也可以正常运行。<sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Operating System Concepts v10 Online](https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf) 2.6 Why Applications Are Operating-System Specific">[3]</span></a></sup></p>
<p><code>RTE</code> : Run Time Environment. </p>
<p><code>LKMs</code> : Loadable Kernel Modules. </p>
<p><code>Darwin</code> : iOS&#x2F;MacOS 底层的类 Unix 操作系统，主要基于 BSD UNIX 的 microkernel</p>
<p><code>IPC</code> : Inter-Process Communication.</p>
<p><code>RPCs</code> : Remote Procedure Calls.</p>
<p><code>JNI</code> : Java Native Interface.</p>
<p><code>HAL</code> : Hardware Abstraction Layer.</p>
<p><code>UEFI</code> : Unified Extensible Firmware Interface.</p>
<p><code>initramfs</code> : 在系统启动过程中（Bootstrap Program 运行过程，比如 GRUB），因为根文件系统（<code>root file system</code>）还未挂载，为了挂载根文件系统，必须加载必要的驱动程序和内核模块，boot loader 会创建一个临时 RAM 文件系统，即 <code>initramfs</code>。一旦内核开始运行，必要的驱动已经安装，内核会将根文件系统从 <code>initramfs</code> 切换到已经挂载的根文件系统。然后启动 <code>systemd</code> 进程。</p>
<p><code>CMT</code> : Chip MultiThreading. 一个物理 CPU 核上实现了双线程或多线程的支持。在一个 CPU 线程因等待内存加载数据而空闲（Memory Stall）时，另一个 CPU 线程开始执行。每个 CPU 线程拥有自己独立的状态数据（architectural state）、指令指针（instruction pointer）、注册器（regester set）等，可以将其当作一个单独的逻辑 CPU 来运行单独的线程（进程&#x2F;Job）。如 Intel 的超线程（hyper-threading）或者叫 SMT（Simultaneous Multi-Threading）</p>
<p><code>CFS</code> : Completely Fail Scheduler。Linux kernel 2.6.23 版本开始默认的 CPU 调度算法。</p>
<p><code>MMU</code> : Memory Management Unit.</p>
<p><code>HDD</code> : Hard Disk Driver.</p>
<p><code>SSD</code> : Solid State Disk.</p>
<p><code>ATA</code> : Advanced Technology Attachment. 存储设备接口协议</p>
<p><code>SATA</code> : Serial ATA. 存储设备接口协议</p>
<p><code>SAS</code> : Serial Attached SCSI. 存储设备接口协议</p>
<p><code>USB</code> : Universal Serial Bus. 存储设备接口协议</p>
<p><code>FC</code> : Fibre Channel. 存储设备接口协议</p>
<p><code>NVMe</code> : NVM express. NVM 存储设备专用的通信接口协议。NVM 设备通过 NVMe 接口协议直接连接在系统 PCI 总线上。 相比其他存储接口协议（如 SATA 、SAS 等）增加了吞吐量及减少了延迟。</p>
<p><code>HBA</code> : Host Bus Adapter.</p>
<p><code>HAS</code> : Host Attached Storage. </p>
<p><code>NAS</code> : Network Attached Storage. 存储设备接口协议，使用基于 TCP&#x2F;IP 的 RPC 实现，如 NFS</p>
<p><code>FC</code> : Fibre Channel，光纤通道，存储设备接口协议</p>
<p><code>SANs</code> : Storage Area Networks. 使用基于 TCP&#x2F;IP 的 RPC 实现</p>
<p><code>RAIDs</code> : Redundant Arrays of Independent Disks.</p>
<p><code>DES</code> : Data Encryption Standard.</p>
<p><code>AES</code> : Advanced Encryption Standard</p>
<p><code>IKE</code> : Internet Key Exchange.</p>
<p><code>TLS</code> : Transport Layer Security.  SSL 的升级版</p>
<p><code>SSL</code> : Secure Sockets Layer.</p>
<p><code>MAC</code> ： Mandatory Access Control. Linux 系统中，是 SELinux 的一部分。</p>
<p><code>DAC</code> ： Discretionary Access Control. UNIX-based 系统上使用的权限控制策略（<code>chmod</code>、<code>chown</code>、<code>chgrp</code>）</p>
<p><code>PAM</code> : Pluggable Authentication Modules. UNIX-based 系统上使用的用户鉴权模块</p>
<p><code>BSD</code> : Berkeley Software Distribution. 第一个 Unix 发行版，由 California Berkeley 大学发行</p>
<p><code>FSF</code> ： Free Software Foundation, 自由软件基金会，由 理查德斯托曼 于 1984 年发起的开源运动，GNU 是其主要的一部分</p>
<h1 id="参考链接-Bibliography"><a href="#参考链接-Bibliography" class="headerlink" title="参考链接|Bibliography"></a>参考链接|Bibliography</h1><p><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a></p>
<h1 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a> 1.2.3 I/O Structure<a href="#fnref:1" rev="footnote"> ↩</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a> 1.3.2 Multiprocessor Systems<a href="#fnref:2" rev="footnote"> ↩</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a> 2.6 Why Applications Are Operating-System Specific<a href="#fnref:3" rev="footnote"> ↩</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a> CHAPTER 5 CPU Scheduling<a href="#fnref:4" rev="footnote"> ↩</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a> 5.5.4 Processor Affinity<a href="#fnref:5" rev="footnote"> ↩</a></span></li><li id="fn:6"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">6.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a> 9.1.5 Dynamic Linking and Shared Libraries<a href="#fnref:6" rev="footnote"> ↩</a></span></li><li id="fn:7"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">7.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a> CHAPTER 10 Virtual Memory<a href="#fnref:7" rev="footnote"> ↩</a></span></li><li id="fn:8"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">8.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a> 10.8 Allocating Kernel Memory<a href="#fnref:8" rev="footnote"> ↩</a></span></li><li id="fn:9"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">9.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a> 11.1.1 Hard Disk Drives<a href="#fnref:9" rev="footnote"> ↩</a></span></li><li id="fn:10"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">10.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://os.ecci.ucr.ac.cr/slides/Abraham-Silberschatz-Operating-System-Concepts-10th-2018.pdf">Operating System Concepts v10 Online</a> 14.1 File-System Structure<a href="#fnref:10" rev="footnote"> ↩</a></span></li></ol></div></div>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/d5da7d5e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="d5da7d5e/" class="post-title-link" itemprop="url">Django 常见错误</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-12 13:55:03" itemprop="dateCreated datePublished" datetime="2022-07-12T13:55:03+08:00">2022-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-02 16:10:00" itemprop="dateModified" datetime="2024-10-02T16:10:00+08:00">2024-10-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Python/Django/" itemprop="url" rel="index"><span itemprop="name">Django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>centos7</li>
<li>python3</li>
<li>Django 4</li>
</ul>
<h2 id="ModuleNotFoundError-No-module-named-‘MySQLdb’"><a href="#ModuleNotFoundError-No-module-named-‘MySQLdb’" class="headerlink" title="ModuleNotFoundError: No module named ‘MySQLdb’"></a>ModuleNotFoundError: No module named ‘MySQLdb’</h2><blockquote>
<p>ModuleNotFoundError: No module named ‘MySQLdb’<br>…<br>django.core.exceptions.ImproperlyConfigured: Error loading MySQLdb module.</p>
</blockquote>
<p><strong>解决方法</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip3 install pymysql</span><br></pre></td></tr></table></figure>

<p>编辑文件<code>./python36/lib/python3.6/site-packages/django/db/backends/mysql/__init__.py</code>, 输入以下内容</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql </span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="d5da7d5e/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/7d1a39d2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="7d1a39d2/" class="post-title-link" itemprop="url">Django+uwsgi+nginx 配置示例</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-19 10:55:03" itemprop="dateCreated datePublished" datetime="2022-07-19T10:55:03+08:00">2022-07-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-02 15:10:00" itemprop="dateModified" datetime="2024-10-02T15:10:00+08:00">2024-10-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Python/Django/" itemprop="url" rel="index"><span itemprop="name">Django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>centos 7</li>
<li>Python 3.10</li>
<li>Django 4.0</li>
<li>uwsgi 2.0.20</li>
<li>nginx 1.20.1</li>
<li>venv<blockquote>
<p>示例中虚拟环境位于 <code>/opt/vb/</code>, Django工程目录位于 <code>/opt/vb/vb/</code> , 工程名称为vb</p>
</blockquote>
</li>
</ul>
<h1 id="uwsgi-配置文件-uwsgi-ini-配置示例"><a href="#uwsgi-配置文件-uwsgi-ini-配置示例" class="headerlink" title="uwsgi 配置文件 (uwsgi.ini) 配置示例"></a>uwsgi 配置文件 (uwsgi.ini) 配置示例</h1><figure class="highlight shell"><figcaption><span>uwsgi.ini</span></figcaption><table><tr><td class="code"><pre><span class="line">[uwsgi]</span><br><span class="line">socket = 127.0.0.1:8081</span><br><span class="line">chdir = /opt/vb/vb</span><br><span class="line">wsgi-file = ./vb/wsgi.py</span><br><span class="line">master = true         //主进程</span><br><span class="line">vhost = true          //多站模式</span><br><span class="line">no-site = true        //多站模式时不设置入口模块和文件</span><br><span class="line">workers = 2           //子进程数</span><br><span class="line">reload-mercy = 10     </span><br><span class="line">vacuum = true         //退出、重启时清理文件</span><br><span class="line">max-requests = 1000   </span><br><span class="line">limit-as = 512</span><br><span class="line">buffer-size = 30000</span><br><span class="line">pidfile = uwsgi-8081.pid</span><br><span class="line">daemonize = uwsgi-8081.log</span><br><span class="line">pythonpath = /opt/vb/env/lib/python3.10/site-packages/</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="7d1a39d2/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202207261420/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202207261420/" class="post-title-link" itemprop="url">Nginx 服务常用配置说明</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-26 14:21:02" itemprop="dateCreated datePublished" datetime="2022-07-26T14:21:02+08:00">2022-07-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-30 14:09:00" itemprop="dateModified" datetime="2024-09-30T14:09:00+08:00">2024-09-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">常用服务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Nginx-服务配置"><a href="#Nginx-服务配置" class="headerlink" title="Nginx 服务配置"></a>Nginx 服务配置</h1><h2 id="全局通用配置"><a href="#全局通用配置" class="headerlink" title="全局通用配置"></a>全局通用配置</h2><figure class="highlight shell"><figcaption><span>nginx.conf</span></figcaption><table><tr><td class="code"><pre><span class="line">user nginx nginx;    </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">建议设置为 cpu 核心数或者 cpu 核心数的 2 倍，进程会包含一个 `master process`，多个 `worker process`</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">master process 负责绑定端口、调度进程等，不负责业务的处理</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">worker process 是业务进程，负责业务的处理</span></span><br><span class="line">worker_processes auto;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一个 worker 进程可以打开的最大的 fd 个数，受 Linux 内核限制</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">理论值应该是系统最多打开文件数（<span class="built_in">ulimit</span> -n）与 nginx 进程数相除</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可通过 <span class="built_in">ulimit</span> 设置或修改系统文件：`/etc/securit/limits.conf`</span></span><br><span class="line">worker_rlimit_nofile 1024；</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">cpu 亲和性设置</span> </span><br><span class="line">worker_cpu_affinity    0001 0010 0100 1000;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">工作进程调度优先级，-20 到 19 之间的值，值越小越优先调用。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果系统同时运行多个任务，你可能需要提高 nginx 的工作进程的优先级</span> </span><br><span class="line">worker_priority 0；              </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ssl 硬件加速服务器，需要硬件支持</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ssl_engine ssl_engine device;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nginx 是否以守护进程运行，是否让 nignx 运行于后台；调试时可为 off，使得所有信息直接输出在控制台</span></span><br><span class="line">daemon      on | off;         </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">events 模块中包含 nginx 中所有处理连接的设置。</span></span><br><span class="line">events &#123;</span><br><span class="line">    # 每个 worker 进程允许的最多连接数, </span><br><span class="line">    # nginx 服务最大连接数：worker_processes * worker_connections (受 worker_rlimit_nofile 限制)</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">    use epoll;</span><br><span class="line">    </span><br><span class="line">    # 是否允许一次性地响应多个用户请求</span><br><span class="line">    multi_accept on;                    </span><br><span class="line"></span><br><span class="line">    # 是否打开 nginx 的 accept 锁；此锁能够让多个 worker 进行轮流地、序列化地与新的客户端建立连接；</span><br><span class="line">    # 而通常当一个 worker 进程的负载达到其上限的 7/8，master 就尽可能不将请求调度至 worker.</span><br><span class="line">	accept_mutex on | off;              </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HTTP 模块控制着 nginx http 处理的所有核心特性</span></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # 是否在错误页面中显示和响应头字段中发出 nginx 版本号。</span><br><span class="line">    # 安全考虑建议关闭</span><br><span class="line">    server_tokens on | off | string; </span><br><span class="line">    </span><br><span class="line">    # 是否启用 sendfile 内核复制模式功能。作为静态服务器可以提供最大的 IO 访问速度。</span><br><span class="line">    sendfile on | off; </span><br><span class="line">    </span><br><span class="line">    # 尽快发送数据，否则会在数据包达到一定大小后再发送数据。这样会减少网络通信次数，降低阻塞概率，但也会影响响应及时性。</span><br><span class="line">    # 比较适合于文件下载这类的大数据通信场景。</span><br><span class="line">    tcp_nodelay on|off; </span><br><span class="line">    </span><br><span class="line">    # 单位s，适当降低此值可以提高响应连接数量</span><br><span class="line">    keepalive_timeout  65; </span><br><span class="line">    </span><br><span class="line">    # 一次长连接上允许的最大请求数</span><br><span class="line">    keepalive_requests 100；       </span><br><span class="line">    </span><br><span class="line">    # 禁止指定浏览器使用 keepalive</span><br><span class="line">    keepalive_disable msie6|none；    </span><br><span class="line">    </span><br><span class="line">    # 读取 http 请求首部的超时时长。如果客户端在此时间内未传输整个头，则会向客户端返回 408（请求超时）错误</span><br><span class="line">    client_header_timeout 1;     </span><br><span class="line">    </span><br><span class="line">    # 读取 http 请求包体的超时时间。</span><br><span class="line">    client_body_timeout 2;</span><br><span class="line">    </span><br><span class="line">    # 发送响应的超时时长。超时后连接将关闭。</span><br><span class="line">    send_timeout 5;  </span><br><span class="line">    </span><br><span class="line">    # http 请求包体的最大值，常用于限定客户端所能够请求的最大包体，根据请求首部中的 Content-Length 来检查，以避免无用的传输。</span><br><span class="line">    client_max_body_size 1m;</span><br><span class="line">    </span><br><span class="line">    # 限制客户端每秒传输的字节数，默认为0，表示没有限制。单位 Byte/s</span><br><span class="line">    limit_rate 0;</span><br><span class="line">    </span><br><span class="line">    # nginx 向客户端发送响应报文时，如果大小超过了此处指定的值，则后续的发送过程开始限速，单位 Byte</span><br><span class="line">    limit_rate_after 0;</span><br><span class="line">    </span><br><span class="line">    # 是否忽略不合法的 http 首部，默认为 on，off 意味着请求首部中出现不合规的首部将拒绝响应。</span><br><span class="line">    ignore_invalid_headers on|off;</span><br><span class="line">    </span><br><span class="line">    # 用户访问的文件不存在时，是否将其记录到错误日志中。</span><br><span class="line">    log_not_found on|off;   </span><br><span class="line">    </span><br><span class="line">    # nginx 使用的 dns 地址，及缓存解析结果的时间               </span><br><span class="line">    resolver 8.8.8.8 [valid=time] [ipv6=on|off];</span><br><span class="line">    </span><br><span class="line">    # dns 解析超时时间 </span><br><span class="line">    resolver_timeout 2；     </span><br><span class="line">    </span><br><span class="line">    # 是否打开文件缓存功能，max：用于缓存条目的最大值，</span><br><span class="line">    # inactive：某缓存条目在指定时长内没有被访问过时，将自动被删除，即缓存有效期，通常默认为 60s。</span><br><span class="line">    open_file_cache off;  </span><br><span class="line">    open_file_cache max=N [inactive=time];    </span><br><span class="line">    </span><br><span class="line">    # 是否缓存文件找不到或没有权限访问等相关信息。</span><br><span class="line">    open_file_cache_errors on | off; </span><br><span class="line">    </span><br><span class="line">    # 多长时间检查一次缓存中的条目是否超出非活动时长。</span><br><span class="line">    # 建议值：小于等于 open_file_cache inactive</span><br><span class="line">    open_file_cache_valid 60;   </span><br><span class="line">    </span><br><span class="line">    # 在 open_file_cache inactive指 定的时长内被访问超过此处指定的次数时，才不会被删除（删除低命中率的缓存）。</span><br><span class="line">    open_file_cache_min_uses 2;     </span><br><span class="line">    </span><br><span class="line">    # 开启内容压缩，可以有效降低客户端的访问流量和网络带宽</span><br><span class="line">    gzip on | off;</span><br><span class="line">    </span><br><span class="line">    # 内容超过最少长度后才开启压缩，太短的内容压缩效果不佳，且会浪费系统资源。</span><br><span class="line">    # 压缩长度会作为 http 响应头 Content-Length 字段返回给客户端。 建议值：64</span><br><span class="line">    gzip_min_length length;</span><br><span class="line">    </span><br><span class="line">    # 压缩级别，默认值为 1。范围为1～9级，压缩级别越高压缩率越高，但对系统性能要求越高。建议值：4</span><br><span class="line">    gzip_comp_level 1~9;</span><br><span class="line">    </span><br><span class="line">    # 压缩内容类型，默认为 text/html;。只压缩 html 文本，一般我们都会压缩 js、css、json 之类的，可以把这些常见的文本数据都配上。</span><br><span class="line">    如：text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;</span><br><span class="line">    gzip_types mime-type …;     </span><br><span class="line">    </span><br><span class="line">    # 自动显示目录</span><br><span class="line">    autoindex on;</span><br><span class="line">    </span><br><span class="line">    # off ： 以人类易读的方式显示文件大小，on：以 bytes 显示文件大小</span><br><span class="line">    autoindex_exact_size off;</span><br><span class="line">    </span><br><span class="line">    # 定义限制区域，imit_req_zone 只能放在 http &#123;&#125; 内，使用此限制可以在 http &#123;&#125; （对服务器内所有的网站生效）、server &#123;&#125; （对具体的一个网站生效）或 location &#123;&#125; （对具体的一个网址生效）</span><br><span class="line">    # 此区域名称为 test，可根据需求自定义； 10m 表示此区域存储 key（$binary_remote_addr）使用的大小</span><br><span class="line">    # 存储大小，一般 1m 空间大约能保存 1.6 万条 IP 地址，空间满了新数据会覆盖旧数据</span><br><span class="line">    # rate=1r/m ，限制访问请求频率为每分钟 1 次，可根据需要自行设置，1r/s 是 1 秒 1 次，时间单位只能选择 s (秒)或 m (分)，最低频率限制是每分钟 1 次访问请求</span><br><span class="line">    # rate=10r/m，1分钟最多访问 10 次，同时不能超过 1r/6s，即 6s 内最多访问 1 次。超过 1r/6s 返回 503</span><br><span class="line">    limit_req_zone $binary_remote_addr zone=test:10m rate=1r/m;</span><br><span class="line">    </span><br><span class="line">    # 定义日志格式</span><br><span class="line">    log_format main &#x27;&#123; time: $time_iso8601|&#x27;</span><br><span class="line">                    &#x27;http_host:$http_host|&#x27;</span><br><span class="line">                    &#x27;cdn_ip:$remote_addr|&#x27;</span><br><span class="line">                    &#x27;request:$request|&#x27;</span><br><span class="line">                    &#x27;request_method:$request_method|&#x27;</span><br><span class="line">                    &#x27;http_user_agent:$http_user_agent|&#x27;</span><br><span class="line">                    &#x27;size:$body_bytes_sent|&#x27;</span><br><span class="line">                    &#x27;responsetime:$request_time|&#x27;</span><br><span class="line">                    &#x27;upstreamtime:$upstream_response_time|&#x27;</span><br><span class="line">                    &#x27;upstreamhost:$upstream_addr|&#x27;</span><br><span class="line">                    &#x27;upstreamstatus:$upstream_status|&#x27;</span><br><span class="line">                    &#x27;url:$http_host$uri|&#x27;</span><br><span class="line">                    &#x27;http_x_forwarded_for:$clientRealIp|&#x27;</span><br><span class="line">                    &#x27;status:$status&#125;&#x27;;</span><br><span class="line">    </span><br><span class="line">    # server 负责具体的 http 服务器实现</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80 [default_server]  [rcvbuf=SIZE]  [sndbuf=SIZE] [ssl];</span><br><span class="line">        </span><br><span class="line">        # 可使用通配符*或正则表达式(~开头)，多个域名先精确匹配，再通配，再正则,&#x27;_&#x27;表示空主机头</span><br><span class="line">        server_name  _  ;</span><br><span class="line">        </span><br><span class="line">        access_log logs/access.log main;</span><br><span class="line">        error_log logs/access.err.log;</span><br><span class="line">        </span><br><span class="line">        # 跨域配置</span><br><span class="line">        add_header Access-Control-Allow-Origin *;</span><br><span class="line">        add_header Access-Control-Allow-Headers &#x27;Origin, No-Cache, X-Requested-With, If-Modified-Since, Pragma, Last-Modified, Cache-Control, Expires, Content-Type, X-E4M-With&#x27;;</span><br><span class="line">        add_header Access-Control-Allow-Methods GET,POST,OPTIONS;</span><br><span class="line">        add_header Access-Control-Allow-Credentials: true;</span><br><span class="line">        </span><br><span class="line">        location / &#123;       </span><br><span class="line">            # web 资源路径             </span><br><span class="line">            root   html;          </span><br><span class="line">            </span><br><span class="line">            # 定义默认页面，从左往右匹配           </span><br><span class="line">            index  index.html index.htm;   </span><br><span class="line">            </span><br><span class="line">            # 自左向右读取指定路径，找到即停止，如果都不存在，返回一个错误码</span><br><span class="line">            try_files $uri $uri.html $uri/index.html =404;        </span><br><span class="line">            </span><br><span class="line">            # 自左向右读取指定路径，找到即停止，如果都不存在，返回一个 uri</span><br><span class="line">            try_files $uri $uri.html $uri/index.html /404.html; </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        location /i/ &#123; </span><br><span class="line">            # 路径别名，只能用于 location 中。</span><br><span class="line">            # 访问 http://a.com/i/a.html, 资源路径为：/data/www/html/a.html</span><br><span class="line">            # 若是root指令，访问 http://a.com/i/a.html，资源路径为：/data/www/html/i/a.html</span><br><span class="line">		    alias /data/www/html/;          </span><br><span class="line">	    &#125;</span><br><span class="line">	    </span><br><span class="line">	    # 对于某个请求发生错误，如果匹配到错误码，重定向到新的 url</span><br><span class="line">	    error_page  404              /404.html; </span><br><span class="line">	    error_page   500 502 503 504  /50x.html;</span><br><span class="line">	    </span><br><span class="line">	    # 对于某个请求发生错误，如果匹配到错误码，重定向到新的 url,同时可以更改返回码</span><br><span class="line">	    error_page 404 =200 /404.html;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    # 包含其他配置文件</span><br><span class="line">    include vhosts/*.conf;        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202207261420/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20240904170014/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20240904170014/" class="post-title-link" itemprop="url">Linux nftables 防火墙</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-04 17:09:00" itemprop="dateCreated datePublished" datetime="2024-09-04T17:09:00+08:00">2024-09-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-27 09:09:00" itemprop="dateModified" datetime="2024-09-27T09:09:00+08:00">2024-09-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">常用服务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>nftables</code> 是一个 <code>netfilter</code> 项目，旨在替换现有的 <code>&#123;ip,ip6,arp,eb&#125;tables</code> 框架，为 <code>&#123;ip,ip6&#125;tables</code> 提供一个新的包过滤框架、一个新的用户空间实用程序（<code>nft</code>）和一个兼容层(<code>iptables-nft</code>)。它使用现有的钩子、链接跟踪系统、用户空间排队组件和 <code>netfilter</code> 日志子系统。</p>
<blockquote>
<p><em>在 Linux 内核版本高于 3.13 时可用</em></p>
</blockquote>
<p>它由三个主要组件组成：</p>
<ul>
<li>内核实现: 内核提供了一个 <code>netlink</code> 配置接口以及运行时规则集评估</li>
<li><code>libnl netlink</code> : <code>libnl</code> 包含了与内核通信的基本函数</li>
<li><code>nftables</code> : 用户空间前端。<code>nftables</code> 的用户空间实用程序 <code>nft</code> 评估大多数规则集并传递到内核。规则存储在链中，链存储在表中。</li>
</ul>
<p><strong>与 <code>iptables</code> 不同点</strong></p>
<ul>
<li><code>nftables</code> 在用户空间中运行，<code>iptables</code> 中的每个模块都运行在内核（空间）中</li>
<li><strong>表和链是完全可配置的</strong>。在 <code>nftables</code> 中，表是没有特定语义的链的容器。<code>iptables</code> 附带了具有预定义数量的基链的表，即使您只需要其中之一，所有链都已注册，未使用的基础链也会损害性能。</li>
<li><strong>可以在一个规则中指定多个操作</strong>。在 <code>iptables</code> 中，您只能指定一个目标。这是一个长期存在的局限性，用户可以通过跳到自定义链来解决，但代价是使规则集结构稍微复杂一些。</li>
<li><strong>每个链和规则没有内置计数器</strong>。在 <code>nftables</code> 中，这些是可选的，因此您可以按需启用计数器。由于 <code>iptables</code> 内置了一个数据包计数器，所以即使这些内置的链是空的，也会带来性能损耗</li>
<li><strong>更好地支持动态规则集更新</strong>。在 <code>nftables</code> 中，如果添加新规则，则剩余的现有规则将保持不变，因为规则集以链表形式表示，这与整体式 blob 表示相反，后者在执行规则集更新时内部状态信息的维护很复杂。</li>
<li><strong>简化的双堆栈 IPv4&#x2F;IPv6 管理</strong>，通过新的 <code>inet</code> 系列，可让您注册同时查看 IPv4 和 IPv6 流量的基链。 因此，您不再需要依赖脚本来复制规则集。</li>
</ul>
<p><strong>服务名称默认为 <code>nftables</code>，默认配置文件为 <code>/etc/nftables.conf</code></strong> ，其中已经包含一个名为 <code>inet filter</code> 的简单 <code>ipv4/ipv6</code> 防火墙列表。</p>
<figure class="highlight shell"><figcaption><span>/etc/nftables.conf</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/sbin/nft -f</span></span><br><span class="line"></span><br><span class="line">flush ruleset</span><br><span class="line"></span><br><span class="line">table inet filter &#123;</span><br><span class="line">	chain input &#123;</span><br><span class="line">		type filter hook input priority 0;</span><br><span class="line">	&#125;</span><br><span class="line">	chain forward &#123;</span><br><span class="line">		type filter hook forward priority 0;</span><br><span class="line">	&#125;</span><br><span class="line">	chain output &#123;</span><br><span class="line">		type filter hook output priority 0;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>nftables</code> 服务的 <code>systemd</code> 配置文件如下：</p>
<figure class="highlight shell"><figcaption><span>/lib/systemd/system/nftables.service</span></figcaption><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nftables</span><br><span class="line">Documentation=man:nft(8) http://wiki.nftables.org</span><br><span class="line">Wants=network-pre.target</span><br><span class="line">Before=network-pre.target shutdown.target</span><br><span class="line">Conflicts=shutdown.target</span><br><span class="line">DefaultDependencies=no</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=oneshot</span><br><span class="line">RemainAfterExit=yes</span><br><span class="line">StandardInput=null</span><br><span class="line">ProtectSystem=full</span><br><span class="line">ProtectHome=true</span><br><span class="line">ExecStart=/usr/sbin/nft -f /etc/nftables.conf</span><br><span class="line">ExecReload=/usr/sbin/nft -f /etc/nftables.conf</span><br><span class="line">ExecStop=/usr/sbin/nft flush ruleset</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=sysinit.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>nftables</code> 使用的内核模块如下，加载这些模块，服务才能正常运行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">lsmod | grep nf</span></span><br><span class="line">nf_log_syslog          20480  1</span><br><span class="line">nft_chain_nat          16384  17</span><br><span class="line">nf_nat                 49152  3 xt_nat,nft_chain_nat,xt_MASQUERADE</span><br><span class="line">nf_conntrack_netlink    49152  0</span><br><span class="line">nft_counter            16384  142</span><br><span class="line">nf_reject_ipv4         16384  1 ipt_REJECT</span><br><span class="line">nf_conntrack          172032  6 xt_conntrack,nf_nat,xt_state,xt_nat,nf_conntrack_netlink,xt_MASQUERADE</span><br><span class="line">nf_defrag_ipv6         24576  1 nf_conntrack</span><br><span class="line">nf_defrag_ipv4         16384  1 nf_conntrack</span><br><span class="line">nft_compat             20480  143</span><br><span class="line">nf_tables             249856  570 nft_compat,nft_counter,nft_chain_nat</span><br><span class="line">nfnetlink              20480  5 nft_compat,nf_conntrack_netlink,nf_tables,ip_set</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="20240904170014/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20240926135814/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20240926135814/" class="post-title-link" itemprop="url">Outline VPN 使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-26 13:09:00" itemprop="dateCreated datePublished" datetime="2024-09-26T13:09:00+08:00">2024-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Tools/VPN/" itemprop="url" rel="index"><span itemprop="name">VPN</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://getoutline.org/">Outline 官网</a></p>
<p>Outline 是由附属于 Google 的 Jigsaw 开发的开源的 VPN 软件。它的设计目标是为了实现 VPN 的简单部署和管理以及安全。Outline 提供了强加密、用户管理工具、并支持多平台，包括 Windows, macOS, Linux, iOS, 和 Android。</p>
<p>Outline 主要由 2 部分组成：</p>
<ul>
<li><code>Outline Manager</code> : 用来部署 VPN 服务器，以及管理用户、限速等</li>
<li><code>Outline Client</code> ： 连接 VPN 的客户端，支持多平台</li>
</ul>
<p><strong>本文示例基本环境信息</strong> ：</p>
<ul>
<li>Ubuntu 22.04.4 LTS (Jammy Jellyfish)</li>
<li>Outline Manager Version 1.15.2</li>
</ul>
<h1 id="Outline-环境-部署"><a href="#Outline-环境-部署" class="headerlink" title="Outline 环境 部署"></a>Outline 环境 部署</h1><h2 id="Outline-Manager-部署"><a href="#Outline-Manager-部署" class="headerlink" title="Outline Manager 部署"></a>Outline Manager 部署</h2><p>Outline Manager 部署非常的简单，只需要下载可执行文件，添加可执行权限并启动即可</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">wget https://s3.amazonaws.com/outline-releases/manager/linux/stable/Outline-Manager.AppImage</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">chmod</span> +x Outline-Manager.AppImage</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./Outline-Manager.AppImage</span> </span><br><span class="line">Outline Manager is starting</span><br><span class="line">libva error: vaGetDriverNameByIndex() failed with unknown libva error, driver_name = (null)</span><br><span class="line">[42740:0925/174650.529715:ERROR:viz_main_impl.cc(186)] Exiting GPU process due to errors during initialization</span><br><span class="line">Launching web app from outline://web_app/index.html?version=1.15.2&amp;sentryDsn=https%3A%2F%2F9df8c810bf1b482d979da996e3e63c40%40o74047.ingest.sentry.io%2F215496</span><br><span class="line">libva error: vaGetDriverNameByIndex() failed with unknown libva error, driver_name = (null)</span><br><span class="line">[42774:0925/174651.006194:ERROR:viz_main_impl.cc(186)] Exiting GPU process due to errors during initialization</span><br><span class="line">libva error: vaGetDriverNameByIndex() failed with unknown libva error, driver_name = (null)</span><br><span class="line">[42800:0925/174651.310808:ERROR:gpu_memory_buffer_support_x11.cc(44)] dri3 extension not supported.</span><br><span class="line">Checking for update</span><br><span class="line">Generated new staging user ID: c5db7469-3a5b-5365-a374-7e29a6e0c71a</span><br><span class="line">Update for version 1.15.2 is not available (latest version: 1.15.2, downgrade is disallowed).</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><p>为安全起见，Outline Manager 不支持以 <code>root</code> 用户执行，请以普通用户身份执行</p>
</li>
<li><p>Outline Manager 依赖于 <code>fuse</code>，执行命令 <code>sudo apt install fuse</code> 安装</p>
</li>
<li><p>Outline VPN Server 依赖于 Docker 和 <code>curl</code>，请提前安装</p>
</li>
</ul>
</blockquote>
<p>Outline Manager 运行后会启动 UI<br><img src="https://i.csms.tech/img_263.png"></p>
<h2 id="Outline-VPN-Server-部署"><a href="#Outline-VPN-Server-部署" class="headerlink" title="Outline VPN Server 部署"></a>Outline VPN Server 部署</h2><p>Outline 环境中，VPN Server 负责具体的 VPN 节点实现。要部署 VPN Server，选择合适的服务器环境，比如使用自己的本地服务器则选择 <code>Set up Outline anywhere</code>，然后根据提示在具体的 VPN Server 上部署程序即可<br><img src="https://i.csms.tech/img_264.png"></p>
<ol>
<li><p>根据提示，执行以下命令，部署 VPN Server 环境程序</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sudo bash -c <span class="string">&quot;<span class="subst">$(wget -qO- https://raw.githubusercontent.com/Jigsaw-Code/outline-server/master/src/server_manager/install_scripts/install_server.sh)</span>&quot;</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Verifying that Docker is installed .......... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Verifying that Docker daemon is running ..... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Setting PUBLIC_HOSTNAME to external IP ...... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Creating persistent state <span class="built_in">dir</span> ............... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Generating secret key ....................... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Generating TLS certificate .................. OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Generating SHA-256 certificate fingerprint .. OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Writing config .............................. OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Starting Shadowbox .......................... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Starting Watchtower ......................... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Removing watchtower container ............... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Restarting watchtower ....................... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Waiting <span class="keyword">for</span> Outline server to be healthy .... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Creating first user ......................... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Adding API URL to config .................... OK</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Checking host firewall ...................... OK</span></span><br><span class="line"></span><br><span class="line">CONGRATULATIONS! Your Outline server is up and running.</span><br><span class="line"></span><br><span class="line">To manage your Outline server, please copy the following line (including curly</span><br><span class="line">brackets) into Step 2 of the Outline Manager interface:</span><br><span class="line"></span><br><span class="line">&#123;&quot;apiUrl&quot;:&quot;https://66.26.90.25:50472/Q6XjXdbbVbetfAV0TK2cyw&quot;,&quot;certSha256&quot;:&quot;67695819036A0FA4CE3C9E4AFAA0466D3C4BE4D9B04DBF7D8BA820FB379C0E4C&quot;&#125;</span><br><span class="line"></span><br><span class="line">If you have connection problems, it may be that your router or cloud provider</span><br><span class="line">blocks inbound connections, even though your machine seems to allow them.</span><br><span class="line"></span><br><span class="line">Make sure to open the following ports on your firewall, router or cloud provider:</span><br><span class="line">- Management port 50472, for TCP</span><br><span class="line">- Access key port 13279, for TCP and UDP</span><br></pre></td></tr></table></figure>
<p>根据提示 <code>Management port 50472, for TCP</code>、<code>Access key port 13279, for TCP and UDP</code>，防火墙放通对应的端口</p>
<blockquote>
<p>默认情况下，<code>Management port</code> 和 <code>Access key port</code> 使用随机端口，要使用自定义的固定端口，使用以下命令配置 VPN Server 环境</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash install_server.sh --api-port 65530 --keys-port 65531</span><br></pre></td></tr></table></figure>
<p><strong>如果在同一台主机上重复执行 <code>install_server.sh</code>，请删除持久化数据目录，默认为 <code>/opt/outline/</code></strong> ，否则可能出现重复部署后某些配置依然是旧的。</p>
</blockquote>
<p><img src="https://i.csms.tech/img_265.png"></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://getoutline.org/get-started/#step-3">下载客户端程序</a>，COPY ACCESS KEY 到客户端测试连接。<br> <img src="https://i.csms.tech/img_266.png"></p>
</li>
</ol>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="20240926135814/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202404241336/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202404241336/" class="post-title-link" itemprop="url">SSL Certbot 使用方法汇总</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-04-24 13:36:18" itemprop="dateCreated datePublished" datetime="2024-04-24T13:36:18+08:00">2024-04-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-25 14:09:00" itemprop="dateModified" datetime="2024-09-25T14:09:00+08:00">2024-09-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Tools/SSL/" itemprop="url" rel="index"><span itemprop="name">SSL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Certbot 是 Let’s Encrypt SSL 官方推荐的 ACME 协议客户端，它是一个 Python 程序，且包含模块化插件支持。Let’s Encrypt 的根证书浏览器支持广泛，且支持泛域名。但单个证书的有效期为 90 天，以防止滥用。</p>
<h1 id="安装-Certbot"><a href="#安装-Certbot" class="headerlink" title="安装 Certbot"></a>安装 Certbot</h1><p><a target="_blank" rel="noopener" href="https://eff-certbot.readthedocs.io/en/stable/install.html#installation">官方安装步骤参考</a></p>
<p>以下步骤演示在 Python3 环境中安装 Certbot 及其相关依赖</p>
<ol>
<li>安装 <code>certbot</code> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install certbot</span><br></pre></td></tr></table></figure></li>
<li>申请证书时，要使用 DNS 方式验证域名所有权并且 DNS 使用 Cloudflare 的情况下，可以安装 <code>certbot-dns-cloudflare</code> 插件实现自动验证，参考以下命令安装 <code>certbot-dns-cloudflare</code>，此模块需要 <code>cloudflare</code> 模块的支持 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install cloudflare</span><br><span class="line">pip install certbot-dns-cloudflare</span><br></pre></td></tr></table></figure>
安装完成后检查相关模块和版本。其中 <code>cloudflare</code> 版本需要最低为 <code>2.3.1</code> <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[certbot-dns-cloudflare’s documentation](https://certbot-dns-cloudflare.readthedocs.io/en/stable/#welcome-to-certbot-dns-cloudflare-s-documentation)">[1]</span></a></sup> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pip list</span></span><br><span class="line">certbot                2.10.0</span><br><span class="line">certbot-dns-cloudflare 2.10.0</span><br><span class="line">cloudflare             2.19.2</span><br></pre></td></tr></table></figure>
以上模块安装完成后，即可使用 <code>certbot</code> 申请域名证书，并支持 Cloudflare DNS 的自动验证。</li>
</ol>
<h1 id="基于-Cloudflare-DNS-的自动验证申请域名证书"><a href="#基于-Cloudflare-DNS-的自动验证申请域名证书" class="headerlink" title="基于 Cloudflare DNS 的自动验证申请域名证书"></a>基于 Cloudflare DNS 的自动验证申请域名证书</h1><p><a href="#%E5%AE%89%E8%A3%85-Certbot">参考步骤安装 <code>certbot</code> 及 Cloudflare DNS 插件后</a> 即可使用 <code>certbot</code> 自动请求 Cloudflare DNS 创建申请证书时需要的 DNS 记录自动完成域名归属权的验证过程。</p>
<p><code>certbot</code> 支持的 Cloudflare 相关的参数如下</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>--dns-cloudflare</code></td>
<td>使用 Cloudflare 的 DNS 插件自动验证域名归属权</td>
<td></td>
</tr>
<tr>
<td><code>--dns-cloudflare-credentials</code></td>
<td>请求 Cloudflare 的授权配置文件</td>
<td></td>
</tr>
<tr>
<td><code>--dns-cloudflare-propagation-seconds</code></td>
<td>请求 Cloudflare DNS 添加相关 DNS 记录后，让 ACME 服务等待多少秒再验证 DNS 记录。主要用来防止 DNS 记录添加后，缓存 DNS 服务器未来得及更新最新记录。 <br/>默认为 10</td>
<td></td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://certbot-dns-cloudflare.readthedocs.io/en/stable/#credentials">Cloudflare Credentials 说明</a></p>
<p>假设有 Cloudflare 账号的 Global API Key，则 Credentials 配置文件内容参考如下</p>
<figure class="highlight shell"><figcaption><span>cloudflare.ini</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Cloudflare API credentials used by Certbot</span></span><br><span class="line">dns_cloudflare_email = cloudflare@example.com</span><br><span class="line">dns_cloudflare_api_key = 0123456789abcdef0123456789abcdef01234</span><br></pre></td></tr></table></figure>

<p>申请证书的具体命令如下，如果是第一次申请，需要根据提示填写自己的邮箱信息并同意许可协议，邮箱用于接受之后系统发送的错误或者域名证书过期等信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">certbot certonly \</span><br><span class="line">  --dns-cloudflare \</span><br><span class="line">  --dns-cloudflare-credentials ~/.secrets/certbot/cloudflare.ini \</span><br><span class="line">  --dns-cloudflare-propagation-seconds 60 \</span><br><span class="line">  -d example.com \</span><br><span class="line">  -d www.example.com</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果是非交互式环境,可以使用参数 <code>--email your-email@example.com</code> 和 <code>--agree-tos</code> 自动绑定邮箱并同意许可</p>
</blockquote>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202404241336/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20240924092814/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20240924092814/" class="post-title-link" itemprop="url">Shadowsocks VPN 使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-24 09:09:00" itemprop="dateCreated datePublished" datetime="2024-09-24T09:09:00+08:00">2024-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Tools/VPN/" itemprop="url" rel="index"><span itemprop="name">VPN</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><a target="_blank" rel="noopener" href="https://shadowsocks.org/doc/what-is-shadowsocks.html">Shadowsocks 官网简介</a></p>
<h1 id="基于-Python3-环境的-Shadowsocks-部署"><a href="#基于-Python3-环境的-Shadowsocks-部署" class="headerlink" title="基于 Python3 环境的 Shadowsocks 部署"></a>基于 Python3 环境的 Shadowsocks 部署</h1><p>执行以下命令之一安装 Shadowsocks (Python3 版本)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip3 install git+https://github.com/shadowsocks/shadowsocks.git@master</span><br><span class="line"></span><br><span class="line">pip3 install shadowsocks</span><br></pre></td></tr></table></figure>

<h1 id="配置-Shadowsocks"><a href="#配置-Shadowsocks" class="headerlink" title="配置 Shadowsocks"></a>配置 Shadowsocks</h1><p>创建一个配置文件，比如放在 <code>/etc/shadowsocks/config.json</code> 目录下。配置文件的内容如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;server&quot;: &quot;0.0.0.0&quot;, </span><br><span class="line">    &quot;server_port&quot;: 8388,</span><br><span class="line">    &quot;local_address&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">    &quot;local_port&quot;: 1080,</span><br><span class="line">    &quot;password&quot;: &quot;your_password&quot;,</span><br><span class="line">    &quot;timeout&quot;: 300,</span><br><span class="line">    &quot;method&quot;: &quot;aes-256-cfb&quot;, </span><br><span class="line">    &quot;fast_open&quot;: false</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>配置选项说明</strong> ：</p>
<ul>
<li><code>server</code> ： 服务器监听的 IP 地址，<code>0.0.0.0</code> 表示监听所有接口。</li>
<li><code>server_port</code> ： 服务器监听的端口，客户端连接到这个端口。</li>
<li><code>password</code> ： 用于加密流量的密码，请设置一个强密码。</li>
<li><code>method</code> ： 加密方法。<a target="_blank" rel="noopener" href="https://shadowsocks.org/doc/configs.html">其他加密算法请参考官网</a></li>
<li><code>timeout</code> ： 超时时间（秒）。</li>
<li><code>fast_open</code> ： 如果启用 TCP Fast Open，请将其设置为 <code>true</code>，但需要内核支持。</li>
</ul>
<h1 id="启动-Shadowsocks-服务"><a href="#启动-Shadowsocks-服务" class="headerlink" title="启动 Shadowsocks 服务"></a>启动 Shadowsocks 服务</h1><p>使用以下命令启动 Shadowsocks 服务，该命令会以后台进程的方式启动 Shadowsocks：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssserver -c /etc/shadowsocks/config.json -d start</span><br></pre></td></tr></table></figure>

<p><strong>常用选项</strong> ：</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-h, --help</code></td>
<td>打印帮助信息</td>
<td></td>
</tr>
<tr>
<td><code>-d [start / stop / restart ]</code></td>
<td>以 Daemon 方式（后台）运行</td>
<td></td>
</tr>
<tr>
<td><code>--pid-file</code></td>
<td>Daemon 模式启动时的 PID 文件路径</td>
<td></td>
</tr>
<tr>
<td><code>--log-file</code></td>
<td>Daemon 模式启动时日志文件路径</td>
<td></td>
</tr>
<tr>
<td><code>--user</code></td>
<td>运行服务的用户</td>
<td></td>
</tr>
<tr>
<td><code>-v, -vv</code></td>
<td><code>verbose</code> 模式</td>
<td></td>
</tr>
<tr>
<td><code>-q, -qq</code></td>
<td><code>quite</code> 模式</td>
<td></td>
</tr>
<tr>
<td><code>-c</code></td>
<td>配置文件路径</td>
<td><code>ssserver -c /etc/shadowsocks/config.json -d start</code></td>
</tr>
<tr>
<td><code>-s</code></td>
<td>指定服务端监听地址，默认为 <code>0.0.0.0</code> 。等同于配置文件中的 <code>server</code></td>
<td></td>
</tr>
<tr>
<td><code>-p</code></td>
<td>指定服务端监听端口，默认为 <code>8388</code> 。等同于配置文件中的 <code>server_port</code></td>
<td></td>
</tr>
<tr>
<td><code>-k</code></td>
<td>指定密码 。等同于配置文件中的 <code>password</code></td>
<td></td>
</tr>
<tr>
<td><code>-m</code></td>
<td>加密方法，默认为 <code>aes-256-cfb</code>   。 等同于配置文件中的 <code>method</code></td>
<td></td>
</tr>
<tr>
<td><code>-t</code></td>
<td>超时时间（单位为 <code>秒</code>），默认 300s 。 等同于配置文件中的 <code>timeout</code></td>
<td></td>
</tr>
<tr>
<td><code>--fast-open</code></td>
<td>启用 <code>TCP_FASTOPEN</code>，需要 <code>Linux 3.7+</code></td>
<td></td>
</tr>
<tr>
<td><code>--workers</code></td>
<td><code>workers</code> 数量，Linux&#x2F;Unix 可用</td>
<td></td>
</tr>
<tr>
<td><code>--forbidden-ip</code></td>
<td><code>,</code> 分割的 IP 列表，在此列表中的 IP 禁止连接，即黑名单</td>
<td></td>
</tr>
<tr>
<td><code>--manager-address</code></td>
<td>服务端 UDP 管理地址</td>
<td></td>
</tr>
</tbody></table>
<h2 id="为-Shadowsocks-配置-systemd-services-文件"><a href="#为-Shadowsocks-配置-systemd-services-文件" class="headerlink" title="为 Shadowsocks 配置 systemd services 文件"></a>为 Shadowsocks 配置 systemd services 文件</h2><p>参考以下内容，为 Shadowsocks 配置 systemd services 文件</p>
<figure class="highlight shell"><figcaption><span>/etc/systemd/system/shadowsocks.service</span></figcaption><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Shadowsocks Proxy Server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/bin/ssserver -c /etc/shadowsocks/config.json</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>启用并启动 Shadowsocks 服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl enable shadowsocks</span><br><span class="line">sudo systemctl start shadowsocks</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h1><p>在客户端（如 Windows、macOS、iOS 或 Android）上，使用 Shadowsocks 客户端进行连接。</p>
<p><strong>客户端配置</strong>：</p>
<ul>
<li><code>服务器地址</code> ： 填写你服务器的公网 IP。</li>
<li><code>服务器端口</code> ：填写 <code>config.json</code> 中的 <code>server_port</code>，如 <code>8388</code>。</li>
<li><code>密码</code> ： 填写配置文件中的 <code>password</code>。</li>
<li><code>加密方法</code> ： 选择 <code>method</code> 中配置的加密方法，如 <code>aes-256-cfb</code>。</li>
</ul>
<p>如果需要调试或查看运行日志，可以通过以下命令查看 Shadowsocks 的日志：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">journalctl -u shadowsocks</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20240923151710/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20240923151710/" class="post-title-link" itemprop="url">Linux ss 命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-23 15:09:00" itemprop="dateCreated datePublished" datetime="2024-09-23T15:09:00+08:00">2024-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><code>ss</code> 命令是一个查看 Linux 系统 <code>socket</code> 统计信息的工具，类似于 <code>netstat</code>，但是能显示更多的 TCP 和状态信息。</p>
<p><strong>常用选项</strong> ，可查看 <code>man ss</code></p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-h, --help</code></td>
<td>输出选项的简要说明</td>
<td></td>
</tr>
<tr>
<td><code>-V, --version</code></td>
<td>打印版本信息</td>
<td></td>
</tr>
<tr>
<td><code>-H, --no-header</code></td>
<td>不打印首行（<code>Netid State  Recv-Q Send-Q                                                                      Local Address:Port            Peer Address:Port    Process</code>）</td>
<td></td>
</tr>
<tr>
<td><code>-n, --numeric</code></td>
<td>不对服务名进行解析，直接输出端口（数值类型）</td>
<td></td>
</tr>
<tr>
<td><code>-r, --resolve</code></td>
<td>尝试解析 IP 和 端口 为对应的名称，默认行为</td>
<td></td>
</tr>
<tr>
<td><code>-a, --all</code></td>
<td>列出正在监听的端口以及已经建立连接的端口</td>
<td></td>
</tr>
<tr>
<td><code>-l, --listening</code></td>
<td>仅列出正在监听的端口，默认不列出。</td>
<td></td>
</tr>
<tr>
<td><code>-m, --memory</code></td>
<td>显示 <code>socket</code> 的 <code>内存</code> 使用情况</td>
<td></td>
</tr>
<tr>
<td><code>-p, --processes</code></td>
<td>显示使用此 <code>socket</code> 的进程</td>
<td></td>
</tr>
<tr>
<td><code>-s, --summary</code></td>
<td>显示简略的统计信息</td>
<td></td>
</tr>
<tr>
<td><code>-4, --ipv4</code></td>
<td>只显示 IPv4 相关的 <code>socket</code></td>
<td></td>
</tr>
<tr>
<td><code>-6, --ipv6</code></td>
<td>只显示 IPv6 相关的 <code>socket</code></td>
<td></td>
</tr>
<tr>
<td><code>-t, --tcp</code></td>
<td>只显示 TCP 相关 <code>socket</code></td>
<td></td>
</tr>
<tr>
<td><code>-u, --udp</code></td>
<td>只显示 UDP 相关 <code>socket</code></td>
<td></td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202306081314/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202306081314/" class="post-title-link" itemprop="url">Linux 常见错误集锦</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-08 13:08:43" itemprop="dateCreated datePublished" datetime="2023-06-08T13:08:43+08:00">2023-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-20 14:09:00" itemprop="dateModified" datetime="2024-09-20T14:09:00+08:00">2024-09-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos 7</li>
</ul>
<h1 id="automake"><a href="#automake" class="headerlink" title="automake"></a>automake</h1><p>编译安装软件报错</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">error: require Automake 1.14, but have 1.13.4</span><br></pre></td></tr></table></figure>
<p>Automake 版本不匹配，需要安装 Automake 1.14</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">rpm -qa | grep automake</span></span><br><span class="line">automake-1.13.4-3.el7.noarch</span><br></pre></td></tr></table></figure>

<p>以下步骤安装 <code>automake-1.14.1</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget http://ftp.gnu.org/gnu/automake/automake-1.14.1.tar.gz</span><br><span class="line">tar -xf automake-1.14.1.tar.gz</span><br><span class="line">cd automake-1.14.1</span><br><span class="line">./bootstrap.sh</span><br></pre></td></tr></table></figure>
<p>以上步骤执行完成后，会生成 <code>configure</code> 可执行文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>安装完成后，执行以下命令验证版本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">automake --version</span></span><br><span class="line">automake (GNU automake) 1.14.1</span><br><span class="line">Copyright (C) 2013 Free Software Foundation, Inc.</span><br><span class="line">License GPLv2+: GNU GPL version 2 or later &lt;http://gnu.org/licenses/gpl-2.0.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line"></span><br><span class="line">Written by Tom Tromey &lt;tromey@redhat.com&gt;</span><br><span class="line">       and Alexandre Duret-Lutz &lt;adl@gnu.org&gt;.</span><br></pre></td></tr></table></figure>

<h1 id="makeinfo"><a href="#makeinfo" class="headerlink" title="makeinfo"></a>makeinfo</h1><p>编译安装软件报错</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">makeinfo: command not found</span><br></pre></td></tr></table></figure>
<p><code>makeinfo</code> 命令不存在，执行以下命令安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install texinfo</span><br></pre></td></tr></table></figure>

<h1 id="gcc"><a href="#gcc" class="headerlink" title="gcc"></a>gcc</h1><h2 id="no-acceptable-C-compiler-found-in-PATH"><a href="#no-acceptable-C-compiler-found-in-PATH" class="headerlink" title="no acceptable C compiler found in $PATH"></a>no acceptable C compiler found in $PATH</h2><p>缺少 <code>gcc</code> 编译器，安装即可</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y gcc</span><br></pre></td></tr></table></figure>

<h2 id="A-compiler-with-support-for-C-11-language-features-is-required"><a href="#A-compiler-with-support-for-C-11-language-features-is-required" class="headerlink" title="A compiler with support for C++11 language features is required"></a>A compiler with support for C++11 language features is required</h2><p>编译安装软件时报错</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">configure: error: *** A compiler with support for C++11 language features is required.</span><br></pre></td></tr></table></figure>
<p>错误原因为 gcc 版本太低。查看当前 gcc 版本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gcc -v</span></span><br><span class="line">Using built-in specs.</span><br><span class="line">COLLECT_GCC=gcc</span><br><span class="line">COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/4.8.5/lto-wrapper</span><br><span class="line">Target: x86_64-redhat-linux</span><br><span class="line">Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --disable-libgcj --with-isl=/builddir/build/BUILD/gcc-4.8.5-20150702/obj-x86_64-redhat-linux/isl-install --with-cloog=/builddir/build/BUILD/gcc-4.8.5-20150702/obj-x86_64-redhat-linux/cloog-install --enable-gnu-indirect-function --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux</span><br><span class="line">Thread model: posix</span><br><span class="line">gcc version 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC)</span><br></pre></td></tr></table></figure>

<h3 id="安装-gcc-8-3-0"><a href="#安装-gcc-8-3-0" class="headerlink" title="安装 gcc-8.3.0"></a>安装 gcc-8.3.0</h3><p>以下步骤演示安装 gcc-8.3.0 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[升级 GCC 支持C++11](https://www.cnblogs.com/gyfluck/p/10537383.html)
">[1]</span></a></sup></p>
<ol>
<li>下载安装包，<a target="_blank" rel="noopener" href="http://ftp.gnu.org/gnu/gcc/">官方下载地址</a> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget ftp://ftp.irisa.fr/pub/mirrors/gcc.gnu.org/gcc/releases/gcc-8.3.0/gcc-8.3.0.tar.gz</span><br><span class="line">tar -xf gcc-8.3.0.tar.gz</span><br><span class="line">cd gcc-8.3.0</span><br></pre></td></tr></table></figure></li>
<li>编译安装。编译依赖 <code>GMP 4.2+</code>, <code>MPFR 2.4.0+</code> and <code>MPC 0.8.0+</code>，需要先按照顺序安装这 3 个依赖。依赖安装参考： <a href="#%E5%AE%89%E8%A3%85-GMP">安装 GMP</a>，<a href="#%E5%AE%89%E8%A3%85-MPFR">安装 MPFR</a>，<a href="%E5%AE%89%E8%A3%85-MPC">安装 MPC</a> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./configure --prefix=/usr/local/gcc-8.3.0 --disable-multilib</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make install</span></span><br></pre></td></tr></table></figure></li>
<li>安装完成后，需要更新系统标准库 查看当前系统使用的 gcc 库文件，可以看到版本为 <code>libstdc++.so.6.0.19</code> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> /usr/lib64/libstdc++.so.6</span></span><br><span class="line">libstdc++.so.6       libstdc++.so.6.0.19 </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> /usr/lib64/libstdc++.so.6 -l</span></span><br><span class="line">lrwxrwxrwx 1 root root 19 May 30 08:05 /usr/lib64/libstdc++.so.6 -&gt; libstdc++.so.6.0.19</span><br></pre></td></tr></table></figure>
 执行以下操作，更新 <code>libstdc++.so.6</code> 到最新安装的版本 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">rm</span> -rf /usr/lib64/libstdc++.so.6</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ln</span> -s /usr/local/gcc-8.3.0/lib64/libstdc++.so.6.0.25 /usr/lib64/libstdc++.so.6</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> /usr/lib64/libstdc++.so.6 -l</span></span><br><span class="line">lrwxrwxrwx 1 root root 46 Jun  9 09:31 /usr/lib64/libstdc++.so.6 -&gt; /usr/local/gcc-8.3.0/lib64/libstdc++.so.6.0.25</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="安装-GMP"><a href="#安装-GMP" class="headerlink" title="安装 GMP"></a>安装 GMP</h2><p><a href="ftp://gcc.gnu.org/pub/gcc/infrastructure/">安装包下载地址</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget ftp://gcc.gnu.org/pub/gcc/infrastructure/gmp-6.1.0.tar.bz2</span><br><span class="line">tar -jxvf gmp-6.1.0.tar.bz2</span><br><span class="line">cd gmp-6.1.0</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h2 id="安装-MPFR"><a href="#安装-MPFR" class="headerlink" title="安装 MPFR"></a>安装 MPFR</h2><p><a href="ftp://gcc.gnu.org/pub/gcc/infrastructure/">安装包下载地址</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget ftp://gcc.gnu.org/pub/gcc/infrastructure/mpfr-3.1.4.tar.bz2</span><br><span class="line">tar -jxvf mpfr-3.1.4.tar.bz2</span><br><span class="line">cd mpfr-3.1.4</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h2 id="安装-MPC"><a href="#安装-MPC" class="headerlink" title="安装 MPC"></a>安装 MPC</h2><p><a href="ftp://gcc.gnu.org/pub/gcc/infrastructure/">安装包下载地址</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget ftp://gcc.gnu.org/pub/gcc/infrastructure/mpc-1.0.3.tar.gz</span><br><span class="line">tar -zxvf mpc-1.0.3.tar.gz</span><br><span class="line">cd mpc-1.0.3</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202306081314/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="page/12/">12</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">COSMOS</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.3" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="js/comments.js"></script><script src="js/utils.js"></script><script src="js/motion.js"></script><script src="js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="js/third-party/search/local-search.js"></script>




  <script src="js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"fl9999","repo":"fl9999.github.io","client_id":"a11bf6f7860762b725b5","client_secret":"a99046105f8bddc72ec718d54dc3fd7f22070821","admin_user":"fl9999","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d41d8cd98f00b204e9800998ecf8427e"}</script>
<script src="js/third-party/comments/gitalk.js"></script>

</body>
</html>
