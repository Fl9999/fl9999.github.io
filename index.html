<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"csms.tech","root":"/","images":"images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="js/config.js"></script>

    <meta name="description" content="å¾— èƒ½ è« å¿˜">
<meta property="og:type" content="website">
<meta property="og:title" content="L B T">
<meta property="og:url" content="http://csms.tech/index.html">
<meta property="og:site_name" content="L B T">
<meta property="og:description" content="å¾— èƒ½ è« å¿˜">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="COSMOS">
<meta property="article:tag" content="åšå®¢, è®°å½•ï¼ŒæŠ€æœ¯">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://csms.tech/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>L B T</title>
  








  <noscript>
    <link rel="stylesheet" href="css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">L B T</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">è®° å½• è¿‡ å» çš„ ç» éªŒ</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="index.html" rel="section"><i class="fa fa-earth-americas fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-folder-tree fa-fw"></i>æ€»ç›®å½•<span class="badge">53</span></a></li><li class="menu-item menu-item-linux"><a href="/categories/Linux" rel="section"><i class="fa fa-brands fa-linux fa-fw"></i>Linux</a></li><li class="menu-item menu-item-python"><a href="/categories/Python" rel="section"><i class="fa fa-brands fa-python fa-fw"></i>Python</a></li><li class="menu-item menu-item-docker"><a href="/categories/Docker" rel="section"><i class="fa fa-brands fa-docker fa-fw"></i>Docker</a></li><li class="menu-item menu-item-kubernetes"><a href="/categories/Kubernetes" rel="section"><i class="fa fa-dharmachakra fa-fw"></i>Kubernetes</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tornado fa-fw"></i>æ ‡ç­¾<span class="badge">78</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>åˆ—è¡¨<span class="badge">253</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« æ€»ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">COSMOS</p>
  <div class="site-description" itemprop="description">å¾— èƒ½ è« å¿˜</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">253</span>
          <span class="site-state-item-name">æ–‡ç« </span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">53</span>
        <span class="site-state-item-name">ç›®å½•</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">78</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20250429103946/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20250429103946/" class="post-title-link" itemprop="url">å…«å­—åç¥</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-04-29 10:04:00" itemprop="dateCreated datePublished" datetime="2025-04-29T10:04:00+08:00">2025-04-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/%E6%98%93%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">æ˜“å­¦</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/%E6%98%93%E5%AD%A6/%E5%85%AB%E5%AD%97%E5%8D%81%E7%A5%9E/" itemprop="url" rel="index"><span itemprop="name">å…«å­—åç¥</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="æ˜“å­¦ç›¸å…³å¸¸è¯†"><a href="#æ˜“å­¦ç›¸å…³å¸¸è¯†" class="headerlink" title="æ˜“å­¦ç›¸å…³å¸¸è¯†"></a>æ˜“å­¦ç›¸å…³å¸¸è¯†</h1><h2 id="å¤©å¹²åœ°æ”¯çºªå¹´æ³•çš„ç¬¬ä¸€ä¸ªç”²å­å¹´"><a href="#å¤©å¹²åœ°æ”¯çºªå¹´æ³•çš„ç¬¬ä¸€ä¸ªç”²å­å¹´" class="headerlink" title="å¤©å¹²åœ°æ”¯çºªå¹´æ³•çš„ç¬¬ä¸€ä¸ªç”²å­å¹´"></a>å¤©å¹²åœ°æ”¯çºªå¹´æ³•çš„ç¬¬ä¸€ä¸ªç”²å­å¹´</h2><ul>
<li><p><strong>ä¸­å›½ä¼ ç»Ÿä¸Šï¼Œä»¥è½©è¾•é»„å¸çºªå…ƒä½œä¸ºèµ·ç‚¹</strong> ã€‚æ®ã€Šå²è®°Â·å¾‹ä¹¦ã€‹è®°è½½ï¼Œå¤äººä»¥è½©è¾•é»„å¸å³ä½ä¹‹å¹´ï¼ˆä¼ è¯´ä¸­çš„é»„å¸å…ƒå¹´ï¼‰ä¸ºç¬¬ä¸€ä¸ªç”²å­å¹´ã€‚ç°ä»£å­¦è€…ä¸€èˆ¬æ¨ç®—é»„å¸å³ä½åœ¨å…¬å…ƒå‰2697å¹´æˆ–å‰2698å¹´ï¼Œå…¶ä¸­ä»¥å…¬å…ƒå‰2637å¹´ã€å‰2697å¹´è¿™ä¸¤ç§è¯´æ³•è¾ƒå¸¸è§ã€‚</p>
</li>
<li><p><strong>å¤©å¹²åœ°æ”¯ç³»ç»Ÿæ­£å¼å¹¿æ³›åº”ç”¨äºçºªå¹´ï¼Œæ˜¯åœ¨æ±‰ä»£ä»¥åé€æ­¥æ™®åŠçš„</strong> ã€‚ å› æ­¤å¸¸è§ä¸¤ç§æ¨æ³•</p>
<table>
<thead>
<tr>
<th>æ¨ç®—åŸºå‡†</th>
<th>ç¬¬ä¸€ä¸ªç”²å­å¹´ï¼ˆå…¬å†ï¼‰</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td>ä»¥è½©è¾•é»„å¸çºªå…ƒèµ·ç®—</td>
<td>å…¬å…ƒå‰ 2637 å¹´</td>
<td>å…¬å…ƒå‰ 2637 å¹´</td>
</tr>
<tr>
<td>ä»¥è¥¿æ±‰å¤ªåˆå…ƒå¹´ï¼ˆå»ºå…ƒï¼‰æ¨å›</td>
<td>å…¬å…ƒå‰ 1984 å¹´</td>
<td>å¦ä¸€ç§å­¦æœ¯æ¨æ³•</td>
</tr>
</tbody></table>
</li>
</ul>
<p><strong>ä¸­å›½å®˜æ–¹å’Œæ°‘é—´ä¼ ç»Ÿçºªå¹´ä¸€èˆ¬é»˜è®¤é»„å¸çºªå…ƒ</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/38105366">æ­¤é“¾æ¥ä¸­çš„è¯´æ³•å¯èƒ½æ›´ä¸ºæœ‰é“ç†ï¼Œå¤æ—¶çºªå¹´æ³•éå¸¸çš„å¤šï¼Œä¹Ÿå­˜åœ¨å¾ˆå¤šè¯¯å·®ï¼Œåˆ°äº†è¥¿æ±‰æ‰ç”±å®˜æ–¹é’¦å®šä½¿ç”¨å¤©å¹²åœ°æ”¯çºªå¹´ï¼Œå¾€å‰çš„çºªå¹´éƒ½æ˜¯ç”±æ­¤å¾€å‰æ¨è®ºè€Œå‡º</a></p>
<h2 id="å¿«é€Ÿç¡®å®šæŸä¸€å¹´å¹²æ”¯çš„é€Ÿç®—æ³•"><a href="#å¿«é€Ÿç¡®å®šæŸä¸€å¹´å¹²æ”¯çš„é€Ÿç®—æ³•" class="headerlink" title="å¿«é€Ÿç¡®å®šæŸä¸€å¹´å¹²æ”¯çš„é€Ÿç®—æ³•"></a>å¿«é€Ÿç¡®å®šæŸä¸€å¹´å¹²æ”¯çš„é€Ÿç®—æ³•</h2><ul>
<li><p>æ–¹æ³• 1ï¼š <strong>é€Ÿç®—å…¬å¼</strong></p>
<p>  ä¸ºäº†å¿«é€Ÿè®¡ç®—ï¼Œé¦–å…ˆä¸ºå¤©å¹²åœ°æ”¯æŒ‰ç…§ä»¥ä¸‹é¡ºåºç¼–å·ï¼š</p>
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody><tr>
<td>ç™¸</td>
<td>ç”²</td>
<td>ä¹™</td>
<td>ä¸™</td>
<td>ä¸</td>
<td>æˆŠ</td>
<td>å·±</td>
<td>åºš</td>
<td>è¾›</td>
<td>å£¬</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
<th>11</th>
</tr>
</thead>
<tbody><tr>
<td>äº¥</td>
<td>å­</td>
<td>ä¸‘</td>
<td>å¯…</td>
<td>å¯</td>
<td>è¾°</td>
<td>å·³</td>
<td>åˆ</td>
<td>æœª</td>
<td>ç”³</td>
<td>é…‰</td>
<td>æˆŒ</td>
</tr>
</tbody></table>
<ol>
<li><p><strong>ç¡®å®šå¤©å¹²ï¼ˆç”²ä¹™ä¸™ä¸æˆŠå·±åºšè¾›å£¬ç™¸ï¼‰</strong></p>
<p> <code>å¤©å¹²åºå·=ï¼ˆå¹´ä»½âˆ’3ï¼‰mod 10</code></p>
</li>
<li><p><strong>ç¡®å®šåœ°æ”¯ï¼ˆå­ä¸‘å¯…å¯è¾°å·³åˆæœªç”³é…‰æˆŒäº¥ï¼‰</strong></p>
<p> <code>åœ°æ”¯åºå·=ï¼ˆå¹´ä»½âˆ’3ï¼‰mod 12</code></p>
</li>
</ol>
<p>   ä¾‹å¦‚ 1992 å¹´ä¸º <strong>å£¬ç”³</strong>ï¼š</p>
<p>   <code>(1992âˆ’3) mod 10 = 1989 mod 10 = 9</code> åˆ™ä¸º <strong>å£¬</strong></p>
<p>   <code>(1992âˆ’3) mod 12 = 1989 mod 12 = 9</code> åˆ™ä¸º <strong>ç”³</strong></p>
</li>
<li><p>æ–¹æ³• 2 ï¼š <strong>è®°ä½å‡ ä¸ªâ€œå…³é”®å¹´â€ï¼Œç„¶åé¡ºæ¨&#x2F;é€†æ¨å¹²æ”¯å¾ªç¯</strong></p>
<p>  <strong>å…³é”®å¹´ä»½è®°å¿†ï¼ˆå¸¸ç”¨é”šç‚¹å¹´ï¼‰</strong></p>
<table>
<thead>
<tr>
<th>å…¬å†å¹´ä»½</th>
<th>å¹²æ”¯</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>1984</td>
<td>ç”²å­</td>
<td>å…­åç”²å­èµ·ç‚¹ï¼Œå»ºè®®èƒŒä½</td>
</tr>
<tr>
<td>2000</td>
<td>åºšè¾°</td>
<td>åƒç¦§å¹´ï¼Œå¸¸ç”¨</td>
</tr>
<tr>
<td>2024</td>
<td>ç”²è¾°</td>
<td>è¿‘æœŸå¹´ä»½ï¼Œå®¹æ˜“è®°ä½</td>
</tr>
</tbody></table>
<p>  ä¸¾ä¸ªä¾‹å­ï¼šå¿«é€Ÿæ¨ç®— 1992 å¹´çš„å¹²æ”¯<br>  æˆ‘ä»¬çŸ¥é“ 1984 å¹´æ˜¯ <strong>ç”²å­å¹´</strong> ï¼Œæ˜¯ä¸€ä¸ªå‘¨æœŸçš„èµ·ç‚¹ã€‚</p>
<p>  ä» 1984 åˆ° 1992 è¿‡äº† 8 å¹´ã€‚</p>
<p>  æ‰€ä»¥ï¼š</p>
<p>  å¹²æ”¯ä½ç½®å¾€åæ¨ 8 ä¸ªï¼š<br>  å¤©å¹²ï¼šç”² â†’ ä¹™ â†’ ä¸™ â†’ ä¸ â†’ æˆŠ â†’ å·± â†’ åºš â†’ è¾› â†’ å£¬ï¼ˆç¬¬ 9 ä¸ªï¼‰</p>
<p>  åœ°æ”¯ï¼šå­ â†’ ä¸‘ â†’ å¯… â†’ å¯ â†’ è¾° â†’ å·³ â†’ åˆ â†’ æœª â†’ ç”³ï¼ˆç¬¬ 9 ä¸ªï¼‰</p>
<p>  ğŸ”µ æ‰€ä»¥ 1992 å¹´ &#x3D; <strong>å£¬ç”³å¹´</strong></p>
<blockquote>
<p><strong>å¤©å¹²å¾€ååŠ  8 ä¸ªç­‰äºå¾€å‰å‡ 2 ä¸ª</strong><br><strong>åœ°æ”¯å¾€ååŠ  8 ä¸ªç­‰äºå¾€å‰å‡ 4 ä¸ª</strong></p>
</blockquote>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20250415143946/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20250415143946/" class="post-title-link" itemprop="url">GIMP å›¾åƒå¤„ç†å·¥å…·</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-04-15 14:04:00" itemprop="dateCreated datePublished" datetime="2025-04-15T14:04:00+08:00">2025-04-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>GIMP(GNU Image Manipulation Program) æ˜¯ä¸€ä¸ªå¼€æºçš„ä¸“ä¸šçš„å›¾åƒå¤„ç†å·¥å…· <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[GNU IMAGE MANIPULATION PROGRAM](https://www.gimp.org/)">[1]</span></a></sup></p>
<h1 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h1><h2 id="è°ƒæ•´å›¾åƒå¤§å°"><a href="#è°ƒæ•´å›¾åƒå¤§å°" class="headerlink" title="è°ƒæ•´å›¾åƒå¤§å°"></a>è°ƒæ•´å›¾åƒå¤§å°</h2><p><a target="_blank" rel="noopener" href="https://www.gimp.org/tutorials/GIMP_Quickies/#changing-the-size-dimensions-of-an-image-scale">è°ƒæ•´å›¾åƒå¤§å°å‚è€ƒæ–‡æ¡£</a></p>
<h2 id="é¢œè‰²æ“ä½œ"><a href="#é¢œè‰²æ“ä½œ" class="headerlink" title="é¢œè‰²æ“ä½œ"></a>é¢œè‰²æ“ä½œ</h2><h3 id="å¦‚ä½•å°†æ–°åŠ å…ƒç´ çš„é¢œè‰²è°ƒæ•´ä¸ºå’Œå›¾ç‰‡ä¸ŠæŸä¸ªåƒç´ é¢œè‰²å®Œå…¨ä¸€è‡´"><a href="#å¦‚ä½•å°†æ–°åŠ å…ƒç´ çš„é¢œè‰²è°ƒæ•´ä¸ºå’Œå›¾ç‰‡ä¸ŠæŸä¸ªåƒç´ é¢œè‰²å®Œå…¨ä¸€è‡´" class="headerlink" title="å¦‚ä½•å°†æ–°åŠ å…ƒç´ çš„é¢œè‰²è°ƒæ•´ä¸ºå’Œå›¾ç‰‡ä¸ŠæŸä¸ªåƒç´ é¢œè‰²å®Œå…¨ä¸€è‡´"></a>å¦‚ä½•å°†æ–°åŠ å…ƒç´ çš„é¢œè‰²è°ƒæ•´ä¸ºå’Œå›¾ç‰‡ä¸ŠæŸä¸ªåƒç´ é¢œè‰²å®Œå…¨ä¸€è‡´</h3><ol>
<li><p><strong>é€‰æ‹©é¢œè‰²æ‹¾å–å™¨å·¥å…·</strong></p>
<p> åœ¨å·¦ä¾§å·¥å…·æ ä¸­ï¼Œç‚¹å‡» <code>é¢œè‰²æ‹¾å–å·¥å…·</code>ï¼ˆå¸ç®¡å›¾æ ‡ï¼‰ï¼Œæˆ–å¿«æ·é”® <code>O</code> ã€‚æ¥ç€é¼ æ ‡ç‚¹å‡»å›¾ç‰‡ä¸Šä½ æƒ³åŒ¹é…çš„é¢œè‰²ã€‚</p>
</li>
<li><p><strong>å°†æ‹¾å–çš„é¢œè‰²ç”¨äºæ–°å†…å®¹</strong></p>
<p> æ‹¾è‰²åï¼ŒGIMP ä¼šè‡ªåŠ¨å°†è¯¥é¢œè‰²è®¾ä¸º <code>å‰æ™¯è‰²ï¼ˆåœ¨å·¥å…·ç®±å·¦ä¸‹è§’å¯è§ï¼‰</code> ã€‚</p>
<p> å¦‚æœä½ æ˜¯ä½¿ç”¨ï¼š</p>
<ul>
<li><p><code>æ–‡å­—å·¥å…·</code> ï¼š è¾“å…¥æ–°æ–‡å­—åï¼Œåœ¨å·¥å…·é€‰é¡¹ä¸­ç‚¹å‡» <code>é¢œè‰²</code> ï¼Œç„¶åç‚¹å‡»åˆšæ‰çš„å‰æ™¯è‰²ã€‚</p>
</li>
<li><p><code>ç”»ç¬”/å¡«å……å·¥å…·</code> ï¼š ç›´æ¥ä½¿ç”¨å‰æ™¯è‰²å³å¯ç»˜åˆ¶æˆ–å¡«å……ã€‚</p>
</li>
</ul>
</li>
</ol>
<h2 id="å¤åˆ¶ç²˜è´´"><a href="#å¤åˆ¶ç²˜è´´" class="headerlink" title="å¤åˆ¶ç²˜è´´"></a>å¤åˆ¶ç²˜è´´</h2><h3 id="å¦‚ä½•å°†çŸ©å½¢é€‰æ‹©å·¥å…·é€‰æ‹©çš„åŒºåŸŸå¤åˆ¶ç²˜è´´åˆ°å…¶ä»–åŒºåŸŸ"><a href="#å¦‚ä½•å°†çŸ©å½¢é€‰æ‹©å·¥å…·é€‰æ‹©çš„åŒºåŸŸå¤åˆ¶ç²˜è´´åˆ°å…¶ä»–åŒºåŸŸ" class="headerlink" title="å¦‚ä½•å°†çŸ©å½¢é€‰æ‹©å·¥å…·é€‰æ‹©çš„åŒºåŸŸå¤åˆ¶ç²˜è´´åˆ°å…¶ä»–åŒºåŸŸ"></a>å¦‚ä½•å°†çŸ©å½¢é€‰æ‹©å·¥å…·é€‰æ‹©çš„åŒºåŸŸå¤åˆ¶ç²˜è´´åˆ°å…¶ä»–åŒºåŸŸ</h3><ol>
<li><p><strong>ä½¿ç”¨çŸ©å½¢é€‰æ‹©å·¥å…·</strong></p>
<p> åœ¨å·¦ä¾§å·¥å…·æ é€‰æ‹© <code>çŸ©å½¢é€‰æ‹©å·¥å…·</code>ï¼ˆå¿«æ·é”®ï¼šRï¼‰ã€‚åœ¨å›¾åƒä¸­æ¡†é€‰ä½ è¦å¤åˆ¶çš„åŒºåŸŸã€‚</p>
</li>
<li><p><strong>å¤åˆ¶æˆ–å‰ªåˆ‡è¯¥åŒºåŸŸ</strong></p>
<ul>
<li><strong>å¤åˆ¶</strong> ï¼šå¿«æ·é”® <code>Ctrl + C</code>ï¼ˆæˆ– <code>èœå•ï¼šç¼–è¾‘ &gt; å¤åˆ¶</code> ï¼‰ã€‚  </li>
<li><strong>å‰ªåˆ‡</strong> ï¼ˆå¦‚æœä½ æƒ³æŠŠåŸä½ç½®æ¸…é™¤ï¼‰ï¼š <code>Ctrl + X</code>ï¼ˆæˆ– <code>èœå•ï¼šç¼–è¾‘ &gt; å‰ªåˆ‡</code> ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>ç²˜è´´åˆ°æ–°ä½ç½®</strong></p>
<p> æŒ‰ <code>Ctrl + V</code> ï¼ˆæˆ– <code>èœå•ï¼šç¼–è¾‘ &gt; ç²˜è´´</code> ï¼‰ã€‚ <strong>æ­¤æ—¶ä¼šå‡ºç°ä¸€ä¸ªåä¸º <code>æµ®åŠ¨é€‰æ‹©ï¼ˆæµ®åŠ¨å›¾å±‚ï¼‰</code> çš„æ–°å›¾å±‚ï¼Œé™„ç€åœ¨åŸå›¾ä¸Šã€‚</strong></p>
</li>
<li><p><strong>ç§»åŠ¨</strong></p>
<p> åœ¨å·¦ä¾§å·¥å…·æ é€‰æ‹© <code>ç§»åŠ¨å·¥å…·</code>ï¼ˆåå­—ç®­å¤´å›¾æ ‡ï¼Œå¿«æ·é”®ï¼šMï¼‰ã€‚ æ‹–åŠ¨ç²˜è´´çš„å†…å®¹åˆ°ä½ æƒ³è¦æ”¾ç½®çš„ä½ç½®ã€‚</p>
</li>
<li><p><strong>é”šå®šæˆ–æ–°å»ºå›¾å±‚</strong></p>
<p> å¦‚æœä½ æ»¡æ„ç°åœ¨çš„ä½ç½®ï¼Œå¯ä»¥ï¼š</p>
<ul>
<li><strong>é”šå®šå›¾å±‚</strong> ï¼š <code>Ctrl + H</code> æˆ– <code>å›¾å±‚ &gt; é”šå®šå›¾å±‚</code> ï¼Œç²˜è´´å†…å®¹ä¼šå¹¶å…¥åŸå›¾ã€‚</li>
<li><strong>è½¬ä¸ºæ–°å›¾å±‚</strong> ï¼šå³é”® <code>æµ®åŠ¨å›¾å±‚ &gt; è½¬ä¸ºæ–°å›¾å±‚</code> ï¼Œä¾¿äºåç»­è°ƒæ•´ã€‚</li>
</ul>
</li>
</ol>
<h2 id="æµ‹é‡å›¾ç‰‡ä¸­å…ƒç´ å¤§å°"><a href="#æµ‹é‡å›¾ç‰‡ä¸­å…ƒç´ å¤§å°" class="headerlink" title="æµ‹é‡å›¾ç‰‡ä¸­å…ƒç´ å¤§å°"></a>æµ‹é‡å›¾ç‰‡ä¸­å…ƒç´ å¤§å°</h2><p>è¦æµ‹é‡å›¾ç‰‡ä¸­æŒ‡å®šå…ƒç´ çš„ç²¾ç¡®å¤§å°ï¼ˆPixelï¼‰ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹æ–¹æ³•</p>
<ul>
<li><p><strong>ä½¿ç”¨ <code>æµ‹é‡å·¥å…·ï¼ˆMeasure Toolï¼‰</code></strong></p>
<ol>
<li>åœ¨å·¥å…·ç®±ä¸­ç‚¹å‡» <code>æµ‹é‡å·¥å…·</code> ï¼ˆå›¾æ ‡åƒä¸€ä¸ªåœ†è§„ï¼‰ï¼Œæˆ–æŒ‰å¿«æ·é”® <code>Shift + M</code> ï¼Œ <strong>é¼ æ ‡ç‚¹å‡»å›¾ç‰‡ä¸Šä½ è¦æµ‹é‡çš„èµ·ç‚¹ â†’ æ‹–åŠ¨åˆ°ç»ˆç‚¹ã€‚çŠ¶æ€æ ä¼šå®æ—¶æ˜¾ç¤º <code>è·ç¦»ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰</code> ï¼Œå¦‚ <code>Distance: XXX px</code> ã€‚</strong></li>
</ol>
</li>
<li><p><strong>ä½¿ç”¨ <code>çŸ©å½¢é€‰æ‹©å·¥å…·</code> çœ‹å®½é«˜</strong></p>
<ol>
<li>é€‰æ‹© <code>çŸ©å½¢é€‰æ‹©å·¥å…·</code> ï¼ˆå¿«æ·é”® <code>R</code>ï¼‰ï¼Œ ç”¨é¼ æ ‡æ‹–å‡ºä¸€ä¸ªåŒºåŸŸï¼ˆæ¡†ä½ä½ è¦æµ‹é‡çš„å…ƒç´ ï¼‰ï¼Œ åœ¨ <code>å·¥å…·é€‰é¡¹</code> é¢æ¿æˆ– <code>çŠ¶æ€æ </code> é‡Œï¼Œä¼šæ˜¾ç¤ºæ‰€é€‰åŒºåŸŸçš„<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Position: X, Y</span><br><span class="line">Size: Width x Heightï¼ˆå•ä½æ˜¯ pxï¼‰</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h2 id="æŠ¬é«˜å›¾ç‰‡çš„æŸä¸€ä¸ªè§’"><a href="#æŠ¬é«˜å›¾ç‰‡çš„æŸä¸€ä¸ªè§’" class="headerlink" title="æŠ¬é«˜å›¾ç‰‡çš„æŸä¸€ä¸ªè§’"></a>æŠ¬é«˜å›¾ç‰‡çš„æŸä¸€ä¸ªè§’</h2><p>å›¾ç‰‡ç»å¸¸ä¼šå‡ºç°æŸä¸ªè§’è¾ƒä½æˆ–è¾ƒé«˜çš„æƒ…å†µï¼Œæ­¤æ—¶æƒ³è¦è°ƒæ•´å›¾ç‰‡æ˜¯æ‰€æœ‰è§’å¤„äºå®Œç¾çš„çŸ©å½¢çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ <strong>é€è§†å·¥å…·ï¼ˆPerspective Toolï¼‰</strong></p>
<ol>
<li><strong>å·¥å…·ç®±é‡Œé¢é€‰æ‹© <code>é€è§†å·¥å…·ï¼ˆPerspective Toolï¼‰</code> æˆ–ä½¿ç”¨å¿«æ·é”® <code>Shift + P</code></strong> </li>
<li>**å›¾ç‰‡ä¸­ä¼šå‡ºç°å››ä¸ªè§’ï¼Œéš1313575799<br><a target="_blank" rel="noopener" href="https://www.gimp.org/">GNU IMAGE MANIPULATION PROGRAM</a></li>
</ol>
<h1 id="è„šæ³¨"><a href="#è„šæ³¨" class="headerlink" title="è„šæ³¨"></a>è„šæ³¨</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.gimp.org/">GNU IMAGE MANIPULATION PROGRAM</a><a href="#fnref:1" rev="footnote"> â†©</a></span></li></ol></div></div>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20250415145440/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20250415145440/" class="post-title-link" itemprop="url">å›¾åƒç›¸å…³æœ¯è¯­è¯æ±‡è¡¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-04-15 14:04:00" itemprop="dateCreated datePublished" datetime="2025-04-15T14:04:00+08:00">2025-04-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><ul>
<li>JPEG - Joint Photographic Experts Group ï¼Œ <strong>å›¾åƒæœ‰æŸå‹ç¼©æ ‡å‡†</strong> ï¼Œä¸»è¦ç”¨äºæ•°ç å›¾åƒçš„å­˜å‚¨å’Œä¼ è¾“ï¼Œ</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202209121102/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202209121102/" class="post-title-link" itemprop="url">kubernetes å®‰è£…é…ç½®</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-09-12 11:03:09" itemprop="dateCreated datePublished" datetime="2022-09-12T11:03:09+08:00">2022-09-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-03-19 13:03:00" itemprop="dateModified" datetime="2025-03-19T13:03:00+08:00">2025-03-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/setup/production-environment/">Kubernetes å®˜ç½‘æ–‡æ¡£</a></p>
<h1 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h1><ul>
<li>Centos 7 5.4.212-1</li>
<li>Docker 20.10.18</li>
<li>containerd.io-1.6.8</li>
<li>kubectl-1.24.7</li>
<li>kubeadm-1.24.7</li>
<li>kubelet-1.24.7</li>
</ul>
<h1 id="kubernetes-ç¯å¢ƒå®‰è£…å‰é…ç½®"><a href="#kubernetes-ç¯å¢ƒå®‰è£…å‰é…ç½®" class="headerlink" title="kubernetes ç¯å¢ƒå®‰è£…å‰é…ç½®"></a>kubernetes ç¯å¢ƒå®‰è£…å‰é…ç½®</h1><h2 id="å‡çº§å†…æ ¸ç‰ˆæœ¬"><a href="#å‡çº§å†…æ ¸ç‰ˆæœ¬" class="headerlink" title="å‡çº§å†…æ ¸ç‰ˆæœ¬"></a>å‡çº§å†…æ ¸ç‰ˆæœ¬</h2><p>Centos 7 é»˜è®¤çš„å†…æ ¸ç‰ˆæœ¬ 3.10 åœ¨è¿è¡Œ kubernetes æ—¶å­˜åœ¨ä¸ç¨³å®šæ€§ï¼Œå»ºè®®å‡çº§å†…æ ¸ç‰ˆæœ¬åˆ°æ–°ç‰ˆæœ¬</p>
<a href="/202209140931/" title="Linux å‡çº§å†…æ ¸">Linux å‡çº§å†…æ ¸</a>

<blockquote>
<ul>
<li><p>Centos 7 é»˜è®¤çš„å†…æ ¸ç‰ˆæœ¬ 3.10 ä½¿ç”¨çš„ cgroup ç‰ˆæœ¬ä¸º v1ï¼ŒKubernetes çš„éƒ¨åˆ†åŠŸèƒ½å¿…é¡»ä½¿ç”¨ <code>cgroup v2</code> æ¥è¿›è¡Œå¢å¼ºçš„èµ„æºç®¡ç†å’Œéš”ç¦» <sup id="fnref:13"><a href="#fn:13" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[About cgroup v2](https://kubernetes.io/docs/concepts/architecture/cgroups/)">[13]</span></a></sup></p>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ç³»ç»Ÿä½¿ç”¨çš„ <code>cgroup</code> ç‰ˆæœ¬</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">stat -fc %T /sys/fs/cgroup/</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¾“å‡ºæ˜¯ <code>cgroup2fs</code>ï¼Œ <strong>è¡¨ç¤ºä½¿ç”¨ cgroup v2</strong></p>
<p>å¦‚æœè¾“å‡ºæ˜¯ <code>tmpfs</code>ï¼Œ <strong>è¡¨ç¤ºä½¿ç”¨ cgroup v1</strong></p>
</li>
<li><p><code>User Namespaces</code> åŠŸèƒ½éœ€è¦ Linux 6.3 ä»¥ä¸Šç‰ˆæœ¬ï¼Œ<code>tmpfs</code> æ‰èƒ½æ”¯æŒ <code>idmap</code> æŒ‚è½½ã€‚å¹¶ä¸”å…¶ä»–åŠŸèƒ½ï¼ˆå¦‚ ServiceAccount çš„æŒ‚è½½ï¼‰ä¹Ÿéœ€è¦æ­¤åŠŸèƒ½çš„æ”¯æŒ <sup id="fnref:14"><a href="#fn:14" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[User Namespaces](https://kubernetes.io/docs/concepts/workloads/pods/user-namespaces/)">[14]</span></a></sup></p>
</li>
<li><p><strong>Kubernetes v1.32 éœ€è¦ Linux Kernel &gt;&#x3D; 4.19, å»ºè®® 5.8+ ä»¥æ›´å¥½çš„æ”¯æŒ cgroups v2</strong></p>
</li>
<li><p><strong>Rocky Linux 8 æˆ–è€… Centos 8 é»˜è®¤ä½¿ç”¨ <code>cgroup v1</code>ï¼Œéœ€è¦å‡çº§åˆ° <code>cgroup v2</code>ï¼Œæ‰§è¡Œå‘½ä»¤ <code>grubby --update-kernel=ALL --args=&quot;systemd.unified_cgroup_hierarchy=1&quot;</code> åé‡å¯å³å¯å‡çº§åˆ° <code>cgroup v2</code> ã€‚</strong> ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">stat</span> -<span class="built_in">fc</span> %T /sys/fs/cgroup/</span></span><br><span class="line">cgroup2fs</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>è‹¥ CRI ä½¿ç”¨ Containerdï¼Œéœ€è¦ <a href="https://csms.tech/202212011355/#Containerd-å¸¸ç”¨é…ç½®">é…ç½®å¯ç”¨ CRI ä»¥åŠé…ç½®å…¶ä½¿ç”¨ <code>cgroup v2</code></a>ã€‚</strong></p>
</li>
</ul>
</blockquote>
<h2 id="å…³é—­-SELinux"><a href="#å…³é—­-SELinux" class="headerlink" title="å…³é—­ SELinux"></a>å…³é—­ SELinux</h2><p>kubernetes ç›®å‰æœªå®ç°å¯¹ SELinux çš„æ”¯æŒï¼Œå› æ­¤å¿…é¡»è¦å…³é—­ SELinux</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo setenforce 0</span><br><span class="line">sudo sed -i &#x27;s/^SELINUX=enforcing$/SELINUX=disabled/&#x27; /etc/selinux/config</span><br></pre></td></tr></table></figure>

<h2 id="é›†ç¾¤ä¸­æ‰€æœ‰è®¡ç®—æœºä¹‹é—´å…·æœ‰å®Œå…¨çš„ç½‘ç»œè¿æ¥"><a href="#é›†ç¾¤ä¸­æ‰€æœ‰è®¡ç®—æœºä¹‹é—´å…·æœ‰å®Œå…¨çš„ç½‘ç»œè¿æ¥" class="headerlink" title="é›†ç¾¤ä¸­æ‰€æœ‰è®¡ç®—æœºä¹‹é—´å…·æœ‰å®Œå…¨çš„ç½‘ç»œè¿æ¥"></a>é›†ç¾¤ä¸­æ‰€æœ‰è®¡ç®—æœºä¹‹é—´å…·æœ‰å®Œå…¨çš„ç½‘ç»œè¿æ¥</h2><p>é…ç½®é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹çš„é˜²ç«å¢™ï¼Œç¡®ä¿æ‰€æœ‰é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´å…·æœ‰å®Œå…¨çš„ç½‘ç»œè¿æ¥ã€‚</p>
<ul>
<li>æ”¾é€šèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡</li>
<li>ç¡®ä¿é˜²ç«å¢™å…è®¸ <code>FORWARD</code> é“¾çš„æµé‡<figure class="highlight shell"><figcaption><span>/etc/sysconfig/iptables</span></figcaption><table><tr><td class="code"><pre><span class="line">*filter</span><br><span class="line">:INPUT DROP [0:0]</span><br><span class="line">:FORWARD ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [4:368]</span><br><span class="line"></span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A INPUT -i lo -j ACCEPT</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubernetes nodes</span></span><br><span class="line">-A INPUT -m comment --comment &quot;kubernetes nodes&quot; -s 172.31.5.58 -j ACCEPT</span><br><span class="line">-A INPUT -m comment --comment &quot;kubernetes nodes&quot; -s 172.31.5.68 -j ACCEPT</span><br><span class="line">-A INPUT -m comment --comment &quot;kubernetes nodes&quot; -s 172.31.0.230 -j ACCEPT</span><br><span class="line"></span><br><span class="line">-A INPUT -p tcp -m multiport --dports 80,443 -j ACCEPT -m comment --comment &quot;k8s ingress http,https&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">-A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT</span><br><span class="line">-A INPUT -p icmp -m icmp --icmp-type 0 -j ACCEPT</span><br><span class="line">-A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line">COMMIT</span><br></pre></td></tr></table></figure></li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202209121102/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202209301604/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202209301604/" class="post-title-link" itemprop="url">ingress-nginx å®‰è£…é…ç½®</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-09-30 16:04:20" itemprop="dateCreated datePublished" datetime="2022-09-30T16:04:20+08:00">2022-09-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-03-19 11:03:00" itemprop="dateModified" datetime="2025-03-19T11:03:00+08:00">2025-03-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h1><ul>
<li>Centos7 5.4.212-1</li>
<li>Docker 20.10.18</li>
<li>containerd.io-1.6.8</li>
<li>kubectl-1.25.0</li>
<li>kubeadm-1.25.0</li>
<li>kubelet-1.25.0</li>
</ul>
<h1 id="å®‰è£…-ingress-nginx-controller"><a href="#å®‰è£…-ingress-nginx-controller" class="headerlink" title="å®‰è£… ingress-nginx controller"></a>å®‰è£… ingress-nginx controller</h1><p>æ­¤æ–‡æ¡£ä¸­çš„é…ç½®ä¸»è¦é’ˆå¯¹åŸºäºéƒ¨ç½²åœ¨è£¸æœºï¼ˆå®‰è£…é€šç”¨ Linux å‘è¡Œç‰ˆçš„ç‰©ç†æœºæˆ–è€…äº‘ä¸»æœºç³»ç»Ÿï¼‰ä¸Šçš„ Kebernetes é›†ç¾¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.3.1/deploy/static/provider/cloud/deploy.yaml</span><br><span class="line">mv deploy.yaml ingress-nginx-controller-v1.3.1.yaml</span><br></pre></td></tr></table></figure>

<h2 id="åŸºäº-hostNetwork-çš„-ingress-nginx-controller"><a href="#åŸºäº-hostNetwork-çš„-ingress-nginx-controller" class="headerlink" title="åŸºäº hostNetwork çš„ ingress-nginx controller"></a>åŸºäº hostNetwork çš„ ingress-nginx controller</h2><p>ç¼–è¾‘ <code>ingress-nginx-controller</code> çš„ <code>Deployment</code> é…ç½®æ–‡ä»¶ï¼Œåœ¨ <code>Deployment</code> ä¸­çš„ <code>.spec.template.spec</code> ä¸‹æ·»åŠ å­—æ®µ <code>hostNetwork: true</code>ï¼Œä»¥ä½¿ <code>ingress-nginx-controller</code> å¯ä»¥ä½¿ç”¨èŠ‚ç‚¹çš„ä¸»æœºç½‘ç»œæä¾›å¯¹å¤–è®¿é—®<br><img src="https://i.csms.tech/img_61.png"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202209301604/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202212020941/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202212020941/" class="post-title-link" itemprop="url">Kubernetes ç½‘ç»œ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-12-02 09:41:16" itemprop="dateCreated datePublished" datetime="2022-12-02T09:41:16+08:00">2022-12-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-03-17 16:03:00" itemprop="dateModified" datetime="2025-03-17T16:03:00+08:00">2025-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h1><ul>
<li>Centos7 3.10.0-1160</li>
<li>Docker Engine - Community 23.0.3</li>
<li>kubernetes 1.21.2-0</li>
<li>kubernetes-cni-0.8.7-0</li>
</ul>
<p>Kubernetes å¯¹ä»»ä½•ç½‘ç»œå®ç°éƒ½è§„å®šäº†ä»¥ä¸‹è¦æ±‚ï¼š <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[ä¸‡å­—é•¿æ–‡ï¼Œå¸¦ä½ ææ‡‚ Kubernetes ç½‘ç»œæ¨¡å‹](https://www.51cto.com/article/714336.html)">[1]</span></a></sup></p>
<ul>
<li><p><strong>æ‰€æœ‰ Pod éƒ½å¯ä»¥åœ¨ä¸ä½¿ç”¨ç½‘ç»œåœ°å€è½¬æ¢ (NAT) çš„æƒ…å†µä¸‹ä¸æ‰€æœ‰å…¶ä»– Pod é€šä¿¡ã€‚</strong></p>
<p>  å®¹å™¨ä¹‹é—´ç›´æ¥é€šä¿¡ï¼Œä¸éœ€è¦é¢å¤–çš„ NATï¼Œä¸å­˜åœ¨æºåœ°å€ä¼ªè£…çš„æƒ…å†µ</p>
</li>
<li><p><strong>æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯ä»¥åœ¨æ²¡æœ‰ NAT çš„æƒ…å†µä¸‹ä¸æ‰€æœ‰ Pod é€šä¿¡ã€‚</strong></p>
<p>  Node ä¸å®¹å™¨ç›´æ¥é€šä¿¡ï¼Œä¸éœ€è¦é¢å¤–çš„ NAT</p>
</li>
<li><p><strong>Pod è®¤ä¸ºè‡ªå·±çš„ IP ä¸å…¶ä»–äººè®¤ä¸ºçš„ IP ç›¸åŒã€‚</strong></p>
</li>
</ul>
<h1 id="CNI"><a href="#CNI" class="headerlink" title="CNI"></a>CNI</h1><p>CNI æ˜¯ Kubernetes å®¹å™¨ç½‘ç»œçš„æ ‡å‡†ï¼ŒCNI æ˜¯ Kubernetes å’Œåº•å±‚ç½‘ç»œæ’ä»¶ä¹‹é—´çš„ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œä¸º Kubernetes å±è”½äº†åº•å±‚ç½‘ç»œå®ç°çš„è´Ÿè´£åº¦ï¼ŒåŒæ—¶è§£è€¦äº† Kubernetes å’Œå…·ä½“çš„ç½‘ç»œæ’ä»¶å®ç°ã€‚</p>
<h2 id="å®‰è£…-CNI"><a href="#å®‰è£…-CNI" class="headerlink" title="å®‰è£… CNI"></a>å®‰è£… CNI</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">yum install kubernetes-cni</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">rpm -qa | grep kube</span></span><br><span class="line">kubeadm-1.21.2-0.x86_64</span><br><span class="line">kubectl-1.21.2-0.x86_64</span><br><span class="line">kubelet-1.21.2-0.x86_64</span><br><span class="line">kubernetes-cni-0.8.7-0.x86_64</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">rpm -ql kubernetes-cni-0.8.7-0</span></span><br><span class="line">/opt/cni</span><br><span class="line">/opt/cni/bin</span><br><span class="line">/opt/cni/bin/bandwidth</span><br><span class="line">/opt/cni/bin/bridge</span><br><span class="line">/opt/cni/bin/dhcp</span><br><span class="line">/opt/cni/bin/firewall</span><br><span class="line">/opt/cni/bin/flannel</span><br><span class="line">/opt/cni/bin/host-device</span><br><span class="line">/opt/cni/bin/host-local</span><br><span class="line">/opt/cni/bin/ipvlan</span><br><span class="line">/opt/cni/bin/loopback</span><br><span class="line">/opt/cni/bin/macvlan</span><br><span class="line">/opt/cni/bin/portmap</span><br><span class="line">/opt/cni/bin/ptp</span><br><span class="line">/opt/cni/bin/sbr</span><br><span class="line">/opt/cni/bin/static</span><br><span class="line">/opt/cni/bin/tuning</span><br><span class="line">/opt/cni/bin/vlan</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Kubernetes è¦ä½¿ç”¨ CNIï¼Œéœ€è¦åœ¨ kubelet å¯åŠ¨æ—¶é…ç½®å¯åŠ¨å‚æ•° <code>--network-plugin=cni</code>ï¼ˆé»˜è®¤é…ç½®ï¼Œå¯ä½¿ç”¨ <code>systemctl status kubelet -l</code> æŸ¥çœ‹å¯åŠ¨å‚æ•°ï¼‰ã€‚</p>
<p>kubelet ä» <code>--cni-config-dir</code> ï¼ˆé»˜è®¤ä¸º <code>/etc/cni/net.d/</code>ï¼‰ä¸­è¯»å–ç½‘ç»œæ’ä»¶çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨è¯¥æ–‡ä»¶ä¸­çš„ CNI é…ç½®æ¥é…ç½®æ¯ä¸ª Pod ç½‘ç»œã€‚å¦‚æœè¯¥ç›®å½• ï¼ˆ<code>/etc/cni/net.d/</code>ï¼‰ä¸­æœ‰å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œåˆ™ä½¿ç”¨æ–‡ä»¶åå­—å…¸åºåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚</p>
<p>CNI æ’ä»¶çš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾ç½®çš„ç›®å½•æ˜¯é€šè¿‡ kubelet çš„ <code>--cni-bin-dir</code> å‚æ•°æŒ‡å®šï¼Œé»˜è®¤ä¸º <code>/opt/cni/bin/</code></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202212020941/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202310051003/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202310051003/" class="post-title-link" itemprop="url">etcd</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-10-05 10:03:54" itemprop="dateCreated datePublished" datetime="2023-10-05T10:03:54+08:00">2023-10-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-03-13 16:03:00" itemprop="dateModified" datetime="2025-03-13T16:03:00+08:00">2025-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h1><ul>
<li>etcd v3.5</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://etcd.io/docs/v3.5/install/">etcd å®˜ç½‘å®‰è£…æŒ‡å—</a><br><a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/releases/">Github ä¸‹è½½é“¾æ¥</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://github.com/etcd-io/etcd/releases/download/v3.5.9/etcd-v3.5.9-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">tar -xf etcd-v3.5.9-linux-amd64.tar.gz -C /usr/local/</span><br><span class="line"></span><br><span class="line">ln -s /usr/local/etcd-v3.5.9-linux-amd64/etcd /usr/bin/</span><br><span class="line">ln -s /usr/local/etcd-v3.5.9-linux-amd64/etcdctl /usr/bin/</span><br><span class="line">ln -s /usr/local/etcd-v3.5.9-linux-amd64/etcdutl /usr/bin/</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨ <code>etcd</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">etcd</span></span><br><span class="line">&#123;&quot;level&quot;:&quot;warn&quot;,&quot;ts&quot;:&quot;2023-10-05T02:16:52.853273Z&quot;,&quot;caller&quot;:&quot;embed/config.go:673&quot;,&quot;msg&quot;:&quot;Running http and grpc server on single port. This is not recommended for production.&quot;&#125;</span><br><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:&quot;2023-10-05T02:16:52.853914Z&quot;,&quot;caller&quot;:&quot;etcdmain/etcd.go:73&quot;,&quot;msg&quot;:&quot;Running: &quot;,&quot;args&quot;:[&quot;etcd&quot;]&#125;</span><br><span class="line">&#123;&quot;level&quot;:&quot;warn&quot;,&quot;ts&quot;:&quot;2023-10-05T02:16:52.853947Z&quot;,&quot;caller&quot;:&quot;etcdmain/etcd.go:105&quot;,&quot;msg&quot;:&quot;&#x27;data-dir&#x27; was empty; using default&quot;,&quot;data-dir&quot;:&quot;default.etcd&quot;&#125;</span><br><span class="line">&#123;&quot;level&quot;:&quot;warn&quot;,&quot;ts&quot;:&quot;2023-10-05T02:16:52.853994Z&quot;,&quot;caller&quot;:&quot;embed/config.go:673&quot;,&quot;msg&quot;:&quot;Running http and grpc server on single port. This is not recommended for production.&quot;&#125;</span><br><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:&quot;2023-10-05T02:16:52.854009Z&quot;,&quot;caller&quot;:&quot;embed/etcd.go:127&quot;,&quot;msg&quot;:&quot;configuring peer listeners&quot;,&quot;listen-peer-urls&quot;:[&quot;http://localhost:2380&quot;]&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h1 id="å¸¸ç”¨ç®¡ç†å‘½ä»¤"><a href="#å¸¸ç”¨ç®¡ç†å‘½ä»¤" class="headerlink" title="å¸¸ç”¨ç®¡ç†å‘½ä»¤"></a>å¸¸ç”¨ç®¡ç†å‘½ä»¤</h1><h2 id="etcd"><a href="#etcd" class="headerlink" title="etcd"></a>etcd</h2><h3 id="æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯"><a href="#æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯"></a>æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">etcd --version</span></span><br><span class="line">etcd Version: 3.5.3</span><br><span class="line">Git SHA: 0452feec7</span><br><span class="line">Go Version: go1.16.15</span><br><span class="line">Go OS/Arch: linux/amd64</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºé›†ç¾¤"><a href="#åˆ›å»ºé›†ç¾¤" class="headerlink" title="åˆ›å»ºé›†ç¾¤"></a>åˆ›å»ºé›†ç¾¤</h3><p><code>etcd</code> åˆ›å»ºé›†ç¾¤æ¶‰åŠå‚æ•°è¯´æ˜</p>
<table>
<thead>
<tr>
<th>name</th>
<th>è¯´æ˜</th>
<th>å‘½ä»¤è¡Œå‚æ•°</th>
</tr>
</thead>
<tbody><tr>
<td><code>name</code></td>
<td>æ¯ä¸ªé›†ç¾¤æˆå‘˜çš„å”¯ä¸€åç§°</td>
<td><code>--name=etcd0</code></td>
</tr>
<tr>
<td><code>initial-advertise-peer-urls</code></td>
<td>ç¾¤æˆå‘˜å¹¿æ’­ç»™é›†ç¾¤å…¶ä»–æˆå‘˜ï¼ˆç”¨äºè¿æ¥æœ¬èŠ‚ç‚¹ï¼‰çš„ URL<br/>é»˜è®¤ä¸º <code>http://IP:2380</code></td>
<td><code>--initial-advertise-peer-urls=http://10.0.0.10:2380</code></td>
</tr>
<tr>
<td><code>listen-peer-urls</code></td>
<td>åœ¨è¿™äº›ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰ URL ä¸Šç›‘å¬å…¶ä»–é›†ç¾¤æˆå‘˜çš„è¿æ¥è¯·æ±‚<br/>é€šä¿¡åŒ…æ‹¬äº†é›†ç¾¤ç®¡ç†ä»»åŠ¡ã€æ•°æ®åŒæ­¥å’Œå¿ƒè·³æ£€æµ‹ç­‰</td>
<td><code>http://10.0.0.10:2380,http://127.0.0.1:2380</code></td>
</tr>
<tr>
<td><code>listen-client-urls</code></td>
<td>è¯¥æˆå‘˜ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ URLã€‚ é»˜è®¤ç«¯å£ 2379</td>
<td><code>--listen-client-urls=http://10.0.0.10:2379,http://127.0.0.1:2379</code></td>
</tr>
<tr>
<td><code>advertise-client-urls</code></td>
<td>è¯¥æˆå‘˜å¹¿æ’­ç»™å®¢æˆ·ç«¯çš„ URL</td>
<td><code>--advertise-client-urls=http://10.0.0.10:2379</code></td>
</tr>
<tr>
<td><code>initial-cluster</code></td>
<td>æ‰€æœ‰ <code>etcd</code> æˆå‘˜çš„åˆå§‹åˆ—è¡¨</td>
<td><code>--initial-cluster=etcd0=http://10.0.0.10:2380,etcd1=http://10.0.0.11:2380,etcd2=http://10.0.0.12:2380</code></td>
</tr>
<tr>
<td><code>data-dir</code></td>
<td><code>etcd</code> æ•°æ®çš„å­˜å‚¨ç›®å½•ã€‚</td>
<td><code>--data-dir=/var/lib/etcd</code></td>
</tr>
<tr>
<td><code>initial-cluster-token</code></td>
<td>åˆå§‹é›†ç¾¤çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„ <code>etcd</code> é›†ç¾¤</td>
<td><code>--initial-cluster-token=my-etcd-token</code></td>
</tr>
<tr>
<td><code>initial-cluster-state</code></td>
<td>åˆå§‹é›†ç¾¤çŠ¶æ€ï¼Œå¯ä»¥æ˜¯ <code>new</code> æˆ– <code>existing</code>ã€‚<br/>é€šå¸¸åœ¨å¼•å¯¼æ–°é›†ç¾¤æ—¶ä½¿ç”¨ <code>new</code>ï¼Œè€Œåœ¨æ·»åŠ æˆ–åˆ é™¤æˆå‘˜æ—¶ä½¿ç”¨ <code>existing</code>ã€‚</td>
<td><code>--initial-cluster-state=new</code></td>
</tr>
<tr>
<td><code>quota-backend-bytes</code></td>
<td><code>etcd</code> çš„åç«¯æ•°æ®åº“å¤§å°çš„ç¡¬é™åˆ¶ï¼Œé»˜è®¤æ˜¯ 2GB</td>
<td><code>--quota-backend-bytes=3000000000</code></td>
</tr>
<tr>
<td><code>cert-file</code><br/><code>key-file</code></td>
<td>ç”¨äº HTTPS çš„è¯ä¹¦å’Œç§é’¥</td>
<td><code>--cert-file=/etc/kubernetes/pki/etcd/server.crt</code> <br/><code>--key-file=/etc/kubernetes/pki/etcd/server.key</code></td>
</tr>
<tr>
<td><code>trusted-ca-file</code></td>
<td>å®¢æˆ·ç«¯å’Œå¯¹ç­‰ä½“çš„éªŒè¯æ‰€éœ€çš„ CA è¯ä¹¦</td>
<td><code>--trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt</code></td>
</tr>
<tr>
<td><code>client-cert-auth</code></td>
<td>å¯ç”¨å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯ï¼Œé»˜è®¤ä¸º <code>false</code></td>
<td><code>--client-cert-auth</code></td>
</tr>
</tbody></table>
<p><code>listen-peer-urls</code> å’Œ <code>initial-advertise-peer-urls</code> çš„åŒºåˆ«è¯´æ˜ï¼š</p>
<ul>
<li><p><code>listen-peer-urls</code></p>
<p>  è¿™ä¸ªå‚æ•°æŒ‡å®šäº† <code>etcd</code> æˆå‘˜åº”è¯¥åœ¨å“ªäº›åœ°å€å’Œç«¯å£ä¸Šç›‘å¬æ¥è‡ªå…¶ä»– <code>etcd</code> æˆå‘˜çš„è¯·æ±‚ï¼ˆæ•°æ®åŒæ­¥ã€é¢†å¯¼é€‰ä¸¾ã€é›†ç¾¤æ›´æ”¹ç­‰ç›¸å…³ï¼‰</p>
<p> ä¸»è¦ç”¨é€”æ˜¯å®šä¹‰å“ªä¸ªç½‘ç»œæ¥å£å’Œç«¯å£å·åº”è¯¥è¢« <code>etcd</code> æœåŠ¡ç»‘å®šï¼Œä»¥ä¾¿å®ƒå¯ä»¥æ¥æ”¶æ¥è‡ªå…¶ä»–æˆå‘˜çš„è¿æ¥</p>
</li>
<li><p><code>initial-advertise-peer-urls</code></p>
<p> è¿™ä¸ªå‚æ•°å‘Šè¯‰ <code>etcd</code> è¯¥å¦‚ä½• <em><strong>é€šå‘Šè‡ªå·±</strong></em> ç»™é›†ç¾¤ä¸­çš„å…¶ä»–æˆå‘˜ã€‚è¿™æ˜¯å…¶ä»–é›†ç¾¤æˆå‘˜ç”¨æ¥è”ç³»æ­¤ <code>etcd</code> æˆå‘˜çš„åœ°å€ã€‚</p>
<p> ä¸»è¦ç”¨é€”æ˜¯ <strong>å½“æ–°æˆå‘˜åŠ å…¥é›†ç¾¤æ—¶ï¼Œå®ƒéœ€è¦é€šçŸ¥å…¶ä»–æˆå‘˜è‡ªå·±çš„å­˜åœ¨ï¼Œä»¥åŠå¦‚ä½•ä¸è‡ªå·±é€šä¿¡</strong>ï¼Œå› æ­¤å®ƒå¿…é¡»æ˜¯ä¸ªå…¶ä»–èŠ‚ç‚¹å¯è¾¾çš„ Endpointsï¼Œå¦‚ <code>http://0.0.0.0:2380</code> å°±ä¸è¡Œã€‚</p>
<blockquote>
<p><code>listen-client-urls</code> å’Œ <code>advertise-client-urls</code> çš„åŒºåˆ«åŒç†</p>
</blockquote>
</li>
</ul>
<p>ç¤ºä¾‹ç¯å¢ƒè¯´æ˜</p>
<table>
<thead>
<tr>
<th>ä¸»æœº</th>
<th>IP</th>
<th>è§’è‰²</th>
</tr>
</thead>
<tbody><tr>
<td>etcd1</td>
<td>172.17.0.2&#x2F;16</td>
<td>etcd node</td>
</tr>
<tr>
<td>etcd2</td>
<td>172.17.0.3&#x2F;16</td>
<td>etcd node</td>
</tr>
<tr>
<td>etcd3</td>
<td>172.17.0.4&#x2F;16</td>
<td>etcd node</td>
</tr>
</tbody></table>
<p>åˆ†åˆ«åœ¨ 3 ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œä»¥ä¸‹ 3 æ¡å‘½ä»¤ï¼Œåˆ›å»ºé›†ç¾¤</p>
<p><code>etcd1</code> æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">etcd --data-dir=data.etcd --name etcd1 \</span><br><span class="line">	--initial-advertise-peer-urls http://172.17.0.2:2380 --listen-peer-urls http://172.17.0.2:2380,http://127.0.0.1:2380 \</span><br><span class="line">	--advertise-client-urls http://172.17.0.2:2379 --listen-client-urls http://172.17.0.2:2379,http://127.0.0.1:2379 \</span><br><span class="line">	--initial-cluster etcd1=http://172.17.0.2:2380,etcd2=http://172.17.0.3:2380,etcd3=http://172.17.0.4:2380 \</span><br><span class="line">	--initial-cluster-state new --initial-cluster-token etcd-cluster</span><br></pre></td></tr></table></figure>

<p><code>etcd2</code> æ‰§è¡Œå‘½ä»¤ï¼š	</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">etcd --data-dir=data.etcd --name etcd2 \</span><br><span class="line">	--initial-advertise-peer-urls http://172.17.0.3:2380 --listen-peer-urls http://172.17.0.3:2380,http://127.0.0.1:2380 \</span><br><span class="line">	--advertise-client-urls http://172.17.0.3:2379 --listen-client-urls http://172.17.0.3:2379,http://127.0.0.1:2379 \</span><br><span class="line">	--initial-cluster etcd1=http://172.17.0.2:2380,etcd2=http://172.17.0.3:2380,etcd3=http://172.17.0.4:2380 \</span><br><span class="line">	--initial-cluster-state new --initial-cluster-token etcd-cluster</span><br></pre></td></tr></table></figure>
<p><code>etcd3</code> æ‰§è¡Œå‘½ä»¤ï¼š	</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">etcd --data-dir=data.etcd --name etcd3 \</span><br><span class="line">	--initial-advertise-peer-urls http://172.17.0.4:2380 --listen-peer-urls http://172.17.0.4:2380,http://127.0.0.1:2380 \</span><br><span class="line">	--advertise-client-urls http://172.17.0.4:2379 --listen-client-urls http://172.17.0.4:2379,http://127.0.0.1:2379 \</span><br><span class="line">	--initial-cluster etcd1=http://172.17.0.2:2380,etcd2=http://172.17.0.3:2380,etcd3=http://172.17.0.4:2380 \</span><br><span class="line">	--initial-cluster-state new --initial-cluster-token etcd-cluster	</span><br></pre></td></tr></table></figure>

<p>æ£€æŸ¥èŠ‚ç‚¹å¥åº·çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ENDPOINT=http://172.17.0.3:2380,http://172.17.0.2:2380,http://172.17.0.4:2380</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">etcdctl endpoint status --endpoints=<span class="variable">$ENDPOINT</span> -w table</span> </span><br><span class="line">+------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span><br><span class="line">|        ENDPOINT        |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |</span><br><span class="line">+------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span><br><span class="line">| http://172.17.0.3:2380 | 660aa483274d103a |   3.5.9 |   20 kB |     false |      false |         2 |          9 |                  9 |        |</span><br><span class="line">| http://172.17.0.2:2380 | 69015be41c714f32 |   3.5.9 |   20 kB |      true |      false |         2 |          9 |                  9 |        |</span><br><span class="line">| http://172.17.0.4:2380 | ad0233873e2a0054 |   3.5.9 |   20 kB |     false |      false |         2 |          9 |                  9 |        |</span><br><span class="line">+------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">etcdctl endpoint health --endpoints=<span class="variable">$ENDPOINT</span> -w table</span></span><br><span class="line">+------------------------+--------+------------+-------+</span><br><span class="line">|        ENDPOINT        | HEALTH |    TOOK    | ERROR |</span><br><span class="line">+------------------------+--------+------------+-------+</span><br><span class="line">| http://172.17.0.2:2380 |   true |  2.44553ms |       |</span><br><span class="line">| http://172.17.0.3:2380 |   true | 2.804559ms |       |</span><br><span class="line">| http://172.17.0.4:2380 |   true | 2.580515ms |       |</span><br><span class="line">+------------------------+--------+------------+-------+</span><br></pre></td></tr></table></figure>

<h2 id="etcdctl"><a href="#etcdctl" class="headerlink" title="etcdctl"></a>etcdctl</h2><h3 id="æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯-1"><a href="#æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯-1" class="headerlink" title="æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯"></a>æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">etcdctl version</span></span><br><span class="line">etcdctl version: 3.5.3</span><br><span class="line">API version: 3.5</span><br></pre></td></tr></table></figure>

<h3 id="etcd-é›†ç¾¤ç®¡ç†"><a href="#etcd-é›†ç¾¤ç®¡ç†" class="headerlink" title="etcd é›†ç¾¤ç®¡ç†"></a>etcd é›†ç¾¤ç®¡ç†</h3><h4 id="æŸ¥çœ‹-etcd-é›†ç¾¤æˆå‘˜åˆ—è¡¨"><a href="#æŸ¥çœ‹-etcd-é›†ç¾¤æˆå‘˜åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹ etcd é›†ç¾¤æˆå‘˜åˆ—è¡¨"></a>æŸ¥çœ‹ etcd é›†ç¾¤æˆå‘˜åˆ—è¡¨</h4><p>Kubernetes ä¸­æŸ¥çœ‹ <code>etcd</code> é›†ç¾¤æˆå‘˜åˆ—è¡¨ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl <span class="built_in">exec</span> -n kube-system -it etcd-k8s-master1 -- sh -c <span class="string">&quot;ETCDCTL_API=3 etcdctl member list --endpoints=https://127.0.0.1:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key&quot;</span></span></span><br><span class="line">3c087bf12db7a0f, started, k8s-master2, https://172.31.30.115:2380, https://172.31.30.115:2379, false</span><br><span class="line">92e04392f8ad0046, started, k8s-master3, https://172.31.29.250:2380, https://172.31.29.250:2379, false</span><br><span class="line">c71592552b3eb9bb, started, k8s-master1, https://172.31.30.123:2380, https://172.31.30.123:2379, false</span><br></pre></td></tr></table></figure>
<p>æŒ‡å®šè¾“å‡ºæ ¼å¼ä¸º <code>table</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">etcdctl member list --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key --write-out=table</span></span><br><span class="line">+------------------+---------+-------------+----------------------------+----------------------------+------------+</span><br><span class="line">|        ID        | STATUS  |     NAME    |         PEER ADDRS         |        CLIENT ADDRS        | IS LEARNER |</span><br><span class="line">+------------------+---------+-------------+----------------------------+----------------------------+------------+</span><br><span class="line">|  3c087bf12db7a0f | started | k8s-master2 | https://172.31.30.115:2380 | https://172.31.30.115:2379 |      false |</span><br><span class="line">| 92e04392f8ad0046 | started | k8s-master3 | https://172.31.29.250:2380 | https://172.31.29.250:2379 |      false |</span><br><span class="line">| c71592552b3eb9bb | started | k8s-master1 | https://172.31.30.123:2380 | https://172.31.30.123:2379 |      false |</span><br><span class="line">+------------------+---------+-------------+----------------------------+----------------------------+------------+</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºå†…å®¹è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>3c087bf12db7a0f</code> : é›†ç¾¤ä¸­æ¯ä¸€ä¸ªæˆå‘˜çš„å”¯ä¸€ IDã€‚</li>
<li><code>started</code> : é›†ç¾¤æˆå‘˜çš„å½“å‰çŠ¶æ€ã€‚<code>started</code> è¡¨ç¤ºæ´»åŠ¨çš„ã€‚</li>
<li><code>k8s-master2</code> : <code>etcd</code> é›†ç¾¤æˆå‘˜çš„åå­—ï¼Œé€šå¸¸ä¸å…¶ä¸»æœºåæˆ–èŠ‚ç‚¹åç›¸å¯¹åº”</li>
<li><code>https://172.31.30.115:2380</code> : <code>Peer URLs</code>ï¼Œå…¶ä»– <code>etcd</code> æˆå‘˜ç”¨äºä¸è¯¥æˆå‘˜é€šä¿¡çš„ URLã€‚é»˜è®¤ä¸º æœ¬åœ° IP çš„ 2380 ç«¯å£</li>
<li><code>https://172.31.30.123:2379</code> : <code>Client URLs</code> ï¼Œå®¢æˆ·ç«¯ç”¨äºä¸ <code>etcd</code> æˆå‘˜é€šä¿¡çš„ URLã€‚é»˜è®¤ä¸º æœ¬åœ° IP çš„ 2379 ç«¯å£</li>
<li><code>Is Learner</code> : è¡¨ç¤ºè¯¥æˆå‘˜æ˜¯å¦æ˜¯ä¸€ä¸ª <code>learner</code>ã€‚Learner æ˜¯ <code>etcd</code> çš„ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œå…è®¸ä¸€ä¸ªæˆå‘˜ä½œä¸ºéæŠ•ç¥¨æˆå‘˜åŠ å…¥é›†ç¾¤ï¼Œç›´åˆ°å®ƒå‡†å¤‡å¥½æˆä¸ºä¸€ä¸ªå®Œå…¨å‚ä¸çš„æˆå‘˜ã€‚<code>false</code> è¡¨ç¤ºå®ƒä»¬éƒ½ä¸æ˜¯ <code>learners</code></li>
</ul>
<h4 id="æ£€æŸ¥é›†ç¾¤çŠ¶æ€"><a href="#æ£€æŸ¥é›†ç¾¤çŠ¶æ€" class="headerlink" title="æ£€æŸ¥é›†ç¾¤çŠ¶æ€"></a>æ£€æŸ¥é›†ç¾¤çŠ¶æ€</h4><p>æ£€æŸ¥å•ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤é…ç½®çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">etcdctl --write-out=table endpoint status --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key</span></span><br><span class="line">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span><br><span class="line">|    ENDPOINT    |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |</span><br><span class="line">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span><br><span class="line">| 127.0.0.1:2379 | c71592552b3eb9bb |   3.5.3 |  106 MB |     false |      false |        16 |  228198001 |          228198001 |        |</span><br><span class="line">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹çš„é›†ç¾¤é…ç½®çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ENDPOINTS=https://172.31.30.115:2379,https://172.31.29.250:2379,https://172.31.30.123:2379</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">etcdctl --write-out=table --endpoints=<span class="variable">$ENDPOINTS</span> endpoint status</span> </span><br><span class="line">+----------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span><br><span class="line">|          ENDPOINT          |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |</span><br><span class="line">+----------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span><br><span class="line">| https://172.31.30.115:2379 |  3c087bf12db7a0f |   3.5.3 |  106 MB |      true |      false |        16 |  228199920 |          228199920 |        |</span><br><span class="line">| https://172.31.29.250:2379 | 92e04392f8ad0046 |   3.5.3 |  106 MB |     false |      false |        16 |  228199920 |          228199920 |        |</span><br><span class="line">| https://172.31.30.123:2379 | c71592552b3eb9bb |   3.5.3 |  106 MB |     false |      false |        16 |  228199920 |          228199920 |        |</span><br><span class="line">+----------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">etcdctl --write-out=table --endpoints=<span class="variable">$ENDPOINTS</span> endpoint health</span></span><br><span class="line">+----------------------------+--------+------------+-------+</span><br><span class="line">|          ENDPOINT          | HEALTH |    TOOK    | ERROR |</span><br><span class="line">+----------------------------+--------+------------+-------+</span><br><span class="line">| https://172.31.30.115:2379 |   true | 7.927976ms |       |</span><br><span class="line">| https://172.31.30.123:2379 |   true | 8.011055ms |       |</span><br><span class="line">| https://172.31.29.250:2379 |   true | 8.349179ms |       |</span><br><span class="line">+----------------------------+--------+------------+-------+</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202310051003/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202209140931/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202209140931/" class="post-title-link" itemprop="url">Linux å‡çº§å†…æ ¸</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-09-14 09:32:00" itemprop="dateCreated datePublished" datetime="2022-09-14T09:32:00+08:00">2022-09-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-03-11 10:03:00" itemprop="dateModified" datetime="2025-03-11T10:03:00+08:00">2025-03-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>é€‚ç”¨ä»¥ä¸‹ç‰ˆæœ¬</strong></p>
<ul>
<li>Centos 7 å†…æ ¸å‡çº§</li>
<li>Centos 8 æˆ– Rocky Linux 8 å†…æ ¸å‡çº§</li>
</ul>
<p><strong>ç¯å¢ƒæ¯æ¯</strong></p>
<ul>
<li>Centos7 3.10.0-1062.9.1.el7.x86_64</li>
<li>Rocky Linux 8</li>
</ul>
<h1 id="å‡çº§æ­¥éª¤"><a href="#å‡çº§æ­¥éª¤" class="headerlink" title="å‡çº§æ­¥éª¤"></a>å‡çº§æ­¥éª¤</h1><h2 id="å®‰è£…-centos-kernel"><a href="#å®‰è£…-centos-kernel" class="headerlink" title="å®‰è£… centos-kernel"></a>å®‰è£… centos-kernel</h2><p><strong>å¦‚æœæ˜¯ Centos 7 ï¼Œå‚è€ƒä»¥ä¸‹å‘½ä»¤å®‰è£… <code>centos-kernel</code> æº</strong></p>
<blockquote>
<p><code>elrepo-kernel</code> ä¸­å·²ç»æ²¡æœ‰ Centos 7 ç›¸å…³çš„å†…æ ¸å®‰è£…åŒ…</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install centos-release</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…-elrepo-æº"><a href="#å®‰è£…-elrepo-æº" class="headerlink" title="å®‰è£… elrepo æº"></a>å®‰è£… elrepo æº</h2><p><strong>å¦‚æœæ˜¯ Centos 8 æˆ– Rocky Linux 8ï¼Œå‚è€ƒä»¥ä¸‹å‘½ä»¤å®‰è£… <code>elrepo</code> æº</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rpm --import https://www.elrepo.org/RPM-GPG-KEY-v2-elrepo.org</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum install https://www.elrepo.org/elrepo-release-8.el8.elrepo.noarch.rpm</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum --disablerepo=<span class="string">&quot;*&quot;</span> --enablerepo=<span class="string">&quot;elrepo-kernel&quot;</span> list available</span></span><br><span class="line">Last metadata expiration check: 0:00:14 ago on Fri 28 Feb 2025 11:42:09 AM HKT.</span><br><span class="line">Available Packages</span><br><span class="line">bpftool.x86_64                                                                5.4.290-1.el8.elrepo                                              elrepo-kernel</span><br><span class="line">kernel-lt.x86_64                                                              5.4.290-1.el8.elrepo                                              elrepo-kernel</span><br><span class="line">kernel-lt-core.x86_64                                                         5.4.290-1.el8.elrepo                                              elrepo-kernel</span><br><span class="line">kernel-lt-devel.x86_64                                                        5.4.290-1.el8.elrepo                                              elrepo-kernel</span><br><span class="line">kernel-lt-doc.noarch                                                          5.4.290-1.el8.elrepo                                              elrepo-kernel</span><br><span class="line">kernel-lt-headers.x86_64                                                      5.4.290-1.el8.elrepo                                              elrepo-kernel</span><br><span class="line">kernel-lt-modules.x86_64                                                      5.4.290-1.el8.elrepo                                              elrepo-kernel</span><br><span class="line">kernel-lt-modules-extra.x86_64                                                5.4.290-1.el8.elrepo                                              elrepo-kernel</span><br><span class="line">kernel-lt-tools.x86_64                                                        5.4.290-1.el8.elrepo                                              elrepo-kernel</span><br><span class="line">kernel-lt-tools-libs.x86_64                                                   5.4.290-1.el8.elrepo                                              elrepo-kernel</span><br><span class="line">kernel-lt-tools-libs-devel.x86_64                                             5.4.290-1.el8.elrepo                                              elrepo-kernel</span><br><span class="line">kernel-ml.x86_64                                                              6.13.5-1.el8.elrepo                                               elrepo-kernel</span><br><span class="line">kernel-ml-core.x86_64                                                         6.13.5-1.el8.elrepo                                               elrepo-kernel</span><br><span class="line">kernel-ml-devel.x86_64                                                        6.13.5-1.el8.elrepo                                               elrepo-kernel</span><br><span class="line">kernel-ml-doc.noarch                                                          6.13.5-1.el8.elrepo                                               elrepo-kernel</span><br><span class="line">kernel-ml-headers.x86_64                                                      6.13.5-1.el8.elrepo                                               elrepo-kernel</span><br><span class="line">kernel-ml-modules.x86_64                                                      6.13.5-1.el8.elrepo                                               elrepo-kernel</span><br><span class="line">kernel-ml-modules-extra.x86_64                                                6.13.5-1.el8.elrepo                                               elrepo-kernel</span><br><span class="line">kernel-ml-tools.x86_64                                                        6.13.5-1.el8.elrepo                                               elrepo-kernel</span><br><span class="line">kernel-ml-tools-libs.x86_64                                                   6.13.5-1.el8.elrepo                                               elrepo-kernel</span><br><span class="line">kernel-ml-tools-libs-devel.x86_64                                             6.13.5-1.el8.elrepo                                               elrepo-kernel</span><br><span class="line">perf.x86_64                                                                   6.13.5-1.el8.elrepo                                               elrepo-kernel</span><br><span class="line">python3-perf.x86_64                                                           6.13.5-1.el8.elrepo                                               elrepo-kernel</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202209140931/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241127142554/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20241127142554/" class="post-title-link" itemprop="url">Linux æ€§èƒ½åˆ†æå·¥å…· strace</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-11-27 11:11:00" itemprop="dateCreated datePublished" datetime="2024-11-27T11:11:00+08:00">2024-11-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-03-10 16:03:00" itemprop="dateModified" datetime="2025-03-10T16:03:00+08:00">2025-03-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" itemprop="url" rel="index"><span itemprop="name">æ€§èƒ½åˆ†æ</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><code>strace</code> å‘½ä»¤ç¤ºä¾‹ï¼Œè¯¦ç»†ä½¿ç”¨è¯´æ˜è¯·å‚è€ƒ <code>man strace</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">strace <span class="built_in">ls</span></span></span><br><span class="line">execve(&quot;/usr/bin/ls&quot;, [&quot;ls&quot;], 0x7ffe75aa9350 /* 12 vars */) = 0</span><br><span class="line">brk(NULL)                               = 0x556c51ed9000</span><br><span class="line">arch_prctl(0x3001 /* ARCH_??? */, 0x7ffc20fecaf0) = -1 EINVAL (Invalid argument)</span><br><span class="line">mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f2b1b0a2000</span><br><span class="line">access(&quot;/etc/ld.so.preload&quot;, R_OK)      = -1 ENOENT (No such file or directory)</span><br><span class="line">openat(AT_FDCWD, &quot;/etc/ld.so.cache&quot;, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line">newfstatat(3, &quot;&quot;, &#123;st_mode=S_IFREG|0644, st_size=34211, ...&#125;, AT_EMPTY_PATH) = 0</span><br><span class="line">mmap(NULL, 34211, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f2b1b099000</span><br><span class="line">close(3)                                = 0</span><br><span class="line">openat(AT_FDCWD, &quot;/lib/x86_64-linux-gnu/libselinux.so.1&quot;, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line">read(3, &quot;\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\0\0\0\0\0\0\0\0&quot;..., 832) = 832</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><code>strace</code> è·Ÿè¸ªè¾“å‡ºä¸­åŒ…å«</p>
<ul>
<li><strong>Syscall Name</strong> ï¼Œå¦‚ <code>execve</code> ã€ <code>openat</code> ç­‰</li>
<li><strong>Arguments</strong> ï¼Œ ç³»ç»Ÿè°ƒç”¨ä½¿ç”¨çš„å‚æ•°ï¼Œå¦‚ <code>&quot;/usr/bin/ls&quot;</code> ã€ <code>AT_FDCWD, &quot;/etc/ld.so.cache&quot;, O_RDONLY|O_CLOEXEC</code></li>
<li><strong>Return Value</strong> ï¼Œç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼ä»¥åŠç®€è¦è¯´æ˜ä¿¡æ¯ï¼Œ å¦‚ <code>= -1 EINVAL (Invalid argument)</code> ã€ <code>-1 ENOENT (No such file or directory)</code> ã€ <code>= 0</code></li>
</ul>
<h1 id="strace-å‘½ä»¤å¸¸ç”¨é€‰é¡¹"><a href="#strace-å‘½ä»¤å¸¸ç”¨é€‰é¡¹" class="headerlink" title="strace å‘½ä»¤å¸¸ç”¨é€‰é¡¹"></a>strace å‘½ä»¤å¸¸ç”¨é€‰é¡¹</h1><table>
<thead>
<tr>
<th>é€‰é¡¹</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>-o filename</code><br/><code>--output=filename</code></td>
<td>å°†è·Ÿè¸ªå†…å®¹å†™å…¥æŒ‡å®šæ–‡ä»¶è€Œä¸æ˜¯ STDOUTï¼ˆé»˜è®¤å€¼ï¼‰</td>
<td></td>
</tr>
<tr>
<td><code>-p pid</code><br/><code>--attach=pid</code></td>
<td>è¿½è¸ª PIDs å¯¹åº”çš„è¿›ç¨‹ï¼Œ<code>Ctrl + C</code> ç»“æŸè¿½è¸ªã€‚ <strong>æ”¯æŒ <code>,</code> ã€ ç©ºæ ¼ ï¼ˆ <code> </code> ï¼‰ ã€ TAB é”®ï¼ˆ <code>\t</code> ï¼‰åˆ†å‰²çš„å¤šä¸ª PID</strong></td>
<td></td>
</tr>
<tr>
<td><code>-e expr</code></td>
<td>è¿½è¸ªè¡¨è¾¾å¼åŒ¹é…çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè¡¨è¾¾å¼è¯­æ³•è¯·å‚è€ƒ <code>man strace</code></td>
<td></td>
</tr>
<tr>
<td><code>-c</code><br/><code>--summary-only</code></td>
<td>ä»…è¾“å‡ºè°ƒç”¨çš„ç»Ÿè®¡æ•°æ®ï¼Œä¸è¾“å‡ºå¸¸è§„è·Ÿè¸ªå†…å®¹</td>
<td></td>
</tr>
<tr>
<td><code>-C</code><br/><code>--summary</code></td>
<td>è¾“å‡ºå¸¸è§„è·Ÿè¸ªå†…å®¹åï¼Œè¾“å‡ºç»Ÿè®¡ä¿¡æ¯</td>
<td></td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202308311109/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202308311109/" class="post-title-link" itemprop="url">Ansible ä½¿ç”¨ä»‹ç»</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-08-31 11:09:16" itemprop="dateCreated datePublished" datetime="2023-08-31T11:09:16+08:00">2023-08-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-03-06 14:03:00" itemprop="dateModified" datetime="2025-03-06T14:03:00+08:00">2025-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h1><ul>
<li>Centos 7</li>
<li>ansible-core 2.16</li>
<li>Docker image python:3.12.3</li>
</ul>
<h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/reference_appendices/release_and_maintenance.html#ansible-core-target-node-python-support"><code>ansible-core</code> ç‰ˆæœ¬åŠ Python ç‰ˆæœ¬æ”¯æŒå¯¹åº”å…³ç³»</a></p>
<table>
<thead>
<tr>
<th>ansible-core Version</th>
<th>Control Node Python</th>
<th>Target Python &#x2F; PowerShell</th>
</tr>
</thead>
<tbody><tr>
<td>2.16</td>
<td>Python 3.10 - 3.12</td>
<td>Python 2.7<br/>Python 3.6 - 3.12<br/>Powershell 3 - 5.1</td>
</tr>
</tbody></table>
<p>ä¸ºäº†ç¯å¢ƒéƒ¨ç½²æ–¹ä¾¿çµæ´»ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ <code>python:3.12.3</code> çš„ Docker é•œåƒï¼Œä»¥å…¶ä¸ºåŸºç¡€ç¯å¢ƒå®‰è£… <code>ansible-core 2.16</code> æˆ–è€…ç›´æ¥ä½¿ç”¨ <code>ansible</code> é•œåƒå¯åŠ¨ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker run --<span class="built_in">rm</span> -it python:3.12.3 bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /etc/os-release</span> </span><br><span class="line">PRETTY_NAME=&quot;Debian GNU/Linux 12 (bookworm)&quot;</span><br><span class="line">NAME=&quot;Debian GNU/Linux&quot;</span><br><span class="line">VERSION_ID=&quot;12&quot;</span><br><span class="line">VERSION=&quot;12 (bookworm)&quot;</span><br><span class="line">VERSION_CODENAME=bookworm</span><br><span class="line">ID=debian</span><br><span class="line">HOME_URL=&quot;https://www.debian.org/&quot;</span><br><span class="line">SUPPORT_URL=&quot;https://www.debian.org/support&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.debian.org/&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">python --version</span></span><br><span class="line">Python 3.12.3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pip install ansible</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pip list</span></span><br><span class="line">Package      Version</span><br><span class="line">------------ -------</span><br><span class="line">ansible      9.5.1</span><br><span class="line">ansible-core 2.16.6</span><br><span class="line">cffi         1.16.0</span><br><span class="line">cryptography 42.0.7</span><br><span class="line">Jinja2       3.1.4</span><br><span class="line">MarkupSafe   2.1.5</span><br><span class="line">packaging    24.0</span><br><span class="line">pip          24.0</span><br><span class="line">pycparser    2.22</span><br><span class="line">PyYAML       6.0.1</span><br><span class="line">resolvelib   1.0.1</span><br><span class="line">setuptools   69.5.1</span><br><span class="line">wheel        0.43.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ansible --version</span></span><br><span class="line">ansible [core 2.16.6]</span><br><span class="line">  config file = None</span><br><span class="line">  configured module search path = [&#x27;/root/.ansible/plugins/modules&#x27;, &#x27;/usr/share/ansible/plugins/modules&#x27;]</span><br><span class="line">  ansible python module location = /usr/local/lib/python3.12/site-packages/ansible</span><br><span class="line">  ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections</span><br><span class="line">  executable location = /usr/local/bin/ansible</span><br><span class="line">  python version = 3.12.3 (main, May 14 2024, 07:23:41) [GCC 12.2.0] (/usr/local/bin/python)</span><br><span class="line">  jinja version = 3.1.4</span><br><span class="line">  libyaml = True</span><br></pre></td></tr></table></figure>

<h1 id="Ansible-é…ç½®è¯´æ˜"><a href="#Ansible-é…ç½®è¯´æ˜" class="headerlink" title="Ansible é…ç½®è¯´æ˜"></a>Ansible é…ç½®è¯´æ˜</h1><p>Ansible ä¸»é…ç½®æ–‡ä»¶ä¸º <code>/etc/ansible/ansible.cfg</code>ï¼Œ<em><strong>å…¶ä¸­çš„é…ç½®éƒ½å¯ä»¥è¢« <code>ansible-playbook</code> æˆ–è€…å‘½ä»¤è¡Œå‚æ•°è¦†ç›–</strong></em>ã€‚</p>
<blockquote>
<p>ansible é»˜è®¤ä¼šè¯»å–ç¯å¢ƒå˜é‡ <code>ANSIBLE_CONFIG</code> æŒ‡å®šçš„é…ç½®æ–‡ä»¶ï¼Œå½“å‰è·¯å¾„ä¸‹çš„ <code>ansible.cfg</code>ï¼Œä»¥åŠç”¨æˆ·å®¶ç›®å½•ä¸‹çš„ <code>.ansible.cfg</code>ï¼Œä»¥åŠ <code>/etc/ansible/ansible.cfg</code> ä½œä¸ºé…ç½®æ–‡ä»¶ï¼Œå·²ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„ä¸ºå‡†</p>
</blockquote>
<p>å¸¸ç”¨é…ç½®è¯´æ˜</p>
<table>
<thead>
<tr>
<th>é…ç½®é¡¹</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>inventory</code></td>
<td>æŒ‡å®š inventory ï¼ˆä¸»æœºåˆ—è¡¨ï¼‰æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º <code>/etc/ansible/hosts</code></td>
<td></td>
</tr>
<tr>
<td><code>remote_user</code></td>
<td>ï¼ˆæœªæŒ‡å®šç”¨æˆ·æ—¶ï¼‰è¿æ¥è¿œç¨‹ä¸»æœºæ—¶ä½¿ç”¨çš„ç”¨æˆ·</td>
<td></td>
</tr>
<tr>
<td><code>remote_port</code></td>
<td>è¿æ¥è¿œç¨‹ä¸»æœºæ—¶ä½¿ç”¨çš„(é»˜è®¤)ç«¯å£</td>
<td></td>
</tr>
<tr>
<td><code>host_key_checking</code></td>
<td>é»˜è®¤å¯ç”¨ã€‚æ£€æŸ¥ä¸»æœºå¯†é’¥å¯ä»¥é˜²æ­¢æœåŠ¡å™¨æ¬ºéª—å’Œä¸­é—´äººæ”»å‡»ã€‚<br/>å¦‚æœä¸»æœºé‡æ–°å®‰è£…å¹¶ä¸”åœ¨ <code>know_hosts</code> ä¸­æ‹¥æœ‰ä¸åŒçš„å¯†é’¥ï¼Œansible ä¼šæç¤ºç¡®è®¤å¯†é’¥ã€‚<br/>å¦‚æœè¦ç¦ç”¨æ­¤è¡Œä¸ºï¼Œå¯ä»¥é…ç½®ä¸º <code>False</code></td>
<td></td>
</tr>
<tr>
<td><code>ask_pass</code></td>
<td>é»˜è®¤ä¸º Falseã€‚å½“è®¾ç½®ä¸º True æ—¶ï¼Œansible è¦æ±‚è¾“å…¥è¿œç«¯æœåŠ¡å™¨çš„å¯†ç ï¼Œå³ä½¿é…ç½®äº†å…å¯†ç™»å½•</td>
<td></td>
</tr>
<tr>
<td><code>log_path</code></td>
<td>æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤ <code>/var/log/ansible.log </code></td>
<td></td>
</tr>
<tr>
<td><code>pattern</code></td>
<td>å½“æ²¡æœ‰ç»™å‡º <code>pattern</code> æ—¶çš„é»˜è®¤ <code>pattern</code>ï¼Œé»˜è®¤å€¼æ˜¯ <code>*</code> å³æ‰€æœ‰ä¸»æœº</td>
<td></td>
</tr>
</tbody></table>
<p>é…ç½®ç¤ºä¾‹</p>
<figure class="highlight shell"><figcaption><span>/etc/ansible/ansible.cfg</span></figcaption><table><tr><td class="code"><pre><span class="line">[defaults]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®é»˜è®¤çš„ inventory æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">inventory = /etc/ansible/hosts</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…³é—­ä¸»æœºå¯†é’¥æ£€æŸ¥ï¼Œæ–¹ä¾¿æ–°ä¸»æœºçš„å¿«é€Ÿæ·»åŠ </span></span><br><span class="line">host_key_checking = False</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®é»˜è®¤çš„è¿œç¨‹ç”¨æˆ·</span></span><br><span class="line">remote_user = ansible</span><br></pre></td></tr></table></figure>

<h1 id="Inventory-é…ç½®è¯´æ˜"><a href="#Inventory-é…ç½®è¯´æ˜" class="headerlink" title="Inventory é…ç½®è¯´æ˜"></a>Inventory é…ç½®è¯´æ˜</h1><p>é»˜è®¤çš„ inventory é…ç½®æ–‡ä»¶è·¯å¾„ä¸º <code>/etc/ansible/hosts</code>ï¼Œä¸»è¦ç”¨æ¥é…ç½® Managed Hosts åˆ—è¡¨ <sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[How to build your inventory](https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html#how-to-build-your-inventory)">[3]</span></a></sup></p>
<p>åœ¨å‘½ä»¤è¡Œä¸­ï¼Œå¯ä»¥ä½¿ç”¨é€‰é¡¹ <code>-i &lt;path&gt;</code> æŒ‡å®šä¸åŒçš„ <code>inventory</code> æˆ–è€…å¯ä»¥åœ¨ <code>ansible</code> é…ç½®æ–‡ä»¶ <code>ansible.cfg</code> ä¸­ä½¿ç”¨æŒ‡ä»¤ <code>inventory</code> æŒ‡å®š <code>inventory</code> æ–‡ä»¶ä½ç½®ã€‚ </p>
<blockquote>
<p>å‘½ä»¤è¡Œä¸­å¯ä»¥ä½¿ç”¨ <code>-i &lt;path1&gt; -i &lt;path2&gt; ...</code> æŒ‡å®šå¤šä¸ª <code>inventory</code>  </p>
</blockquote>
<p><code>inventory</code> æ–‡ä»¶æ”¯æŒå¤šç§æ ¼å¼ï¼Œæœ€å¸¸è§çš„æ˜¯ <code>INI</code> å’Œ <code>YAML</code> æ ¼å¼ã€‚</p>
<ul>
<li>Ansible é»˜è®¤åˆ›å»ºäº† 2 ä¸ªç»„ï¼š<ul>
<li><code>all</code> : åŒ…å«æ‰€æœ‰ä¸»æœº</li>
<li><code>ungrouped</code> : åŒ…å«æ‰€æœ‰ä¸åœ¨å…¶ä»–ç»„ï¼ˆ<code>all</code> é™¤å¤–ï¼‰ä¸­çš„æ‰€æœ‰ä¸»æœºã€‚<blockquote>
<p>ä»»ä½•ä¸€ä¸ªä¸»æœºéƒ½ä¼šè‡³å°‘åœ¨ 2 ä¸ªç»„ä¸­ï¼Œè¦ä¹ˆ <strong>åœ¨ <code>all</code> å’ŒæŸä¸ªç»„ä¸­</strong>ï¼Œè¦ä¹ˆ <strong>åœ¨ <code>all</code> å’Œ <code>ungrouped</code> ç»„</strong>ã€‚</p>
</blockquote>
</li>
</ul>
</li>
<li><strong>ä¸€ä¸ªä¸»æœºå¯ä»¥åŒ…å«åœ¨å¤šä¸ªç»„ä¸­</strong></li>
<li><strong><code>parent/child</code> ç»„</strong>ï¼Œ<code>child</code> ç»„è¢«åŒ…å«åœ¨ <code>parent</code> ç»„ä¸­ã€‚<ul>
<li>INI é…ç½®æ ¼å¼ä¸­ï¼Œä½¿ç”¨ <code>:children</code> åç¼€é…ç½® <code>parent</code></li>
<li>YAML é…ç½®æ ¼å¼ä¸­ï¼Œä½¿ç”¨ <code>children:</code> é…ç½® <code>parent</code><blockquote>
<ul>
<li>ä»»ä½•åœ¨ <code>child</code> ç»„ä¸­çš„ä¸»æœºè‡ªåŠ¨æˆä¸º <code>parent</code> ç»„ä¸­çš„ä¸€å‘˜</li>
<li>ä¸€ä¸ªç»„å¯ä»¥åŒ…æ‹¬å¤šä¸ª <code>parent</code> å’Œ <code>child</code> ç»„ï¼Œ<em><strong>ä½†æ˜¯ä¸èƒ½å½¢æˆå¾ªç¯å…³ç³»</strong></em></li>
<li>ä¸€ä¸ªä¸»æœºå¯ä»¥åœ¨å¤šä¸ªç»„ä¸­ï¼Œä½†æ˜¯åœ¨è¿è¡Œæ—¶ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ï¼ŒAnsible ä¼šè‡ªåŠ¨å°†å±äºå¤šä¸ªç»„çš„ä¸»æœºåˆå¹¶ã€‚</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li><strong>ä¸»æœºèŒƒå›´åŒ¹é…</strong>ã€‚å¦‚æœæœ‰æ ¼å¼ç›¸ä¼¼çš„ä¸»æœºï¼Œå¯ä»¥é€šè¿‡<strong>èŒƒå›´æ ¼å¼</strong>ä½¿ç”¨ä¸€æ¡æŒ‡ä»¤æ¥æ·»åŠ å¤šå°ä¸»æœºã€‚<ul>
<li>INI é…ç½®æ ¼å¼ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹æ ¼å¼  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[webservers]</span><br><span class="line">www[01:50].example.com</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># æŒ‡å®šæ­¥é•¿å¢é•¿</span></span></span><br><span class="line">www[01:50:2].example.com</span><br><span class="line">      </span><br><span class="line">db-[a:f].example.com</span><br></pre></td></tr></table></figure></li>
<li>YAML é…ç½®æ ¼å¼ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹æ ¼å¼  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">...</span></span><br><span class="line">  webservers:</span><br><span class="line">    hosts:</span><br><span class="line">      www[01:50].example.com:</span><br><span class="line">      </span><br><span class="line">      ## æŒ‡å®šæ­¥é•¿å¢é•¿</span><br><span class="line">      www[01:50:2].example.com:</span><br><span class="line">      db-[a:f].example.com:</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>èŒƒå›´æ ¼å¼</strong> çš„ç¬¬ä¸€é¡¹å’Œæœ€åä¸€é¡¹ä¹ŸåŒ…æ‹¬åœ¨å†…ã€‚å³åŒ¹é… <code>www01</code> å’Œ <code>www50</code></p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="Inventory-å¤šé…ç½®æ–‡ä»¶æ”¯æŒ"><a href="#Inventory-å¤šé…ç½®æ–‡ä»¶æ”¯æŒ" class="headerlink" title="Inventory å¤šé…ç½®æ–‡ä»¶æ”¯æŒ"></a>Inventory å¤šé…ç½®æ–‡ä»¶æ”¯æŒ</h2><p>åœ¨ä¸»æœºæ•°é‡è¾ƒå¤šï¼Œæˆ–è€…ç»„ç»‡ç»“æ„è¾ƒå¤æ‚çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å•ä¸ª Inventory é…ç½®æ–‡ä»¶ä¼šå¯¼è‡´ä¸»æœºç®¡ç†è¾ƒä¸ºå¤æ‚ã€‚å°†å•ä¸ª Inventory é…ç½®æ–‡ä»¶æŒ‰ç…§é¡¹ç›®æˆ–è€…ç»„ç»‡æˆ–å…¶ä»–è§„åˆ™è¿›è¡Œåˆ†å‰²ä¼šæ˜¾è‘—é™ä½ç»´æŠ¤å¤æ‚åº¦ã€‚</p>
<p>Inventory å¤šé…ç½®æ–‡ä»¶æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¹‹ä¸€</p>
<ul>
<li>æŒ‰ç…§é¡¹ç›®æˆ–è€…ç»„ç»‡æˆ–å…¶ä»–è§„åˆ™å°†ä¸»æœºåˆ†å‰²åˆ°å¤šä¸ªé…ç½®ä¸­ï¼Œå‘½ä»¤è¡Œä¸­å¯ä»¥ä½¿ç”¨ <code>-i &lt;path1&gt; -i &lt;path2&gt; ...</code> æŒ‡å®šå¤šä¸ª <code>inventory</code></li>
<li>æŒ‰ç…§é¡¹ç›®æˆ–è€…ç»„ç»‡æˆ–å…¶ä»–è§„åˆ™å°†ä¸»æœºåˆ†å‰²æ”¾ç½®åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶å°†æ‰€æœ‰æ–‡ä»¶ç»Ÿä¸€æ”¾ç½®åœ¨ä¸€ä¸ªå•ç‹¬çš„ç›®å½•ä¸­ï¼ˆå¦‚ <code>/etc/ansible/inventory/</code>ï¼‰ï¼Œåœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨é€‰é¡¹ <code>-i /etc/ansible/inventory/</code> æˆ–è€…åœ¨ Ansible é…ç½®æ–‡ä»¶(<code>ansible.cfg</code>)ä¸­ä½¿ç”¨æŒ‡ä»¤ <code>inventory</code> é…ç½®ç›®å½•ã€‚<blockquote>
<p><em><strong>æ³¨æ„äº‹é¡¹</strong></em>ï¼š Ansible ä½¿ç”¨å­—å…¸é¡ºåºåŠ è½½é…ç½®æ–‡ä»¶ï¼Œå¦‚æœåœ¨ä¸åŒçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®äº† <code>parent groups</code> å’Œ <code>child groups</code>ï¼Œé‚£ä¹ˆå®šä¹‰ <code>child groups</code> çš„é…ç½®è¦å…ˆç”¨å®šä¹‰ <code>parent groups</code> çš„æ–‡ä»¶åŠ è½½ï¼Œå¦åˆ™ Ansible åŠ è½½é…ç½®ä¼šæŠ¥é”™ï¼š <code>Unable to parse /path/to/source_of_parent_groups as an inventory source</code> <sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Managing inventory load order](https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html#managing-inventory-load-order)">[4]</span></a></sup> </p>
</blockquote>
</li>
<li>ä½¿ç”¨ <code>group_vars</code> å’Œ <code>host_vars</code> ç›®å½•åˆ†åˆ«å­˜å‚¨ç»„å˜é‡å’Œä¸»æœºå˜é‡ <sup id="fnref:7"><a href="#fn:7" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Organizing host and group variables](https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html#organizing-host-and-group-variables)">[7]</span></a></sup><blockquote>
<p><em><strong>æ³¨æ„äº‹é¡¹</strong></em>ï¼š ç»„å˜é‡å’Œä¸»æœºå˜é‡å¿…é¡»ä½¿ç”¨ YAML æ ¼å¼ï¼Œåˆæ³•çš„æ–‡ä»¶æ‰©å±•ååŒ…æ‹¬ï¼š <code>.yaml</code>ã€<code>yml</code>ã€<code>.json</code> æˆ–è€…æ— æ–‡ä»¶æ‰©å±•å</p>
</blockquote>
</li>
</ul>
<h2 id="INI-æ ¼å¼çš„-Inventory"><a href="#INI-æ ¼å¼çš„-Inventory" class="headerlink" title="INI æ ¼å¼çš„ Inventory"></a>INI æ ¼å¼çš„ Inventory</h2><p>ä¸»æœºåˆ—è¡¨ä¸­çš„ä¸»æœºå¯ä»¥å•ç‹¬å‡ºç°ï¼Œä¹Ÿå¯ä»¥ä½äºæŸä¸ªæˆ–è€…å¤šä¸ª <strong>ç»„(<code>[]</code> å¼€å¤´çš„è¡Œ)ä¸­</strong></p>
<figure class="highlight shell"><figcaption><span>/etc/ansible/hosts</span></figcaption><table><tr><td class="code"><pre><span class="line">ansible-demo1.local</span><br><span class="line">ansible-demo2.local</span><br><span class="line"></span><br><span class="line">[webserver]</span><br><span class="line">webserver1.local</span><br><span class="line">webserver2.local</span><br><span class="line"></span><br><span class="line">[nginxserver]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŒ¹é…å¤šä¸ªä¸»æœºï¼šnginx1.localï¼Œ nginx2.localï¼Œ nginx3.localï¼Œ nginx4.local</span></span><br><span class="line">nginx[1:4].local variable1=value1 variable2=value2</span><br><span class="line">nginx-bak.local ansible_ssh_host=10.10.0.1 ansible_ssh_port=22 ansible_ssh_user=root ansible_ssh_pass=PASSWORD</span><br><span class="line">127.0.0.1 http_port=80 maxRequestPerChild=808</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>è¿æ¥ä¸»æœºä½¿ç”¨çš„å¸¸ç”¨é…ç½®è¯´æ˜ <sup id="fnref:6"><a href="#fn:6" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Connecting to hosts: behavioral inventory parameters](https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html#connecting-to-hosts-behavioral-inventory-parameters)">[6]</span></a></sup></p>
<table>
<thead>
<tr>
<th>é…ç½®é¡¹</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>ansible_host</code></td>
<td>è¿œç¨‹ä¸»æœºåœ°å€</td>
<td></td>
</tr>
<tr>
<td><code>ansible_port</code></td>
<td>è¿œç¨‹ä¸»æœºç«¯å£</td>
<td></td>
</tr>
<tr>
<td><code>ansible_user</code></td>
<td>è¿æ¥è¿œç¨‹ä¸»æœºçš„ ssh ç”¨æˆ·<br/>Ansible é»˜è®¤ä½¿ç”¨ control node ä¸Šæ‰§è¡Œ <code>ansible</code> çš„ç”¨æˆ·åæ¥è¿æ¥è¿œç¨‹ä¸»æœº <sup id="fnref:9"><a href="#fn:9" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Setting a remote user](https://docs.ansible.com/ansible/latest/inventory_guide/connection_details.html#setting-a-remote-user)">[9]</span></a></sup></td>
<td></td>
</tr>
<tr>
<td><code>ansible_password</code></td>
<td>è¿æ¥è¿œç¨‹ä¸»æœºçš„ ssh ç”¨æˆ·å¯†ç ï¼Œå»ºè®®ä½¿ç”¨ key è¿æ¥</td>
<td></td>
</tr>
<tr>
<td><code>ansible_ssh_private_key_file</code></td>
<td>è¿æ¥è¿œç¨‹ä¸»æœºçš„ ssh ç§é’¥æ–‡ä»¶è·¯å¾„</td>
<td></td>
</tr>
<tr>
<td><code>ansible_become</code> <br/> <code>ansible_sudo</code>   <br/> <code>ansible_su</code></td>
<td>ç”¨æˆ·æƒé™æå‡</td>
<td></td>
</tr>
<tr>
<td><code>ansible_become_method</code></td>
<td>ç”¨æˆ·æƒé™æå‡(escalation)çš„æ–¹å¼</td>
<td></td>
</tr>
<tr>
<td><code>ansible_become_user</code> <br/> <code>ansible_sudo_user</code>     <br/> <code>ansible_su_user</code></td>
<td>ç”¨æˆ·æƒé™æå‡(escalation)åçš„ç”¨æˆ·</td>
<td></td>
</tr>
<tr>
<td><code>ansible_become_password</code> <br/> <code>ansible_sudo_password</code> <br/> <code>ansible_su_password</code></td>
<td><code>sudo</code> å¯†ç (è¿™ç§æ–¹å¼å¹¶ä¸å®‰å…¨,å¼ºçƒˆå»ºè®®ä½¿ç”¨ <code>--ask-sudo-pass</code>)</td>
<td></td>
</tr>
<tr>
<td><code>ansible_become_exe</code><br/> <code>ansible_sudo_exe</code> <br/> <code>ansible_su_exe</code> <br/></td>
<td>è®¾ç½®ç”¨æˆ·æƒé™æå‡(escalation)åçš„å¯æ‰§è¡Œæ–‡ä»¶</td>
<td></td>
</tr>
<tr>
<td><code>ansible_connection</code></td>
<td>ä¸ä¸»æœºçš„è¿æ¥ç±»å‹.æ¯”å¦‚:<code>local</code>, <code>ssh</code> æˆ–è€… <code>paramiko</code><br/>Ansible 1.2 ä»¥å‰é»˜è®¤ä½¿ç”¨ <code>paramiko</code>ã€‚1.2 ä»¥åé»˜è®¤ä½¿ç”¨ <code>smart</code>,<code>smart</code> æ–¹å¼ä¼šæ ¹æ®æ˜¯å¦æ”¯æŒ <code>ControlPersist</code>, æ¥åˆ¤æ–­ <code>ssh</code> æ–¹å¼æ˜¯å¦å¯è¡Œ.</td>
<td></td>
</tr>
<tr>
<td><code>ansible_shell_type</code></td>
<td>ç›®æ ‡ç³»ç»Ÿçš„ shell ç±»å‹.é»˜è®¤æƒ…å†µä¸‹,å‘½ä»¤çš„æ‰§è¡Œä½¿ç”¨ <code>sh</code> è¯­æ³•,å¯è®¾ç½®ä¸º <code>csh</code> æˆ– <code>fish</code>.</td>
<td></td>
</tr>
<tr>
<td><code>ansible_python_interpreter</code></td>
<td>ç›®æ ‡ä¸»æœºçš„ python è·¯å¾„<br/>ç³»ç»Ÿä¸­æœ‰å¤šä¸ª Python, æˆ–è€…å‘½ä»¤è·¯å¾„ä¸æ˜¯ <code>/usr/bin/python</code></td>
<td></td>
</tr>
</tbody></table>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202308311109/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202212011355/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202212011355/" class="post-title-link" itemprop="url">containerd ä½¿ç”¨æ–¹æ³•</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-12-01 13:55:17" itemprop="dateCreated datePublished" datetime="2022-12-01T13:55:17+08:00">2022-12-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-03-03 10:03:00" itemprop="dateModified" datetime="2025-03-03T10:03:00+08:00">2025-03-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h1><ul>
<li>Centos 7</li>
<li>containerd.io-1.4.13-3</li>
</ul>
<h1 id="containerd-ç›¸å…³é…ç½®"><a href="#containerd-ç›¸å…³é…ç½®" class="headerlink" title="containerd ç›¸å…³é…ç½®"></a>containerd ç›¸å…³é…ç½®</h1><h2 id="é»˜è®¤é…ç½®æ–‡ä»¶"><a href="#é»˜è®¤é…ç½®æ–‡ä»¶" class="headerlink" title="é»˜è®¤é…ç½®æ–‡ä»¶"></a>é»˜è®¤é…ç½®æ–‡ä»¶</h2><p><code>containerd</code> æœåŠ¡é»˜è®¤é…ç½®æ–‡ä»¶ä¸º <code>/etc/containerd/config.toml</code></p>
<figure class="highlight shell"><figcaption><span>/etc/containerd/config.toml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">root = <span class="string">&quot;/var/lib/containerd&quot;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">state = <span class="string">&quot;/run/containerd&quot;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">subreaper = <span class="literal">true</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">oom_score = 0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Containerd æœ‰ä¸¤ä¸ªä¸åŒçš„å­˜å‚¨è·¯å¾„ï¼Œä¸€ä¸ªç”¨æ¥ä¿å­˜æŒä¹…åŒ–æ•°æ®ï¼Œä¸€ä¸ªç”¨æ¥ä¿å­˜è¿è¡Œæ—¶çŠ¶æ€ã€‚ <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Containerd çš„å‰ä¸–ä»Šç”Ÿå’Œä¿å§†çº§å…¥é—¨æ•™ç¨‹](https://blog.51cto.com/u_15127639/3256557)">[1]</span></a></sup></p>
<figure class="highlight shell"><figcaption><span>/etc/containerd/config.toml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">root = <span class="string">&quot;/var/lib/containerd&quot;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">state = <span class="string">&quot;/run/containerd&quot;</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>root</code> - ç”¨æ¥ä¿å­˜æŒä¹…åŒ–æ•°æ®ï¼ŒåŒ…æ‹¬ Snapshots, Content, Metadata ä»¥åŠå„ç§æ’ä»¶çš„æ•°æ®ã€‚æ¯ä¸€ä¸ªæ’ä»¶éƒ½æœ‰è‡ªå·±å•ç‹¬çš„ç›®å½•ï¼ŒContainerd æœ¬èº«ä¸å­˜å‚¨ä»»ä½•æ•°æ®ï¼Œå®ƒçš„æ‰€æœ‰åŠŸèƒ½éƒ½æ¥è‡ªäºå·²åŠ è½½çš„æ’ä»¶ã€‚</li>
<li><code>state</code> - ç”¨æ¥ä¿å­˜ä¸´æ—¶æ•°æ®ï¼ŒåŒ…æ‹¬ <code>sockets</code>ã€<code>pid</code>ã€<code>æŒ‚è½½ç‚¹</code>ã€<code>è¿è¡Œæ—¶çŠ¶æ€</code> ä»¥åŠä¸éœ€è¦æŒä¹…åŒ–ä¿å­˜çš„æ’ä»¶æ•°æ®ã€‚</li>
</ul>
<figure class="highlight shell"><figcaption><span>/etc/containerd/config.toml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">oom_score = 0</span></span><br></pre></td></tr></table></figure>
<p>Containerd æ˜¯å®¹å™¨çš„å®ˆæŠ¤è€…ï¼Œä¸€æ—¦å‘ç”Ÿå†…å­˜ä¸è¶³çš„æƒ…å†µï¼Œç†æƒ³çš„æƒ…å†µåº”è¯¥æ˜¯å…ˆæ€æ­»å®¹å™¨ï¼Œè€Œä¸æ˜¯æ€æ­» Containerdã€‚æ‰€ä»¥éœ€è¦è°ƒæ•´ Containerd çš„ OOM æƒé‡ï¼Œå‡å°‘å…¶è¢« OOM Kill çš„å‡ ç‡ã€‚<code>oom_score</code> å…¶å–å€¼èŒƒå›´ä¸º <code>-1000</code> åˆ° <code>1000</code>ï¼Œå¦‚æœå°†è¯¥å€¼è®¾ç½®ä¸º <code>-1000</code>ï¼Œåˆ™è¿›ç¨‹æ°¸è¿œä¸ä¼šè¢«æ€æ­»ï¼Œå»ºè®® Containerd å°†è¯¥å€¼è®¾ç½®ä¸º <code>-999</code> åˆ° <code>0</code> ä¹‹é—´ã€‚å¦‚æœä½œä¸º Kubernetes çš„ Worker èŠ‚ç‚¹ï¼Œå¯ä»¥è€ƒè™‘è®¾ç½®ä¸º <code>-999</code>ã€‚</p>
<h2 id="containerd-æœåŠ¡é…ç½®æ–‡ä»¶"><a href="#containerd-æœåŠ¡é…ç½®æ–‡ä»¶" class="headerlink" title="containerd æœåŠ¡é…ç½®æ–‡ä»¶"></a>containerd æœåŠ¡é…ç½®æ–‡ä»¶</h2><p>é»˜è®¤çš„ <code>containerd</code> æœåŠ¡çš„é…ç½®ä¸º <code>/usr/lib/systemd/system/containerd.service</code></p>
<figure class="highlight shell"><figcaption><span>/usr/lib/systemd/system/containerd.service</span></figcaption><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=containerd container runtime</span><br><span class="line">Documentation=https://containerd.io</span><br><span class="line">After=network.target local-fs.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStartPre=-/sbin/modprobe overlay</span><br><span class="line">ExecStart=/usr/bin/containerd</span><br><span class="line"></span><br><span class="line">Type=notify</span><br><span class="line">Delegate=yes</span><br><span class="line">KillMode=process</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=5</span><br><span class="line"></span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">LimitNOFILE=1048576</span><br><span class="line"></span><br><span class="line">TasksMax=infinity</span><br><span class="line">OOMScoreAdjust=-999</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong><code>Delegate</code></strong> - è¿™ä¸ªé€‰é¡¹å…è®¸ Containerd ä»¥åŠè¿è¡Œæ—¶è‡ªå·±ç®¡ç†è‡ªå·±åˆ›å»ºçš„å®¹å™¨çš„ cgroupsã€‚å¦‚æœä¸è®¾ç½®è¿™ä¸ªé€‰é¡¹ï¼Œ<code>systemd</code> å°±ä¼šå°†è¿›ç¨‹ç§»åˆ°è‡ªå·±çš„ cgroups ä¸­ï¼Œä»è€Œå¯¼è‡´ Containerd æ— æ³•æ­£ç¡®è·å–å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µã€‚</p>
</li>
<li><p><strong><code>KillMode</code></strong> - è¿™ä¸ªé€‰é¡¹ç”¨æ¥å¤„ç† Containerd è¿›ç¨‹è¢«æ€æ­»çš„æ–¹å¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>systemd</code> ä¼šåœ¨è¿›ç¨‹çš„ cgroup ä¸­æŸ¥æ‰¾å¹¶æ€æ­» Containerd çš„æ‰€æœ‰å­è¿›ç¨‹ï¼Œè¿™è‚¯å®šä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚<code>KillMode</code> å­—æ®µå¯ä»¥è®¾ç½®çš„å€¼å¦‚ä¸‹:</p>
<ul>
<li><strong><code>control-group</code></strong> -ï¼ˆé»˜è®¤å€¼ï¼‰å½“å‰æ§åˆ¶ç»„é‡Œé¢çš„æ‰€æœ‰å­è¿›ç¨‹ï¼Œéƒ½ä¼šè¢«æ€æ‰</li>
<li><strong><code>process</code></strong> - åªæ€ä¸»è¿›ç¨‹ã€‚</li>
<li><strong><code>mixed</code></strong> - ä¸»è¿›ç¨‹å°†æ”¶åˆ° <code>SIGTERM</code> ä¿¡å·ï¼Œå­è¿›ç¨‹æ”¶åˆ° <code>SIGKILL</code> ä¿¡å·</li>
<li><strong><code>none</code></strong> - æ²¡æœ‰è¿›ç¨‹ä¼šè¢«æ€æ‰ï¼Œåªæ˜¯æ‰§è¡ŒæœåŠ¡çš„ stop å‘½ä»¤ã€‚</li>
</ul>
<p>  éœ€è¦å°† <code>KillMode</code> çš„å€¼è®¾ç½®ä¸º<code> process</code>ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿å‡çº§æˆ–é‡å¯ Containerd æ—¶ä¸æ€æ­»ç°æœ‰çš„å®¹å™¨ã€‚</p>
</li>
</ul>
<h2 id="Containerd-å¸¸ç”¨é…ç½®"><a href="#Containerd-å¸¸ç”¨é…ç½®" class="headerlink" title="Containerd å¸¸ç”¨é…ç½®"></a>Containerd å¸¸ç”¨é…ç½®</h2><p>Containerd é»˜è®¤é…ç½®æ–‡ä»¶ä¸º <code>/etc/containerd/config.toml</code>ï¼Œæœªåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„åˆ™ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œä¸ºäº†æ–¹ä¾¿ä¿®æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†é»˜è®¤é…ç½®å†™å…¥é…ç½®æ–‡ä»¶ä¸­</p>
<figure class="highlight shell"><figcaption><span>/etc/containerd/config.toml</span></figcaption><table><tr><td class="code"><pre><span class="line">containerd config default | sudo tee /etc/containerd/config.toml</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨ä½œä¸º Kubernetes çš„ CRI æ—¶ï¼Œéœ€è¦ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š</p>
<ul>
<li><strong>å¯ç”¨ CRI åŠŸèƒ½</strong> ã€‚Containerd é»˜è®¤ç¦ç”¨äº† CRI åŠŸèƒ½ï¼ˆ<code>disabled_plugins = [&#39;cri&#39;]</code>ï¼‰ï¼Œè¦å¯ç”¨ <code>cri</code> ï¼Œå°†å…¶æ³¨é‡Šæˆ–åˆ é™¤</li>
<li><strong>é…ç½® <code>cgroup v2</code>ï¼Œ</strong> Kubernetes çš„å¾ˆå¤šåŠŸèƒ½éœ€è¦ <code>cgroup v2</code> æ”¯æŒï¼ŒKubernetes èŠ‚ç‚¹é€šå¸¸ä½¿ç”¨ <code>cgroup v2</code>ï¼Œè¦é…ç½® <code>containerd</code> ä½¿ç”¨ <code>cgroup v2</code>ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶çš„ <code>plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options</code> éƒ¨åˆ†ï¼Œå°† <code>SystemdCgroup</code> é…ç½®ä¸º <code>true</code> åé‡å¯ <code>containerd</code> æœåŠ¡<figure class="highlight shell"><figcaption><span>/etc/containerd/config.toml</span></figcaption><table><tr><td class="code"><pre><span class="line">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]</span><br><span class="line">  BinaryName = &quot;&quot;</span><br><span class="line">  CriuImagePath = &quot;&quot;</span><br><span class="line">  CriuPath = &quot;&quot;</span><br><span class="line">  CriuWorkPath = &quot;&quot;</span><br><span class="line">  IoGid = 0</span><br><span class="line">  IoUid = 0</span><br><span class="line">  NoNewKeyring = false</span><br><span class="line">  NoPivotRoot = false</span><br><span class="line">  Root = &quot;&quot;</span><br><span class="line">  ShimCgroup = &quot;&quot;</span><br><span class="line">  SystemdCgroup = true</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="å®¢æˆ·ç«¯å·¥å…·-ctr-ä½¿ç”¨"><a href="#å®¢æˆ·ç«¯å·¥å…·-ctr-ä½¿ç”¨" class="headerlink" title="å®¢æˆ·ç«¯å·¥å…· ctr ä½¿ç”¨"></a>å®¢æˆ·ç«¯å·¥å…· ctr ä½¿ç”¨</h1><h2 id="ctr-ç®¡ç†é•œåƒ"><a href="#ctr-ç®¡ç†é•œåƒ" class="headerlink" title="ctr ç®¡ç†é•œåƒ"></a>ctr ç®¡ç†é•œåƒ</h2><h3 id="é•œåƒä¸‹è½½"><a href="#é•œåƒä¸‹è½½" class="headerlink" title="é•œåƒä¸‹è½½"></a>é•œåƒä¸‹è½½</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ctr image pull docker.io/library/nginx:alpine</span><br></pre></td></tr></table></figure>

<h3 id="åˆ—å‡ºæœ¬åœ°é•œåƒ"><a href="#åˆ—å‡ºæœ¬åœ°é•œåƒ" class="headerlink" title="åˆ—å‡ºæœ¬åœ°é•œåƒ"></a>åˆ—å‡ºæœ¬åœ°é•œåƒ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ctr image <span class="built_in">ls</span></span></span><br><span class="line">REF                            TYPE                                                      DIGEST                                                                  SIZE    PLATFORMS                                                                                LABELS </span><br><span class="line">docker.io/library/nginx:alpine application/vnd.docker.distribution.manifest.list.v2+json sha256:455c39afebd4d98ef26dd70284aa86e6810b0485af5f4f222b19b89758cabf1e 9.8 MiB linux/386,linux/amd64,linux/arm/v6,linux/arm/v7,linux/arm64/v8,linux/ppc64le,linux/s390x -</span><br></pre></td></tr></table></figure>
<h3 id="å°†é•œåƒæŒ‚è½½åˆ°æœ¬åœ°ç›®å½•"><a href="#å°†é•œåƒæŒ‚è½½åˆ°æœ¬åœ°ç›®å½•" class="headerlink" title="å°†é•œåƒæŒ‚è½½åˆ°æœ¬åœ°ç›®å½•"></a>å°†é•œåƒæŒ‚è½½åˆ°æœ¬åœ°ç›®å½•</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ctr image mount docker.io/library/nginx:alpine /mnt</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> /mnt</span></span><br><span class="line">bin  docker-entrypoint.d   etc   lib    mnt  proc  run   srv  tmp  var</span><br><span class="line">dev  docker-entrypoint.sh  home  media  opt  root  sbin  sys  usr</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¸è½½å·²æŒ‚è½½çš„é•œåƒ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ctr image unmount /mnt</span><br></pre></td></tr></table></figure>

<h2 id="ctr-ç®¡ç†-å®¹å™¨"><a href="#ctr-ç®¡ç†-å®¹å™¨" class="headerlink" title="ctr ç®¡ç† å®¹å™¨"></a>ctr ç®¡ç† å®¹å™¨</h2><h3 id="åˆ›å»ºå®¹å™¨"><a href="#åˆ›å»ºå®¹å™¨" class="headerlink" title="åˆ›å»ºå®¹å™¨"></a>åˆ›å»ºå®¹å™¨</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ctr container create docker.io/library/nginx:alpine nginx</span><br></pre></td></tr></table></figure>
<p>å®¹å™¨åˆ›å»ºåï¼Œå¹¶æ²¡æœ‰å¼€å§‹è¿è¡Œï¼Œåªæ˜¯åˆ†é…äº†å®¹å™¨è¿è¡Œæ‰€éœ€çš„èµ„æºåŠé…ç½®çš„æ•°æ®ç»“æ„ï¼Œè¿™æ„å‘³ç€ <code>namespaces</code>ã€<code>rootfs</code> å’Œå®¹å™¨çš„é…ç½®éƒ½å·²ç»åˆå§‹åŒ–æˆåŠŸäº†ï¼Œåªæ˜¯ç”¨æˆ·è¿›ç¨‹(è¿™é‡Œæ˜¯ <code>nginx</code>)è¿˜æ²¡æœ‰å¯åŠ¨ï¼Œå®¹å™¨ï¼ˆè¿›ç¨‹ï¼‰çŠ¶æ€çš„å˜åŒ–ç”± <code>Task</code> å¯¹è±¡å®ç°ï¼Œé€šè¿‡å‘½ä»¤ <code>ctr task</code> æ¥ç®¡ç†ã€‚</p>
<p>å¯åŠ¨ <code>ctr container create</code> åˆ›å»ºçš„å®¹å™¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ctr task start nginx</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå‘½ä»¤å¯åŠ¨ä¹‹å‰åˆ›å»ºçš„å®¹å™¨ <code>nginx</code>ï¼ŒæœªæŒ‡å®šå…¶ä»–å‚æ•°æ—¶ï¼Œå®¹å™¨ä¸­çš„è¿›ç¨‹åœ¨ç³»ç»Ÿå‰å°è¿è¡Œï¼Œå¦‚éœ€åå°è¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨é€‰é¡¹ <code>-d</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ctr task start nginx -d</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>run</code> å‘½ä»¤ï¼Œåˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ctr run --rm -d docker.io/library/nginx:alpine nginx1</span><br></pre></td></tr></table></figure>

<h3 id="åˆ—å‡ºå®¹å™¨"><a href="#åˆ—å‡ºå®¹å™¨" class="headerlink" title="åˆ—å‡ºå®¹å™¨"></a>åˆ—å‡ºå®¹å™¨</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ctr container ls</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å®¹å™¨ä¸­è¿›ç¨‹çš„çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ctr task <span class="built_in">ls</span></span></span><br><span class="line">TASK      PID     STATUS    </span><br><span class="line">nginx1    5495    RUNNING</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹å®¹å™¨ä¸­è¿è¡Œçš„æ‰€æœ‰çš„è¿›ç¨‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ctr task ps nginx1</span></span><br><span class="line">PID     INFO</span><br><span class="line">5495    -</span><br><span class="line">5531    -</span><br><span class="line">5532    -</span><br><span class="line">5533    -</span><br><span class="line">5534    -</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>è¿™é‡Œçš„ PID æ˜¯å®¿ä¸»æœºçœ‹åˆ°çš„ PIDï¼Œä¸æ˜¯å®¹å™¨ä¸­çœ‹åˆ°çš„ PIDã€‚</strong></p>
<h3 id="æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯"><a href="#æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯"></a>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ctr container info nginx</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤å®¹å™¨"><a href="#åˆ é™¤å®¹å™¨" class="headerlink" title="åˆ é™¤å®¹å™¨"></a>åˆ é™¤å®¹å™¨</h3><p>åœæ­¢&#x2F;åˆ é™¤å®¹å™¨ä¸­çš„è¿›ç¨‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ctr task delete nginx -f</span><br><span class="line"></span><br><span class="line">ctr task pause nginx</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå‘½ä»¤<strong>åˆ é™¤&#x2F;åœæ­¢å®¹å™¨ä¸­çš„è¿›ç¨‹ï¼Œä½†æ˜¯å¹¶ä¸åˆ é™¤å®¹å™¨</strong>ï¼Œæ‰§è¡Œä»¥ä¸Šå‘½ä»¤åå†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯åˆ é™¤å®¹å™¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ctr container delete nginx</span><br></pre></td></tr></table></figure>
<p><strong>ctr æ²¡æœ‰ stop å®¹å™¨çš„åŠŸèƒ½ï¼Œåªèƒ½æš‚åœæˆ–è€…æ€æ­»å®¹å™¨ã€‚</strong></p>
<h3 id="è¿›å…¥å®¹å™¨"><a href="#è¿›å…¥å®¹å™¨" class="headerlink" title="è¿›å…¥å®¹å™¨"></a>è¿›å…¥å®¹å™¨</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ctr task exec -t --exec-id 1 nginx1 sh</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œ <code>ctr task exec</code> è¿›å…¥å®¹å™¨ï¼Œå¿…é¡»åˆ¶å®š <code>--exec-id</code>ï¼Œå€¼å¯ä»¥éšä¾¿æŒ‡å®šã€‚</p>
<h3 id="namespace-ç®¡ç†"><a href="#namespace-ç®¡ç†" class="headerlink" title="namespace ç®¡ç†"></a>namespace ç®¡ç†</h3><p>Containerd ç›¸æ¯”äº Docker ï¼Œå¤šäº† Namespace çš„æ¦‚å¿µï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹æ‰€æœ‰çš„ Namespace</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ctr ns <span class="built_in">ls</span></span></span><br><span class="line">NAME    LABELS </span><br><span class="line">default        </span><br><span class="line">moby     </span><br></pre></td></tr></table></figure>
<p><code>docker</code> é»˜è®¤ä½¿ç”¨ <code>moby</code> çš„ Namespaceï¼Œè¦ä½¿ç”¨ <code>ctr</code> å‘½ä»¤æŸ¥çœ‹ <code>docker</code> åˆ›å»ºçš„å®¹å™¨ï¼Œéœ€è¦ä½¿ç”¨é€‰é¡¹ <code>-n moby</code> æŒ‡å®šå‘½åç©ºé—´ï¼Œå¦åˆ™ <code>ctr</code> é»˜è®¤ä½¿ç”¨ <code>default</code> å‘½åç©ºé—´ï¼Œæ— æ³•çœ‹åˆ° <code>moby</code> å‘½åç©ºé—´ä¸­çš„èµ„æº</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ctr -n moby container ls</span><br><span class="line">CONTAINER                                                           IMAGE    RUNTIME                           </span><br><span class="line">17b16c3699cdb88a1ff80d8a7c84724eff393c42186775b58418c90bd178600f    -        io.containerd.runtime.v1.linux    </span><br><span class="line">27fc19226baa91251d63a375a7b1309122334cfb5ceb39aeb67ab1701b708464    -        io.containerd.runtime.v1.linux</span><br></pre></td></tr></table></figure>

<p><em><strong>Kubernetes é»˜è®¤ä½¿ç”¨ <code>k8s.io</code> å‘½åç©ºé—´</strong></em>ã€‚</p>
<p><code>ctr</code> æ²¡æœ‰é…ç½®æˆ–è€…ç¯å¢ƒå˜é‡å¯ä»¥æ¥é…ç½®é»˜è®¤çš„ Namespaceï¼Œåœ¨ Kubernetes åœºæ™¯ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>alias</code> å‘½ä»¤é…ç½® <code>ctr</code>ï¼Œä½¿å…¶è‡ªåŠ¨æŒ‡å‘ <code>k8s.io</code> çš„ Namespace</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">alias ctr=&#x27;ctr -n k8s.io&#x27;</span><br></pre></td></tr></table></figure>

<h1 id="nerdctl"><a href="#nerdctl" class="headerlink" title="nerdctl"></a>nerdctl</h1><p><code>nerdctl</code> æ˜¯ä¸º Containerd å¼€å‘çš„å®Œå…¨å…¼å®¹ Docker å‘½ä»¤è¡Œçš„å·¥å…·ï¼Œå®ƒå¯ä»¥ä½¿ç”¨å’Œ <code>docker</code> å‘½ä»¤ä¸€æ ·çš„è¯­æ³•æ¥æ“ä½œ <code>containerd</code> ä¸­çš„å®¹å™¨ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/containerd/nerdctl?tab=readme-ov-file"><code>nerdctl</code> å®˜æ–¹è¯´æ˜æ–‡æ¡£</a></p>
<p>å¦‚æœè¦ä½¿ç”¨ <code>nerdctl</code> è°ƒè¯• Kubernetes ç¯å¢ƒä¸­çš„å®¹å™¨ï¼Œéœ€è¦æŒ‡å®š Namespaceï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nerdctl --namespace k8s.io ps -a</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯åœ¨ Kubernetes ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œä¸ºæ–¹ä¾¿èµ·è§ï¼Œå¯ä»¥æ·»åŠ ç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">alias</span> nerdctl=<span class="string">&#x27;nerdctl --namespace k8s.io&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nerdctl ps</span></span><br><span class="line">CONTAINER ID    IMAGE                                              COMMAND                   CREATED       STATUS    PORTS    NAMES</span><br><span class="line">4de4c59a8913    registry.k8s.io/kube-controller-manager:v1.32.0    &quot;kube-controller-manâ€¦&quot;    2 days ago    Up                 k8s://kube-system/kube-controller-manager-k8s-master/kube-controller-manager</span><br><span class="line">6a9f17dffdb5    registry.k8s.io/pause:3.6                          &quot;/pause&quot;                  2 days ago    Up                 k8s://kube-system/kube-controller-manager-k8s-master</span><br><span class="line">3ae8ed830b63    registry.k8s.io/kube-scheduler:v1.32.0             &quot;kube-scheduler --auâ€¦&quot;    2 days ago    Up                 k8s://kube-system/kube-scheduler-k8s-master/kube-scheduler</span><br><span class="line">0cb15e8f5ac7    registry.k8s.io/pause:3.6                          &quot;/pause&quot;                  2 days ago    Up                 k8s://kube-system/kube-scheduler-k8s-master</span><br><span class="line">60ea2cfc01c8    registry.k8s.io/pause:3.6                          &quot;/pause&quot;                  2 days ago    Up                 k8s://kube-system/kube-apiserver-k8s-master</span><br><span class="line">eaf781314f4a    registry.k8s.io/pause:3.6                          &quot;/pause&quot;                  2 days ago    Up                 k8s://kube-system/etcd-k8s-master</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="è„šæ³¨"><a href="#è„šæ³¨" class="headerlink" title="è„šæ³¨"></a>è„šæ³¨</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15127639/3256557">Containerd çš„å‰ä¸–ä»Šç”Ÿå’Œä¿å§†çº§å…¥é—¨æ•™ç¨‹</a><a href="#fnref:1" rev="footnote"> â†©</a></span></li></ol></div></div>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20240904170014/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20240904170014/" class="post-title-link" itemprop="url">Linux nftables é˜²ç«å¢™</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-09-04 17:09:00" itemprop="dateCreated datePublished" datetime="2024-09-04T17:09:00+08:00">2024-09-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-02-28 17:02:00" itemprop="dateModified" datetime="2025-02-28T17:02:00+08:00">2025-02-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">å¸¸ç”¨æœåŠ¡</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>nftables</code> æ˜¯ä¸€ä¸ª <code>netfilter</code> é¡¹ç›®ï¼Œæ—¨åœ¨æ›¿æ¢ç°æœ‰çš„ <code>&#123;ip,ip6,arp,eb&#125;tables</code> æ¡†æ¶ï¼Œä¸º <code>&#123;ip,ip6&#125;tables</code> æä¾›ä¸€ä¸ªæ–°çš„åŒ…è¿‡æ»¤æ¡†æ¶ã€ä¸€ä¸ªæ–°çš„ç”¨æˆ·ç©ºé—´å®ç”¨ç¨‹åºï¼ˆ<code>nft</code>ï¼‰å’Œä¸€ä¸ªå…¼å®¹å±‚(<code>iptables-nft</code>)ã€‚å®ƒä½¿ç”¨ç°æœ‰çš„é’©å­ã€é“¾æ¥è·Ÿè¸ªç³»ç»Ÿã€ç”¨æˆ·ç©ºé—´æ’é˜Ÿç»„ä»¶å’Œ <code>netfilter</code> æ—¥å¿—å­ç³»ç»Ÿã€‚</p>
<blockquote>
<p><em>åœ¨ Linux å†…æ ¸ç‰ˆæœ¬é«˜äº 3.13 æ—¶å¯ç”¨</em></p>
</blockquote>
<p>å®ƒç”±ä¸‰ä¸ªä¸»è¦ç»„ä»¶ç»„æˆï¼š</p>
<ul>
<li>å†…æ ¸å®ç°: å†…æ ¸æä¾›äº†ä¸€ä¸ª <code>netlink</code> é…ç½®æ¥å£ä»¥åŠè¿è¡Œæ—¶è§„åˆ™é›†è¯„ä¼°</li>
<li><code>libnl netlink</code> : <code>libnl</code> åŒ…å«äº†ä¸å†…æ ¸é€šä¿¡çš„åŸºæœ¬å‡½æ•°</li>
<li><code>nftables</code> : ç”¨æˆ·ç©ºé—´å‰ç«¯ã€‚<code>nftables</code> çš„ç”¨æˆ·ç©ºé—´å®ç”¨ç¨‹åº <code>nft</code> è¯„ä¼°å¤§å¤šæ•°è§„åˆ™é›†å¹¶ä¼ é€’åˆ°å†…æ ¸ã€‚è§„åˆ™å­˜å‚¨åœ¨é“¾ä¸­ï¼Œé“¾å­˜å‚¨åœ¨è¡¨ä¸­ã€‚</li>
</ul>
<p><strong>ä¸ <code>iptables</code> ä¸åŒç‚¹</strong></p>
<ul>
<li><code>nftables</code> åœ¨ç”¨æˆ·ç©ºé—´ä¸­è¿è¡Œï¼Œ<code>iptables</code> ä¸­çš„æ¯ä¸ªæ¨¡å—éƒ½è¿è¡Œåœ¨å†…æ ¸ï¼ˆç©ºé—´ï¼‰ä¸­</li>
<li><strong>è¡¨å’Œé“¾æ˜¯å®Œå…¨å¯é…ç½®çš„</strong>ã€‚åœ¨ <code>nftables</code> ä¸­ï¼Œè¡¨æ˜¯æ²¡æœ‰ç‰¹å®šè¯­ä¹‰çš„é“¾çš„å®¹å™¨ã€‚<code>iptables</code> é™„å¸¦äº†å…·æœ‰é¢„å®šä¹‰æ•°é‡çš„åŸºé“¾çš„è¡¨ï¼Œå³ä½¿æ‚¨åªéœ€è¦å…¶ä¸­ä¹‹ä¸€ï¼Œæ‰€æœ‰é“¾éƒ½å·²æ³¨å†Œï¼Œæœªä½¿ç”¨çš„åŸºç¡€é“¾ä¹Ÿä¼šæŸå®³æ€§èƒ½ã€‚</li>
<li><strong>å¯ä»¥åœ¨ä¸€ä¸ªè§„åˆ™ä¸­æŒ‡å®šå¤šä¸ªæ“ä½œ</strong>ã€‚åœ¨ <code>iptables</code> ä¸­ï¼Œæ‚¨åªèƒ½æŒ‡å®šä¸€ä¸ªç›®æ ‡ã€‚è¿™æ˜¯ä¸€ä¸ªé•¿æœŸå­˜åœ¨çš„å±€é™æ€§ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è·³åˆ°è‡ªå®šä¹‰é“¾æ¥è§£å†³ï¼Œä½†ä»£ä»·æ˜¯ä½¿è§„åˆ™é›†ç»“æ„ç¨å¾®å¤æ‚ä¸€äº›ã€‚</li>
<li><strong>æ¯ä¸ªé“¾å’Œè§„åˆ™æ²¡æœ‰å†…ç½®è®¡æ•°å™¨</strong>ã€‚åœ¨ <code>nftables</code> ä¸­ï¼Œè¿™äº›æ˜¯å¯é€‰çš„ï¼Œå› æ­¤æ‚¨å¯ä»¥æŒ‰éœ€å¯ç”¨è®¡æ•°å™¨ã€‚ç”±äº <code>iptables</code> å†…ç½®äº†ä¸€ä¸ªæ•°æ®åŒ…è®¡æ•°å™¨ï¼Œæ‰€ä»¥å³ä½¿è¿™äº›å†…ç½®çš„é“¾æ˜¯ç©ºçš„ï¼Œä¹Ÿä¼šå¸¦æ¥æ€§èƒ½æŸè€—</li>
<li><strong>æ›´å¥½åœ°æ”¯æŒåŠ¨æ€è§„åˆ™é›†æ›´æ–°</strong>ã€‚åœ¨ <code>nftables</code> ä¸­ï¼Œå¦‚æœæ·»åŠ æ–°è§„åˆ™ï¼Œåˆ™å‰©ä½™çš„ç°æœ‰è§„åˆ™å°†ä¿æŒä¸å˜ï¼Œå› ä¸ºè§„åˆ™é›†ä»¥é“¾è¡¨å½¢å¼è¡¨ç¤ºï¼Œè¿™ä¸æ•´ä½“å¼ blob è¡¨ç¤ºç›¸åï¼Œåè€…åœ¨æ‰§è¡Œè§„åˆ™é›†æ›´æ–°æ—¶å†…éƒ¨çŠ¶æ€ä¿¡æ¯çš„ç»´æŠ¤å¾ˆå¤æ‚ã€‚</li>
<li><strong>ç®€åŒ–çš„åŒå †æ ˆ IPv4&#x2F;IPv6 ç®¡ç†</strong>ï¼Œé€šè¿‡æ–°çš„ <code>inet</code> ç³»åˆ—ï¼Œå¯è®©æ‚¨æ³¨å†ŒåŒæ—¶æŸ¥çœ‹ IPv4 å’Œ IPv6 æµé‡çš„åŸºé“¾ã€‚ å› æ­¤ï¼Œæ‚¨ä¸å†éœ€è¦ä¾èµ–è„šæœ¬æ¥å¤åˆ¶è§„åˆ™é›†ã€‚</li>
</ul>
<p><strong>æœåŠ¡åç§°é»˜è®¤ä¸º <code>nftables</code>ï¼Œé»˜è®¤é…ç½®æ–‡ä»¶ä¸º <code>/etc/nftables.conf</code></strong> ï¼Œå…¶ä¸­å·²ç»åŒ…å«ä¸€ä¸ªåä¸º <code>inet filter</code> çš„ç®€å• <code>ipv4/ipv6</code> é˜²ç«å¢™åˆ—è¡¨ã€‚</p>
<figure class="highlight shell"><figcaption><span>/etc/nftables.conf</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/sbin/nft -f</span></span><br><span class="line"></span><br><span class="line">flush ruleset</span><br><span class="line"></span><br><span class="line">table inet filter &#123;</span><br><span class="line">	chain input &#123;</span><br><span class="line">		type filter hook input priority 0;</span><br><span class="line">	&#125;</span><br><span class="line">	chain forward &#123;</span><br><span class="line">		type filter hook forward priority 0;</span><br><span class="line">	&#125;</span><br><span class="line">	chain output &#123;</span><br><span class="line">		type filter hook output priority 0;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>nftables</code> æœåŠ¡çš„ <code>systemd</code> é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><figcaption><span>/lib/systemd/system/nftables.service</span></figcaption><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nftables</span><br><span class="line">Documentation=man:nft(8) http://wiki.nftables.org</span><br><span class="line">Wants=network-pre.target</span><br><span class="line">Before=network-pre.target shutdown.target</span><br><span class="line">Conflicts=shutdown.target</span><br><span class="line">DefaultDependencies=no</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=oneshot</span><br><span class="line">RemainAfterExit=yes</span><br><span class="line">StandardInput=null</span><br><span class="line">ProtectSystem=full</span><br><span class="line">ProtectHome=true</span><br><span class="line">ExecStart=/usr/sbin/nft -f /etc/nftables.conf</span><br><span class="line">ExecReload=/usr/sbin/nft -f /etc/nftables.conf</span><br><span class="line">ExecStop=/usr/sbin/nft flush ruleset</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=sysinit.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>nftables</code> ä½¿ç”¨çš„å†…æ ¸æ¨¡å—å¦‚ä¸‹ï¼ŒåŠ è½½è¿™äº›æ¨¡å—ï¼ŒæœåŠ¡æ‰èƒ½æ­£å¸¸è¿è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">lsmod | grep nf</span></span><br><span class="line">nf_log_syslog          20480  1</span><br><span class="line">nft_chain_nat          16384  17</span><br><span class="line">nf_nat                 49152  3 xt_nat,nft_chain_nat,xt_MASQUERADE</span><br><span class="line">nf_conntrack_netlink    49152  0</span><br><span class="line">nft_counter            16384  142</span><br><span class="line">nf_reject_ipv4         16384  1 ipt_REJECT</span><br><span class="line">nf_conntrack          172032  6 xt_conntrack,nf_nat,xt_state,xt_nat,nf_conntrack_netlink,xt_MASQUERADE</span><br><span class="line">nf_defrag_ipv6         24576  1 nf_conntrack</span><br><span class="line">nf_defrag_ipv4         16384  1 nf_conntrack</span><br><span class="line">nft_compat             20480  143</span><br><span class="line">nf_tables             249856  570 nft_compat,nft_counter,nft_chain_nat</span><br><span class="line">nfnetlink              20480  5 nft_compat,nf_conntrack_netlink,nf_tables,ip_set</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="20240904170014/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202209281614/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202209281614/" class="post-title-link" itemprop="url">kubernetes å¸¸è§é”™è¯¯æ€»ç»“</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-09-28 16:14:41" itemprop="dateCreated datePublished" datetime="2022-09-28T16:14:41+08:00">2022-09-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-02-28 13:02:00" itemprop="dateModified" datetime="2025-02-28T13:02:00+08:00">2025-02-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h1><ul>
<li>Centos7 5.4.212-1</li>
<li>Docker 20.10.18</li>
<li>containerd.io-1.6.8</li>
<li>kubectl-1.25.0</li>
<li>kubeadm-1.25.0</li>
<li>kubelet-1.25.0</li>
</ul>
<h1 id="POD-çŠ¶æ€å¼‚å¸¸"><a href="#POD-çŠ¶æ€å¼‚å¸¸" class="headerlink" title="POD çŠ¶æ€å¼‚å¸¸"></a>POD çŠ¶æ€å¼‚å¸¸</h1><h2 id="CrashLoopBackOff"><a href="#CrashLoopBackOff" class="headerlink" title="CrashLoopBackOff"></a>CrashLoopBackOff</h2><p><strong>é”™è¯¯åœºæ™¯</strong> ï¼š </p>
<p><code>Pod</code> çŠ¶æ€æ˜¾ç¤º <code>CrashLoopBackOff</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubectl get pods</span></span><br><span class="line">NAME                                     READY   STATUS             RESTARTS       AGE</span><br><span class="line">test-centos7-7cc5dc6987-jz486            0/1     CrashLoopBackOff   8 (111s ago)   17m</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ <code>Pod</code> è¯¦ç»†ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubectl describe pod test-centos7-7cc5dc6987-jz486</span></span><br><span class="line">...</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason     Age                  From               Message</span><br><span class="line">  ----     ------     ----                 ----               -------</span><br><span class="line">  Normal   Scheduled  18m                  default-scheduler  Successfully assigned default/test-centos7-7cc5dc6987-jz486 to ops-kubernetes3</span><br><span class="line">  Normal   Pulled     16m (x5 over 18m)    kubelet            Container image &quot;centos:centos7.9.2009&quot; already present on machine</span><br><span class="line">  Normal   Created    16m (x5 over 18m)    kubelet            Created container centos7</span><br><span class="line">  Normal   Started    16m (x5 over 18m)    kubelet            Started container centos7</span><br><span class="line">  Warning  BackOff    3m3s (x71 over 18m)  kubelet            Back-off restarting failed container</span><br></pre></td></tr></table></figure>
<p>ç»“æœæ˜¾ç¤ºï¼Œ<code>Reason</code> ä¸º <code>BackOff</code>ï¼Œ<code>Message</code> æ˜¾ç¤º <code>Back-off restarting failed container</code></p>
<p><strong>å¯èƒ½åŸå› </strong> ï¼š</p>
<p><code>Back-off restarting failed container</code> çš„åŸå› ï¼Œé€šå¸¸æ˜¯å› ä¸ºï¼Œå®¹å™¨å†… PID ä¸º 1 çš„è¿›ç¨‹é€€å‡ºå¯¼è‡´ï¼ˆé€šå¸¸ç”¨æˆ·åœ¨æ„å»ºé•œåƒæ‰§è¡Œ <code>CMD</code> æ—¶ï¼Œå¯åŠ¨çš„ç¨‹åºï¼Œå‡æ˜¯ PID ä¸º1ï¼‰<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Back-off restarting failed container æ€ä¹ˆåŠ](https://cloud.tencent.com/developer/article/1931089)">[1]</span></a></sup></p>
<p>å®¹å™¨è¿›ç¨‹é€€å‡ºï¼ˆå‘½ä»¤æ‰§è¡Œç»“æŸæˆ–è€…è¿›ç¨‹å¼‚å¸¸ç»“æŸï¼‰ï¼Œåˆ™å®¹å™¨ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚kubernetes æ§åˆ¶å™¨æ£€æŸ¥åˆ°å®¹å™¨é€€å‡ºï¼Œä¼šæŒç»­é‡å¯å®¹å™¨ã€‚é’ˆå¯¹æ­¤ç§æƒ…å†µï¼Œéœ€è¦æ£€æŸ¥é•œåƒï¼Œæ˜¯å¦ä¸å­˜åœ¨å¸¸é©»è¿›ç¨‹ï¼Œæˆ–è€…å¸¸é©»è¿›ç¨‹å¼‚å¸¸ã€‚</p>
<p>é’ˆå¯¹æ­¤ç§æƒ…å†µï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨ <code>docker</code> å®¢æˆ·ç«¯éƒ¨ç½²é•œåƒï¼ŒæŸ¥çœ‹é•œåƒçš„è¿è¡Œæƒ…å†µï¼Œå¦‚æœéƒ¨ç½²åï¼Œå®¹å™¨ä¸­çš„è¿›ç¨‹ç«‹é©¬ç»“æŸæˆ–é€€å‡ºï¼Œåˆ™å®¹å™¨ä¹Ÿä¼šéšä¹‹ç»“æŸã€‚</p>
<p>å®šä½ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>kubectl describe pod</code> å‘½ä»¤æ£€æŸ¥ Pod çš„é€€å‡ºçŠ¶æ€ç ã€‚Kubernetes ä¸­çš„ Pod ExitCode çŠ¶æ€ç æ˜¯å®¹å™¨é€€å‡ºæ—¶è¿”å›çš„é€€å‡ºçŠ¶æ€ç ï¼Œè¿™ä¸ªçŠ¶æ€ç é€šå¸¸ç”¨æ¥æŒ‡ç¤ºå®¹å™¨çš„æ‰§è¡Œç»“æœï¼Œä»¥ä¾¿ Kubernetes å’Œç›¸å…³å·¥å…·å¯ä»¥æ ¹æ®å®ƒæ¥é‡‡å–åç»­çš„æ“ä½œã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ ExitCode çŠ¶æ€ç è¯´æ˜ï¼š</p>
<ul>
<li><code>ExitCode 0</code> : è¿™è¡¨ç¤ºå®¹å™¨æ­£å¸¸é€€å‡ºï¼Œæ²¡æœ‰é”™è¯¯ã€‚è¿™é€šå¸¸æ˜¯æœŸæœ›çš„ç»“æœã€‚</li>
<li><code>ExitCode 1</code> ï¼š é€šå¸¸è¡¨ç¤ºå®¹å™¨ä»¥éæ­£å¸¸æ–¹å¼é€€å‡ºï¼Œå¯èƒ½æ˜¯ç”±äºåº”ç”¨ç¨‹åºå†…éƒ¨é”™è¯¯æˆ–å¼‚å¸¸å¯¼è‡´çš„ã€‚é€šå¸¸æ˜¯å®¹å™¨ä¸­ pid ä¸º 1 çš„è¿›ç¨‹é”™è¯¯è€Œå¤±è´¥</li>
<li><code>ExitCode éé›¶</code> ï¼š ä»»ä½•éé›¶çš„çŠ¶æ€ç éƒ½è¡¨ç¤ºå®¹å™¨é€€å‡ºæ—¶å‘ç”Ÿäº†é”™è¯¯ã€‚ExitCode çš„å…·ä½“å€¼é€šå¸¸æ˜¯è‡ªå®šä¹‰çš„ï¼Œå®¹å™¨å†…çš„åº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®éœ€è¦è¿”å›ä¸åŒçš„çŠ¶æ€ç æ¥è¡¨ç¤ºä¸åŒçš„é”™è¯¯æƒ…å†µã€‚ä½ éœ€è¦æŸ¥çœ‹å®¹å™¨å†…åº”ç”¨ç¨‹åºçš„æ–‡æ¡£æˆ–æ—¥å¿—æ¥äº†è§£å…·ä½“çš„å«ä¹‰ã€‚</li>
<li><code>ExitCode 137</code> ï¼š é€šå¸¸è¡¨ç¤ºå®¹å™¨å› ä¸ºè¢«æ“ä½œç³»ç»Ÿç»ˆæ­¢ï¼ˆä¾‹å¦‚ï¼Œ<code>OOM-killer</code>ï¼‰è€Œéæ­£å¸¸é€€å‡ºã€‚è¿™å¯èƒ½æ˜¯ç”±äºå†…å­˜ä¸è¶³ç­‰èµ„æºé—®é¢˜å¯¼è‡´çš„ã€‚</li>
<li><code>ExitCode 139</code> ï¼š é€šå¸¸è¡¨ç¤ºå®¹å™¨å› ä¸ºæ¥æ”¶åˆ°äº†ä¸€ä¸ªä¿¡å·è€Œéæ­£å¸¸é€€å‡ºã€‚è¿™ä¸ªä¿¡å·é€šå¸¸æ˜¯ <code>SIGSEGV</code>ï¼ˆæ®µé”™è¯¯ï¼‰ï¼Œè¡¨ç¤ºåº”ç”¨ç¨‹åºè¯•å›¾è®¿é—®æ— æ•ˆçš„å†…å­˜ã€‚</li>
<li><code>ExitCode 143</code> ï¼š é€šå¸¸è¡¨ç¤ºå®¹å™¨å› ä¸ºæ¥æ”¶åˆ°äº† <code>SIGTERM</code> ä¿¡å·è€Œæ­£å¸¸é€€å‡ºã€‚è¿™æ˜¯ Kubernetes åœ¨åˆ é™¤ Pod æ—¶å‘é€çš„ä¿¡å·ï¼Œå®¹å™¨åº”è¯¥åœ¨æ¥æ”¶åˆ°è¯¥ä¿¡å·ååšä¸€äº›æ¸…ç†å·¥ä½œç„¶åé€€å‡ºã€‚</li>
<li><code>ExitCode 130</code> ï¼š é€šå¸¸è¡¨ç¤ºå®¹å™¨å› ä¸ºæ¥æ”¶åˆ°äº† <code>SIGINT</code> ä¿¡å·è€Œæ­£å¸¸é€€å‡ºã€‚è¿™æ˜¯å½“ç”¨æˆ·åœ¨å‘½ä»¤è¡Œä¸­æŒ‰ä¸‹ <code>Ctrl+C</code> æ—¶å‘é€çš„ä¿¡å·ã€‚</li>
<li><code>ExitCode 255</code> ï¼šé€šå¸¸è¡¨ç¤ºæœªçŸ¥é”™è¯¯ï¼Œæˆ–è€…å®¹å™¨æ— æ³•å¯åŠ¨ã€‚è¿™ä¸ªçŠ¶æ€ç é€šå¸¸æ˜¯å®¹å™¨è¿è¡Œæ—¶çš„é—®é¢˜ï¼Œæ¯”å¦‚å®¹å™¨é•œåƒä¸å­˜åœ¨æˆ–è€…å¯åŠ¨å‘½ä»¤æœ‰é—®é¢˜ã€‚</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202209281614/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20250228101014/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="20250228101014/" class="post-title-link" itemprop="url">Github ç›¸å…³æ“ä½œ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-02-28 10:02:00" itemprop="dateCreated datePublished" datetime="2025-02-28T10:02:00+08:00">2025-02-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="PAT-è®¤è¯"><a href="#PAT-è®¤è¯" class="headerlink" title="PAT è®¤è¯"></a>PAT è®¤è¯</h1><p>Github ä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œåœ¨ Shell ä¸­ç¦æ­¢ä½¿ç”¨å¸å·åç§°ç™»é™†ï¼Œæä¾›äº†æ›´ä¸ºå®‰å…¨çš„ PATï¼ˆPersonal Access Tokenï¼‰ï¼ŒPAT çš„æƒé™å’Œåˆ›å»ºå®ƒçš„ç”¨æˆ·æƒé™ç›¸åŒï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ <code>Fine-grained personal access tokens</code> å®ç°æ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶</p>
<p>å‚è€ƒä»¥ä¸‹æ­¥éª¤åˆ›å»º PATï¼š</p>
<ol>
<li><p>ç™»å½• GitHubã€‚</p>
</li>
<li><p>ç‚¹å‡»å³ä¸Šè§’å¤´åƒï¼Œè¿›å…¥ <code>Settings</code> ã€‚</p>
</li>
<li><p>åœ¨å·¦ä¾§èœå•ä¸­é€‰æ‹© <code>Developer settings</code> ã€‚</p>
</li>
<li><p>é€‰æ‹© <code>Personal access tokens</code> ï¼Œç„¶åç‚¹å‡» <code>Generate new token</code> ã€‚</p>
</li>
<li><p>ç”Ÿæˆä»¤ç‰Œå¹¶å¤åˆ¶ã€‚</p>
</li>
</ol>
<h1 id="gh"><a href="#gh" class="headerlink" title="gh"></a>gh</h1><p>Github å‘½ä»¤è¡Œå·¥å…· <code>gh</code> å¸¸ç”¨æ“ä½œ</p>
<h2 id="Login"><a href="#Login" class="headerlink" title="Login"></a>Login</h2><p>å‚è€ƒä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨å‘½ä»¤ <code>gh auth login</code> ç™»é™† Github</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gh auth login</span></span><br><span class="line">? Where do you use GitHub? GitHub.com</span><br><span class="line">? What is your preferred protocol for Git operations on this host? HTTPS</span><br><span class="line">? Authenticate Git with your GitHub credentials? Yes</span><br><span class="line">? How would you like to authenticate GitHub CLI? Paste an authentication token</span><br><span class="line">Tip: you can generate a Personal Access Token here https://github.com/settings/tokens</span><br><span class="line">The minimum required scopes are &#x27;repo&#x27;, &#x27;read:org&#x27;, &#x27;workflow&#x27;.</span><br><span class="line">? Paste your authentication token: *********************************************************************************************</span><br><span class="line">- gh config set -h github.com git_protocol https</span><br><span class="line">âœ“ Configured git protocol</span><br><span class="line">! Authentication credentials saved in plain text</span><br><span class="line">âœ“ Logged in as user1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>æŸ¥çœ‹ Github è®¤è¯çŠ¶æ€ï¼ˆ<code>gh auth status</code>ï¼‰</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gh auth status</span></span><br><span class="line">github.com</span><br><span class="line">  âœ“ Logged in to github.com account user1 (/root/.config/gh/hosts.yml)</span><br><span class="line">  - Active account: true</span><br><span class="line">  - Git operations protocol: https</span><br><span class="line">  - Token: github_pat_11BP5YWMA0XuC4iSW26eBN_***********************************************************</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="pull"><a href="#pull" class="headerlink" title="pull"></a>pull</h2><p>å‚è€ƒä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨å‘½ä»¤ <code>gh repo clone user1/resp1</code> clone ä»£ç åˆ°æœ¬åœ°</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gh repo <span class="built_in">clone</span> user1/resp1</span></span><br><span class="line">Cloning into &#x27;resp1&#x27;...</span><br><span class="line">remote: Enumerating objects: 27, done.</span><br><span class="line">remote: Counting objects: 100% (27/27), done.</span><br><span class="line">remote: Compressing objects: 100% (25/25), done.</span><br><span class="line">remote: Total 27 (delta 12), reused 0 (delta 0), pack-reused 0 (from 0)</span><br><span class="line">Receiving objects: 100% (27/27), 9.10 KiB | 9.10 MiB/s, done.</span><br><span class="line">Resolving deltas: 100% (12/12), done.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæŠ¥é”™ï¼š <code>GraphQL: Resource not accessible by personal access token (repository.defaultBranchRef)</code> ï¼Œåˆ™è¯´æ˜ PAT æƒé™ä¸è¶³ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202208041317/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202208041317/" class="post-title-link" itemprop="url">docker å®‰è£…åŠå¸¸ç”¨å‘½ä»¤ä»‹ç»</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-08-04 13:13:13" itemprop="dateCreated datePublished" datetime="2022-08-04T13:13:13+08:00">2022-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-02-27 16:02:00" itemprop="dateModified" datetime="2025-02-27T16:02:00+08:00">2025-02-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h1><ul>
<li>Centos 7.9.2009</li>
<li>docker-ce-19.03.15</li>
<li>docker-20.10.9</li>
</ul>
<h1 id="Docker-å®‰è£…"><a href="#Docker-å®‰è£…" class="headerlink" title="Docker å®‰è£…"></a>Docker å®‰è£…</h1><h2 id="yum-å®‰è£…-docker"><a href="#yum-å®‰è£…-docker" class="headerlink" title="yum å®‰è£… docker"></a>yum å®‰è£… docker</h2><p>å®‰è£… yum æºï¼Œ<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">dockerå®˜æ–¹ centos å®‰è£…æ–‡æ¡£</a>  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y yum-utils</span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p>å®‰è£… <code>docker</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure>

<h2 id="yum-ç¦»çº¿å®‰è£…-docker"><a href="#yum-ç¦»çº¿å®‰è£…-docker" class="headerlink" title="yum ç¦»çº¿å®‰è£… docker"></a>yum ç¦»çº¿å®‰è£… docker</h2><p><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5">å‚è€ƒé“¾æ¥</a>ä¸‹è½½rpmå®‰è£…åŒ…</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-19.03.15-3.el7.x86_64.rpm</span><br><span class="line">wget https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-cli-19.03.15-3.el7.x86_64.rpm</span><br><span class="line">wget https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.4.13-3.1.el7.x86_64.rpm</span><br><span class="line">wget https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-compose-plugin-2.3.3-3.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>
<p>å®‰è£… docker</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum localinstall -y containerd.io-1.4.13-3.1.el7.x86_64.rpm \</span><br><span class="line">                    docker-ce-cli-19.03.15-3.el7.x86_64.rpm \</span><br><span class="line">                    docker-ce-19.03.15-3.el7.x86_64.rpm \</span><br><span class="line">                    docker-compose-plugin-2.3.3-3.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Š 2 æ¡å‘½ä»¤å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ 1 æ¡å‘½ä»¤å®Œæˆ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum localinstall -y https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-19.03.15-3.el7.x86_64.rpm \</span><br><span class="line">                    https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-cli-19.03.15-3.el7.x86_64.rpm \</span><br><span class="line">                    https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.4.13-3.1.el7.x86_64.rpm \</span><br><span class="line">                    https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-compose-plugin-2.3.3-3.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p><strong>Docker 26 å®‰è£…ï¼Œé€‚ç”¨äº <code>Centos 8</code>ã€<code>Rocky Linux 8</code> ç­‰</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum localinstall -y https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-ce-26.1.3-1.el8.x86_64.rpm https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-ce-cli-26.1.3-1.el8.x86_64.rpm https://download.docker.com/linux/centos/8/x86_64/stable/Packages/containerd.io-1.6.32-3.1.el8.x86_64.rpm https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-compose-plugin-2.6.0-3.el8.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨docker</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable docker --now</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202208041317/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202208181117/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202208181117/" class="post-title-link" itemprop="url">vim</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-08-18 09:23:46" itemprop="dateCreated datePublished" datetime="2022-08-18T09:23:46+08:00">2022-08-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-02-27 15:02:00" itemprop="dateModified" datetime="2025-02-27T15:02:00+08:00">2025-02-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">å¸¸ç”¨å‘½ä»¤</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h1><ul>
<li>Centos 7</li>
</ul>
<h1 id="vim-é…ç½®"><a href="#vim-é…ç½®" class="headerlink" title="vim é…ç½®"></a>vim é…ç½®</h1><p><code>vim</code> å¯åŠ¨æ—¶ä¼šè¯»å– <code>/etc/vimrc</code>ï¼ˆå…¨å±€é…ç½®ï¼‰ å’Œ <code>~/.vimrc</code> ï¼ˆç”¨æˆ·é…ç½®ï¼‰</p>
<p>å¸¸ç”¨é…ç½®å¦‚ä¸‹ï¼Œä½¿ç”¨ <code>&quot;</code> æ³¨é‡Š</p>
<figure class="highlight shell"><figcaption><span>/etc/vimrc</span></figcaption><table><tr><td class="code"><pre><span class="line">&quot; è‡ªåŠ¨ç¼©è¿› </span><br><span class="line">set ai</span><br><span class="line">set autoindent</span><br><span class="line"></span><br><span class="line">&quot; ä¿å­˜å†å²å‘½ä»¤æ•°é‡</span><br><span class="line">set history=50</span><br><span class="line"></span><br><span class="line">&quot; å³ä¸‹è§’æ˜¾ç¤ºå½“å‰é¼ æ ‡ä½ç½®ï¼ˆè¡Œåˆ—æ•°ï¼‰</span><br><span class="line">set ruler</span><br><span class="line"></span><br><span class="line">&quot; é¼ æ ‡ä½ç½®æ‰€åœ¨è¡Œæ˜¾ç¤ºä¸‹åˆ’çº¿</span><br><span class="line">set cursorline</span><br><span class="line"></span><br><span class="line">&quot; å¼€å¯è¯­æ³•é«˜äº®</span><br><span class="line">syntax on</span><br><span class="line"></span><br><span class="line">&quot; é«˜äº®æœç´¢ç»“æœ</span><br><span class="line">set hlsearch</span><br><span class="line"></span><br><span class="line">&quot; æœç´¢æ—¶ä¸åŒºåˆ†å¤§å°å†™</span><br><span class="line">set ignorecase</span><br><span class="line"></span><br><span class="line">&quot; å°† tab è½¬æ¢ä¸ºç©ºæ ¼</span><br><span class="line">set expandtab</span><br><span class="line"></span><br><span class="line">&quot; tab è½¬æ¢ä¸º4ä¸ªç©ºæ ¼</span><br><span class="line">set tabstop=4</span><br><span class="line"></span><br><span class="line">&quot; åˆ é™¤æ—¶ï¼Œå¯ä»¥ä¸€æ¬¡åˆ é™¤4ä¸ªç©ºæ ¼</span><br><span class="line">set softtabstop=4</span><br><span class="line"></span><br><span class="line">&quot; æ˜¾ç¤ºè¡Œæ•°</span><br><span class="line">set nu</span><br><span class="line"></span><br><span class="line">&quot; ç¦ç”¨æ ¼å¼åŒ–æŒ‡ä»¤ã€‚</span><br><span class="line">set paste</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202208181117/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202304191340/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202304191340/" class="post-title-link" itemprop="url">linux namespace ç®€ä»‹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-04-19 13:41:02" itemprop="dateCreated datePublished" datetime="2023-04-19T13:41:02+08:00">2023-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-02-20 15:02:00" itemprop="dateModified" datetime="2025-02-20T15:02:00+08:00">2025-02-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h1><ul>
<li>Centos 7 5.4.239-1</li>
</ul>
<p>Linux çš„ namespace çš„ä½œç”¨æ˜¯ <strong>éš”ç¦»å†…æ ¸èµ„</strong> ï¼Œç›®å‰ä¸»è¦å®ç°äº†ä»¥ä¸‹ namespace</p>
<ul>
<li><code>mount namespace</code> - æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹</li>
<li><code>UTS namespace</code> - ä¸»æœºå</li>
<li><code>IPC namespace</code> - POSIX è¿›ç¨‹é—´é€šä¿¡æ¶ˆæ¯é˜Ÿåˆ—</li>
<li><code>PID namespace</code> - è¿›ç¨‹ pid æ•°å­—ç©ºé—´</li>
<li><code>network namespace</code> - network</li>
<li><code>user namespace</code> - user ID æ•°å­—ç©ºé—´</li>
<li><code>cgroup</code> - èµ„æºä½¿ç”¨æ§åˆ¶</li>
<li><code>time</code> - éš”ç¦»æ—¶é’Ÿï¼ˆClockï¼‰</li>
</ul>
<p>å…¶ä¸­ï¼Œé™¤äº† <code>network namespace</code>ï¼Œå…¶ä»– namespace çš„æ“ä½œéœ€è¦ä½¿ç”¨ C è¯­è¨€è°ƒç”¨ç³»ç»Ÿ API å®ç°ã€‚<code>network namespace</code> çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½å·²ç»é›†æˆåˆ°äº† Linux çš„ <code>ip</code> å·¥å…·é›†çš„ <code>netns</code> å­å‘½ä»¤ä¸­</p>
<p>Linux é‡Œé¢çš„ namespace ç»™å¤„åœ¨å…¶ä¸­çš„è¿›ç¨‹é€ æˆ 2 ä¸ªé”™è§‰ï¼š</p>
<ol>
<li>å®ƒæ˜¯ç³»ç»Ÿé‡Œé¢å”¯ä¸€çš„è¿›ç¨‹</li>
<li>å®ƒç‹¬äº«ç³»ç»Ÿçš„æ‰€æœ‰èµ„æº</li>
</ol>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinux é‡Œé¢çš„æ‰€æœ‰è¿›ç¨‹å¤„åœ¨å’Œå®¿ä¸»æœºç›¸åŒçš„ namespace ï¼Œå³åˆå§‹ namespace é‡Œï¼Œé»˜è®¤äº«æœ‰å…¨å±€ç³»ç»Ÿèµ„æºã€‚</p>
<p><strong><code>lsns</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸Šå­˜åœ¨å“ªäº› Namespace</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">lsns</span></span><br><span class="line">        NS TYPE   NPROCS     PID USER             COMMAND</span><br><span class="line">4026531834 time      251       1 root             /lib/systemd/systemd --system --deserialize 52</span><br><span class="line">4026531835 cgroup    224       1 root             /lib/systemd/systemd --system --deserialize 52</span><br><span class="line">4026531836 pid       224       1 root             /lib/systemd/systemd --system --deserialize 52</span><br><span class="line">4026531837 user      686       1 root             /lib/systemd/systemd --system --deserialize 52</span><br><span class="line">4026531838 uts       221       1 root             /lib/systemd/systemd --system --deserialize 52</span><br><span class="line">4026531839 ipc       224       1 root             /lib/systemd/systemd --system --deserialize 52</span><br><span class="line">4026531840 net       229       1 root             /lib/systemd/systemd --system --deserialize 52</span><br><span class="line">4026531841 mnt       213       1 root             /lib/systemd/systemd --system --deserialize 52</span><br><span class="line">4026531862 mnt         1      61 root             kdevtmpfs</span><br><span class="line">4026532219 mnt         1 1426338 root             /lib/systemd/systemd-udevd</span><br><span class="line">4026532220 uts         1 1426338 root             /lib/systemd/systemd-udevd</span><br><span class="line">4026532230 mnt         1 2124756 root             /lib/systemd/systemd-logind</span><br><span class="line">4026532231 uts         1 2124756 root             /lib/systemd/systemd-logind</span><br><span class="line">4026532232 mnt         1 1426274 systemd-timesync /lib/systemd/systemd-timesyncd</span><br><span class="line">4026532233 mnt         1 1426257 root             /usr/sbin/irqbalance --foreground</span><br><span class="line">4026532326 mnt         1 2134793 root             /usr/sbin/NetworkManager --no-daemon</span><br><span class="line">4026532593 cgroup      7  937225 root             python manage.py runserver 0.0.0.0:8080</span><br><span class="line">4026532603 mnt         1 1416468 472              grafana server --homepath=/usr/share/grafana --config=/etc/grafana/grafana.ini --packaging=docker cfg:defau</span><br><span class="line">4026532604 uts         1 1416468 472              grafana server --homepath=/usr/share/grafana --config=/etc/grafana/grafana.ini --packaging=docker cfg:defau</span><br><span class="line">4026532605 ipc         1 1416468 472              grafana server --homepath=/usr/share/grafana --config=/etc/grafana/grafana.ini --packaging=docker cfg:defau</span><br><span class="line">4026532606 pid         1 1416468 472              grafana server --homepath=/usr/share/grafana --config=/etc/grafana/grafana.ini --packaging=docker cfg:defau</span><br><span class="line">4026532607 net         1 1416468 472              grafana server --homepath=/usr/share/grafana --config=/etc/grafana/grafana.ini --packaging=docker cfg:defau</span><br><span class="line">4026532664 cgroup      1 1416468 472              grafana server --homepath=/usr/share/grafana --config=/etc/grafana/grafana.ini --packaging=docker cfg:defau</span><br><span class="line">4026532665 mnt         1 1416534 1001             /opt/bitnami/blackbox-exporter/bin/blackbox_exporter --config.file=/etc/blackbox/blackbox.yml</span><br><span class="line">4026532666 uts         1 1416534 1001             /opt/bitnami/blackbox-exporter/bin/blackbox_exporter --config.file=/etc/blackbox/blackbox.yml</span><br><span class="line">4026532667 ipc         1 1416534 1001             /opt/bitnami/blackbox-exporter/bin/blackbox_exporter --config.file=/etc/blackbox/blackbox.yml</span><br><span class="line">4026532668 pid         1 1416534 1001             /opt/bitnami/blackbox-exporter/bin/blackbox_exporter --config.file=/etc/blackbox/blackbox.yml</span><br><span class="line">4026532669 net         1 1416534 1001             /opt/bitnami/blackbox-exporter/bin/blackbox_exporter --config.file=/etc/blackbox/blackbox.yml</span><br></pre></td></tr></table></figure>

<p>æƒ³è¦æŸ¥çœ‹æŸä¸ªè¿›ç¨‹éƒ½åœ¨å“ªäº› namespace ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°è¿›ç¨‹ ID ï¼ˆPIDï¼‰ï¼Œé€šè¿‡æŸ¥çœ‹ä»¥ä¸‹å†…å®¹æˆ–è€… namespace ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ps -elf | grep nginx</span></span><br><span class="line">4 S root     32679 32659  0  80   0 -  2248 sigsus Apr07 ?        00:00:00 nginx: master process nginx -g daemon off;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ll /proc/32679/ns/</span></span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:51 cgroup -&gt; cgroup:[4026531835]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:51 ipc -&gt; ipc:[4026534784]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:51 mnt -&gt; mnt:[4026534583]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:51 net -&gt; net:[4026534787]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:51 pid -&gt; pid:[4026534878]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:51 pid_for_children -&gt; pid:[4026534878]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:51 user -&gt; user:[4026531837]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:51 uts -&gt; uts:[4026534877]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä»¥ä¸Šå‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ° <code>nginx</code> è¿›ç¨‹æ‰€å±çš„ namespaceï¼Œè¦æŸ¥çœ‹ç³»ç»Ÿåˆå§‹ namespace ï¼Œå¯ä»¥æŸ¥çœ‹ PID ä¸º 1 çš„è¿›ç¨‹çš„ namespace ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ll /proc/1/ns/</span></span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:53 cgroup -&gt; cgroup:[4026531835]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:53 ipc -&gt; ipc:[4026531839]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:53 mnt -&gt; mnt:[4026531840]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:53 net -&gt; net:[4026531992]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:53 pid -&gt; pid:[4026531836]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:53 pid_for_children -&gt; pid:[4026531836]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:53 user -&gt; user:[4026531837]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Apr 19 13:53 uts -&gt; uts:[4026531838]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é“¾æ¥æ–‡ä»¶çš„å†…å®¹çš„æ ¼å¼ä¸º ns ç±»å‹: [inode number]ã€‚è¿™é‡Œçš„ <code>inode number</code> åˆ™ç”¨æ¥æ ‡è¯†ä¸€ä¸ª namespaceï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå®ƒç†è§£ä¸º namespace çš„ IDã€‚å¦‚æœä¸¤ä¸ªè¿›ç¨‹çš„æŸä¸ª namespace æ–‡ä»¶æŒ‡å‘åŒä¸€ä¸ªé“¾æ¥æ–‡ä»¶ï¼Œè¯´æ˜å…¶ç›¸å…³èµ„æºåœ¨åŒä¸€ä¸ª namespace ä¸­ã€‚ <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[ä¸èƒ½ä¸çŸ¥é“çš„ä¸‰ä¸ªdockerå®¹å™¨éš”ç¦»æ ¸å¿ƒæŠ€æœ¯ï¼šnamespaceã€cgroupsã€rootfs](https://zhuanlan.zhihu.com/p/374503196)">[1]</span></a></sup></p>
</blockquote>
<h1 id="è„šæ³¨"><a href="#è„šæ³¨" class="headerlink" title="è„šæ³¨"></a>è„šæ³¨</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/374503196">ä¸èƒ½ä¸çŸ¥é“çš„ä¸‰ä¸ªdockerå®¹å™¨éš”ç¦»æ ¸å¿ƒæŠ€æœ¯ï¼šnamespaceã€cgroupsã€rootfs</a><a href="#fnref:1" rev="footnote"> â†©</a></span></li></ol></div></div>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202301171137/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202301171137/" class="post-title-link" itemprop="url">linux ç³»ç»ŸçŠ¶æ€æŸ¥çœ‹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-01-17 11:37:49" itemprop="dateCreated datePublished" datetime="2023-01-17T11:37:49+08:00">2023-01-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-02-19 14:02:00" itemprop="dateModified" datetime="2025-02-19T14:02:00+08:00">2025-02-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h1><ul>
<li>Centos 7 kernel 5.4.221</li>
</ul>
<h1 id="å¯åŠ¨è¿‡ç¨‹"><a href="#å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="å¯åŠ¨è¿‡ç¨‹"></a>å¯åŠ¨è¿‡ç¨‹</h1><p>åœ¨ <code>systemd</code> ç®¡ç†çš„ç³»ç»Ÿä¸­ï¼Œæä¾›äº†å·¥å…· <code>systemd-analyze</code> ç”¨äºåˆ†æå…·ä½“çš„å¯åŠ¨è¿‡ç¨‹ï¼Œä½¿ç”¨ <code>systemd-analyze --help</code> æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©</p>
<h2 id="æ£€æŸ¥ç³»ç»Ÿå¯åŠ¨æ—¶é—´"><a href="#æ£€æŸ¥ç³»ç»Ÿå¯åŠ¨æ—¶é—´" class="headerlink" title="æ£€æŸ¥ç³»ç»Ÿå¯åŠ¨æ—¶é—´"></a>æ£€æŸ¥ç³»ç»Ÿå¯åŠ¨æ—¶é—´</h2><p>ä½¿ç”¨ <code>systemd-analyze</code> å‘½ä»¤ä¼šæ˜¾ç¤ºç³»ç»Ÿå¯åŠ¨æ‰€ç”¨çš„æ—¶é—´ï¼Œç­‰åŒäº <code>systemd-analyze time</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemd-analyze</span> </span><br><span class="line">Startup finished in 1.830s (kernel) + 36.827s (userspace) = 38.657s </span><br><span class="line">graphical.target reached after 12.604s in userspace</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>systemd-analyze blame</code> åˆ—å‡ºç³»ç»Ÿä¸Šå„ä¸ª Unit å¯åŠ¨çš„æ—¶é—´</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemd-analyze blame</span></span><br><span class="line">          6.414s wazuh-agent.service</span><br><span class="line">          3.161s dracut-initqueue.service</span><br><span class="line">          2.473s network.service</span><br><span class="line">          1.004s watchdog.service</span><br><span class="line">          ...</span><br><span class="line">            45ms sysstat.service</span><br><span class="line">            14ms plymouth-switch-root.service</span><br><span class="line">            14ms systemd-journald.service</span><br><span class="line">             4ms systemd-logind.service</span><br><span class="line">             3ms sys-kernel-config.mount</span><br><span class="line">             3ms initrd-udevadm-cleanup-db.service</span><br><span class="line">             3ms systemd-random-seed.service</span><br><span class="line">             2ms google-shutdown-scripts.service</span><br></pre></td></tr></table></figure>

<p><strong>åˆ—å‡ºç³»ç»Ÿå„ä¸ª Unit å¯åŠ¨æ¶ˆè€—çš„æ—¶é—´</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemd-analyze critical-chain</span></span><br><span class="line">The time when unit became active or started is printed after the &quot;@&quot; character.</span><br><span class="line">The time the unit took to start is printed after the &quot;+&quot; character.</span><br><span class="line"></span><br><span class="line">graphical.target @12.604s</span><br><span class="line">â””â”€multi-user.target @12.601s</span><br><span class="line">  â””â”€skylight-agent.service @36.639s</span><br><span class="line">    â””â”€network.target @9.073s</span><br><span class="line">      â””â”€NetworkManager.service @8.795s +275ms</span><br><span class="line">        â””â”€dbus.service @8.788s</span><br><span class="line">          â””â”€basic.target @8.774s</span><br><span class="line">            â””â”€sockets.target @8.772s</span><br><span class="line">              â””â”€snapd.socket @8.766s +5ms</span><br><span class="line">                â””â”€sysinit.target @8.669s</span><br><span class="line">                  â””â”€cloud-init.service @6.850s +1.811s</span><br><span class="line">                    â””â”€systemd-networkd-wait-online.service @4.970s +1.871s</span><br><span class="line">                      â””â”€systemd-networkd.service @4.864s +91ms</span><br><span class="line">                        â””â”€network-pre.target @4.850s</span><br><span class="line">                          â””â”€cloud-init-local.service @3.228s +1.620s</span><br><span class="line">                            â””â”€systemd-remount-fs.service @1.113s +93ms</span><br><span class="line">                              â””â”€systemd-fsck-root.service @1.030s +69ms</span><br><span class="line">                                â””â”€systemd-journald.socket @853ms</span><br><span class="line">                                  â””â”€-.mount @692ms</span><br><span class="line">                                    â””â”€-.slice @692ms</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="æŸ¥çœ‹å†…å­˜ä¿¡æ¯"><a href="#æŸ¥çœ‹å†…å­˜ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹å†…å­˜ä¿¡æ¯"></a>æŸ¥çœ‹å†…å­˜ä¿¡æ¯</h1><p>å†…å­˜ç›¸å…³æ¦‚å¿µè¯´æ˜ï¼š</p>
<ul>
<li><strong>VSS ,Virtual Set Size , VIRT</strong> - è™šæ‹Ÿè€—ç”¨å†…å­˜ï¼ˆåŒ…å«å…±äº«åº“å ç”¨çš„å†…å­˜ï¼‰ï¼Œ <strong>é€šå¸¸ VIRT æ˜¯ç³»ç»Ÿæ‰¿è¯ºåˆ†é…ç»™åº”ç”¨çš„å†…å­˜ï¼Œä¸æ˜¯å®é™…ä½¿ç”¨çš„å†…å­˜</strong></li>
<li><strong>RSS , Resident Set Size , RES</strong> - å®é™…ä½¿ç”¨ç‰©ç†å†…å­˜ï¼ˆåŒ…å«å…±äº«åº“å ç”¨çš„å†…å­˜ï¼‰</li>
<li><strong>PSS , Proportional Set Size</strong> - å®é™…ä½¿ç”¨çš„ç‰©ç†å†…å­˜ï¼ˆæ¯”ä¾‹åˆ†é…å…±äº«åº“å ç”¨çš„å†…å­˜ï¼‰ã€‚ <strong><code>top</code> å‘½ä»¤ä¸­çš„ <code>SHR</code> åˆ—å±•ç¤ºçš„å°±æ˜¯å…±äº«åº“æŒ‰æ¯”ä¾‹åˆ†é…ç»™è¿›ç¨‹çš„å†…å­˜</strong></li>
<li><strong>USS , Unique Set Size</strong> - è¿›ç¨‹ç‹¬è‡ªå ç”¨çš„ç‰©ç†å†…å­˜ï¼ˆä¸åŒ…å«å…±äº«åº“å ç”¨çš„å†…å­˜ï¼‰</li>
</ul>
<h2 id="ç³»ç»Ÿå†…å­˜ä½¿ç”¨é‡ç»Ÿè®¡"><a href="#ç³»ç»Ÿå†…å­˜ä½¿ç”¨é‡ç»Ÿè®¡" class="headerlink" title="ç³»ç»Ÿå†…å­˜ä½¿ç”¨é‡ç»Ÿè®¡"></a>ç³»ç»Ÿå†…å­˜ä½¿ç”¨é‡ç»Ÿè®¡</h2><h3 id="free"><a href="#free" class="headerlink" title="free"></a>free</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">free -h</span></span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            15Gi       7.8Gi       707Mi       449Mi       7.0Gi       6.9Gi</span><br><span class="line">Swap:           30Gi       1.0Gi        29Gi</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h3><p>ä¾‹å¦‚æŸ¥çœ‹ä½¿ç”¨å†…å­˜æ’åå‰åçš„è¿›ç¨‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ps aux | sort -k4,4nr | head -n 10</span><br></pre></td></tr></table></figure>

<h3 id="sar-å‘½ä»¤"><a href="#sar-å‘½ä»¤" class="headerlink" title="sar å‘½ä»¤"></a>sar å‘½ä»¤</h3><p><a href="#sar-%E6%A3%80%E6%9F%A5%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AD%98%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE">ä½¿ç”¨ <code>sar</code> å‘½ä»¤æ£€æŸ¥ç³»ç»Ÿä¸Šçš„å†…å­˜åŠ Swap ä½¿ç”¨æƒ…å†µ</a></p>
<h2 id="æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ä½¿ç”¨çš„å†…å­˜é‡"><a href="#æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ä½¿ç”¨çš„å†…å­˜é‡" class="headerlink" title="æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ä½¿ç”¨çš„å†…å­˜é‡"></a>æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ä½¿ç”¨çš„å†…å­˜é‡</h2><p>æ¯”å¦‚æ£€æŸ¥ <code>docker</code> ä½¿ç”¨çš„å†…å­˜é‡ï¼Œé¦–å…ˆé€šè¿‡ <code>ps</code> å‘½ä»¤æŸ¥è¯¢åˆ° <code>docker</code> çš„ PID ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ps -elf | grep docker</span></span><br><span class="line">4 S root      1243     1  4  80   0 - 1067527 futex_ Jan03 ?      15:14:45 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚æ­¤å¤„çš„ <code>docker</code> è¿›ç¨‹çš„ PID ä¸º 1243</p>
<ul>
<li><p>ä½¿ç”¨ <code>top</code> å‘½ä»¤åŠ¨æ€æŸ¥çœ‹ <code>docker</code> ä½¿ç”¨çš„å†…å­˜ä¿¡æ¯</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">top -p 1243</span></span><br><span class="line">top - 11:47:40 up 14 days,  2:09,  3 users,  load average: 0.65, 1.42, 1.70</span><br><span class="line">Tasks:   1 total,   0 running,   1 sleeping,   0 stopped,   0 zombie</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">Cpu(s):  1.0 us,  0.6 sy,  0.0 ni, 98.3 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span></span><br><span class="line">KiB Mem : 32068748 total,  2494500 free, 18536188 used, 11038060 buff/cache</span><br><span class="line">KiB Swap:        0 total,        0 free,        0 used.  9586340 avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                           </span><br><span class="line"> 1243 root      20   0 4270108   1.4g  53956 S   1.0  4.6 914:55.80 dockerd</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨ <code>ps aux</code> å‘½ä»¤æŸ¥çœ‹å†…å­˜ä½¿ç”¨é‡</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ps aux | grep 1243</span></span><br><span class="line">root      1243  4.5  4.6 4270108 1486460 ?     Ssl  Jan03 914:57 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br></pre></td></tr></table></figure>

<p>  è¾“å‡ºç»“æœä¸­</p>
<ul>
<li>ç¬¬ 3ã€4 åˆ— (<code>4.5  4.6</code>) åˆ†åˆ«è¡¨ç¤º <code>cpu ä½¿ç”¨ç‡</code>ã€<code>å†…å­˜ä½¿ç”¨ç‡</code>ã€‚</li>
<li>ç¬¬ 5ã€6 åˆ— (<code>4270108 1486460</code>) åˆ†åˆ«è¡¨ç¤º <code>è™šæ‹Ÿå†…å­˜ä½¿ç”¨é‡</code>ã€<code>ç‰©ç†å†…å­˜ä½¿ç”¨é‡</code>ï¼Œå•ä½ä¸º <code>k</code>ã€‚</li>
</ul>
</li>
<li><p>é€šè¿‡è¿›ç¨‹çš„ <code>status</code> æ–‡ä»¶æŸ¥çœ‹å†…å­˜ä½¿ç”¨</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> /proc/1243/status</span></span><br><span class="line">Name:	dockerd</span><br><span class="line">Umask:	0022</span><br><span class="line">State:	S (sleeping)</span><br><span class="line">Pid:	1243</span><br><span class="line">PPid:	1</span><br><span class="line">VmPeak:	 4270364 kB</span><br><span class="line">VmSize:	 4270108 kB</span><br><span class="line">VmLck:	       0 kB</span><br><span class="line">VmPin:	       0 kB</span><br><span class="line">VmHWM:	 1562204 kB</span><br><span class="line">VmRSS:	 1492340 kB</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ<code>VmRSS</code> ä¸ºè¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜</p>
</li>
<li><p>ä½¿ç”¨ <code>pmap</code> å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜ä¿¡æ¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pmap -x 1243</span><br><span class="line">pmap -p 1243</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨ <code>pidstat</code> å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pidstat -r -t -p 1424681 1 1</span></span><br><span class="line">Linux 6.8.0-1017-aws (U-3TSDMAL9IVFAQ) 	11/26/2024 	_x86_64_	(4 CPU)</span><br><span class="line"></span><br><span class="line">04:15:40 PM   UID      TGID       TID  minflt/s  majflt/s     VSZ     RSS   %MEM  Command</span><br><span class="line">04:15:41 PM 408001114   1424681         -      0.00      0.00 34656400  256620   1.59  chrome</span><br><span class="line">04:15:41 PM 408001114         -   1424681      0.00      0.00 34656400  256620   1.59  |__chrome</span><br><span class="line">04:15:41 PM 408001114         -   1424696      0.00      0.00 34656400  256620   1.59  |__sandbox_ipc_thr</span><br><span class="line">04:15:41 PM 408001114         -   1424702      0.00      0.00 34656400  256620   1.59  |__chrome</span><br><span class="line">04:15:41 PM 408001114         -   1424703      0.00      0.00 34656400  256620   1.59  |__HangWatcher</span><br><span class="line">04:15:41 PM 408001114         -   1424704      0.00      0.00 34656400  256620   1.59  |__ThreadPoolServi</span><br><span class="line">04:15:41 PM 408001114         -   1424705      0.00      0.00 34656400  256620   1.59  |__ThreadPoolForeg</span><br><span class="line">04:15:41 PM 408001114         -   1424706      0.00      0.00 34656400  256620   1.59  |__ThreadPoolForeg</span><br><span class="line"></span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202301171137/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202405231459/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202405231459/" class="post-title-link" itemprop="url">Ansible playbooks ä½¿ç”¨ä»‹ç»</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-05-23 14:59:10" itemprop="dateCreated datePublished" datetime="2024-05-23T14:59:10+08:00">2024-05-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-02-12 09:02:00" itemprop="dateModified" datetime="2025-02-12T09:02:00+08:00">2025-02-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h1><ul>
<li>ansible-core 2.16</li>
<li>Docker image python:3.12.3</li>
</ul>
<a href="/202308311109/" title="Ansible å®‰è£…éƒ¨ç½²å‚è€ƒ">Ansible å®‰è£…éƒ¨ç½²å‚è€ƒ</a>  

<a href="/202405241042/" title="Ansible templates ä½¿ç”¨ä»‹ç»">Ansible templates ä½¿ç”¨ä»‹ç»</a>  

<h1 id="Ansible-Playbook-è¯­æ³•"><a href="#Ansible-Playbook-è¯­æ³•" class="headerlink" title="Ansible Playbook è¯­æ³•"></a>Ansible Playbook è¯­æ³•</h1><p>Playbooks ä½¿ç”¨ YAML è¯­æ³•å®šä¹‰ï¼ˆæè¿°ï¼‰ã€‚ä¸€ä¸ª <code>playbook</code> ç”±ä¸€ä¸ªæˆ–å¤šä¸ª <code>play</code> ä¾åºç»„æˆã€‚æ¯ä¸ª <code>play</code> è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ª <code>task</code>ï¼Œæ¯ä¸ª <code>task</code> ä¹Ÿç§°ä¸ºä¸€ä¸ª <code>module</code></p>
<p>æ¯ä¸€ä¸ª <code>play</code> ä¸­åŒ…å«äº†ä¸€ä¸ª <code>tasks</code> åˆ—è¡¨ï¼Œ<code>tasks</code> åˆ—è¡¨ä¸­çš„æ¯ä¸ª <code>task</code> åœ¨å…¶å¯¹åº”çš„ <code>hosts</code> ä¸Š <em><strong>ä¾æ¬¡æ‰§è¡Œ</strong></em>ã€‚<strong>å³ä¸€ä¸ª <code>task</code> æ‰§è¡Œå®Œæ¯•ï¼Œä¸‹ä¸€ä¸ª <code>task</code> æ‰ä¼šæ‰§è¡Œ</strong>ã€‚</p>
<p>åœ¨è¿è¡Œ playbook çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>å¦‚æœä¸€ä¸ª <code>host</code> æ‰§è¡Œ <code>task</code> å¤±è´¥ï¼Œè¿™ä¸ª <code>host</code> å°†ä»æ•´ä¸ª playbook ä¸­ç§»é™¤</strong>ã€‚å¦‚æœå‘ç”Ÿæ‰§è¡Œå¤±è´¥çš„æƒ…å†µï¼Œéœ€è¦ä¿®æ­£ <code>playbook</code> ä¸­çš„é”™è¯¯ï¼Œé‡æ–°æ‰§è¡Œã€‚</p>
<p>Ansible playbook ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><figcaption><span>playbook.yml</span></figcaption><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">- name: Update web servers</span><br><span class="line">  hosts: webservers</span><br><span class="line">  remote_user: root</span><br><span class="line"></span><br><span class="line">  tasks:</span><br><span class="line">  - name: Ensure apache is at the latest version</span><br><span class="line">    ansible.builtin.yum:</span><br><span class="line">      name: httpd</span><br><span class="line">      state: latest</span><br><span class="line"></span><br><span class="line">  - name: Write the apache config file</span><br><span class="line">    ansible.builtin.template:</span><br><span class="line">      src: /srv/httpd.j2</span><br><span class="line">      dest: /etc/httpd.conf</span><br><span class="line"></span><br><span class="line">- name: Update db servers</span><br><span class="line">  hosts: databases</span><br><span class="line">  remote_user: root</span><br><span class="line">  vars:</span><br><span class="line">    port: 8080</span><br><span class="line"></span><br><span class="line">  tasks:</span><br><span class="line">  - name: Ensure postgresql is at the latest version</span><br><span class="line">    ansible.builtin.yum:</span><br><span class="line">      name: postgresql</span><br><span class="line">      state: latest</span><br><span class="line"></span><br><span class="line">  - name: Ensure that postgresql is started</span><br><span class="line">    ansible.builtin.service:</span><br><span class="line">      name: postgresql</span><br><span class="line">      state: started</span><br><span class="line">      </span><br><span class="line">---</span><br><span class="line">- name: Install multiple packages</span><br><span class="line">  hosts: webservers</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Install packages</span><br><span class="line">      apt:</span><br><span class="line">        name: &quot;&#123;&#123; item &#125;&#125;&quot;</span><br><span class="line">        state: present</span><br><span class="line">      loop:</span><br><span class="line">        - nginx</span><br><span class="line">        - git</span><br><span class="line">        - curl      </span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ª Ansible playbook ç”±ä¸€ä¸ªæˆ–å¤šä¸ª <code>plays</code> ç»„æˆï¼Œæ¯ä¸ª <code>play</code> åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š</p>
<ul>
<li><code>name</code> : æè¿°æ€§çš„åç§°</li>
<li><code>hosts</code> : æŒ‡å®šç›®æ ‡ä¸»æœº</li>
<li><code>become</code> : æå‡æƒé™ï¼ˆé»˜è®¤æ˜¯ä½¿ç”¨ <code>sudo</code> æå‡åˆ° <code>root</code> ç”¨æˆ·ï¼‰</li>
<li><code>remote_user</code> : ç”¨äºè¿æ¥åˆ°è¿œç¨‹ä¸»æœºçš„è´¦æˆ·ã€‚(<strong>å¦‚æœ Inventory ä¸­å®šä¹‰äº†è¿œç¨‹è¿æ¥çš„ç”¨æˆ·ï¼Œä¼šè¦†ç›–æ­¤å¤„çš„é…ç½®</strong>)</li>
<li><code>tasks</code> : è¦æ‰§è¡Œçš„ä¸€ç³»åˆ—ä»»åŠ¡åˆ—è¡¨</li>
<li><code>vars</code> : ç”¨äºå®šä¹‰å˜é‡ï¼Œä¾¿äºç®¡ç†å’Œé‡ç”¨</li>
<li><code>gather_facts</code> : æ”¶é›† <code>Facts</code>ï¼Œ é»˜è®¤å€¼ä¸º <code>yes</code></li>
</ul>
<p><code>tasks</code> æ˜¯ä¸€ä¸ªä»»åŠ¡åˆ—è¡¨ï¼Œæ¯ä¸ªä»»åŠ¡æ‰§è¡Œç‰¹å®šçš„æ“ä½œã€‚ä»»åŠ¡åŒ…å«ä»¥ä¸‹å…ƒç´ ï¼š</p>
<ul>
<li><code>name</code> : æè¿°ä»»åŠ¡çš„ç›®çš„ã€‚</li>
<li><code>module_name</code> : Ansible æ¨¡å—åç§°ï¼Œå¦‚ <code>apt</code>ã€<code>service</code> ç­‰ã€‚</li>
<li><code>module_options</code> : æ¨¡å—çš„å‚æ•°ï¼Œä»¥é”®å€¼å¯¹çš„å½¢å¼æä¾›ã€‚</li>
<li><code>when</code> : æ¡ä»¶è¯­å¥ï¼Œæ§åˆ¶ä»»åŠ¡æ˜¯å¦æ‰§è¡Œã€‚</li>
<li><code>loop</code> : å¾ªç¯æ‰§è¡Œä»»åŠ¡</li>
</ul>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿è¡Œ <code>playbook.yml</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ansible-playbook playbook.yml -f 10</span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨é€‰é¡¹è¯´æ˜</p>
<table>
<thead>
<tr>
<th>é€‰é¡¹</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>-f</code><br/><code>--forks</code></td>
<td>æŒ‡å®šå¹¶å‘æ‰§è¡Œçš„æ•°é‡ï¼Œé»˜è®¤ä¸º 5</td>
<td></td>
</tr>
<tr>
<td><code>-v</code><br/><code>--verbose</code> <br/><code>-vvvvvv</code></td>
<td>æ‰“å° debug ä¿¡æ¯ï¼Œè¯¦ç»†ç¨‹åº¦ä» <code>-v</code> åˆ° <code>-vvvvvv</code></td>
<td></td>
</tr>
<tr>
<td><code>-C</code><br/><code>--check</code></td>
<td><code>Check mode</code>ï¼Œä¸æ‰§è¡Œä»»ä½•å®é™…æ“ä½œï¼Œè€Œæ˜¯å¯¹è¦æ‰§è¡Œçš„æ“ä½œè¿›è¡ŒéªŒè¯</td>
<td></td>
</tr>
<tr>
<td><code>-D</code><br/><code>--diff</code></td>
<td>- <strong>åªä½¿ç”¨ <code>--diff</code> ä¼šæ‰§è¡Œ play å®šä¹‰çš„å®é™…æ“ä½œ</strong>ï¼Œå¹¶å¯¹æ‰€æœ‰å—å½±å“çš„æ–‡ä»¶æˆ–è€…æ¨¡æ¿æ˜¾ç¤ºå…¶å˜æ›´å‰åçš„å…·ä½“å·®å¼‚<br/>- <strong>å’Œ <code>--check</code> ä¸€èµ·ä½¿ç”¨ï¼Œä¸ä¼šæ‰§è¡Œ play å®šä¹‰çš„å®é™…æ“ä½œï¼Œåªæ˜¾ç¤ºå˜æ›´å‰åçš„å·®å¼‚</strong>ï¼Œå¯ä»¥åœ¨å®é™…æ‰§è¡Œå‰ï¼Œè°ƒè¯•&#x2F;é¢„è§ˆå°†è¦è¿›è¡Œçš„å˜æ›´ï¼Œé˜²æ­¢æ„å¤–é…ç½®å˜æ›´æˆ–æ–‡ä»¶ä¿®æ”¹<br/>ä¸»è¦ç”¨äºæ–‡ä»¶æˆ–è€…æ¨¡æ¿çš„å˜æ›´ï¼Œå¯¹äºå…¶ä»–ç±»å‹çš„ä»»åŠ¡ï¼ˆå¦‚åŒ…å®‰è£…ã€æœåŠ¡ç®¡ç†ã€ä¿®æ”¹ä¸»æœºåç­‰ï¼‰ï¼Œä¸ä¼šæ˜¾ç¤ºå…·ä½“çš„å·®å¼‚ï¼ˆ <strong>é…åˆ <code>--check</code> ä½¿ç”¨æ—¶ï¼Œç»“æœä¼šæ˜¾ç¤ºä¸º <code>skipping</code>ï¼Œå®é™…æ‰§è¡Œæ—¶ç»“æœä¸º <code>changed</code></strong> ï¼‰ã€‚</td>
<td></td>
</tr>
<tr>
<td><code>--list-hosts</code></td>
<td>ä¸æ‰§è¡Œä»»ä½•å®é™…æ“ä½œï¼Œåªåˆ—å‡ºç¬¦åˆ <code>pattern</code> çš„ç›®æ ‡ä¸»æœº</td>
<td></td>
</tr>
<tr>
<td><code>--list-tasks</code></td>
<td>ä¸æ‰§è¡Œä»»ä½•å®é™…æ“ä½œï¼Œåªåˆ—å‡ºå°†è¦æ‰§è¡Œçš„ <code>task</code></td>
<td></td>
</tr>
<tr>
<td><code>--syntax-check</code></td>
<td>ä¸æ‰§è¡Œä»»ä½•å®é™…æ“ä½œï¼Œåªæ£€æŸ¥ playbook æ–‡ä»¶æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯</td>
<td></td>
</tr>
</tbody></table>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="202405231459/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202308311739/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="å¾— èƒ½ è« å¿˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="202308311739/" class="post-title-link" itemprop="url">Linux sudo ä½¿ç”¨ä»‹ç»</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-08-31 11:09:16" itemprop="dateCreated datePublished" datetime="2023-08-31T11:09:16+08:00">2023-08-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-02-11 16:02:00" itemprop="dateModified" datetime="2025-02-11T16:02:00+08:00">2025-02-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">ä¸Šå±‚ç›®å½•</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><strong>ç¯å¢ƒä¿¡æ¯</strong></p>
<ul>
<li>Centos 7</li>
</ul>
<p><code>sudo</code> å¯ä»¥é…ç½®é€‚å½“çš„æƒé™æˆäºˆæ™®é€šç”¨æˆ·ï¼Œä½¿æ™®é€šç”¨æˆ·æ‰§è¡Œ <code>root</code> ç”¨æˆ·æ‰èƒ½æ‰§è¡Œçš„æ“ä½œ</p>
<p>é…ç½® <code>sudo</code> æƒé™çš„ä¸»è¦é…ç½®æ–‡ä»¶ä¸º <code>/etc/sudoers</code>ã€‚<code>/etc/sudoers</code>æ˜¯ä¸€ä¸ªåªè¯»æ–‡ä»¶ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ <code>vim</code> ç­‰ç¼–è¾‘å™¨æ¥ç¼–è¾‘ï¼Œè¦ä¿®æ”¹æ­¤æ–‡ä»¶ï¼Œéœ€è¦ä»¥ <code>root</code> ç”¨æˆ·èº«ä»½ä½¿ç”¨ <code>visudo</code> å‘½ä»¤æ¥ä¿®æ”¹ã€‚</p>
<p>ä¸»è¦é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p>
<figure class="highlight shell"><figcaption><span>/etc/sudoers</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Allow root to run any commands anywhere</span></span></span><br><span class="line">root    ALL=(ALL)       ALL</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">wheel  ALL=(ALL)       NOPASSWD: ALL</span></span><br></pre></td></tr></table></figure>

<p>å„åˆ—å€¼å«ä¹‰è¯´æ˜ï¼š</p>
<ul>
<li><code>root</code> ç¬¬ä¸€åˆ—ä¸ºç”¨æˆ·åï¼Œå¦‚ <code>root</code>ã€<code>users</code>ï¼›<code>%wheel</code> ä»¥ <code>%</code> å¼€å¤´è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç»„ï¼Œè€Œä¸æ˜¯ç”¨æˆ·</li>
<li><code>ALL=(ALL)</code> ç¬¬äºŒåˆ—ç­‰å·å·¦è¾¹çš„ <code>ALL</code> è¡¨ç¤ºå…è®¸ä»ä»»ä½•ä¸»æœºç™»å½•å½“å‰çš„ç”¨æˆ·è´¦æˆ·ï¼›ç­‰å·å³è¾¹çš„ <code>ALL</code> è¡¨ç¤ºç¬¬ä¸€åˆ—çš„ç”¨æˆ·å¯ä»¥åˆ‡æ¢æˆç³»ç»Ÿä¸­ä»»ä½•ä¸€ä¸ªå…¶å®ƒç”¨æˆ·ï¼ˆå¦‚ï¼š<code>su users</code>ï¼‰ï¼›</li>
<li><code>ALL</code> ç¬¬ä¸‰åˆ—è¡¨ç¤ºç¬¬ä¸€åˆ—çš„ç”¨æˆ·èƒ½ä¸‹è¾¾çš„å‘½ä»¤ï¼Œ<code>ALL</code> è¡¨ç¤ºå¯ä»¥ä¸‹è¾¾ä»»ä½•å‘½ä»¤ã€‚<code>NOPASSWD: ALL</code> æ„å‘³ç€æˆå‘˜å¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤è€Œæ— éœ€è¾“å…¥å¯†ç ã€‚</li>
</ul>
<p>å½“æˆ‘ä»¬ä»¥æ™®é€šç”¨æˆ·èº«ä»½ï¼ˆä»¥ <code>test</code> ä¸ºä¾‹ï¼‰ç™»å½•ï¼Œåœ¨ä½¿ç”¨ <code>sudo</code> å‘½ä»¤æ—¶æŠ¥å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<p><code>test is not in the sudoers file.  This incident will be reported.</code></p>
<p>åˆ™è¯´æ˜è¯¥ç”¨æˆ·æ²¡æœ‰åœ¨ <code>/etc/sudoers</code> æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨ <code>sudo</code> å‘½ä»¤</p>
<p>AWS çš„ Centos é•œåƒéƒ¨ç½²åçš„è™šæ‹Ÿæœºé»˜è®¤ä½¿ç”¨ <code>centos</code> ç”¨æˆ·ç™»é™†ï¼Œç™»é™†åå³å¯æ‰§è¡Œ <code>sudo su -</code> åˆ‡æ¢åˆ° <code>root</code> ç”¨æˆ·ï¼Œæ­¤é…ç½®ç”± <code> /etc/sudoers.d/90-cloud-init-users</code> é…ç½®ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><figcaption><span>/etc/sudoers.d/90-cloud-init-users</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /etc/sudoers.d/90-cloud-init-users</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Created by cloud-init v. 19.4 on Mon, 31 Oct 2022 07:58:58 +0000</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">User rules <span class="keyword">for</span> centos</span></span><br><span class="line">centos ALL=(ALL) NOPASSWD:ALL</span><br></pre></td></tr></table></figure>
<p>è‹¥è¦ç¦æ­¢æ­¤è¡Œä¸ºï¼Œåˆ é™¤æ­¤æ–‡ä»¶å³å¯ã€‚</p>
<h1 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h1><h2 id="é™åˆ¶ç‰¹å®šç”¨æˆ·åªèƒ½æ‰§è¡ŒæŒ‡å®šç›®å½•ä¸‹çš„è„šæœ¬"><a href="#é™åˆ¶ç‰¹å®šç”¨æˆ·åªèƒ½æ‰§è¡ŒæŒ‡å®šç›®å½•ä¸‹çš„è„šæœ¬" class="headerlink" title="é™åˆ¶ç‰¹å®šç”¨æˆ·åªèƒ½æ‰§è¡ŒæŒ‡å®šç›®å½•ä¸‹çš„è„šæœ¬"></a>é™åˆ¶ç‰¹å®šç”¨æˆ·åªèƒ½æ‰§è¡ŒæŒ‡å®šç›®å½•ä¸‹çš„è„šæœ¬</h2><p>åœ¨ <code>visudo</code> ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>Cmnd_Alias</code> é™åˆ¶ç”¨æˆ·åªèƒ½æ‰§è¡Œç‰¹å®šç›®å½•ä¸‹çš„è„šæœ¬ã€‚å‡è®¾ä½ æƒ³è®©ç”¨æˆ· <code>centos</code> åªèƒ½æ‰§è¡Œ <code>/usr/local/scripts/</code> ç›®å½•ä¸‹çš„è„šæœ¬ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼é…ç½®ï¼š</p>
<figure class="highlight shell"><figcaption><span>visudo</span></figcaption><table><tr><td class="code"><pre><span class="line">Cmnd_Alias ALLOWED_SCRIPTS = /usr/local/scripts/*</span><br><span class="line"></span><br><span class="line">centos ALL=(ALL) NOPASSWD: ALLOWED_SCRIPTS</span><br></pre></td></tr></table></figure>
<p><strong>å«ä¹‰</strong> ï¼š</p>
<ul>
<li><p><strong>Cmnd_Alias ALLOWED_SCRIPTS &#x3D; &#x2F;usr&#x2F;local&#x2F;scripts&#x2F;</strong>*</p>
<p>  å®šä¹‰ <code>ALLOWED_SCRIPTS</code> ï¼Œè¡¨ç¤º <strong>å…è®¸æ‰§è¡Œ &#x2F;usr&#x2F;local&#x2F;scripts&#x2F; ç›®å½•ä¸‹çš„æ‰€æœ‰è„šæœ¬</strong> ã€‚</p>
</li>
<li><p><strong>qqc ALL&#x3D;(ALL) NOPASSWD: ALLOWED_SCRIPTS</strong></p>
<p>  å…è®¸ <code>centos</code> ç”¨æˆ·ä»¥ <code>sudo</code> æ‰§è¡Œ <code>ALLOWED_SCRIPTS</code> ç›®å½•ä¸‹çš„æ‰€æœ‰è„šæœ¬ï¼Œä¸”æ— éœ€è¾“å…¥å¯†ç ã€‚</p>
</li>
</ul>
<p>åˆ‡æ¢åˆ° <code>centos</code> ç”¨æˆ·ï¼Œå¹¶å°è¯•æ‰§è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo /usr/local/scripts/test.sh</span><br></pre></td></tr></table></figure>
<p><strong>æˆåŠŸæ‰§è¡Œ</strong> ï¼Œè¯´æ˜è§„åˆ™ç”Ÿæ•ˆã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœ <code>centos</code> ç”¨æˆ· <strong>è¯•å›¾è¿è¡Œ <code>/bin/bash</code> æˆ– <code>/usr/bin/python</code> ï¼Œæˆ–è€…è®¿é—®å…¶ä»–è·¯å¾„</strong> ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo /bin/bash</span></span><br><span class="line">Sorry, user centos is not allowed to execute &#x27;/bin/bash&#x27; as root on this host.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœå¸Œæœ› <code>centos</code> ç”¨æˆ·å¯ä»¥æŸ¥çœ‹è‡ªå·±å¯ä»¥è¿è¡Œçš„å‘½ä»¤ï¼š</strong></p>
<figure class="highlight shell"><figcaption><span>visudo</span></figcaption><table><tr><td class="code"><pre><span class="line">Cmnd_Alias ALLOWED_SCRIPTS = /usr/local/scripts/*</span><br><span class="line">qqc ALL=(ALL) NOPASSWD: ALLOWED_SCRIPTS, /usr/bin/sudo -l</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œ<code>centos</code> ç”¨æˆ·å¯ä»¥è¿è¡Œ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure>
<p>æ¥æŸ¥çœ‹è‡ªå·±è¢«å…è®¸çš„ <code>sudo</code> å‘½ä»¤ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="page/13/">13</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">COSMOS</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.3" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="js/comments.js"></script><script src="js/utils.js"></script><script src="js/motion.js"></script><script src="js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="js/third-party/search/local-search.js"></script>




  <script src="js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"fl9999","repo":"fl9999.github.io","client_id":"a11bf6f7860762b725b5","client_secret":"a99046105f8bddc72ec718d54dc3fd7f22070821","admin_user":"fl9999","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d41d8cd98f00b204e9800998ecf8427e"}</script>
<script src="js/third-party/comments/gitalk.js"></script>

</body>
</html>
