<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16-next.png">
  <link rel="mask-icon" href="../images/logo.svg" color="#222">

<link rel="stylesheet" href="../css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"csms.tech","root":"/","images":"../images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"../search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="../js/config.js"></script>

    <meta name="description" content="环境信息 elasticsearch 8.8.2  集群状态查看集群健康状态Elasticsearch 的集群监控信息中包含了许多的统计数据，其中最为重要的一项就是 集群健康 ， 它在 status 字段中展示为 green 、 yellow 或者 red 。  green - 所有的主分片和副分片都正常运行 yellow - 所有主分片都正常运行，但不是所有的副本分片都正常运行 red - 有主">
<meta property="og:type" content="article">
<meta property="og:title" content="elasticsearch 常用 endpoint">
<meta property="og:url" content="http://csms.tech/202307281032/index.html">
<meta property="og:site_name" content="L B T">
<meta property="og:description" content="环境信息 elasticsearch 8.8.2  集群状态查看集群健康状态Elasticsearch 的集群监控信息中包含了许多的统计数据，其中最为重要的一项就是 集群健康 ， 它在 status 字段中展示为 green 、 yellow 或者 red 。  green - 所有的主分片和副分片都正常运行 yellow - 所有主分片都正常运行，但不是所有的副本分片都正常运行 red - 有主">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-07-28T02:32:51.000Z">
<meta property="article:modified_time" content="2023-07-28T02:32:55.000Z">
<meta property="article:author" content="COSMOS">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://csms.tech/202307281032/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://csms.tech/202307281032/","path":"202307281032/","title":"elasticsearch 常用 endpoint"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>elasticsearch 常用 endpoint | L B T</title>
  








  <noscript>
    <link rel="stylesheet" href="../css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">L B T</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记 录 过 去 的 经 验</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="../index.html" rel="section"><i class="fa fa-earth-americas fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="../categories/" rel="section"><i class="fa fa-folder-tree fa-fw"></i>总目录<span class="badge">51</span></a></li><li class="menu-item menu-item-linux"><a href="../categories/Linux" rel="section"><i class="fa fa-brands fa-linux fa-fw"></i>Linux</a></li><li class="menu-item menu-item-python"><a href="../categories/Python" rel="section"><i class="fa fa-brands fa-python fa-fw"></i>Python</a></li><li class="menu-item menu-item-docker"><a href="../categories/Docker" rel="section"><i class="fa fa-brands fa-docker fa-fw"></i>Docker</a></li><li class="menu-item menu-item-kubernetes"><a href="../categories/Kubernetes" rel="section"><i class="fa fa-dharmachakra fa-fw"></i>Kubernetes</a></li><li class="menu-item menu-item-tags"><a href="../tags/" rel="section"><i class="fa fa-tornado fa-fw"></i>标签<span class="badge">78</span></a></li><li class="menu-item menu-item-archives"><a href="../archives/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>列表<span class="badge">250</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章总目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF"><span class="nav-number">1.</span> <span class="nav-text">环境信息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81"><span class="nav-number">2.</span> <span class="nav-text">集群状态</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E5%81%A5%E5%BA%B7%E7%8A%B6%E6%80%81"><span class="nav-number">2.1.</span> <span class="nav-text">查看集群健康状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E4%BF%A1%E6%81%AF"><span class="nav-number">2.2.</span> <span class="nav-text">查看集群节点信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E9%9B%86%E7%BE%A4%E7%BA%A7%E5%88%AB%E7%9A%84%E4%BF%A1%E6%81%AF%E5%92%8C%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE"><span class="nav-number">2.3.</span> <span class="nav-text">获取集群级别的信息和统计数据</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E5%8F%8A%E6%96%87%E6%A1%A3%E7%AE%A1%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">索引及文档管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%88%96%E8%80%85%E6%B7%BB%E5%8A%A0%E7%B4%A2%E5%BC%95"><span class="nav-number">3.1.</span> <span class="nav-text">创建或者添加索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E6%95%B4%E5%88%86%E7%89%87%E7%9A%84%E5%89%AF%E6%9C%AC%E6%95%B0%E9%87%8F"><span class="nav-number">3.2.</span> <span class="nav-text">调整分片的副本数量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E4%B8%AD%E6%89%80%E6%9C%89%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="nav-number">3.3.</span> <span class="nav-text">查看集群中所有的索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E6%96%87%E6%A1%A3"><span class="nav-number">3.4.</span> <span class="nav-text">索引文档</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89-ID-%E7%B4%A2%E5%BC%95%E6%96%87%E6%A1%A3"><span class="nav-number">3.4.1.</span> <span class="nav-text">使用自定义 ID 索引文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Elasticsearch-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90-ID"><span class="nav-number">3.4.2.</span> <span class="nav-text">Elasticsearch 自动生成 ID</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%96%E5%9B%9E%E4%B8%80%E4%B8%AA%E6%96%87%E6%A1%A3"><span class="nav-number">3.5.</span> <span class="nav-text">取回一个文档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96-Elasticsearch-%E4%B8%AD%E6%89%80%E6%9C%89%E7%9A%84%E6%96%87%E6%A1%A3"><span class="nav-number">3.6.</span> <span class="nav-text">获取 Elasticsearch 中所有的文档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E7%B4%A2%E5%BC%95%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89%E6%96%87%E6%A1%A3"><span class="nav-number">3.7.</span> <span class="nav-text">获取指定索引下的所有文档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%A4%9A%E4%B8%AA%E6%8C%87%E5%AE%9A%E7%B4%A2%E5%BC%95%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89%E6%96%87%E6%A1%A3"><span class="nav-number">3.8.</span> <span class="nav-text">获取多个指定索引下的所有文档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E9%A1%B5%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C"><span class="nav-number">3.9.</span> <span class="nav-text">分页搜索结果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E6%96%87%E6%A1%A3%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="nav-number">3.10.</span> <span class="nav-text">检查文档是否存在</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%96%87%E6%A1%A3%E4%B8%AD%E6%8C%87%E5%AE%9A%E7%9A%84%E5%AD%97%E6%AE%B5"><span class="nav-number">3.11.</span> <span class="nav-text">获取文档中指定的字段</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#data-stream"><span class="nav-number">4.</span> <span class="nav-text">data stream</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4-data-stream"><span class="nav-number">4.1.</span> <span class="nav-text">删除 data stream</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E7%9A%84-data-stream"><span class="nav-number">4.2.</span> <span class="nav-text">查看所有的 data stream</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#user-and-role"><span class="nav-number">5.</span> <span class="nav-text">user and role</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B-Elasticsearch-%E4%B8%AD%E6%89%80%E6%9C%89%E7%9A%84%E7%94%A8%E6%88%B7"><span class="nav-number">5.1.</span> <span class="nav-text">查看 Elasticsearch 中所有的用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E7%BD%AE%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="nav-number">5.2.</span> <span class="nav-text">重置用户密码</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="nav-number">6.</span> <span class="nav-text">参考链接</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%84%9A%E6%B3%A8"><span class="nav-number">7.</span> <span class="nav-text">脚注</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">COSMOS</p>
  <div class="site-description" itemprop="description">得 能 莫 忘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="../archives/">
          <span class="site-state-item-count">250</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="../categories/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">目录</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="../tags/">
        <span class="site-state-item-count">78</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202307281032/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="elasticsearch 常用 endpoint | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          elasticsearch 常用 endpoint
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-07-28 10:32:51 / 修改时间：10:32:55" itemprop="dateCreated datePublished" datetime="2023-07-28T10:32:51+08:00">2023-07-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../categories/Linux/ELK/" itemprop="url" rel="index"><span itemprop="name">ELK</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>elasticsearch 8.8.2</li>
</ul>
<h1 id="集群状态"><a href="#集群状态" class="headerlink" title="集群状态"></a>集群状态</h1><h2 id="查看集群健康状态"><a href="#查看集群健康状态" class="headerlink" title="查看集群健康状态"></a>查看集群健康状态</h2><p>Elasticsearch 的集群监控信息中包含了许多的统计数据，其中最为重要的一项就是 <em><strong>集群健康</strong></em> ， 它在 <code>status</code> 字段中展示为 <code>green</code> 、 <code>yellow</code> 或者 <code>red</code> 。</p>
<ul>
<li><code>green</code> - 所有的主分片和副分片都正常运行</li>
<li><code>yellow</code> - 所有主分片都正常运行，但<strong>不是所有的副本分片都正常运行</strong></li>
<li><code>red</code> - <strong>有主分片没能正常运行</strong></li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/_add-an-index.html"><code>分片</code> 概念说明</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl <span class="string">&#x27;http://localhost:9200/_cluster/health&#x27;</span></span></span><br><span class="line">&#123;&quot;cluster_name&quot;:&quot;elasticsearch&quot;,&quot;status&quot;:&quot;green&quot;,&quot;timed_out&quot;:false,&quot;number_of_nodes&quot;:1,&quot;number_of_data_nodes&quot;:1,&quot;active_primary_shards&quot;:1,&quot;active_shards&quot;:1,&quot;relocating_shards&quot;:0,&quot;initializing_shards&quot;:0,&quot;unassigned_shards&quot;:0,&quot;delayed_unassigned_shards&quot;:0,&quot;number_of_pending_tasks&quot;:0,&quot;number_of_in_flight_fetch&quot;:0,&quot;task_max_waiting_in_queue_millis&quot;:0,&quot;active_shards_percent_as_number&quot;:100.0&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl <span class="string">&#x27;http://localhost:9200/_cluster/health?pretty&#x27;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;cluster_name&quot; : &quot;elasticsearch&quot;,</span><br><span class="line">  &quot;status&quot; : &quot;green&quot;,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;number_of_nodes&quot; : 1,</span><br><span class="line">  &quot;number_of_data_nodes&quot; : 1,</span><br><span class="line">  &quot;active_primary_shards&quot; : 1,</span><br><span class="line">  &quot;active_shards&quot; : 1,</span><br><span class="line">  &quot;relocating_shards&quot; : 0,</span><br><span class="line">  &quot;initializing_shards&quot; : 0,</span><br><span class="line">  &quot;unassigned_shards&quot; : 0,</span><br><span class="line">  &quot;delayed_unassigned_shards&quot; : 0,</span><br><span class="line">  &quot;number_of_pending_tasks&quot; : 0,</span><br><span class="line">  &quot;number_of_in_flight_fetch&quot; : 0,</span><br><span class="line">  &quot;task_max_waiting_in_queue_millis&quot; : 0,</span><br><span class="line">  &quot;active_shards_percent_as_number&quot; : 100.0</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="查看集群节点信息"><a href="#查看集群节点信息" class="headerlink" title="查看集群节点信息"></a>查看集群节点信息</h2><p>使用 <code>_cat/nodes</code> API 可以获取集群中所有节点的信息，包括它们的 IP 地址、堆内存使用情况、CPU 使用情况等。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">curl -u elastic:XhScf5Jqw -XGET <span class="string">&#x27;http://172.31.25.229:9200/_cat/nodes?pretty&#x27;</span></span></span><br><span class="line">172.31.25.229 58 98  9 1.86 2.27 2.36 dilm    - node-1</span><br><span class="line">172.31.30.249 54 98 10 2.05 2.12 2.30 dilm    - node-2</span><br><span class="line">172.31.21.225 65 91  0 0.00 0.04 0.05 dfilmrt * node-3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">curl -u elastic:XhScf5Jqw -XGET <span class="string">&#x27;http://172.31.25.229:9200/_cat/nodes?v&#x27;</span></span></span><br><span class="line">ip            heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name</span><br><span class="line">172.31.25.229           51          99  10    2.11    2.33     2.37 dilm      -      node-1</span><br><span class="line">172.31.30.249           49          99   9    1.96    2.06     2.25 dilm      -      node-2</span><br><span class="line">172.31.21.225           40          91   0    0.03    0.04     0.05 dfilmrt   *      node-3</span><br></pre></td></tr></table></figure>

<p>输出信息说明</p>
<ul>
<li><code>heap.percent</code> - JVM 堆内存使用的百分比。这是节点分配给 Java 虚拟机堆的内存使用量的百分比。</li>
<li><code>ram.percent</code> - 节点的物理内存（RAM）使用率的百分比</li>
<li><code>cpu</code> - 节点的CPU使用率百分比</li>
<li><code>node.role</code> - 节点的角色。各个字母含义如下<ul>
<li><code>d</code> - 代表数据节点 Data Node。负责存储数据，执行与数据相关的操作，如 CRUD（创建、读取、更新、删除）、搜索和聚合。</li>
<li><code>i</code> - 代表摄取节点 Ingest Node。用于预处理文档，然后再将其索引到 Elasticsearch 中，它们可以运行摄取管道，这些管道可以执行各种转换，如提取数据、转换数据格式、添加信息等。</li>
<li><code>l</code> - 代表机器学习节点 Machine Learning Node。机器学习节点专门用于运行Elasticsearch的机器学习功能，它们可以分析数据，识别模式，执行异常检测等。</li>
<li><code>m</code> - 代表主节点 Master Node。主节点负责管理集群的全局状态，例如哪些索引存在，哪个节点是哪个索引的一部分等，它们还负责集群重新分片、索引创建、删除等操作。</li>
<li><code>r</code> - 代表远程集群客户端节点 Remote Cluster Client Node。这些节点用于连接到远程集群，它们使得可以从一个集群中执行跨集群搜索和其他操作</li>
<li><code>t</code> - 代表转换节点 Transform Node。转换节点用于运行 Elasticsearch 中的转换任务，这些任务可以将现有的 Elasticsearch 索引数据重新整理和汇总成新的索引。</li>
</ul>
</li>
<li><code>*</code> - 表示这个节点是当前的主节点。</li>
</ul>
<p>使用 <code>_nodes/stats</code> 查看集群中所有节点的详细状态和统计信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">curl -u elastic:XhScf5JqwVsSQwHe -XGET <span class="string">&#x27;http://172.31.25.229:9200/_nodes/stats?pretty&#x27;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;_nodes&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 3,</span><br><span class="line">    &quot;successful&quot; : 3,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;es-cluster&quot;,</span><br><span class="line">  &quot;nodes&quot; : &#123;</span><br><span class="line">    &quot;TrQqg_8HTDiKBt6t8Z1JVw&quot; : &#123;</span><br><span class="line">      &quot;timestamp&quot; : 1699941330544,</span><br><span class="line">      &quot;name&quot; : &quot;node-1&quot;,</span><br><span class="line">      &quot;transport_address&quot; : &quot;172.31.25.229:9300&quot;,</span><br><span class="line">      &quot;host&quot; : &quot;172.31.25.229&quot;,</span><br><span class="line">      &quot;ip&quot; : &quot;172.31.25.229:9300&quot;,</span><br><span class="line">      &quot;roles&quot; : [</span><br><span class="line">        &quot;ingest&quot;,</span><br><span class="line">        &quot;master&quot;,</span><br><span class="line">        &quot;data&quot;,</span><br><span class="line">        &quot;ml&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;attributes&quot; : &#123;</span><br><span class="line">        &quot;ml.machine_memory&quot; : &quot;133483876352&quot;,</span><br><span class="line">        &quot;xpack.installed&quot; : &quot;true&quot;,</span><br><span class="line">        &quot;ml.max_open_jobs&quot; : &quot;20&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;indices&quot; : &#123;</span><br><span class="line">        &quot;docs&quot; : &#123;</span><br><span class="line">          &quot;count&quot; : 1725702315,</span><br><span class="line">          &quot;deleted&quot; : 0</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;store&quot; : &#123;</span><br><span class="line">          &quot;size_in_bytes&quot; : 1766657662877</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;indexing&quot; : &#123;</span><br><span class="line">          &quot;index_total&quot; : 28053218,</span><br><span class="line">          &quot;index_time_in_millis&quot; : 6610781,</span><br><span class="line">          &quot;index_current&quot; : 1,</span><br><span class="line">          &quot;index_failed&quot; : 0,</span><br><span class="line">          &quot;delete_total&quot; : 0,</span><br><span class="line">          &quot;delete_time_in_millis&quot; : 0,</span><br><span class="line">          &quot;delete_current&quot; : 0,</span><br><span class="line">          &quot;noop_update_total&quot; : 0,</span><br><span class="line">          &quot;is_throttled&quot; : false,</span><br><span class="line">          &quot;throttle_time_in_millis&quot; : 0</span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<p>参考以下命令查看指定节点的详细状态和统计信息，Endpoint 格式参考 <code>_nodes/&#123;nodeId&#125;/stats?pretty</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">curl -u elastic:XhScf5JqwVsSQwHe -XGET <span class="string">&#x27;http://172.31.25.229:9200/_nodes/TrQqg_8HTDiKBt6t8Z1JVw/stats?pretty&#x27;</span></span> </span><br><span class="line">&#123;</span><br><span class="line">  &quot;_nodes&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 1,</span><br><span class="line">    &quot;successful&quot; : 1,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;es-cluster&quot;,</span><br><span class="line">  &quot;nodes&quot; : &#123;</span><br><span class="line">    &quot;TrQqg_8HTDiKBt6t8Z1JVw&quot; : &#123;</span><br><span class="line">      &quot;timestamp&quot; : 1699941591263,</span><br><span class="line">      &quot;name&quot; : &quot;node-1&quot;,</span><br><span class="line">      &quot;transport_address&quot; : &quot;172.31.25.229:9300&quot;,</span><br><span class="line">      &quot;host&quot; : &quot;172.31.25.229&quot;,</span><br><span class="line">      &quot;ip&quot; : &quot;172.31.25.229:9300&quot;,</span><br><span class="line">      &quot;roles&quot; : [</span><br><span class="line">        &quot;ingest&quot;,</span><br><span class="line">        &quot;master&quot;,</span><br><span class="line">        &quot;data&quot;,</span><br><span class="line">        &quot;ml&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;attributes&quot; : &#123;</span><br><span class="line">        &quot;ml.machine_memory&quot; : &quot;133483876352&quot;,</span><br><span class="line">        &quot;xpack.installed&quot; : &quot;true&quot;,</span><br><span class="line">        &quot;ml.max_open_jobs&quot; : &quot;20&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;indices&quot; : &#123;</span><br><span class="line">        &quot;docs&quot; : &#123;</span><br><span class="line">          &quot;count&quot; : 1726608289,</span><br><span class="line">          &quot;deleted&quot; : 0</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;store&quot; : &#123;</span><br><span class="line">          &quot;size_in_bytes&quot; : 1768415039992</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;indexing&quot; : &#123;</span><br><span class="line">          &quot;index_total&quot; : 29016441,</span><br><span class="line">          &quot;index_time_in_millis&quot; : 6829570,</span><br><span class="line">          &quot;index_current&quot; : 0,</span><br><span class="line">          &quot;index_failed&quot; : 0,</span><br><span class="line">          &quot;delete_total&quot; : 0,</span><br><span class="line">          &quot;delete_time_in_millis&quot; : 0,</span><br><span class="line">          &quot;delete_current&quot; : 0,</span><br><span class="line">          &quot;noop_update_total&quot; : 0,</span><br><span class="line">          &quot;is_throttled&quot; : false,</span><br><span class="line">          &quot;throttle_time_in_millis&quot; : 0</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="获取集群级别的信息和统计数据"><a href="#获取集群级别的信息和统计数据" class="headerlink" title="获取集群级别的信息和统计数据"></a>获取集群级别的信息和统计数据</h2><p><code>/?pretty</code> 参数的主要作用为通过<strong>添加缩进和换行增强输出的可读性</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl <span class="string">&#x27;http://localhost:9200/?pretty&#x27;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;b5f96e32c638&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;elasticsearch&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;UAiC0qVVT-Ov4nJFvoE1HA&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;8.8.2&quot;,</span><br><span class="line">    &quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot; : &quot;tar&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;98e1271edf932a480e4262a471281f1ee295ce6b&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2023-06-26T05:16:16.196344851Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;9.6.0&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot; : &quot;7.17.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot; : &quot;7.0.0&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h1 id="索引及文档管理"><a href="#索引及文档管理" class="headerlink" title="索引及文档管理"></a>索引及文档管理</h1><h2 id="创建或者添加索引"><a href="#创建或者添加索引" class="headerlink" title="创建或者添加索引"></a>创建或者添加索引</h2><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/_indexing_employee_documents.html"><strong>索引概念说明</strong></a>。<strong>索引(<code>index</code>)</strong> 在 Elasticsearch 中有多个含义 <sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[索引](https://www.elastic.co/guide/cn/elasticsearch/guide/current/_indexing_employee_documents.html)">[3]</span></a></sup></p>
<ul>
<li><p><code>索引（名词）</code>：</p>
<p>  一个 <strong>索引(<code>index</code>)</strong> 类似于传统关系数据库中的一个 <em>数据库</em> ，是一个存储关系型文档的地方。 <code>索引 (index)</code> 的复数词为 <code>indices</code> 或 <code>indexes</code>。</p>
</li>
<li><p><code>索引（动词）</code>：</p>
<p>  <em>索引一个文档</em> 就是存储一个文档到一个 <code>索引 （名词）</code>中以便被检索和查询。这非常类似于 SQL 语句中的 <code>INSERT</code> 关键词，除了文档已存在时，新文档会替换旧文档情况之外。</p>
</li>
<li><p><code>倒排索引</code>：</p>
<p>  关系型数据库通过增加一个 <strong>索引</strong> 比如一个 <code>B树（B-tree）索引</code> 到指定的列上，以便提升数据检索速度。Elasticsearch 和 Lucene 使用了一个叫做 <strong>倒排索引</strong> 的结构来达到相同的目的。</p>
</li>
</ul>
<p>使用以下 url 可以添加名为 <code>blogs</code> 的索引。在索引建立的时候就已经确定了<strong>主分片数</strong>，但是副分片数可以随时修改。<em><strong>索引在默认情况下会被分配 5 个主分片</strong></em>。以下示例演示了创建 3 个主分片和一份副本（每个主分片拥有一个副本）的 index</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PUT /blogs</span><br><span class="line">&#123;</span><br><span class="line">   &quot;settings&quot; : &#123;</span><br><span class="line">      &quot;number_of_shards&quot; : 3,</span><br><span class="line">      &quot;number_of_replicas&quot; : 1</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>curl</code> 命令操作如下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -X PUT <span class="string">&#x27;localhost:9200/blogs&#x27;</span> -H <span class="string">&quot;Content-Type: application/json&quot;</span> -d <span class="string">&#x27;&#123;&quot;settings&quot;: &#123;&quot;number_of_shards&quot;: 3, &quot;number_of_replicas&quot;: 1&#125;&#125;&#x27;</span></span></span><br><span class="line">&#123;&quot;acknowledged&quot;:true,&quot;shards_acknowledged&quot;:true,&quot;index&quot;:&quot;blogs&quot;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>重新查看集群 <em>健康状态</em></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl <span class="string">&#x27;localhost:9200/_cluster/health/?pretty&#x27;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;cluster_name&quot; : &quot;elasticsearch&quot;,</span><br><span class="line">  &quot;status&quot; : &quot;yellow&quot;,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;number_of_nodes&quot; : 1,</span><br><span class="line">  &quot;number_of_data_nodes&quot; : 1,</span><br><span class="line">  &quot;active_primary_shards&quot; : 4,</span><br><span class="line">  &quot;active_shards&quot; : 4,</span><br><span class="line">  &quot;relocating_shards&quot; : 0,</span><br><span class="line">  &quot;initializing_shards&quot; : 0,</span><br><span class="line">  &quot;unassigned_shards&quot; : 3,</span><br><span class="line">  &quot;delayed_unassigned_shards&quot; : 0,</span><br><span class="line">  &quot;number_of_pending_tasks&quot; : 0,</span><br><span class="line">  &quot;number_of_in_flight_fetch&quot; : 0,</span><br><span class="line">  &quot;task_max_waiting_in_queue_millis&quot; : 0,</span><br><span class="line">  &quot;active_shards_percent_as_number&quot; : 57.14285714285714</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>集群状态为 <code>yellow</code>。表示所有<strong>主分片</strong>都正常运行，但是 <em>副本分片</em>没有全部处于正常状态。本示例中使用的单节点集群，因此所有副本都处于 <code>unassigned_shards</code> 状态。</p>
<h2 id="调整分片的副本数量"><a href="#调整分片的副本数量" class="headerlink" title="调整分片的副本数量"></a>调整分片的副本数量</h2><p>在运行中的集群上是可以动态调整副本分片数目的，我们可以按需伸缩集群</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PUT /blogs/_settings</span><br><span class="line">&#123;</span><br><span class="line">   &quot;number_of_replicas&quot; : 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="查看集群中所有的索引"><a href="#查看集群中所有的索引" class="headerlink" title="查看集群中所有的索引"></a>查看集群中所有的索引</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">curl -u elastic:password1 -XGET <span class="string">&quot;http://localhost:9200/_cat/indices?pretty&quot;</span></span></span><br><span class="line">green open .fleet-file-data-endpoint-000001                             HvLnz66ATPu3y-V7_LWiGw 1 1   0 0   494b   247b</span><br><span class="line">green open .internal.alerts-observability.logs.alerts-default-000001    qLVSX-3jTNSEJ5TUei8xeg 1 1   0 0   494b   247b</span><br><span class="line">green open .internal.alerts-observability.metrics.alerts-default-000001 No3BDeiPSS-Fc9VLC1_Bmw 1 1   0 0   494b   247b</span><br><span class="line">green open .fleet-file-data-agent-000001                                8bD6W2sVROuRew13axuZtA 1 1   0 0   494b   247b</span><br><span class="line">green open metrics-endpoint.metadata_current_default                    BGeiP6xhT2ChBVlgGBDrGQ 1 1   0 0   494b   247b</span><br><span class="line">green open .internal.alerts-observability.slo.alerts-default-000001     8mwwuFYZRoKhEwnZgP-fAg 1 1   0 0   494b   247b</span><br><span class="line">green open .fleet-files-agent-000001                                    IPWzmYjyTCicpe92zEXVwg 1 1   0 0   494b   247b</span><br><span class="line">green open .ds-filebeat-8.8.2-2023.07.28-000001                         U3A3AD3-R2KjiYXJaApgRQ 1 1 100 0 62.2kb 31.1kb</span><br><span class="line">green open .fleet-files-endpoint-000001                                 NTH-qwe1R6aPNLZKoHu8Yg 1 1   0 0   494b   247b</span><br><span class="line">green open .internal.alerts-security.alerts-default-000001              FnDUGt2SQN2qd4aztKtYXQ 1 1   0 0   494b   247b</span><br><span class="line">green open .internal.alerts-observability.apm.alerts-default-000001     l-nS3wQtQ3KptM4b93mosA 1 1   0 0   494b   247b</span><br><span class="line">green open .internal.alerts-observability.uptime.alerts-default-000001  VD8sDy64TZSWW2ArhdrSjQ 1 1   0 0   494b   247b</span><br></pre></td></tr></table></figure>

<h2 id="索引文档"><a href="#索引文档" class="headerlink" title="索引文档"></a>索引文档</h2><p>我们可以提供自定义的 <code>_id</code> 值，或者让 <code>index</code> API 自动生成。 <sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[索引文档](https://www.elastic.co/guide/cn/elasticsearch/guide/current/index-doc.html#index-doc)">[4]</span></a></sup></p>
<h3 id="使用自定义-ID-索引文档"><a href="#使用自定义-ID-索引文档" class="headerlink" title="使用自定义 ID 索引文档"></a>使用自定义 ID 索引文档</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PUT /&#123;index&#125;/&#123;type&#125;/&#123;id&#125;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;field&quot;: &quot;value&quot;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>举个例子，如果我们的索引称为 website ，类型称为 blog ，并且选择 123 作为 ID ，那么索引请求应该是下面这样：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -X PUT <span class="string">&#x27;localhost:9200/website/_doc/123?pretty&#x27;</span> -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> -d <span class="string">&#x27;&#123;</span></span></span><br><span class="line">  &quot;title&quot;: &quot;My first blog entry&quot;,</span><br><span class="line">  &quot;text&quot;:  &quot;Just trying this out...&quot;,</span><br><span class="line">  &quot;date&quot;:  &quot;2014/01/01&quot;</span><br><span class="line">&#125;&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Elasticsearch 响应体如下所示：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;_index&quot; : &quot;website&quot;,</span><br><span class="line">  &quot;_id&quot; : &quot;123&quot;,</span><br><span class="line">  &quot;_version&quot; : 2,</span><br><span class="line">  &quot;result&quot; : &quot;updated&quot;,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 2,</span><br><span class="line">    &quot;successful&quot; : 1,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_seq_no&quot; : 1,</span><br><span class="line">  &quot;_primary_term&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>新版本中已经没有了 <code>&#123;type&#125;</code>  概念，已经废弃，可以使用 <code>_doc</code> 代替。否则报错</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -X PUT <span class="string">&#x27;localhost:9200/website/blog/123&#x27;</span> -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> -d <span class="string">&#x27;&#123;</span></span></span><br><span class="line">  &quot;title&quot;: &quot;My first blog entry&quot;,</span><br><span class="line">  &quot;text&quot;:  &quot;Just trying this out...&quot;,</span><br><span class="line">  &quot;date&quot;:  &quot;2014/01/01&quot;</span><br><span class="line">&#125;&#x27;</span><br><span class="line">&#123;&quot;error&quot;:&quot;no handler found for uri [/website/blog/123] and method [PUT]&quot;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Elasticsearch-自动生成-ID"><a href="#Elasticsearch-自动生成-ID" class="headerlink" title="Elasticsearch 自动生成 ID"></a>Elasticsearch 自动生成 ID</h3><p>如果你的数据没有自然的 ID， Elasticsearch 可以帮我们自动生成 ID 。 请求的结构调整为： 不再使用 <code>PUT</code> (<code>用这个 URL 存储这个文档</code>)， 而是使用 <code>POST</code> (<code>存储文档在这个 URL 命名空间下</code>)。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -X POST <span class="string">&#x27;localhost:9200/website/_doc/?pretty&#x27;</span> -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> -d <span class="string">&#x27;&#123;</span></span></span><br><span class="line">  &quot;title&quot;: &quot;My first blog entry&quot;,</span><br><span class="line">  &quot;text&quot;:  &quot;Just trying this out...&quot;,</span><br><span class="line">  &quot;date&quot;:  &quot;2014/01/01&quot;</span><br><span class="line">&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>除了 <code>_id</code> 是 Elasticsearch 自动生成的，响应的其他部分和 <a href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89-ID-%E7%B4%A2%E5%BC%95%E6%96%87%E6%A1%A3"><em>使用自定义 ID 索引文档</em></a> 的类似：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;_index&quot; : &quot;website&quot;,</span><br><span class="line">  &quot;_id&quot; : &quot;E6bZZ4kB3MyoSII6u2fy&quot;,</span><br><span class="line">  &quot;_version&quot; : 1,</span><br><span class="line">  &quot;result&quot; : &quot;created&quot;,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 2,</span><br><span class="line">    &quot;successful&quot; : 1,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_seq_no&quot; : 2,</span><br><span class="line">  &quot;_primary_term&quot; : 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="取回一个文档"><a href="#取回一个文档" class="headerlink" title="取回一个文档"></a>取回一个文档</h2><p>为了从 Elasticsearch 中检索出文档，我们仍然使用相同的 <code>_index</code> , <code>_type</code> , 和 <code>_id</code> ，但是 HTTP 方法更改为 <code>GET</code> <sup id="fnref:5"><a href="#fn:5" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[取回一个文档](https://www.elastic.co/guide/cn/elasticsearch/guide/current/get-doc.html)">[5]</span></a></sup></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"> curl <span class="string">&#x27;localhost:9200/website/_doc/123?pretty&#x27;</span></span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;_index&quot; : &quot;website&quot;,</span><br><span class="line">  &quot;_id&quot; : &quot;123&quot;,</span><br><span class="line">  &quot;_version&quot; : 2,</span><br><span class="line">  &quot;_seq_no&quot; : 1,</span><br><span class="line">  &quot;_primary_term&quot; : 1,</span><br><span class="line">  &quot;found&quot; : true,</span><br><span class="line">  &quot;_source&quot; : &#123;</span><br><span class="line">    &quot;title&quot; : &quot;My first blog entry&quot;,</span><br><span class="line">    &quot;text&quot; : &quot;Just trying this out...&quot;,</span><br><span class="line">    &quot;date&quot; : &quot;2014/01/01&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>响应体中 <code>found</code> 字段为 <code>true</code> 表示文档已经被找到， 如果我们请求一个不存在的文档，我们仍旧会得到一个 JSON 响应体，但是 <code>found</code> 将会是 <code>false</code> 。 此外， HTTP 响应码将会是 <code>404 Not Found</code> ，而不是 <code>200 OK</code></p>
<p>默认情况下，Elasticsearch 将会返回整个 <code>Document (文档)</code> ，也可以不获取整个 <code>Document (文档)</code> 而只是获取其中的一部分内容，要实现此功能，可以使用查询参数 <code>_source=title,text</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl <span class="string">&#x27;localhost:9200/website/_doc/123?pretty&amp;_source=title,text&#x27;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;_index&quot; : &quot;website&quot;,</span><br><span class="line">  &quot;_id&quot; : &quot;123&quot;,</span><br><span class="line">  &quot;_version&quot; : 2,</span><br><span class="line">  &quot;_seq_no&quot; : 1,</span><br><span class="line">  &quot;_primary_term&quot; : 1,</span><br><span class="line">  &quot;found&quot; : true,</span><br><span class="line">  &quot;_source&quot; : &#123;</span><br><span class="line">    &quot;title&quot; : &quot;My first blog entry&quot;,</span><br><span class="line">    &quot;text&quot; : &quot;Just trying this out...&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>或者，如果你只想得到 _source 字段，不需要任何元数据，你能使用 _source 端点：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">GET /website/blog/123/_source</span></span><br><span class="line">&#123;</span><br><span class="line">   &quot;title&quot;: &quot;My first blog entry&quot;,</span><br><span class="line">   &quot;text&quot;:  &quot;Just trying this out...&quot;,</span><br><span class="line">   &quot;date&quot;:  &quot;2014/01/01&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此方法新版本(elasticsearch 8.8.2)不存在</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl <span class="string">&#x27;localhost:9200/website/_doc/123/_source&#x27;</span></span></span><br><span class="line">&#123;&quot;error&quot;:&quot;no handler found for uri [/website/_doc/123/_source] and method [GET]&quot;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="获取-Elasticsearch-中所有的文档"><a href="#获取-Elasticsearch-中所有的文档" class="headerlink" title="获取 Elasticsearch 中所有的文档"></a>获取 Elasticsearch 中所有的文档</h2><p>获取 Elasticsearch 中所有的 文档(<code>document</code>)，使用以下 <code>_search</code> 查询</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl <span class="string">&#x27;localhost:9200/_search?pretty&#x27;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 2,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 4,</span><br><span class="line">    &quot;successful&quot; : 4,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : &#123;</span><br><span class="line">      &quot;value&quot; : 4,</span><br><span class="line">      &quot;relation&quot; : &quot;eq&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;max_score&quot; : 1.0,</span><br><span class="line">    &quot;hits&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;website&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;123&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;My first blog entry&quot;,</span><br><span class="line">          &quot;text&quot; : &quot;Just trying this out...&quot;,</span><br><span class="line">          &quot;date&quot; : &quot;2014/01/01&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;website&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;E6bZZ4kB3MyoSII6u2fy&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;My first blog entry&quot;,</span><br><span class="line">          &quot;text&quot; : &quot;Just trying this out...&quot;,</span><br><span class="line">          &quot;date&quot; : &quot;2014/01/01&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;website&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123; &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;blogs&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;test post&quot;,</span><br><span class="line">          &quot;content&quot; : &quot;test post&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出结果中</p>
<ul>
<li><code>hits</code> - 包含查询到的所有文档信息</li>
<li><code>hits.total</code> - 表示匹配到的文档总数</li>
<li><code>hits.hits</code> - 数组，包含了查询结果中的前 10 个文档。每个数组包含了 <code>Document (文档)</code> 的 <code>_index</code>、<code>_id</code>、<code>_source</code> 字段。</li>
<li><code>hits.hits[*]._score</code> - 每个数组包含了一个 <code>_score</code> 值，它衡量了文档和查询的匹配程度。默认情况下，首先返回最相关的文档，就是说，<strong>返回结果是按照 <code>_score</code> 降序排列的。</strong></li>
<li><code>took</code> - 表示整个搜索请求耗费了多少 ms</li>
<li><code>_shards</code> - 这部分记录了此次查询中参与的分片的总数，以及这些分片成功了多少，失败了多少。</li>
<li><code>timed_out</code> - 表示查询是否超时，默认情况下，搜索请求不会超时。如果<em><strong>低响应时间更重要</strong></em>，可以使用 <code>/_search?timeout=10ms</code> 方式指定搜索的超时时间。</li>
</ul>
<h2 id="获取指定索引下的所有文档"><a href="#获取指定索引下的所有文档" class="headerlink" title="获取指定索引下的所有文档"></a>获取指定索引下的所有文档</h2><p>要获取指定索引(<code>index</code>) 下的所有文档(<code>document</code>)，使用 <code>_search</code> 方法</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl <span class="string">&#x27;localhost:9200/website/_search?pretty&#x27;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 1,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 1,</span><br><span class="line">    &quot;successful&quot; : 1,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : &#123;</span><br><span class="line">      &quot;value&quot; : 3,</span><br><span class="line">      &quot;relation&quot; : &quot;eq&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;max_score&quot; : 1.0,</span><br><span class="line">    &quot;hits&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;website&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;123&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;My first blog entry&quot;,</span><br><span class="line">          &quot;text&quot; : &quot;Just trying this out...&quot;,</span><br><span class="line">          &quot;date&quot; : &quot;2014/01/01&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;website&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;E6bZZ4kB3MyoSII6u2fy&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;My first blog entry&quot;,</span><br><span class="line">          &quot;text&quot; : &quot;Just trying this out...&quot;,</span><br><span class="line">          &quot;date&quot; : &quot;2014/01/01&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;website&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123; &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="获取多个指定索引下的所有文档"><a href="#获取多个指定索引下的所有文档" class="headerlink" title="获取多个指定索引下的所有文档"></a>获取多个指定索引下的所有文档</h2><p>有时候不想列出 Elasticsearch 中的所有文档，又需要一次性列出多个索引(<code>index</code>) 中的 <code>Document (文档)</code>。此时可以使用 Elasticsearch 的 <em><strong>多索引搜索</strong></em> 功能 <sup id="fnref:6"><a href="#fn:6" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[多索引](https://www.elastic.co/guide/cn/elasticsearch/guide/current/multi-index-multi-type.html#multi-index-multi-type)">[6]</span></a></sup></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl <span class="string">&#x27;localhost:9200/website,blogs/_search?pretty&#x27;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 2,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 4,</span><br><span class="line">    &quot;successful&quot; : 4,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : &#123;</span><br><span class="line">      &quot;value&quot; : 4,</span><br><span class="line">      &quot;relation&quot; : &quot;eq&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;max_score&quot; : 1.0,</span><br><span class="line">    &quot;hits&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;website&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;123&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;My first blog entry&quot;,</span><br><span class="line">          &quot;text&quot; : &quot;Just trying this out...&quot;,</span><br><span class="line">          &quot;date&quot; : &quot;2014/01/01&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;website&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;E6bZZ4kB3MyoSII6u2fy&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;My first blog entry&quot;,</span><br><span class="line">          &quot;text&quot; : &quot;Just trying this out...&quot;,</span><br><span class="line">          &quot;date&quot; : &quot;2014/01/01&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;website&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123; &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;blogs&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;test post&quot;,</span><br><span class="line">          &quot;content&quot; : &quot;test post&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>相关 API 格式汇总 <sup id="fnref:6"><a href="#fn:6" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[多索引](https://www.elastic.co/guide/cn/elasticsearch/guide/current/multi-index-multi-type.html#multi-index-multi-type)">[6]</span></a></sup></p>
<ul>
<li><code>/_search</code>   在所有的索引中搜索所有的文档</li>
<li><code>/gb/_search</code>  在 <code>gb</code> 索引中搜索所有的文档</li>
<li><code>/gb,us/_search</code>  在 <code>gb</code> 和 <code>us</code> 索引中搜索所有的文档</li>
<li><code>/g*,u*/_search</code>   在任何以 <code>g</code> 或者 <code>u</code> 开头的索引中搜索所有的文档</li>
<li><code>/_all/_search</code> 在所有的索引中搜索</li>
</ul>
<h2 id="分页搜索结果"><a href="#分页搜索结果" class="headerlink" title="分页搜索结果"></a>分页搜索结果</h2><p>搜索默认返回最前面的 10 个结果，如果要自定义返回的结果数，可以使用以下查询参数 <sup id="fnref:7"><a href="#fn:7" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[分页](https://www.elastic.co/guide/cn/elasticsearch/guide/current/pagination.html#pagination)">[7]</span></a></sup></p>
<ul>
<li><code>size</code> - 显示返回结果的数量，默认为 10</li>
<li><code>from</code> - 显示应该跳过的初始结果数量，默认为 0</li>
</ul>
<p>如果每页展示 5 条结果，可以用下面的方式请求得到 1 到 3 页的数据</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GET /_search?size=5</span><br><span class="line">GET /_search?size=5&amp;from=5</span><br><span class="line">GET /_search?size=5&amp;from=10</span><br></pre></td></tr></table></figure>


<h2 id="检查文档是否存在"><a href="#检查文档是否存在" class="headerlink" title="检查文档是否存在"></a>检查文档是否存在</h2><p>如果只想知道一个 <code>Document (文档)</code> 是否存在，而不关心其内容，那么用 <code>HEAD</code> 方法代替 <code>GET</code> 方法，<code>HEAD</code> 方法只返回头部，不返回 HTTP body 内容</p>
<p>如果 <code>Document (文档)</code> 存在，返回 <code>200 OK</code>，不存在则返回 <code>404 Not Found</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">$  curl -v -X HEAD <span class="string">&#x27;localhost:9200/blogs/_doc/1&#x27;</span></span></span><br><span class="line">* About to connect() to localhost port 9200 (#0)</span><br><span class="line">*   Trying 127.0.0.1...</span><br><span class="line">* Connected to localhost (127.0.0.1) port 9200 (#0)</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">HEAD /blogs/_doc/1 HTTP/1.1</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">User-Agent: curl/7.29.0</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Host: localhost:9200</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Accept: */*</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">&lt; HTTP/1.1 200 OK</span></span><br><span class="line">&lt; X-elastic-product: Elasticsearch</span><br><span class="line">&lt; content-type: application/json</span><br><span class="line">&lt; content-length: 147</span><br><span class="line">&lt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -v -X HEAD <span class="string">&#x27;localhost:9200/blogs/_doc/11&#x27;</span></span></span><br><span class="line">* About to connect() to localhost port 9200 (#0)</span><br><span class="line">*   Trying 127.0.0.1...</span><br><span class="line">* Connected to localhost (127.0.0.1) port 9200 (#0)</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">HEAD /blogs/_doc/11 HTTP/1.1</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">User-Agent: curl/7.29.0</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Host: localhost:9200</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Accept: */*</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">&lt; HTTP/1.1 404 Not Found</span></span><br><span class="line">&lt; X-elastic-product: Elasticsearch</span><br><span class="line">&lt; content-type: application/json</span><br><span class="line">&lt; content-length: 43</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="获取文档中指定的字段"><a href="#获取文档中指定的字段" class="headerlink" title="获取文档中指定的字段"></a>获取文档中指定的字段</h2><p>如果只想获取文档中指定的字段，而不是所有字段，可以使用 <code>_source_includes</code> 查询参数</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">GET /log-8.8.2-2023.08.02/_search?size=10000&amp;_source_includes=dissect.hostname,agent.name</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot;: 178,</span><br><span class="line">  &quot;timed_out&quot;: false,</span><br><span class="line">  &quot;_shards&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 1,</span><br><span class="line">    &quot;successful&quot;: 1,</span><br><span class="line">    &quot;skipped&quot;: 0,</span><br><span class="line">    &quot;failed&quot;: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: &#123;</span><br><span class="line">      &quot;value&quot;: 10000,</span><br><span class="line">      &quot;relation&quot;: &quot;gte&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;max_score&quot;: 1,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;fm-k8s-pro-system-message-log-8.8.2-2023.08.02&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;5IHStIkBQ8H_mBHnz6Ec&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;agent&quot;: &#123;</span><br><span class="line">            &quot;name&quot;: &quot;fm-k8s-c1-worker2&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;dissect&quot;: &#123;</span><br><span class="line">            &quot;hostname&quot;: &quot;ip-172-31-22-159&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<h1 id="data-stream"><a href="#data-stream" class="headerlink" title="data stream"></a>data stream</h1><p><strong><code>data stream</code> (数据流) 是 Elasticsearch 中用于管理时间序列数据的功能，它会自动创建和管理多个索引，包括索引写入和滚动索引</strong>。<code>data stream</code> (数据流) 有一个或者多个写入索引，用于实际写入和索引数据。<em><strong>由于数据流是一种时间序列的数据存储方式，不应该直接删除写入索引</strong></em>。<em>如果想要删除一个数据流，应该通过删除整个数据流来实现，而不是单独的删除写入索引</em></p>
<h2 id="删除-data-stream"><a href="#删除-data-stream" class="headerlink" title="删除 data stream"></a>删除 data stream</h2><p>要删除一个 <code>data stream</code> (数据流)，参考以下 API</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$ curl -<span class="variable constant_">XDELETE</span> <span class="attr">localhost</span>:<span class="number">9200</span>/_data_stream/logs-generic-<span class="keyword">default</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查看所有的-data-stream"><a href="#查看所有的-data-stream" class="headerlink" title="查看所有的 data stream"></a>查看所有的 data stream</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl localhost:9200/_data_stream?pretty</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;data_streams&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot; : &quot;logs-generic-default&quot;,</span><br><span class="line">      &quot;timestamp_field&quot; : &#123;</span><br><span class="line">        &quot;name&quot; : &quot;@timestamp&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;indices&quot; : [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;index_name&quot; : &quot;.ds-logs-generic-default-2023.07.24-000001&quot;,</span><br><span class="line">          &quot;index_uuid&quot; : &quot;wxd_EjasSayBSu1d9GmcvA&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;generation&quot; : 1,</span><br><span class="line">      &quot;_meta&quot; : &#123;</span><br><span class="line">        &quot;description&quot; : &quot;default logs template installed by x-pack&quot;,</span><br><span class="line">        &quot;managed&quot; : true</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;status&quot; : &quot;GREEN&quot;,</span><br><span class="line">      &quot;template&quot; : &quot;logs&quot;,</span><br><span class="line">      &quot;ilm_policy&quot; : &quot;logs&quot;,</span><br><span class="line">      &quot;hidden&quot; : false,</span><br><span class="line">      &quot;system&quot; : false,</span><br><span class="line">      &quot;allow_custom_routing&quot; : false,</span><br><span class="line">      &quot;replicated&quot; : false</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="user-and-role"><a href="#user-and-role" class="headerlink" title="user and role"></a>user and role</h1><h2 id="查看-Elasticsearch-中所有的用户"><a href="#查看-Elasticsearch-中所有的用户" class="headerlink" title="查看 Elasticsearch 中所有的用户"></a>查看 Elasticsearch 中所有的用户</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">curl -u elastic:password1 -XGET <span class="string">&quot;http://localhost:9200/_security/user?pretty&quot;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;elastic&quot; : &#123;</span><br><span class="line">    &quot;username&quot; : &quot;elastic&quot;,</span><br><span class="line">    &quot;roles&quot; : [</span><br><span class="line">      &quot;superuser&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;full_name&quot; : null,</span><br><span class="line">    &quot;email&quot; : null,</span><br><span class="line">    &quot;metadata&quot; : &#123;</span><br><span class="line">      &quot;_reserved&quot; : true</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;enabled&quot; : true</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;kibana&quot; : &#123;</span><br><span class="line">    &quot;username&quot; : &quot;kibana&quot;,</span><br><span class="line">    &quot;roles&quot; : [</span><br><span class="line">      &quot;kibana_system&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;full_name&quot; : null,</span><br><span class="line">    &quot;email&quot; : null,</span><br><span class="line">    &quot;metadata&quot; : &#123;</span><br><span class="line">      &quot;_deprecated_reason&quot; : &quot;Please use the [kibana_system] user instead.&quot;,</span><br><span class="line">      &quot;_deprecated&quot; : true,</span><br><span class="line">      &quot;_reserved&quot; : true</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;enabled&quot; : true</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;kibana_system&quot; : &#123;</span><br><span class="line">    &quot;username&quot; : &quot;kibana_system&quot;,</span><br><span class="line">    &quot;roles&quot; : [</span><br><span class="line">      &quot;kibana_system&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;full_name&quot; : null,</span><br><span class="line">    &quot;email&quot; : null,</span><br><span class="line">    &quot;metadata&quot; : &#123;</span><br><span class="line">      &quot;_reserved&quot; : true</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;enabled&quot; : true</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;logstash_system&quot; : &#123;</span><br><span class="line">    &quot;username&quot; : &quot;logstash_system&quot;,</span><br><span class="line">    &quot;roles&quot; : [</span><br><span class="line">      &quot;logstash_system&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;full_name&quot; : null,</span><br><span class="line">    &quot;email&quot; : null,</span><br><span class="line">    &quot;metadata&quot; : &#123;</span><br><span class="line">      &quot;_reserved&quot; : true</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;enabled&quot; : true</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;beats_system&quot; : &#123;</span><br><span class="line">    &quot;username&quot; : &quot;beats_system&quot;,</span><br><span class="line">    &quot;roles&quot; : [</span><br><span class="line">      &quot;beats_system&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;full_name&quot; : null,</span><br><span class="line">    &quot;email&quot; : null,</span><br><span class="line">    &quot;metadata&quot; : &#123;</span><br><span class="line">      &quot;_reserved&quot; : true</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;enabled&quot; : true</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;apm_system&quot; : &#123;</span><br><span class="line">    &quot;username&quot; : &quot;apm_system&quot;,</span><br><span class="line">    &quot;roles&quot; : [</span><br><span class="line">      &quot;apm_system&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;full_name&quot; : null,</span><br><span class="line">    &quot;email&quot; : null,</span><br><span class="line">    &quot;metadata&quot; : &#123;</span><br><span class="line">      &quot;_reserved&quot; : true</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;enabled&quot; : true</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;remote_monitoring_user&quot; : &#123;</span><br><span class="line">    &quot;username&quot; : &quot;remote_monitoring_user&quot;,</span><br><span class="line">    &quot;roles&quot; : [</span><br><span class="line">      &quot;remote_monitoring_collector&quot;,</span><br><span class="line">      &quot;remote_monitoring_agent&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;full_name&quot; : null,</span><br><span class="line">    &quot;email&quot; : null,</span><br><span class="line">    &quot;metadata&quot; : &#123;</span><br><span class="line">      &quot;_reserved&quot; : true</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;enabled&quot; : true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="重置用户密码"><a href="#重置用户密码" class="headerlink" title="重置用户密码"></a>重置用户密码</h2><p><a href="https://csms.tech/202307271329/#重置用户密码">具体步骤参考</a></p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html">elastic 官网介绍</a></p>
<h1 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://lucene.apache.org/core/">Apache Lucene</a><a href="#fnref:1" rev="footnote"> ↩</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/_document_oriented.html#_document_oriented">面向文档</a><a href="#fnref:2" rev="footnote"> ↩</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/_indexing_employee_documents.html">索引</a><a href="#fnref:3" rev="footnote"> ↩</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/index-doc.html#index-doc">索引文档</a><a href="#fnref:4" rev="footnote"> ↩</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/get-doc.html">取回一个文档</a><a href="#fnref:5" rev="footnote"> ↩</a></span></li><li id="fn:6"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">6.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/multi-index-multi-type.html#multi-index-multi-type">多索引</a><a href="#fnref:6" rev="footnote"> ↩</a></span></li><li id="fn:7"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">7.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/pagination.html#pagination">分页</a><a href="#fnref:7" rev="footnote"> ↩</a></span></li><li id="fn:8"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">8.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html">重要配置项</a><a href="#fnref:8" rev="footnote"> ↩</a></span></li><li id="fn:9"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">9.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/advanced-configuration.html#set-jvm-heap-size">Set the heap size</a><a href="#fnref:9" rev="footnote"> ↩</a></span></li><li id="fn:10"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">10.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html#secure-settings">安全相关配置</a><a href="#fnref:10" rev="footnote"> ↩</a></span></li><li id="fn:11"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">11.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.8/auditing-settings.html">Auditing settings</a><a href="#fnref:11" rev="footnote"> ↩</a></span></li><li id="fn:12"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">12.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.8/configuring-stack-security.html#configuring-stack-security">启用安全特性启动 Elasticsearch</a><a href="#fnref:12" rev="footnote"> ↩</a></span></li></ol></div></div>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="../tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="../202307271329/" rel="prev" title="elasticsearch 管理操作">
                  <i class="fa fa-chevron-left"></i> elasticsearch 管理操作
                </a>
            </div>
            <div class="post-nav-item">
                <a href="../202307281401/" rel="next" title="kibana 管理操作">
                  kibana 管理操作 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">COSMOS</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.3" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="../js/comments.js"></script><script src="../js/utils.js"></script><script src="../js/motion.js"></script><script src="../js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="../js/third-party/search/local-search.js"></script>




  <script src="../js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"fl9999","repo":"fl9999.github.io","client_id":"a11bf6f7860762b725b5","client_secret":"a99046105f8bddc72ec718d54dc3fd7f22070821","admin_user":"fl9999","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d41d8cd98f00b204e9800998ecf8427e"}</script>
<script src="../js/third-party/comments/gitalk.js"></script>

</body>
</html>
