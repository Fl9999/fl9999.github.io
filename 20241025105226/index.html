<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16-next.png">
  <link rel="mask-icon" href="../images/logo.svg" color="#222">

<link rel="stylesheet" href="../css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"csms.tech","root":"/","images":"../images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"../search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="../js/config.js"></script>

    <meta name="description" content="Linux 审计系统提供了一种方式来跟踪系统上与安全相关的信息。根据预配置的规则，审计会生成日志条目，来尽可能多地记录系统上所发生的事件的相关信息。对于关键任务环境而言至关重要，可用来确定安全策略的违反者及其所执行的操作。审计不会为您的系统提供额外的安全，而是用于发现系统上使用的安全策略的违规。可以通过其他安全措施(如 SELinux)进一步防止这些违规。 [1] 以下列表总结了审计可以在其日志文">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux auditd 服务">
<meta property="og:url" content="http://csms.tech/20241025105226/index.html">
<meta property="og:site_name" content="L B T">
<meta property="og:description" content="Linux 审计系统提供了一种方式来跟踪系统上与安全相关的信息。根据预配置的规则，审计会生成日志条目，来尽可能多地记录系统上所发生的事件的相关信息。对于关键任务环境而言至关重要，可用来确定安全策略的违反者及其所执行的操作。审计不会为您的系统提供额外的安全，而是用于发现系统上使用的安全策略的违规。可以通过其他安全措施(如 SELinux)进一步防止这些违规。 [1] 以下列表总结了审计可以在其日志文">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-10-25T02:10:00.000Z">
<meta property="article:modified_time" content="2024-10-25T02:10:00.000Z">
<meta property="article:author" content="COSMOS">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://csms.tech/20241025105226/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://csms.tech/20241025105226/","path":"20241025105226/","title":"Linux auditd 服务"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Linux auditd 服务 | L B T</title>
  








  <noscript>
    <link rel="stylesheet" href="../css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">L B T</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记 录 过 去 的 经 验</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="../index.html" rel="section"><i class="fa fa-earth-americas fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="../categories/" rel="section"><i class="fa fa-folder-tree fa-fw"></i>总目录<span class="badge">51</span></a></li><li class="menu-item menu-item-linux"><a href="../categories/Linux" rel="section"><i class="fa fa-brands fa-linux fa-fw"></i>Linux</a></li><li class="menu-item menu-item-python"><a href="../categories/Python" rel="section"><i class="fa fa-brands fa-python fa-fw"></i>Python</a></li><li class="menu-item menu-item-docker"><a href="../categories/Docker" rel="section"><i class="fa fa-brands fa-docker fa-fw"></i>Docker</a></li><li class="menu-item menu-item-kubernetes"><a href="../categories/Kubernetes" rel="section"><i class="fa fa-dharmachakra fa-fw"></i>Kubernetes</a></li><li class="menu-item menu-item-tags"><a href="../tags/" rel="section"><i class="fa fa-tornado fa-fw"></i>标签<span class="badge">79</span></a></li><li class="menu-item menu-item-archives"><a href="../archives/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>列表<span class="badge">250</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章总目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%A1%E8%AE%A1%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">审计系统架构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-audit-%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="nav-number">2.</span> <span class="nav-text">安装 audit 软件包</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%AE%A1%E8%AE%A1%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.</span> <span class="nav-text">配置审计服务</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E5%AE%A1%E8%AE%A1%E8%A7%84%E5%88%99"><span class="nav-number">4.</span> <span class="nav-text">定义审计规则</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#auditctl"><span class="nav-number">4.1.</span> <span class="nav-text">auditctl</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AE%A1%E8%AE%A1%E8%A7%84%E5%88%99"><span class="nav-number">4.2.</span> <span class="nav-text">定义文件系统审计规则</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="nav-number">5.</span> <span class="nav-text">参考链接</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%84%9A%E6%B3%A8"><span class="nav-number">6.</span> <span class="nav-text">脚注</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">COSMOS</p>
  <div class="site-description" itemprop="description">得 能 莫 忘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="../archives/">
          <span class="site-state-item-count">250</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="../categories/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">目录</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="../tags/">
        <span class="site-state-item-count">79</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241025105226/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Linux auditd 服务 | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux auditd 服务
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-25 10:10:00" itemprop="dateCreated datePublished" datetime="2024-10-25T10:10:00+08:00">2024-10-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../categories/Linux/%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">常用服务</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>Linux 审计系统提供了一种方式来跟踪系统上与安全相关的信息。根据预配置的规则，审计会生成日志条目，来尽可能多地记录系统上所发生的事件的相关信息。对于关键任务环境而言至关重要，可用来确定安全策略的违反者及其所执行的操作。审计不会为您的系统提供额外的安全，而是用于发现系统上使用的安全策略的违规。可以通过其他安全措施(如 SELinux)进一步防止这些违规。 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[第 7 章 系统审计](https://docs.redhat.com/zh_hans/documentation/red_hat_enterprise_linux/7/html/security_guide/chap-system_auditing#chap-system_auditing) ">[1]</span></a></sup></p>
<p>以下列表总结了审计可以在其日志文件中记录的一些信息：</p>
<ul>
<li>事件的日期、时间、类型和结果.</li>
<li>主题和对象的敏感度标签。</li>
<li>事件与触发事件的用户身份的关联。</li>
<li>对审计配置的所有修改，以及对访问审计日志文件的尝试。</li>
<li>所有身份验证机制的使用，如 SSH 和 Kerberos 等。</li>
<li>对任何受信任数据库的修改，如 &#x2F;etc&#x2F;passwd。</li>
<li>尝试将信息导入系统或从系统导出。</li>
<li>根据用户身份、主题和对象标签以及其他属性包含或排除事件。</li>
</ul>
<p><strong>使用案例</strong></p>
<ul>
<li><strong>监视文件访问</strong><br>  审计可以跟踪文件或目录是否已被访问、修改、执行或者文件的属性是否已改变。例如，这有助于检测对重要文件的访问，并在其中一个文件损坏时提供审计跟踪。</li>
<li><strong>监控系统调用</strong><br>  可将审计配置为在每次使用特定系统调用时生成日志条目。例如，这可用于通过监控 <code>settimeofday</code>、<code>clock_adjtime</code> 和其他与时间相关的系统调用来跟踪对系统时间的修改。</li>
<li><strong>记录用户运行的命令</strong><br>  审计可以跟踪文件是否已被执行，因此可以定义一个规则以记录每次特定命令的执行。例如，可以对 <code>/bin</code> 目录中的每个可执行文件定义一个规则。然后，可以按用户 ID 搜索生成的日志条目，以生成每个用户所执行的命令的审计跟踪。</li>
<li><strong>记录系统路径名称的执行</strong><br>  除了观察在规则调用时将路径转换为 inode 的文件访问之外，审计现在还可以观察路径的执行，即使路径在规则调用中不存在，或者在规则调用后文件被替换了。这允许规则在升级程序可执行文件后或甚至在其安装之前继续运行。</li>
<li><strong>记录安全事件</strong><br>  <code>pam_faillock</code> 认证模块能够记录失败的登录尝试。也可以将审计设置为记录失败的登录尝试，并提供有关试图登录的用户的附加信息。</li>
<li><strong>搜索事件</strong><br>  审计提供了 <code>ausearch</code> 工具，可用于过滤日志条目，并根据多个条件提供完整的审计跟踪。</li>
<li><strong>运行总结报告</strong><br>  <code>aureport</code> 实用程序可用于生成记录事件的日常报告等。然后，系统管理员可以分析这些报告，并进一步调查可疑的活动。</li>
<li><strong>监控网络访问</strong><br>  <code>iptables</code> 和 <code>ebtables</code> 工具可以配置为触发审计事件，允许系统管理员监控网络访问。<blockquote>
<p>系统性能可能会受到影响，具体取决于审计所收集的信息量。</p>
</blockquote>
</li>
</ul>
<h1 id="审计系统架构"><a href="#审计系统架构" class="headerlink" title="审计系统架构"></a>审计系统架构</h1><p>审计系统由两个主要部分组成： <strong>用户空间应用程序和工具</strong> ，以及 <strong>内核端系统调用处理</strong> 。内核组件接收用户空间应用程序的系统调用，并通过以下过滤器对其进行过滤： <code>user</code>、<code>task</code>、<code>fstype</code> 或 <code>exit</code> 。 <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[第 7 章 系统审计](https://docs.redhat.com/zh_hans/documentation/red_hat_enterprise_linux/7/html/security_guide/chap-system_auditing#chap-system_auditing) ">[1]</span></a></sup></p>
<p><strong>用户空间审计守护进程</strong> 从内核收集信息，并在日志文件中创建条目。<strong>其他审计用户空间工具</strong> 与 <strong>审计守护进程</strong> 、 <strong>内核审计组件</strong> 或 <strong>审计日志文件</strong> 进行交互：</p>
<ul>
<li><code>audisp</code> - Audit 分配程序守护进程与 Audit 守护进程交互，并将事件发送到其他应用程序，以便进一步处理。此守护进程的目的是提供插件机制，以便实时分析程序可以与审计事件交互。</li>
<li><code>auditctl</code> - 审计控制实用程序与内核审计组件交互，以管理规则并控制事件生成进程的多个设置和参数。</li>
<li>其余的审计工具会将审计日志文件的内容作为输入，并根据用户的要求生成输出。例如，<code>aureport</code> 工具生成所有记录的事件的报告。</li>
</ul>
<span id="more"></span>

<h1 id="安装-audit-软件包"><a href="#安装-audit-软件包" class="headerlink" title="安装 audit 软件包"></a>安装 audit 软件包</h1><p>要使用审计系统，必须在系统中安装了 <code>audit</code> 软件包。<code>audit</code> 软件包(<code>audit</code> 和 <code>audit-libs</code>)默认安装在 Red Hat Enterprise Linux 7 中。如果您没有安装这些软件包，请以 <code>root</code> 用户身份执行以下命令来安装审计和依赖项：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install audit</span><br></pre></td></tr></table></figure>

<p>Ubuntu 参考以下命令安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt install auditd</span><br></pre></td></tr></table></figure>

<p><strong>主要服务为 <code>auditd.service</code></strong></p>
<p><strong>关键配置文件为 <code>/etc/audit/auditd.conf </code></strong></p>
<h1 id="配置审计服务"><a href="#配置审计服务" class="headerlink" title="配置审计服务"></a>配置审计服务</h1><p>Audit 守护进程可以在 <code>/etc/audit/auditd.conf</code> 文件中配置。此文件由 <strong>修改审计守护进程行为</strong> 的配置参数组成。哈希符号(<code>#</code>)后面的空行和文本将被忽略。详情请查看 <code>auditd.conf(5) man page</code>。</p>
<p><code>auditd</code> 常用配置参数说明</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Descriptions</th>
<th>Examples</th>
</tr>
</thead>
<tbody><tr>
<td><code>log_file</code></td>
<td>审计日志全路径</td>
<td><code>log_file = /var/log/audit/audit.log</code></td>
</tr>
<tr>
<td><code>max_log_file</code></td>
<td>审计日志的最大大小，以 <code>MB</code> 为单位</td>
<td><code>max_log_file = 8</code></td>
</tr>
<tr>
<td><code>max_log_file_action</code></td>
<td>在达到 <code>max_log_file</code> 中设置的限制后，决定要采取什么操作，应设置为 <code>keep_logs</code> 以防止审计日志文件被覆盖。<br/>- <code>ignore</code> ： 忽略，什么也不做<br/>- <code>syslog</code> ： 向 <code>syslog</code> 发送一个告警信息<br/>- <code>suspend</code> ： 不再写入审计日志，进程依然运行<br/>- <code>rotate</code> ： 日志轮转（<code>logs with higher numbers are older than logs with lower numbers</code>）</td>
<td></td>
</tr>
<tr>
<td><code>num_logs</code></td>
<td>如果 <code>max_log_file_action</code> 配置为 <code>rotate</code>，用于指定要保留的日志文件数量。 <strong>要设置为 <code>2-999</code> 才有效</strong></td>
<td></td>
</tr>
<tr>
<td><code>space_left</code></td>
<td>指定磁盘上剩余的可用空间量，会触发 <code>space_left_action</code> 参数中设置的操作<br/>- 如果 <code>space_left</code> 的值指定为整数，它将解释为绝对大小(MiB)。<br/>- 果该值指定为 <strong>百分比</strong>（例如 <code>5%</code>），则审计守护进程会根据包含 <code>log_file</code> 的文件系统的大小计算绝对大小（以 MB 为单位）。</td>
<td><code>space_left = 75</code><br/><code>space_left = 75%</code></td>
</tr>
<tr>
<td><code>space_left_action</code></td>
<td>建议参数设置为 <code>email</code> 或 <code>exec</code>。可选值包括：<br/>- <strong>ignore</strong> <br/>- <strong>syslog</strong><br/>- <strong>rotate</strong><br/>- <strong>Email</strong> ： Email 帐号信息配置在 <code>action_mail_acct</code> 中<br/>- <strong>exec</strong> ： 执行脚本<br/>- <strong>suspend</strong> <br/>- <strong>single</strong> ： <code>auditd</code> 服务会将系统设置为单用户模式<br/>- <strong>halt</strong> ： <code>auditd</code> 服务会关闭操作系统</td>
<td></td>
</tr>
<tr>
<td><code>admin_space_left</code></td>
<td>指定触发 <code>admin_space_left_action</code> 参数中设置的操作的绝对最小可用空间量，必须将其设置为一个值，以便有足够的空间来记录管理员执行的操作。 <strong>此参数的数字值应小于 <code>space_left</code> 的数字值</strong> 。还可以设置为百分比（例如 1%），以便审计守护进程根据磁盘分区计算数值。</td>
<td></td>
</tr>
<tr>
<td><code>admin_space_left_action</code></td>
<td>应设置为 <code>single</code> 来将系统置于 <strong>单用户模式</strong> ，并允许管理员释放一些磁盘空间。</td>
<td></td>
</tr>
<tr>
<td><code>disk_full_action</code></td>
<td>没有可用空间时触发的操作，必须设置为 <code>halt</code> 或 <code>single</code>。当审计无法记录事件时，这可确保系统关闭或以单用户模式运行。</td>
<td></td>
</tr>
<tr>
<td><code>disk_error_action</code></td>
<td>指定当在包含审计日志文件的分区上检测到错误时触发的操作，必须设置为 <code>syslog</code>、<code>single</code> 或 <code>halt</code>，具体取决于您处理硬件故障的本地安全策略。</td>
<td></td>
</tr>
<tr>
<td><code>flush</code></td>
<td>应设置为 <code>incremental_async</code> 。它与 <code>freq</code> 参数结合使用，该参数决定了在强制与硬盘进行硬盘同步前可以将多少条记录发送到磁盘。<code>freq</code> 参数应设置为 <code>100</code>。这些参数可确保审计事件数据与磁盘上的日志文件同步，同时保持良好的活动性能。</td>
<td></td>
</tr>
</tbody></table>
<h1 id="定义审计规则"><a href="#定义审计规则" class="headerlink" title="定义审计规则"></a>定义审计规则</h1><p>可以通过以下方式设置审计规则：</p>
<ul>
<li>在命令行中使用 <code>auditctl</code> 工具。请注意， <strong>这些规则在重启后不会保留</strong> 。</li>
<li>在 <code>/etc/audit/audit.rules</code> 文件中。</li>
</ul>
<h2 id="auditctl"><a href="#auditctl" class="headerlink" title="auditctl"></a>auditctl</h2><p><code>auditctl</code> 常见控制选项，可参考 <code>auditctl -h</code> 或 <code>man auditctl</code></p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-b backlog</code></td>
<td>在内核中设置现有审计缓冲区的最大数量，默认值 <code>64</code></td>
<td><code>auditctl -b 8192</code></td>
</tr>
<tr>
<td><code>-f [0..2]</code></td>
<td>在检测到关键错误（<code>failure flag</code>）时执行的操作，默认为 <code>1</code>。可选值： <code>0=silent</code> ， <code>1=printk</code>，<code>2=panic</code> 。<br/>常见关键错误包括：<br/>- <code>backlog limit exceeded</code><br/>- <code>out of kernel memory</code><br/>- <code>rate limit exceeded</code></td>
<td></td>
</tr>
<tr>
<td><code>-e [0..2]</code></td>
<td>配置启动开关。<br/>- When <code>0</code> is passed, this can be used to temporarily disable auditing.  <br/>- When <code>1</code> is passed  as  an  argument, it will enable auditing.<br/> - To lock the audit configuration so that it can’t be changed, pass a <code>2</code> as the argument. <br/><strong>Locking the configuration is intended to be the last command in audit.rules for anyone wishing this feature to be active.  Any attempt to change the configuration in this mode will be audited and denied. The configuration can only be changed by rebooting the machine.</strong></td>
<td></td>
</tr>
<tr>
<td><code>-r rate</code></td>
<td>设置每秒生成的消息率 messages&#x2F;sec (<code>0=none</code>)    。默认为 <code>0</code>  。如果超过限制，内核将会根据 <code>failure flag</code> 采取对应的动作</td>
<td></td>
</tr>
<tr>
<td><code>-s</code></td>
<td>报告审计系统状态。会报告以下内容：<br/>- 内核中参数 <code>-e</code>, <code>-f</code>, <code>-r</code> 和 <code>-b</code> 的值<br/>- PID（如果为 <code>0</code> 表示审计未启动）<br/>- <code>lost</code> 的值表示内核审计队列溢出（kernel audit queue overflowing）导致丢失的事件数量<br/>- <code>backlog</code> 的值表示处于队列中正在等待 <code>auditd</code> 读取的事件的数量。</td>
<td><code>auditctl -s -i</code> 组合使用会将 <code>auditctl -s</code> 中显示的数值翻译为对应的字符值</td>
</tr>
<tr>
<td><code>-l</code></td>
<td>列出所有当前载入的审计规则</td>
<td></td>
</tr>
<tr>
<td><code>-D</code></td>
<td>删除所有的规则和监视（watch），也可以通过 <code>-k</code> 指定关键字</td>
<td></td>
</tr>
<tr>
<td><code>-m text</code></td>
<td>发送用户空间的消息到 <code>auditd</code>，消息类型为 <code>USER</code> 类型，可以用来测试  <code>auditd</code></td>
<td></td>
</tr>
</tbody></table>
<p><code>auditctl</code> 定义审计规则常用选项，可参考 <code>auditctl -h</code> 或 <code>man auditctl</code></p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-w path</code></td>
<td>针对 <code>path</code> 定义的文件系统对象添加一个 <code>watch</code> 规则。因为其内部实现是通过追踪文件的 <code>inode</code>，监控 <code>/</code> 或者使用通配符指定 <code>path</code> 是不支持的。<br/><strong>它可以用 <code>-F path</code> 和 <code>-F dir</code> 来代替监控文件和目录，这个选项主要是为了向后兼容，推荐使用 <code>-F</code> 选项替代</strong> <br/> <strong><code>-w</code> 选项只能配合 <code>-p</code> 和 <code>-k</code> 选项使用</strong></td>
<td></td>
</tr>
<tr>
<td><code>-W path</code></td>
<td>删除针对 <code>path</code> 定义的文件系统对象的 <code>watch</code> 规则，要删除的规则必须和定义时的规则精确匹配</td>
<td></td>
</tr>
<tr>
<td><code>-p [rwxa]</code></td>
<td>权限 <code>r=read</code>, <code>w=write</code>, <code>x=execute</code>, <code>a=attribute</code></td>
<td></td>
</tr>
<tr>
<td><code>-k key</code></td>
<td>可选的随即字符串，用于识别特定的规则</td>
<td></td>
</tr>
</tbody></table>
<h2 id="定义文件系统审计规则"><a href="#定义文件系统审计规则" class="headerlink" title="定义文件系统审计规则"></a>定义文件系统审计规则</h2><p>要定义文件系统审计规则，请使用以下语法：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">auditctl -w path_to_file -p permissions -k key_name</span><br></pre></td></tr></table></figure>

<p>例如，要定义一条规则，记录对 <code>/etc/passwd</code> 文件的所有 <strong>写</strong> 访问以及 <code>/etc/passwd</code> 文件的每个属性，请执行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">auditctl -w /etc/passwd -p wa -k passwd_changes</span><br></pre></td></tr></table></figure>

<p>检查审计日志，在添加审计规则时，审计日志会记录以下日志：</p>
<figure class="highlight shell"><figcaption><span>/var/log/audit/audit.log</span></figcaption><table><tr><td class="code"><pre><span class="line">type=CONFIG_CHANGE msg=audit(1729837815.559:368452): auid=1001 ses=48825 subj=kernel op=add_rule key=&quot;passwd_changes&quot; list=4 res=1</span><br></pre></td></tr></table></figure>

<p>加入此时删除系统上的某个用户，审计日志会记录以下内容：</p>
<figure class="highlight shell"><figcaption><span>/var/log/audit/audit.log</span></figcaption><table><tr><td class="code"><pre><span class="line">type=SYSCALL msg=audit(1729837888.712:368453): arch=c000003e syscall=2 success=yes exit=5 a0=55dc6b214ac0 a1=20902 a2=ffffff00 a3=8 items=1 ppid=29173 pid=18424 auid=1001 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts1 ses=48825 comm=&quot;userdel&quot; exe=&quot;/usr/sbin/userdel&quot; subj=kernel key=&quot;passwd_changes&quot;</span><br><span class="line">type=CWD msg=audit(1729837888.712:368453): cwd=&quot;/root&quot;</span><br><span class="line">type=PATH msg=audit(1729837888.712:368453): item=0 name=&quot;/etc/passwd&quot; inode=106612 dev=103:01 mode=0100644 ouid=0 ogid=0 rdev=00:00 obj=unlabeled nametype=NORMAL cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span><br><span class="line">type=PROCTITLE msg=audit(1729837888.712:368453): proctitle=7573657264656C0063656E746F73</span><br><span class="line">type=DEL_USER msg=audit(1729837888.713:368454): pid=18424 uid=0 auid=1001 ses=48825 subj=kernel msg=&#x27;op=delete-user id=1000 exe=&quot;/usr/sbin/userdel&quot; hostname=nginx_server addr=? terminal=pts/1 res=success&#x27;</span><br><span class="line">type=USER_MGMT msg=audit(1729837888.713:368455): pid=18424 uid=0 auid=1001 ses=48825 subj=kernel msg=&#x27;op=deleting-user-from-group grp=&quot;adm&quot; id=1000 exe=&quot;/usr/sbin/userdel&quot; hostname=nginx_server addr=? terminal=pts/1 res=success&#x27;</span><br><span class="line">type=USER_MGMT msg=audit(1729837888.713:368456): pid=18424 uid=0 auid=1001 ses=48825 subj=kernel msg=&#x27;op=deleting-user-from-group grp=&quot;systemd-journal&quot; id=1000 exe=&quot;/usr/sbin/userdel&quot; hostname=nginx_server addr=? terminal=pts/1 res=success&#x27;</span><br><span class="line">type=DEL_GROUP msg=audit(1729837888.713:368457): pid=18424 uid=0 auid=1001 ses=48825 subj=kernel msg=&#x27;op=delete-group grp=&quot;centos&quot; acct=&quot;centos&quot; exe=&quot;/usr/sbin/userdel&quot; hostname=nginx_server addr=? terminal=pts/1 res=success&#x27;</span><br><span class="line">type=GRP_MGMT msg=audit(1729837888.713:368458): pid=18424 uid=0 auid=1001 ses=48825 subj=kernel msg=&#x27;op=delete-shadow-group grp=&quot;centos&quot; acct=&quot;centos&quot; exe=&quot;/usr/sbin/userdel&quot; hostname=nginx_server addr=? terminal=pts/1 res=success&#x27;</span><br><span class="line">type=USER_MGMT msg=audit(1729837888.713:368459): pid=18424 uid=0 auid=1001 ses=48825 subj=kernel msg=&#x27;op=deleting-user-from-shadow-group grp=&quot;adm&quot; id=1000 exe=&quot;/usr/sbin/userdel&quot; hostname=nginx_server addr=? terminal=pts/1 res=success&#x27;</span><br><span class="line">type=USER_MGMT msg=audit(1729837888.714:368460): pid=18424 uid=0 auid=1001 ses=48825 subj=kernel msg=&#x27;op=deleting-user-from-shadow-group grp=&quot;systemd-journal&quot; id=1000 exe=&quot;/usr/sbin/userdel&quot; hostname=nginx_server addr=? terminal=pts/1 res=success&#x27;</span><br><span class="line">type=SYSCALL msg=audit(1729837888.716:368461): arch=c000003e syscall=82 success=yes exit=0 a0=7fffce030120 a1=55dc6b214ac0 a2=7fffce030090 a3=2f6e6962732f3a78 items=5 ppid=29173 pid=18424 auid=1001 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts1 ses=48825 comm=&quot;userdel&quot; exe=&quot;/usr/sbin/userdel&quot; subj=kernel key=&quot;passwd_changes&quot;</span><br><span class="line">type=CWD msg=audit(1729837888.716:368461): cwd=&quot;/root&quot;</span><br><span class="line">type=PATH msg=audit(1729837888.716:368461): item=0 name=&quot;/etc/&quot; inode=68 dev=103:01 mode=040755 ouid=0 ogid=0 rdev=00:00 obj=unlabeled nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span><br><span class="line">type=PATH msg=audit(1729837888.716:368461): item=1 name=&quot;/etc/&quot; inode=68 dev=103:01 mode=040755 ouid=0 ogid=0 rdev=00:00 obj=unlabeled nametype=PARENT cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span><br><span class="line">type=PATH msg=audit(1729837888.716:368461): item=2 name=&quot;/etc/passwd+&quot; inode=642300 dev=103:01 mode=0100644 ouid=0 ogid=0 rdev=00:00 obj=unlabeled nametype=DELETE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span><br><span class="line">type=PATH msg=audit(1729837888.716:368461): item=3 name=&quot;/etc/passwd&quot; inode=106612 dev=103:01 mode=0100644 ouid=0 ogid=0 rdev=00:00 obj=unlabeled nametype=DELETE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span><br><span class="line">type=PATH msg=audit(1729837888.716:368461): item=4 name=&quot;/etc/passwd&quot; inode=642300 dev=103:01 mode=0100644 ouid=0 ogid=0 rdev=00:00 obj=unlabeled nametype=CREATE cap_fp=0 cap_fi=0 cap_fe=0 cap_fver=0 cap_frootid=0</span><br><span class="line">type=PROCTITLE msg=audit(1729837888.716:368461): proctitle=7573657264656C0063656E746F73</span><br></pre></td></tr></table></figure>

<p><strong>其中的很多原始内容不适合人类阅读和理解，为了方便人类阅读和理解，可以使用 <code>ausearch -i</code> 对其中的内容进行翻译</strong> ，如以下输出中，会对上面示例中的内容如 <code>proctitle=7573657264656C0063656E746F73</code> 进行翻译</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ausearch -k passwd_changes -i</span></span><br><span class="line">----</span><br><span class="line">type=PROCTITLE msg=audit(10/25/2024 14:30:15.559:368452) : proctitle=auditctl -w /etc/passwd -p wa -k passwd_changes </span><br><span class="line">type=SYSCALL msg=audit(10/25/2024 14:30:15.559:368452) : arch=x86_64 syscall=sendto success=yes exit=1084 a0=0x4 a1=0x7fff7ce41fa0 a2=0x43c a3=0x0 items=0 ppid=29173 pid=18303 auid=qqc uid=root gid=root euid=root suid=root fsuid=root egid=root sgid=root fsgid=root tty=pts1 ses=48825 comm=auditctl exe=/usr/sbin/auditctl subj=kernel key=(null) </span><br><span class="line">type=CONFIG_CHANGE msg=audit(10/25/2024 14:30:15.559:368452) : auid=qqc ses=48825 subj=kernel op=add_rule key=passwd_changes list=exit res=yes </span><br><span class="line">----</span><br><span class="line">type=PROCTITLE msg=audit(10/25/2024 14:31:28.712:368453) : proctitle=userdel centos </span><br><span class="line">type=PATH msg=audit(10/25/2024 14:31:28.712:368453) : item=0 name=/etc/passwd inode=106612 dev=103:01 mode=file,644 ouid=root ogid=root rdev=00:00 obj=unlabeled nametype=NORMAL cap_fp=none cap_fi=none cap_fe=0 cap_fver=0 cap_frootid=0 </span><br><span class="line">type=CWD msg=audit(10/25/2024 14:31:28.712:368453) : cwd=/root </span><br><span class="line">type=SYSCALL msg=audit(10/25/2024 14:31:28.712:368453) : arch=x86_64 syscall=open success=yes exit=5 a0=0x55dc6b214ac0 a1=O_RDWR|O_NOCTTY|O_NONBLOCK|O_NOFOLLOW a2=0xffffff00 a3=0x8 items=1 ppid=29173 pid=18424 auid=qqc uid=root gid=root euid=root suid=root fsuid=root egid=root sgid=root fsgid=root tty=pts1 ses=48825 comm=userdel exe=/usr/sbin/userdel subj=kernel key=passwd_changes </span><br><span class="line">----</span><br><span class="line">type=PROCTITLE msg=audit(10/25/2024 14:31:28.716:368461) : proctitle=userdel centos </span><br><span class="line">type=PATH msg=audit(10/25/2024 14:31:28.716:368461) : item=4 name=/etc/passwd inode=642300 dev=103:01 mode=file,644 ouid=root ogid=root rdev=00:00 obj=unlabeled nametype=CREATE cap_fp=none cap_fi=none cap_fe=0 cap_fver=0 cap_frootid=0 </span><br><span class="line">type=PATH msg=audit(10/25/2024 14:31:28.716:368461) : item=3 name=/etc/passwd inode=106612 dev=103:01 mode=file,644 ouid=root ogid=root rdev=00:00 obj=unlabeled nametype=DELETE cap_fp=none cap_fi=none cap_fe=0 cap_fver=0 cap_frootid=0 </span><br><span class="line">type=PATH msg=audit(10/25/2024 14:31:28.716:368461) : item=2 name=/etc/passwd+ inode=642300 dev=103:01 mode=file,644 ouid=root ogid=root rdev=00:00 obj=unlabeled nametype=DELETE cap_fp=none cap_fi=none cap_fe=0 cap_fver=0 cap_frootid=0 </span><br><span class="line">type=PATH msg=audit(10/25/2024 14:31:28.716:368461) : item=1 name=/etc/ inode=68 dev=103:01 mode=dir,755 ouid=root ogid=root rdev=00:00 obj=unlabeled nametype=PARENT cap_fp=none cap_fi=none cap_fe=0 cap_fver=0 cap_frootid=0 </span><br><span class="line">type=PATH msg=audit(10/25/2024 14:31:28.716:368461) : item=0 name=/etc/ inode=68 dev=103:01 mode=dir,755 ouid=root ogid=root rdev=00:00 obj=unlabeled nametype=PARENT cap_fp=none cap_fi=none cap_fe=0 cap_fver=0 cap_frootid=0 </span><br><span class="line">type=CWD msg=audit(10/25/2024 14:31:28.716:368461) : cwd=/root </span><br><span class="line">type=SYSCALL msg=audit(10/25/2024 14:31:28.716:368461) : arch=x86_64 syscall=rename success=yes exit=0 a0=0x7fffce030120 a1=0x55dc6b214ac0 a2=0x7fffce030090 a3=0x2f6e6962732f3a78 items=5 ppid=29173 pid=18424 auid=qqc uid=root gid=root euid=root suid=root fsuid=root egid=root sgid=root fsgid=root tty=pts1 ses=48825 comm=userdel exe=/usr/sbin/userdel subj=kernel key=passwd_changes</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://docs.redhat.com/zh_hans/documentation/red_hat_enterprise_linux/7/html/security_guide/sec-understanding_audit_log_files">审计日志内容分析参考</a></p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a target="_blank" rel="noopener" href="https://docs.redhat.com/zh_hans/documentation/red_hat_enterprise_linux/7/html/security_guide/chap-system_auditing#chap-system_auditing">第 7 章 系统审计</a></p>
<h1 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://docs.redhat.com/zh_hans/documentation/red_hat_enterprise_linux/7/html/security_guide/chap-system_auditing#chap-system_auditing">第 7 章 系统审计</a><a href="#fnref:1" rev="footnote"> ↩</a></span></li></ol></div></div>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="../tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="../20241023162615/" rel="prev" title="BIOS 和 UEFI">
                  <i class="fa fa-chevron-left"></i> BIOS 和 UEFI
                </a>
            </div>
            <div class="post-nav-item">
                <a href="../20241026135656/" rel="next" title="关于 Hash">
                  关于 Hash <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">COSMOS</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.3" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="../js/comments.js"></script><script src="../js/utils.js"></script><script src="../js/motion.js"></script><script src="../js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="../js/third-party/search/local-search.js"></script>




  <script src="../js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"fl9999","repo":"fl9999.github.io","client_id":"a11bf6f7860762b725b5","client_secret":"a99046105f8bddc72ec718d54dc3fd7f22070821","admin_user":"fl9999","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d41d8cd98f00b204e9800998ecf8427e"}</script>
<script src="../js/third-party/comments/gitalk.js"></script>

</body>
</html>
