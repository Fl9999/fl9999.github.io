<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16-next.png">
  <link rel="mask-icon" href="../images/logo.svg" color="#222">

<link rel="stylesheet" href="../css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"csms.tech","root":"/","images":"../images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"../search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="../js/config.js"></script>

    <meta name="description" content="PAM（Pluggable Authentication Modules） 由 Sun Microsystems 发明并最初在 Solarise OS 上实现，Linux 于 1997 年实现了 Linux-PAM. PAM 简化了系统认证管理的过程，使用 PAM 提供了以下好处：  使用中心化的方式简化了用户身份认证过程以及系统管理员的视角 简化了应用在认证相关功能方面的开发，开发者无需重复写认">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux PAM">
<meta property="og:url" content="http://csms.tech/20241028140006/index.html">
<meta property="og:site_name" content="L B T">
<meta property="og:description" content="PAM（Pluggable Authentication Modules） 由 Sun Microsystems 发明并最初在 Solarise OS 上实现，Linux 于 1997 年实现了 Linux-PAM. PAM 简化了系统认证管理的过程，使用 PAM 提供了以下好处：  使用中心化的方式简化了用户身份认证过程以及系统管理员的视角 简化了应用在认证相关功能方面的开发，开发者无需重复写认">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-10-28T05:10:00.000Z">
<meta property="article:modified_time" content="2024-10-28T05:10:00.000Z">
<meta property="article:author" content="COSMOS">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://csms.tech/20241028140006/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://csms.tech/20241028140006/","path":"20241028140006/","title":"Linux PAM"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Linux PAM | L B T</title>
  








  <noscript>
    <link rel="stylesheet" href="../css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">L B T</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记 录 过 去 的 经 验</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="../index.html" rel="section"><i class="fa fa-earth-americas fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="../categories/" rel="section"><i class="fa fa-folder-tree fa-fw"></i>总目录<span class="badge">51</span></a></li><li class="menu-item menu-item-linux"><a href="../categories/Linux" rel="section"><i class="fa fa-brands fa-linux fa-fw"></i>Linux</a></li><li class="menu-item menu-item-python"><a href="../categories/Python" rel="section"><i class="fa fa-brands fa-python fa-fw"></i>Python</a></li><li class="menu-item menu-item-docker"><a href="../categories/Docker" rel="section"><i class="fa fa-brands fa-docker fa-fw"></i>Docker</a></li><li class="menu-item menu-item-kubernetes"><a href="../categories/Kubernetes" rel="section"><i class="fa fa-dharmachakra fa-fw"></i>Kubernetes</a></li><li class="menu-item menu-item-tags"><a href="../tags/" rel="section"><i class="fa fa-tornado fa-fw"></i>标签<span class="badge">79</span></a></li><li class="menu-item menu-item-archives"><a href="../archives/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>列表<span class="badge">250</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章总目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#PAM-Contexts"><span class="nav-number">1.</span> <span class="nav-text">PAM Contexts</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PAM-Control-Flags"><span class="nav-number">2.</span> <span class="nav-text">PAM Control Flags</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PAM-Modules"><span class="nav-number">3.</span> <span class="nav-text">PAM Modules</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux-%E4%B8%AD%E7%9A%84%E5%B8%B8%E7%94%A8%E7%9A%84-PAM-%E6%A8%A1%E5%9D%97"><span class="nav-number">4.</span> <span class="nav-text">Linux 中的常用的 PAM 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#pam-limits-%E9%99%90%E5%88%B6%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">4.1.</span> <span class="nav-text">pam_limits 限制系统资源的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pam-time-%E9%99%90%E5%88%B6%E7%89%B9%E5%AE%9A%E7%9A%84%E6%97%B6%E9%97%B4%E4%BD%BF%E7%94%A8%E7%89%B9%E5%AE%9A%E7%9A%84%E8%B5%84%E6%BA%90"><span class="nav-number">4.2.</span> <span class="nav-text">pam_time 限制特定的时间使用特定的资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pam-wheel-%E9%99%90%E5%88%B6-su-%E5%91%BD%E4%BB%A4%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">4.3.</span> <span class="nav-text">pam_wheel 限制 su 命令的使用</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">COSMOS</p>
  <div class="site-description" itemprop="description">得 能 莫 忘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="../archives/">
          <span class="site-state-item-count">250</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="../categories/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">目录</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="../tags/">
        <span class="site-state-item-count">79</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/20241028140006/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Linux PAM | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux PAM
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-28 13:10:00" itemprop="dateCreated datePublished" datetime="2024-10-28T13:10:00+08:00">2024-10-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>PAM（Pluggable Authentication Modules） 由 Sun Microsystems 发明并最初在 Solarise OS 上实现，Linux 于 1997 年实现了 Linux-PAM.</p>
<p>PAM 简化了系统认证管理的过程，使用 PAM 提供了以下好处：</p>
<ul>
<li>使用中心化的方式简化了用户身份认证过程以及系统管理员的视角</li>
<li>简化了应用在认证相关功能方面的开发，开发者无需重复写认证相关代码，只需要直接使用已有的认证模块即可</li>
<li>认证灵活性<ul>
<li>可以根据用户身份或者是特定的时间，或者是对特定资源的使用进行允许&#x2F;拒绝操作</li>
</ul>
</li>
</ul>
<p><strong>包含 PAM 的应用中 PAM 使用流程大体如下</strong> ：</p>
<ul>
<li>一个主体（用户或者进程）请求访问（通过认证）一个应用</li>
<li>此应用读取其 PAM 配置文件，其 PAM 配置文件中配置了认证策略，认证策略中一般包含要进行认证的 PAM 模块的列表，这个列表也称为 <em>Stack</em></li>
<li>Stack 中配置的 PAM 模块被依次调用</li>
<li>每个 PAM 模块会根据其配置返回 <strong>成功（Success）</strong> 或者 <strong>失败（Failure）</strong> 状态</li>
<li>最后是否认证成功，由所有的 PAM 模块返回的结果组合得到 <strong>成功（Success）</strong> 或者 <strong>失败（Failure）</strong> ，具体组合方式取决于配置文件中的配置。</li>
</ul>
<p>Linux 中，大多数包含 PAM 的应用的配置文件位于 <code>/etc/pam.d/</code>，通用的 PAM 配置文件格式使用：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">context &#x27;control flag&#x27; &#x27;PAM module&#x27; [module options]</span><br></pre></td></tr></table></figure>

<p>Linux 中，系统安全（如资源限制，用户登陆等）相关的 PAM 配置文件位于 <code>/etc/security/*.conf</code></p>
<h1 id="PAM-Contexts"><a href="#PAM-Contexts" class="headerlink" title="PAM Contexts"></a>PAM Contexts</h1><p>PAM 模块为不同的认证服务提供了标准的函数，这些 PAM 模块中的标准函数根据其函数类型称为 <code>Contexts</code>，也可以叫做 <code>Module Interfaces</code> 或者 <code>Types</code>，下列出了不同的 PAM Contexts 及其对应的 认证服务（Authentication Service）</p>
<table>
<thead>
<tr>
<th>Context</th>
<th>Service Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>auth</code></td>
<td>提供认证管理服务（Authentication Management Services），如验证帐号密码</td>
</tr>
<tr>
<td><code>account</code></td>
<td>帐号验证服务（Account Validation Services），例如只允许特定时间登陆</td>
</tr>
<tr>
<td><code>password</code></td>
<td>管理帐号密码（Manages Account Passwords），如限制帐号密码长度</td>
</tr>
</tbody></table>
<h1 id="PAM-Control-Flags"><a href="#PAM-Control-Flags" class="headerlink" title="PAM Control Flags"></a>PAM Control Flags</h1><p>PAM 中的 Control Flags 用于决定返回什么样的状态。下表列出了 PAM 配置中的相关的 Control Flags 及其响应</p>
<table>
<thead>
<tr>
<th>Control Flag</th>
<th>Response Handle</th>
</tr>
</thead>
<tbody><tr>
<td><code>required</code></td>
<td>If failed, returns a failure status to the application, after the rest of the contexts have been run in the stack.<br/>For example, a <code>requisite control</code> might cause a login to fail if someone types in an invalid user. But the user might not be told of the failure until after entering a password, hiding the fact that it was the bad username that caused the failure</td>
</tr>
<tr>
<td><code>requisite</code></td>
<td>If failed, returns a failure status to the application immediately <strong>without running the rest of the stack</strong> 。 <strong>(Be careful where you place this control in the stack.)</strong> <br/> For example, a <code>requisite control</code> might require key-based authentication and <strong>fail immediately when a valid key is not provided</strong> . In that case, it could fail before even prompting for a username&#x2F;password.</td>
</tr>
<tr>
<td><code>sufficient</code></td>
<td>- If failed, the module status is ignored. <br/> - If successful, then a success status is immediately returned to the application without running the rest of the stack.<br/> <strong>(Be careful where you place this control in the stack.)</strong></td>
</tr>
<tr>
<td><code>optional</code></td>
<td><strong>This control flag is important only for the final overall return status of success or failure</strong> . Think of it as a tiebreaker. When the other modules in the configuration file stack return statuses that are neither clear-cut failure nor success statuses, this optional module’s status is used to determine the final status or break the tie. In cases where the other modules in the stack are returning a clear-cut path of failure or success, this status is ignored.</td>
</tr>
<tr>
<td><code>include</code></td>
<td>Get all the return statuses from this particular PAM configuration file’s stack to include in this stack’s overall return status. It’s as if the entire stack from the named configuration file is now in this configuration file</td>
</tr>
<tr>
<td><code>substack</code></td>
<td>Similar to the include control flag, except for how certain errors and evaluations affect the main stack. This forces the included configuration file stack to act as a substack to the main stack. Thus, certain errors and evaluations affect only the substack and not the main stack.</td>
</tr>
</tbody></table>
<h1 id="PAM-Modules"><a href="#PAM-Modules" class="headerlink" title="PAM Modules"></a>PAM Modules</h1><p>Linux 中，PAM Modules 其实是系统共享库（Shared Library Module）文件，RHEL 默认位于 <code> /usr/lib64/security/pam*.so</code>， Ubuntu 位于 <code>/usr/lib/x86_64-linux-gnu/security/pam*.so</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> /usr/lib/x86_64-linux-gnu/security/</span></span><br><span class="line">pam_access.so           pam_exec.so        pam_gdm.so            pam_listfile.so   pam_nologin.so           pam_securetty.so  pam_stress.so      pam_unix.so</span><br><span class="line">pam_cap.so              pam_extrausers.so  pam_gnome_keyring.so  pam_localuser.so  pam_oddjob_mkhomedir.so  pam_selinux.so    pam_succeed_if.so  pam_userdb.so</span><br><span class="line">pam_dcvgraphicalsso.so  pam_faildelay.so   pam_group.so          pam_loginuid.so   pam_permit.so            pam_sepermit.so   pam_systemd.so     pam_usertype.so</span><br><span class="line">pam_debug.so            pam_faillock.so    pam_issue.so          pam_mail.so       pam_pwhistory.so         pam_setquota.so   pam_time.so        pam_warn.so</span><br><span class="line">pam_deny.so             pam_filter.so      pam_keyinit.so        pam_mkhomedir.so  pam_pwquality.so         pam_shells.so     pam_timestamp.so   pam_wheel.so</span><br><span class="line">pam_echo.so             pam_fprintd.so     pam_lastlog.so        pam_motd.so       pam_rhosts.so            pam_sss_gss.so    pam_tty_audit.so   pam_xauth.so</span><br><span class="line">pam_env.so              pam_ftp.so         pam_limits.so         pam_namespace.so  pam_rootok.so            pam_sss.so        pam_umask.so</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>要查看 PAM Module 的帮助文档，可以使用 <code>man</code> 手册，如 <code>man pam_access</code>。</p>
<p>使用 PAM 的应用可以大概分为以下 2 类：</p>
<ul>
<li><p><strong>普通程序（Application）</strong> 。默认使用 PAM 的应用的配置位于 <code>/etc/pam.d</code>，每个使用 PAM Module 的应用程序都应该有其自己的配置文件来定义它如何使用 PAM 模块。如果没有，这将是一个漏洞，为了防止这种情况出现，系统内置了一个 <code>other</code> 的配置（<code>/etc/pam.d/other</code>），所有使用了 PAM 但是没有指定其配置文件的应用都将使用此配置。 <strong><code>other</code> 配置默认拒绝（Implicit Deny）所有的请求</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> /etc/pam.d/</span></span><br><span class="line">chfn            common-auth                    cron               gdm-autologin           gdm-smartcard                   login     polkit-1   samba             sudo</span><br><span class="line">chpasswd        common-password                cups               gdm-fingerprint         gdm-smartcard-pkcs11-exclusive  newusers  ppp        sshd              sudo-i</span><br><span class="line">chsh            common-session                 dcv                gdm-launch-environment  gdm-smartcard-sssd-exclusive    other     runuser    sssd-shadowutils  su-l</span><br><span class="line">common-account  common-session-noninteractive  dcv-graphical-sso  gdm-password            gdm-smartcard-sssd-or-password  passwd    runuser-l  su                vmtoolsd</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>系统安全相关程序</strong> 。系统安全相关的 PAM 配置默认位于 <code> /etc/security</code>。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> /etc/security/</span></span><br><span class="line">access.conf      faillock.conf  limits.conf  namespace.conf  namespace.init  pam_env.conf    sepermit.conf</span><br><span class="line">capability.conf  group.conf     limits.d     namespace.d     opasswd         pwquality.conf  time.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<span id="more"></span>

<h1 id="Linux-中的常用的-PAM-模块"><a href="#Linux-中的常用的-PAM-模块" class="headerlink" title="Linux 中的常用的 PAM 模块"></a>Linux 中的常用的 PAM 模块</h1><p>Linux 中的 PAM 模块提供了非常丰富的功能，以下列出经常使用的功能</p>
<ul>
<li><a href="#pam-limits-%E9%99%90%E5%88%B6%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9A%84%E4%BD%BF%E7%94%A8"><code>pam_limits</code> 限制系统资源的使用</a></li>
<li><a href="#pam-time-%E9%99%90%E5%88%B6%E7%89%B9%E5%AE%9A%E7%9A%84%E6%97%B6%E9%97%B4%E4%BD%BF%E7%94%A8%E7%89%B9%E5%AE%9A%E7%9A%84%E8%B5%84%E6%BA%90"><code>pam-time</code> 限制特定的时间使用特定的资源</a></li>
<li><code>pam_cracklib</code> 限制密码复杂度</li>
<li><a href="#pam-wheel-%E9%99%90%E5%88%B6-su-%E5%91%BD%E4%BB%A4%E7%9A%84%E4%BD%BF%E7%94%A8"><code>pam_wheel</code> 限制 <code>su</code> 命令的使用</a></li>
</ul>
<h2 id="pam-limits-限制系统资源的使用"><a href="#pam-limits-限制系统资源的使用" class="headerlink" title="pam_limits 限制系统资源的使用"></a>pam_limits 限制系统资源的使用</h2><blockquote>
<p><em>Fork Bomb</em> : Fork 炸弹属于一种攻击或者是对资源的错误使用，一个进程无限制的循环创建子进程，直到系统资源耗尽</p>
</blockquote>
<p><code>pam_limits</code> 模块主要用来 <strong>限制系统资源的使用</strong> 。其 PAM 配置文件为 <code>/etc/security/limits.conf</code> 。默认情况下，这个文件里面没有任何对资源的使用限制。</p>
<blockquote>
<p>要自定义对资源的限制配置时，建议使用 <code>/etc/security/limits.d/*.conf</code> 下的文件，如此无需修改 <code>/etc/security/limits.conf</code></p>
</blockquote>
<figure class="highlight shell"><figcaption><span>/etc/security/limits.conf</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/etc/security/limits.conf</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#Each line describes a limit for a user in the form:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#&lt;domain&gt;        &lt;type&gt;  &lt;item&gt;  &lt;value&gt;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#Where:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">&lt;domain&gt; can be:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - a user name</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - a group name, with @group syntax</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - the wildcard *, <span class="keyword">for</span> default entry</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - the wildcard %, can be also used with %group syntax,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                <span class="keyword">for</span> maxlogin <span class="built_in">limit</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - NOTE: group and wildcard limits are not applied to root.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">         To apply a <span class="built_in">limit</span> to the root user, &lt;domain&gt; must be</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">         the literal username root.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#&lt;type&gt; can have the two values:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - <span class="string">&quot;soft&quot;</span> <span class="keyword">for</span> enforcing the soft limits</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - <span class="string">&quot;hard&quot;</span> <span class="keyword">for</span> enforcing hard limits</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#&lt;item&gt; can be one of the following:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - core - limits the core file size (KB)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - data - max data size (KB)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - fsize - maximum filesize (KB)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - memlock - max locked-in-memory address space (KB)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - nofile - max number of open file descriptors</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - rss - max resident <span class="built_in">set</span> size (KB)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - stack - max stack size (KB)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - cpu - max CPU time (MIN)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - <span class="built_in">nproc</span> - max number of processes</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - as - address space <span class="built_in">limit</span> (KB)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - maxlogins - max number of logins <span class="keyword">for</span> this user</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - maxsyslogins - max number of logins on the system</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - priority - the priority to run user process with</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - locks - max number of file locks the user can hold</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - sigpending - max number of pending signals</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - msgqueue - max memory used by POSIX message queues (bytes)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - <span class="built_in">nice</span> - max <span class="built_in">nice</span> priority allowed to raise to values: [-20, 19]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - rtprio - max realtime priority</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">       - <span class="built_in">chroot</span> - change root to directory (Debian-specific)</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#&lt;domain&gt;      &lt;type&gt;  &lt;item&gt;         &lt;value&gt;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">*               soft    core            0</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">root            hard    core            100000</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">*               hard    rss             10000</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">@student        hard    <span class="built_in">nproc</span>           20</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">@faculty        soft    <span class="built_in">nproc</span>           20</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">@faculty        hard    <span class="built_in">nproc</span>           50</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ftp             hard    <span class="built_in">nproc</span>           0</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ftp             -       <span class="built_in">chroot</span>          /ftp</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">@student        -       maxlogins       4</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">End of file</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>/etc/security/limits.conf</code> 配置中相关参数说明，详细帮助信息可参考 <code>man 5 limits.conf</code>：</p>
<ul>
<li><p><code>domain</code> ： 资源限制针对的目标，可以是用户（如 <code>root</code>）或组（如 <code>@student</code>），<code>*</code> 表示对所有用户和组生效</p>
</li>
<li><p><code>type</code>： <code>hard</code> 表示限制不能被超出; <code>soft</code> 表示限制可以短暂的超出</p>
</li>
<li><p><code>item</code> ： 要限制的资源</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Description</th>
<th>Examples</th>
</tr>
</thead>
<tbody><tr>
<td><code>nproc</code></td>
<td>限制用户或组能够启动&#x2F;创建的最大进程数（Tasks）<br/> <strong>可以防止 Fork Bomb</strong></td>
<td></td>
</tr>
<tr>
<td><code>maxlogins</code></td>
<td><strong>设置一个用户同时登录系统的最大数量（session），确保用户无法通过多次登录来绕过资源限制。</strong> <br/>用户的资源限制（例如进程数量、文件打开数量等）通常只在该登录会话期间有效。一旦用户注销并重新登录，这些限制可能会被重置。因此，恶意用户可以通过多次登录来绕过这些限制，或者在每次登录会话中制造大量进程，进而创建一种被称为 <code>fork bomb</code> 的攻击。</td>
<td><code>* hard maxlogins 3</code><br/> 当用户同时登陆的数量（Sessions）超过 3 时，会无法登陆，提示 <code>Too many logins for </code></td>
</tr>
<tr>
<td><code>nofile</code></td>
<td>最大可以打开的 <code>file descriptors</code></td>
<td></td>
</tr>
</tbody></table>
</li>
</ul>
<p>通过以下方式检查使用了 <code>pam_limits</code> 模块的应用，<code>pam_limits</code> 模块使用了配置 <code>/etc/security/limits.conf</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">grep <span class="string">&#x27;pam_limits&#x27;</span> /etc/pam.d/*</span></span><br><span class="line">/etc/pam.d/cron:session    required   pam_limits.so</span><br><span class="line">/etc/pam.d/gdm-autologin:session required        pam_limits.so</span><br><span class="line">/etc/pam.d/gdm-fingerprint:session required        pam_limits.so</span><br><span class="line">/etc/pam.d/gdm-launch-environment:session required        pam_limits.so</span><br><span class="line">/etc/pam.d/gdm-password:session required        pam_limits.so</span><br><span class="line">/etc/pam.d/gdm-smartcard:session required        pam_limits.so</span><br><span class="line">/etc/pam.d/gdm-smartcard-pkcs11-exclusive:session required        pam_limits.so</span><br><span class="line">/etc/pam.d/gdm-smartcard-sssd-exclusive:session required        pam_limits.so</span><br><span class="line">/etc/pam.d/gdm-smartcard-sssd-or-password:session required        pam_limits.so</span><br><span class="line">/etc/pam.d/login:session    required   pam_limits.so</span><br><span class="line">/etc/pam.d/runuser:session		required	pam_limits.so</span><br><span class="line">/etc/pam.d/sshd:session    required     pam_limits.so</span><br><span class="line">/etc/pam.d/su:session    required   pam_limits.so</span><br><span class="line">/etc/pam.d/sudo:session    required   pam_limits.so</span><br><span class="line">/etc/pam.d/sudo-i:session    required   pam_limits.so</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="pam-time-限制特定的时间使用特定的资源"><a href="#pam-time-限制特定的时间使用特定的资源" class="headerlink" title="pam_time 限制特定的时间使用特定的资源"></a>pam_time 限制特定的时间使用特定的资源</h2><p>通过 <code>pam_time</code> PAM 模块可以实现类似功能：</p>
<ul>
<li>在每天的固定时间才能访问指定的应用</li>
<li>在每周的固定时间才能登陆系统</li>
</ul>
<p>负责处理类似时间限制的 PAM 配置文件是 <code>/etc/security/time.conf</code>，使用此配置的 PAM 模块是 <code>pam_time</code></p>
<figure class="highlight shell"><figcaption><span>/etc/security/time.conf</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">this is an example configuration file <span class="keyword">for</span> the pam_time module. Its syntax</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">was initially based heavily on that of the shadow package (shadow-960129).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># the syntax of the lines is as follows:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#       services;ttys;users;times</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># white space is ignored and lines maybe extended with &#x27;\\n&#x27; (escaped</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">newlines). As should be clear from reading these comments,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">text following a <span class="string">&#x27;#&#x27;</span> is ignored to the end of the line.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># the combination of individual users/terminals etc is a logic list</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">namely individual tokens that are optionally prefixed with <span class="string">&#x27;!&#x27;</span> (logical</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">not) and separated with <span class="string">&#x27;&amp;&#x27;</span> (logical and) and <span class="string">&#x27;|&#x27;</span> (logical or).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># services</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	is a logic list of PAM service names that the rule applies to.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ttys</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	is a logic list of terminal names that this rule applies to.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># users</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	is a logic list of <span class="built_in">users</span> or a netgroup of <span class="built_in">users</span> to whom this</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	rule applies.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># NB. For these items the simple wildcard &#x27;*&#x27; may be used only once.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># times</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	the format here is a logic list of day/time-range</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	entries the days are specified by a sequence of two character</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	entries, MoTuSa <span class="keyword">for</span> example is Monday Tuesday and Saturday. Note</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	that repeated days are <span class="built_in">unset</span> MoMo = no day, and MoWk = all weekdays</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	bar Monday. The two character combinations accepted are</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#		Mo Tu We Th Fr Sa Su Wk Wd Al</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#	the last two being week-end days and all 7 days of the week</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	respectively. As a final example, AlFr means all days except Friday.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#	each day/time-range can be prefixed with a &#x27;!&#x27; to indicate &quot;anything</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	but<span class="string">&quot;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#	The time-range part is two 24-hour times HHMM separated by a hyphen</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">	indicating the start and finish time (if the finish time is smaller</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">	than the start time it is deemed to apply on the following day).</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># for a rule to be active, ALL of service+ttys+users must be satisfied</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">by the applying process.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"></span></span><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Here is a simple example: running blank on tty* (any ttyXXX device),</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the users &#x27;you&#x27; and &#x27;me&#x27; are denied service all of the time</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"></span></span><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">blank;tty* &amp; !ttyp*;you|me;!Al0000-2400</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Another silly example, user &#x27;root&#x27; is denied xsh access</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">from pseudo terminals at the weekend and on mondays.</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">xsh;ttyp*;root;!WdMo0000-2400</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># End of example file.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"></span></span></span><br></pre></td></tr></table></figure>
<p><code>/etc/security/time.conf</code> 配置中相关参数说明，详细帮助信息请参考 <code>man 5 time.conf</code></p>
<ul>
<li><code>services</code> ： PAM 的服务名称逻辑列表，被限制的对象，如 <code>Login</code></li>
<li><code>tty</code> ： 关联的终端名称逻辑列表，如 <code>ttys-*</code> 表示所有终端</li>
<li><code>users</code> ： 关联的用户名称逻辑列表，如 <code>!root</code> 表示除 <code>root</code> 外的所有用户</li>
<li><code>times</code> : 时间。具体格式请参考 <code>man 5 time.conf</code></li>
</ul>
<blockquote>
<p>A logic list namely means individual tokens that are optionally prefixed with ‘!’ (logical not) and separated with ‘&amp;’ (logical and) and ‘|’ (logical or).</p>
</blockquote>
<p>使用了 <code>pam_time</code> 模块的应用包括：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">grep pam_time /etc/pam.d/*</span></span><br><span class="line">/etc/pam.d/login:# account    requisite  pam_time.so</span><br><span class="line">/etc/pam.d/su:# account    requisite  pam_time.so</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="pam-wheel-限制-su-命令的使用"><a href="#pam-wheel-限制-su-命令的使用" class="headerlink" title="pam_wheel 限制 su 命令的使用"></a>pam_wheel 限制 su 命令的使用</h2><p>默认情况下，系统上的所有用户都可以使用 <code>su</code> 命令切换到其他用户环境。<code>su</code> 是一个 PAM-ware 的应用，其 PAM 配置文件为 <code>/etc/pam.d/su</code></p>
<figure class="highlight shell"><figcaption><span>/etc/pam.d/su</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The PAM configuration file for the Shadow `su&#x27; service</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This allows root to su without passwords (normal operation)</span></span><br><span class="line">auth       sufficient pam_rootok.so</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Uncomment this to force <span class="built_in">users</span> to be a member of group wheel</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">before they can use `su<span class="string">&#x27;. You can also add &quot;group=foo&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">to the end of this line if you want to use a group other</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">than the default &quot;wheel&quot; (but this may have side effect of</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">denying &quot;root&quot; user, unless she&#x27;</span>s a member of <span class="string">&quot;foo&quot;</span> or explicitly</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">permitted earlier by e.g. <span class="string">&quot;sufficient pam_rootok.so&quot;</span>).</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">(Replaces the `SU_WHEEL_ONLY<span class="string">&#x27; option from login.defs)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">auth       required   pam_wheel.so</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Uncomment this if you want wheel members to be able to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">su without a password.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">auth       sufficient pam_wheel.so trust</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Uncomment this if you want members of a specific group to not</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">be allowed to use su at all.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">auth       required   pam_wheel.so deny group=nosu</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Uncomment and edit /etc/security/time.conf if you need to set</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">time restrainst on su usage.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">(Replaces the `PORTTIME_CHECKS_ENAB&#x27;</span> option from login.defs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">as well as /etc/porttime)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">account    requisite  pam_time.so</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This module parses environment configuration file(s)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">and also allows you to use an extended config</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">file /etc/security/pam_env.conf.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># parsing /etc/environment needs &quot;readenv=1&quot;</span></span></span><br><span class="line">session       required   pam_env.so readenv=1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">locale variables are also kept into /etc/default/locale <span class="keyword">in</span> etch</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">reading this file *<span class="keyword">in</span> addition to /etc/environment* does not hurt</span></span><br><span class="line">session       required   pam_env.so readenv=1 envfile=/etc/default/locale</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Defines the MAIL environment variable</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">However, userdel also needs MAIL_DIR and MAIL_FILE variables</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">in</span> /etc/login.defs to make sure that removing a user</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">also removes the user<span class="string">&#x27;s mail spool file.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">See comments in /etc/login.defs</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># &quot;nopen&quot; stands to avoid reporting new mail when su&#x27;</span>ing to another user</span></span><br><span class="line">session    optional   pam_mail.so nopen</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Sets up user limits according to /etc/security/limits.conf</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">(Replaces the use of /etc/limits <span class="keyword">in</span> old login)</span></span><br><span class="line">session    required   pam_limits.so</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The standard Unix authentication modules, used with</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">NIS (man nsswitch) as well as normal /etc/passwd and</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/etc/shadow entries.</span></span><br><span class="line">@include common-auth</span><br><span class="line">@include common-account</span><br><span class="line">@include common-session</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>要更改 <code>su</code> 命令的行为，可以参考以下配置：</p>
<ul>
<li><p><strong>限制只有在 <code>wheel</code> 组中的用户才能使用 <code>su</code>，可以启用</strong> ：</p>
<figure class="highlight shell"><figcaption><span>/etc/pam.d/su</span></figcaption><table><tr><td class="code"><pre><span class="line">auth       required   pam_wheel.so</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>启用此配置，并确保 <code>wheel</code> 组中无任何用户，可以限制任何普通用户使用 <code>su</code> 命令</strong></p>
</blockquote>
</li>
<li><p><strong>限制只有在 <code>foo</code> 组中的用户才能使用 <code>su</code>，可以配置为</strong> ：</p>
<figure class="highlight shell"><figcaption><span>/etc/pam.d/su</span></figcaption><table><tr><td class="code"><pre><span class="line">auth       required   pam_wheel.so group=foo</span><br></pre></td></tr></table></figure></li>
<li><p><strong>限制在 <code>wheel</code> 组中的用户使用 <code>su</code> 时无需输入密码</strong> ： </p>
<figure class="highlight shell"><figcaption><span>/etc/pam.d/su</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Uncomment this <span class="keyword">if</span> you want wheel members to be able to</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">su without a password.</span></span><br><span class="line">auth       sufficient pam_wheel.so trust</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>指定组中的用户限制其使用 <code>su</code> 命令</strong></p>
<figure class="highlight shell"><figcaption><span>/etc/pam.d/su</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Uncomment this <span class="keyword">if</span> you want members of a specific group to not</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">be allowed to use su at all.</span></span><br><span class="line">auth       required   pam_wheel.so deny group=nosu</span><br></pre></td></tr></table></figure></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="../tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="../20241026144120/" rel="prev" title="加密">
                  <i class="fa fa-chevron-left"></i> 加密
                </a>
            </div>
            <div class="post-nav-item">
                <a href="../20241028135437/" rel="next" title="linux modules 及 library 相关操作">
                  linux modules 及 library 相关操作 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">COSMOS</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.3" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="../js/comments.js"></script><script src="../js/utils.js"></script><script src="../js/motion.js"></script><script src="../js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="../js/third-party/search/local-search.js"></script>




  <script src="../js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"fl9999","repo":"fl9999.github.io","client_id":"a11bf6f7860762b725b5","client_secret":"a99046105f8bddc72ec718d54dc3fd7f22070821","admin_user":"fl9999","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d41d8cd98f00b204e9800998ecf8427e"}</script>
<script src="../js/third-party/comments/gitalk.js"></script>

</body>
</html>
