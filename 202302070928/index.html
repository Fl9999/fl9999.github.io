<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16-next.png">
  <link rel="mask-icon" href="../images/logo.svg" color="#222">

<link rel="stylesheet" href="../css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"csms.tech","root":"/","images":"../images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"../search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="../js/config.js"></script>

    <meta name="description" content="SoftEther VPN 官网手册 环境信息 Centos7 5.4.221 SoftEther VPN Server 4.41 iptables  SoftEther VPN Server 有两种模式，Service Mode 和 User Mode，本文档安装使用 Service Mode [1]  Service Mode - 安装之后以系统服务的形式存在（被管理） User Mode -">
<meta property="og:type" content="article">
<meta property="og:title" content="SoftEther VPN 使用">
<meta property="og:url" content="http://csms.tech/202302070928/index.html">
<meta property="og:site_name" content="L B T">
<meta property="og:description" content="SoftEther VPN 官网手册 环境信息 Centos7 5.4.221 SoftEther VPN Server 4.41 iptables  SoftEther VPN Server 有两种模式，Service Mode 和 User Mode，本文档安装使用 Service Mode [1]  Service Mode - 安装之后以系统服务的形式存在（被管理） User Mode -">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.csms.tech/img_116.png">
<meta property="og:image" content="https://i.csms.tech/img_117.png">
<meta property="og:image" content="https://i.csms.tech/img_118.png">
<meta property="og:image" content="https://i.csms.tech/img_122.png">
<meta property="og:image" content="https://i.csms.tech/img_120.png">
<meta property="og:image" content="https://i.csms.tech/img_121.png">
<meta property="article:published_time" content="2023-02-07T01:28:28.000Z">
<meta property="article:modified_time" content="2023-02-07T01:28:34.000Z">
<meta property="article:author" content="COSMOS">
<meta property="article:tag" content="VPN">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.csms.tech/img_116.png">


<link rel="canonical" href="http://csms.tech/202302070928/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://csms.tech/202302070928/","path":"202302070928/","title":"SoftEther VPN 使用"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SoftEther VPN 使用 | L B T</title>
  








  <noscript>
    <link rel="stylesheet" href="../css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">L B T</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记 录 过 去 的 经 验</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="../index.html" rel="section"><i class="fa fa-earth-americas fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="../categories/" rel="section"><i class="fa fa-folder-tree fa-fw"></i>总目录<span class="badge">30</span></a></li><li class="menu-item menu-item-linux"><a href="../categories/Linux" rel="section"><i class="fa fa-brands fa-linux fa-fw"></i>Linux</a></li><li class="menu-item menu-item-docker"><a href="../categories/Docker" rel="section"><i class="fa fa-docker fa-fw"></i>Docker</a></li><li class="menu-item menu-item-tags"><a href="../tags/" rel="section"><i class="fa fa-tornado fa-fw"></i>标签<span class="badge">73</span></a></li><li class="menu-item menu-item-archives"><a href="../archives/" rel="section"><i class="fa fa-rectangle-list fa-fw"></i>列表<span class="badge">126</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章总目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF"><span class="nav-number">1.</span> <span class="nav-text">环境信息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E8%BF%87%E7%A8%8B"><span class="nav-number">2.</span> <span class="nav-text">安装配置过程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">2.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="nav-number">2.2.</span> <span class="nav-text">初始化配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5"><span class="nav-number">3.</span> <span class="nav-text">客户端连接</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#android-%E8%87%AA%E5%B8%A6-VPN-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5"><span class="nav-number">3.1.</span> <span class="nav-text">android 自带 VPN 客户端连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ios-%E8%87%AA%E5%B8%A6%E7%9A%84-VPN-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5"><span class="nav-number">3.2.</span> <span class="nav-text">ios 自带的 VPN 客户端连接</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF"><span class="nav-number">4.</span> <span class="nav-text">常见错误</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#VPN-Client-%E5%8F%AF%E4%BB%A5%E8%BF%9E%E6%8E%A5%E5%88%B0-VPN-Server%EF%BC%8C%E4%BD%86%E6%98%AF-client-%E7%9A%84%E5%87%BA%E5%8F%A3-IP-%E6%9C%AA%E5%8F%98"><span class="nav-number">4.1.</span> <span class="nav-text">VPN Client 可以连接到 VPN Server，但是 client 的出口 IP 未变</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%84%9A%E6%B3%A8"><span class="nav-number">5.</span> <span class="nav-text">脚注</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">COSMOS</p>
  <div class="site-description" itemprop="description">得 能 莫 忘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="../archives/">
          <span class="site-state-item-count">126</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="../categories/">
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">目录</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="../tags/">
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://csms.tech/202302070928/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../images/avatar.gif">
      <meta itemprop="name" content="COSMOS">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L B T">
      <meta itemprop="description" content="得 能 莫 忘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="SoftEther VPN 使用 | L B T">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SoftEther VPN 使用
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-02-07 09:28:28 / 修改时间：09:28:34" itemprop="dateCreated datePublished" datetime="2023-02-07T09:28:28+08:00">2023-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">上层目录</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="../categories/Tools/VPN/" itemprop="url" rel="index"><span itemprop="name">VPN</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><a target="_blank" rel="noopener" href="https://www.softether.org/4-docs">SoftEther VPN 官网手册</a></p>
<h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><ul>
<li>Centos7 5.4.221</li>
<li>SoftEther VPN Server 4.41</li>
<li>iptables</li>
</ul>
<p>SoftEther VPN Server 有两种模式，<code>Service Mode</code> 和 <code>User Mode</code>，本文档安装使用 <code>Service Mode</code> <sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Operating Modes](https://www.softether.org/4-docs/1-manual/3._SoftEther_VPN_Server_Manual/3.2_Operating_Modes)">[1]</span></a></sup></p>
<ul>
<li><code>Service Mode</code> - 安装之后以系统服务的形式存在（被管理）</li>
<li><code>User Mode</code> - 安装之后不存在对应的服务，（管理员）用户直接通过进程管理，程序启动停止需要（管理员）用户手动停止相应进程</li>
</ul>
<h1 id="安装配置过程"><a href="#安装配置过程" class="headerlink" title="安装配置过程"></a>安装配置过程</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>安装依赖包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install gcc zlib-devel openssl-devel readline-devel ncurses-devel</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.softether.org/">参考链接</a> 下载最新的安装包，本文档使用版本 4.41 版本 <sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Install on Linux and Initial Configurations](https://www.softether.org/4-docs/1-manual/7._Installing_SoftEther_VPN_Server/7.3_Install_on_Linux_and_Initial_Configurations)">[2]</span></a></sup></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://github.com/SoftEtherVPN/SoftEtherVPN_Stable/releases/download/v4.41-9782-beta/softether-vpnserver-v4.41-9782-beta-2022.11.17-linux-x64-64bit.tar.gz</span><br><span class="line"></span><br><span class="line">tar -xf softether-vpnserver-v4.41-9782-beta-2022.11.17-linux-x64-64bit.tar.gz</span><br><span class="line"></span><br><span class="line">cd vpnserver/</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>使用以下命令编译生成可执行文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>
<p>将编译后的目录移动到 <code>/usr/local/</code> 下，并修改权限</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ..</span><br><span class="line">mv vpnserver /usr/local/</span><br><span class="line"></span><br><span class="line">cd /usr/local/vpnserver/</span><br><span class="line"></span><br><span class="line">chmod 600 *</span><br><span class="line"></span><br><span class="line">chmod 700 vpncmd</span><br><span class="line">chmod 700 vpnserver</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<p>使用 <code>vpncmd check</code> 命令检查 vpn server 是否可以正常运行。在 <code>/usr/local/vpnserver/</code> 目录下执行 <code>./vpncmd</code>，根据提示选择 3 (<code>3. Use of VPN Tools (certificate creation and Network Traffic Speed Test Tool)</code>)， 然后执行 <code>check</code> 命令进行检查。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./vpncmd</span></span><br><span class="line">By using vpncmd program, the following can be achieved. </span><br><span class="line"></span><br><span class="line">1. Management of VPN Server or VPN Bridge </span><br><span class="line">2. Management of VPN Client</span><br><span class="line">3. Use of VPN Tools (certificate creation and Network Traffic Speed Test Tool)</span><br><span class="line"></span><br><span class="line">Select 1, 2 or 3: 3</span><br><span class="line"></span><br><span class="line">VPN Tools&gt;check</span><br><span class="line">Check command - Check whether SoftEther VPN Operation is Possible</span><br><span class="line">---------------------------------------------------</span><br><span class="line">SoftEther VPN Operation Environment Check Tool</span><br><span class="line"></span><br><span class="line">Copyright (c) SoftEther VPN Project.</span><br><span class="line">All Rights Reserved.</span><br><span class="line"></span><br><span class="line">If this operation environment check tool is run on a system and that system passes, it is most likely that SoftEther VPN software can operate on that system. This check may take a while. Please wait...</span><br><span class="line"></span><br><span class="line">Checking &#x27;Kernel System&#x27;... </span><br><span class="line">              Pass</span><br><span class="line">Checking &#x27;Memory Operation System&#x27;... </span><br><span class="line">              Pass</span><br><span class="line">Checking &#x27;ANSI / Unicode string processing system&#x27;... </span><br><span class="line">              Pass</span><br><span class="line">Checking &#x27;File system&#x27;... </span><br><span class="line">              Pass</span><br><span class="line">Checking &#x27;Thread processing system&#x27;... </span><br><span class="line">              Pass</span><br><span class="line">Checking &#x27;Network system&#x27;... </span><br><span class="line">              Pass</span><br><span class="line"></span><br><span class="line">All checks passed. It is most likely that SoftEther VPN Server / Bridge can operate normally on this system.</span><br><span class="line"></span><br><span class="line">The command completed successfully.</span><br></pre></td></tr></table></figure>
<p>执行检查后输出 <code>All checks passed. It is most likely that SoftEther VPN Server / Bridge can operate normally on this system.</code> ，说明系统可正常满足 vpn server 运行的条件。</p>
<p>根据以下内容生成服务启动脚本，将 vpn server 以 service 的形式运行</p>
<figure class="highlight shell"><figcaption><span>/etc/init.d/softether-vpn-server</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">chkconfig: 2345 99 01</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">description: SoftEther VPN Server</span></span><br><span class="line">DAEMON=/usr/local/vpnserver/vpnserver</span><br><span class="line">LOCK=/var/lock/subsys/vpnserver</span><br><span class="line">test -x $DAEMON || exit 0</span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">start)</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">DAEMON start</span></span><br><span class="line">touch $LOCK</span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">DAEMON stop</span></span><br><span class="line">rm $LOCK</span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">DAEMON stop</span></span><br><span class="line">sleep 3</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">DAEMON start</span></span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">echo &quot;Usage: $0 &#123;start|stop|restart&#125;&quot;</span><br><span class="line">exit 1</span><br><span class="line">esac</span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure>
<p>给服务脚本添加可执行权限，并配置开机启动，之后可以通过 <code>systemctl</code> 管理服务状态。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">chmod</span> 755 /etc/init.d/softether-vpn-server</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl daemon-reload</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl status softether-vpn-server</span></span><br><span class="line">● softether-vpn-server.service - SYSV: SoftEther VPN Server</span><br><span class="line">   Loaded: loaded (/etc/rc.d/init.d/softether-vpn-server; bad; vendor preset: disabled)</span><br><span class="line">   Active: inactive (dead)</span><br><span class="line">     Docs: man:systemd-sysv-generator(8)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl <span class="built_in">enable</span> softether-vpn-server</span></span><br><span class="line">softether-vpn-server.service is not a native service, redirecting to /sbin/chkconfig.</span><br><span class="line">Executing /sbin/chkconfig softether-vpn-server on</span><br></pre></td></tr></table></figure>

<p>防火墙添加以下配置 <sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Listener Ports](https://www.softether.org/4-docs/1-manual/3._SoftEther_VPN_Server_Manual/3.3_VPN_Server_Administration)">[4]</span></a></sup></p>
<figure class="highlight shell"><figcaption><span>/etc/sysconfig/iptables</span></figcaption><table><tr><td class="code"><pre><span class="line">-A INPUT -m comment --comment &quot;vpn&quot; -m multiport -p tcp --dports 443,1194,5555,992 -j ACCEPT</span><br><span class="line">-A INPUT -m comment --comment &quot;vpn&quot; -m multiport -p udp --dports 4500,500 -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>启动服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start softether-vpn-server</span><br></pre></td></tr></table></figure>

<h2 id="初始化配置"><a href="#初始化配置" class="headerlink" title="初始化配置"></a>初始化配置</h2><p>安装完 vpn server 之后，可以通过 <code>SoftEther VPN Server Manager</code> 管理 VPN Server。windows 上下载 <a target="_blank" rel="noopener" href="https://www.softether-download.com/en.aspx?product=softether"><code>SoftEther VPN Server Manager for Windows</code></a> <sup id="fnref:5"><a href="#fn:5" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Initial Configurations](https://www.softether.org/4-docs/1-manual/7._Installing_SoftEther_VPN_Server/7.4_Initial_Configurations)">[5]</span></a></sup> </p>
<p>初次登陆后，建议设置管理员密码<br><img src="https://i.csms.tech/img_116.png"></p>
<p>默认情况下，只存在一个名为 <code>DEFAULT</code> 的 Virtual Hub 注册到了 VPN Server，可以使用此 Virtual Hub，或者删除它重新创建自己的 Virtual Hub。</p>
<p>根据提示选择要创建的的 VPN Server 的类型，普通 VPN 选择 <code>Remote Access VPN Server</code><br><img src="https://i.csms.tech/img_117.png"><br>根据提示，配置要创建的 Virtual Hub 的名称，接着会弹出 <code>Dynamic DNS Function</code> 配置界面。<code>Dynamic DNS Function</code> 的功能，会提供一个 <code>softether.net</code> 域的子域名，通过这个域名，可以解析到 VPN Server 的 IP 地址，如果服务器使用的是动态 IP，此解析会跟着变化。如果服务器只有内网 IP（云主机），此解析会自动解析到公网 IP。<br><img src="https://i.csms.tech/img_118.png"></p>
<p><code>Dynamic DNS Function</code> 配置完成后退出（<code>exit</code>），进入协议配置界面，此处启用所有协议(手机连接 VPN 需要)<br><img src="https://i.csms.tech/img_122.png"></p>
<p>创建 VPN 用户<br><img src="https://i.csms.tech/img_120.png"></p>
<p>回到管理界面后，选择刚刚创建的 Virtual Hub，点击 <code>Manage Virtual Hub</code> 按钮管理配置，选择 <code>Virtual NAT and Virtual DHCP Server(SecureNAT)</code>，启用 <code>SecureNAT</code>，否则客户端可以连接到 VPN Server，但是 VPN Server 不会分配 IP 地址给客户端。<br><img src="https://i.csms.tech/img_121.png"></p>
<h1 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h1><h2 id="android-自带-VPN-客户端连接"><a href="#android-自带-VPN-客户端连接" class="headerlink" title="android 自带 VPN 客户端连接"></a>android 自带 VPN 客户端连接</h2><p>打开手机 VPN 设置，添加 VPN 配置，主要配置以下项：</p>
<ul>
<li><code>Type</code> : <code>L2TP/IPSec PSK</code></li>
<li><code>Server address</code> : 填写 VPN 服务器 IP 或域名</li>
<li><code>IPSec pre-shared key</code> : 填写协议配置界面中配置的 <code>IPsec Pre-shared Key</code> 对应的值，本文档中为<code>vpn</code></li>
<li><code>Username</code> : 填写 VPN 的用户名</li>
<li><code>Password</code> : 填写 VPN 用户密码</li>
</ul>
<h2 id="ios-自带的-VPN-客户端连接"><a href="#ios-自带的-VPN-客户端连接" class="headerlink" title="ios 自带的 VPN 客户端连接"></a>ios 自带的 VPN 客户端连接</h2><p>在 IOS 的 <code>通用</code> –&gt; <code>VPN 与 设备管理</code> –&gt; <code>VPN</code> 中添加 VPN 配置，主要配置以下项：</p>
<ul>
<li><code>类型</code> ： <code>L2TP</code></li>
<li><code>服务器</code> : 填写 VPN 服务器 IP 或域名</li>
<li><code>账户</code> : 填写 VPN 的用户名</li>
<li><code>密码</code> : 填写 VPN 用户密码</li>
<li><code>密钥</code> : 填写协议配置界面中配置的 <code>IPsec Pre-shared Key</code> 对应的值，本文档中为<code>vpn</code></li>
</ul>
<h1 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h1><h2 id="VPN-Client-可以连接到-VPN-Server，但是-client-的出口-IP-未变"><a href="#VPN-Client-可以连接到-VPN-Server，但是-client-的出口-IP-未变" class="headerlink" title="VPN Client 可以连接到 VPN Server，但是 client 的出口 IP 未变"></a>VPN Client 可以连接到 VPN Server，但是 client 的出口 IP 未变</h2><p><strong>问题现象</strong></p>
<p>windows 使用 VPN Client 可以正常连接到 VPN Server，但是检查客户端系统的出口 IP，不是 VPN Server 的 IP。检查客户端系统的 IP 地址信息</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">ipconfig</span> /all</span><br><span class="line">未知适配器 VPN - VPN Client:</span><br><span class="line"></span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span><br><span class="line">   描述. . . . . . . . . . . . . . . : VPN Client Adapter - VPN</span><br><span class="line">   物理地址. . . . . . . . . . . . . : <span class="number">5</span>E-<span class="number">7</span>F-<span class="number">99</span>-<span class="number">71</span>-<span class="number">74</span>-AF</span><br><span class="line">   DHCP 已启用 . . . . . . . . . . . : 是</span><br><span class="line">   自动配置已启用. . . . . . . . . . : 是</span><br><span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::<span class="number">7674</span>:<span class="number">9039</span>:eaca:<span class="number">5976</span>%<span class="number">52</span>(首选)</span><br><span class="line">   自动配置 IPv4 地址  . . . . . . . : <span class="number">169</span>.<span class="number">254</span>.<span class="number">160</span>.<span class="number">75</span>(首选)</span><br><span class="line">   子网掩码  . . . . . . . . . . . . : <span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span>.<span class="number">0</span></span><br><span class="line">   默认网关. . . . . . . . . . . . . :</span><br><span class="line">   DHCPv6 IAID . . . . . . . . . . . : <span class="number">878608281</span></span><br><span class="line">   DHCPv6 客户端 DUID  . . . . . . . : <span class="number">00</span>-<span class="number">01</span>-<span class="number">00</span>-<span class="number">01</span>-<span class="number">29</span>-<span class="number">5</span>D-CA-<span class="number">62</span>-F4-<span class="number">39</span>-<span class="number">09</span>-<span class="number">4</span>B-<span class="number">1</span>C-<span class="number">6</span>A</span><br><span class="line">   DNS 服务器  . . . . . . . . . . . : fec0:<span class="number">0</span>:<span class="number">0</span>:ffff::<span class="number">1</span>%<span class="number">1</span></span><br><span class="line"><span class="function">                                       fec0:0:0:<span class="title">ffff</span>::2%1</span></span><br><span class="line"><span class="function">                                       <span class="title">fec0</span>:0:0:<span class="title">ffff</span>::3%1</span></span><br><span class="line"><span class="function">   <span class="title">TCPIP</span> 上的 <span class="title">NetBIOS</span>  . . . . . . . : 已启用</span></span><br></pre></td></tr></table></figure>
<p>VPN 适配器的 IP 地址为 <code>169.254.160.75</code>，说明客户端未获取 VPN 相应的 IP 地址。检查 VPN Server 配置的 <code>Virtual NAT and Virtual DHCP Server(SecureNAT)</code> 部分，看是否启用了 <code>SecureNAT</code>。启用后重新连接，查看 Windows 系统 IP 地址，看到已经正常分配到 VPN 的 IP，测试公网，变成了 VPN Server 的 IP。 </p>
<h1 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.softether.org/4-docs/1-manual/3._SoftEther_VPN_Server_Manual/3.2_Operating_Modes">Operating Modes</a><a href="#fnref:1" rev="footnote"> ↩</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.softether.org/4-docs/1-manual/7._Installing_SoftEther_VPN_Server/7.3_Install_on_Linux_and_Initial_Configurations">Install on Linux and Initial Configurations</a><a href="#fnref:2" rev="footnote"> ↩</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.softether.org/4-docs/1-manual/7._Installing_SoftEther_VPN_Server/7.4_Initial_Configurations">Initial Configurations</a><a href="#fnref:3" rev="footnote"> ↩</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.softether.org/4-docs/1-manual/3._SoftEther_VPN_Server_Manual/3.3_VPN_Server_Administration">Listener Ports</a><a href="#fnref:4" rev="footnote"> ↩</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://www.softether.org/4-docs/1-manual/7._Installing_SoftEther_VPN_Server/7.4_Initial_Configurations">Initial Configurations</a><a href="#fnref:5" rev="footnote"> ↩</a></span></li></ol></div></div>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="../tags/VPN/" rel="tag"><i class="fa fa-tag"></i> VPN</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="../202302011153/" rel="prev" title="akamai cdn api 使用">
                  <i class="fa fa-chevron-left"></i> akamai cdn api 使用
                </a>
            </div>
            <div class="post-nav-item">
                <a href="../202302091320/" rel="next" title="Centos7 安装使用 Fiddler">
                  Centos7 安装使用 Fiddler <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">COSMOS</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.3" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="../js/comments.js"></script><script src="../js/utils.js"></script><script src="../js/motion.js"></script><script src="../js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="../js/third-party/search/local-search.js"></script>




  <script src="../js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"fl9999","repo":"fl9999.github.io","client_id":"a11bf6f7860762b725b5","client_secret":"a99046105f8bddc72ec718d54dc3fd7f22070821","admin_user":"fl9999","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d41d8cd98f00b204e9800998ecf8427e"}</script>
<script src="../js/third-party/comments/gitalk.js"></script>

</body>
</html>
